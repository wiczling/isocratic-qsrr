<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2025-07-16">

<title>Bayesian Multilevel Modeling of Retention Data Informed by Structural Similarity of Analytes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="model-development-050_files/libs/clipboard/clipboard.min.js"></script>
<script src="model-development-050_files/libs/quarto-html/quarto.js"></script>
<script src="model-development-050_files/libs/quarto-html/popper.min.js"></script>
<script src="model-development-050_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="model-development-050_files/libs/quarto-html/anchor.min.js"></script>
<link href="model-development-050_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="model-development-050_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model-development-050_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model-development-050_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model-development-050_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introductions" id="toc-introductions" class="nav-link active" data-scroll-target="#introductions">Introductions</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#prepare-data" id="toc-prepare-data" class="nav-link" data-scroll-target="#prepare-data">Prepare data</a></li>
  <li><a href="#initial-estimates" id="toc-initial-estimates" class="nav-link" data-scroll-target="#initial-estimates">Initial estimates</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory data analysis</a></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data analysis</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#priors" id="toc-priors" class="nav-link" data-scroll-target="#priors">Priors</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#genereted-quantitites" id="toc-genereted-quantitites" class="nav-link" data-scroll-target="#genereted-quantitites">Genereted quantitites</a></li>
  </ul></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  <li><a href="#summary-of-functional-groups-effects-figures" id="toc-summary-of-functional-groups-effects-figures" class="nav-link" data-scroll-target="#summary-of-functional-groups-effects-figures">Summary of functional groups effects (figures)</a></li>
  <li><a href="#fits" id="toc-fits" class="nav-link" data-scroll-target="#fits">Fits</a></li>
  <li><a href="#individual-parameters-and-etaplots" id="toc-individual-parameters-and-etaplots" class="nav-link" data-scroll-target="#individual-parameters-and-etaplots">Individual Parameters and etaplots</a>
  <ul class="collapse">
  <li><a href="#individual-parameters" id="toc-individual-parameters" class="nav-link" data-scroll-target="#individual-parameters">Individual parameters</a></li>
  <li><a href="#etas" id="toc-etas" class="nav-link" data-scroll-target="#etas">Etas</a></li>
  <li><a href="#effect-of-functional-groups-screening" id="toc-effect-of-functional-groups-screening" class="nav-link" data-scroll-target="#effect-of-functional-groups-screening">Effect of functional groups (screening)</a></li>
  </ul></li>
  <li><a href="#posterior-correlations" id="toc-posterior-correlations" class="nav-link" data-scroll-target="#posterior-correlations">Posterior correlations</a></li>
  <li><a href="#effect-of-similairty" id="toc-effect-of-similairty" class="nav-link" data-scroll-target="#effect-of-similairty">Effect of similairty</a>
  <ul class="collapse">
  <li><a href="#fitting-the-model-1" id="toc-fitting-the-model-1" class="nav-link" data-scroll-target="#fitting-the-model-1">Fitting the model</a></li>
  <li><a href="#genereted-quantitites-1" id="toc-genereted-quantitites-1" class="nav-link" data-scroll-target="#genereted-quantitites-1">Genereted quantitites</a></li>
  <li><a href="#summary-of-model-parameters-table-1" id="toc-summary-of-model-parameters-table-1" class="nav-link" data-scroll-target="#summary-of-model-parameters-table-1">Summary of model parameters (table):</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#licenses" id="toc-licenses" class="nav-link" data-scroll-target="#licenses">Licenses</a></li>
  <li><a href="#original-computing-environment" id="toc-original-computing-environment" class="nav-link" data-scroll-target="#original-computing-environment">Original Computing Environment</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Bayesian Multilevel Modeling of Retention Data Informed by Structural Similarity of Analytes</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introductions" class="level1">
<h1>Introductions</h1>
<p>This work focuses on multilevel modeling of isocratic HPLC retention data<span class="citation" data-cites="kamedulska_toward_2022"><sup><a href="#ref-kamedulska_toward_2022" role="doc-biblioref">1</a>,</sup></span> <span class="citation" data-cites="kamedulska_statistical_2022"><sup><a href="#ref-kamedulska_statistical_2022" role="doc-biblioref">2</a>,</sup></span><span class="citation" data-cites="wiczling_application_2021"><sup><a href="#ref-wiczling_application_2021" role="doc-biblioref">3</a>,</sup></span> <span class="citation" data-cites="kubik_analysis_2018"><sup><a href="#ref-kubik_analysis_2018" role="doc-biblioref">4</a></sup></span>, incorporating structural similarity between analytes. Structural similarity (such as Taniomoto similairty metric) can be easily calculated from SMILES representations and help predicting analyte retention if experimental data of structurally similar analytes is available.</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggplot2))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(patchwork))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(gridExtra))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(naniar))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(knitr))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(data.table))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(glue))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(whisker))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(here))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(cmdstanr))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(posterior))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(bayesplot))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(tidybayes))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(reshape2))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(pracma))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(mrgmisc))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(GGally))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(igraph))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggraph))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggcorrplot))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("metrumresearchgroup/mrgmisc")</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/GUMed/.cmdstan/cmdstan-2.36.0"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10271998</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>select<span class="ot">&lt;-</span>dplyr<span class="sc">::</span>select</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"helper-functions.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/settings_a69b9021d5cf8efb539b35a43cc9690a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>model_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>,<span class="st">"stan"</span>)  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>tables_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir, <span class="at">recursive =</span> T)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir, <span class="at">recursive =</span> T)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_dir)) <span class="fu">dir.create</span>(tables_dir, <span class="at">recursive =</span> T)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>data_deliv_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"deliv"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>data_derived_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"derived"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_deliv_dir)) <span class="fu">dir.create</span>(data_deliv_dir, <span class="at">recursive =</span> T)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_derived_dir)) <span class="fu">dir.create</span>(data_derived_dir, <span class="at">recursive =</span> T)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>figures_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>tables_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_eda_dir)) <span class="fu">dir.create</span>(figures_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_eda_dir)) <span class="fu">dir.create</span>(tables_eda_dir, <span class="at">recursive =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35°C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient<span class="citation" data-cites="BOSWELL20116732"><sup><a href="#ref-BOSWELL20116742" role="doc-biblioref">6</a></sup></span>.</p>
<p>The 2D structures of analytes, Tanimoto similarity matrix, log P and the number of functional groups were calculated using RDkit toolkit<span class="citation" data-cites="greg_landrum_2025_15773589"><sup><a href="#ref-greg_landrum_2025_15773589" role="doc-biblioref">7</a></sup></span>:</p>
<p><a href="functional-groups-rdkit.html" title="rdkit">RDKit-based predcitors</a></p>
<p><a href="print-analytes-structures.html" title="Structures">2D-structures</a></p>
<p>The Tanimoto coefficient is a common metric used to assess the structural similarity between molecules in cheminformatics. It quantifies the overlap of structural features, represented as binary fingerprints, between two molecules, with a higher coefficient indicating greater similarity (0 indicates no similarity and 1 indicates identical structures).</p>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell" data-hash="model-development-050_cache/html/load-data_382860beb7e10a1ecaff3673863e3e91">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir, <span class="st">"database_logk_1026.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"database_logk_1026_analyte_names.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>analytes_names<span class="sc">$</span>Analyte <span class="ot">&lt;-</span> <span class="fu">iconv</span>(analytes_names<span class="sc">$</span>Analyte, <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">"byte"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"smiles1026.smi"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>smiles<span class="ot">&lt;-</span>smiles <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ID=</span>V2,<span class="at">smiles=</span>V1) <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID,smiles)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">905</span>] <span class="ot">=</span> <span class="st">"CN(C1CCCCC1N1CCCC1)C(=O)Cc1ccc(c(c1)Cl)Cl"</span> <span class="co"># remove tartrate moiety </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">425</span>] <span class="ot">=</span> <span class="st">"CC(Cc1ccc(cc1)OCC(=O)O)NCC(c1cccc(c1)Cl)O"</span> <span class="co"># remove Na+ and dissociation</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">501</span>] <span class="ot">=</span> <span class="st">"c1ccc(cc1)C1(c2ccccc2)C(=O)NC(=N1)O"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">401</span>]<span class="ot">=</span> <span class="st">"CC(C)(C)c1c(CC(C(=O)[OH])[NH2])c(=O)[nH]o1"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">686</span>] <span class="ot">=</span> <span class="st">"CCCCCCCCCCCCCCCC(=O)OC(CC(=O)[OH])C[N+](C)(C)C"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">901</span>] <span class="ot">=</span> <span class="st">"CCOC(=Nc1c[n+](no1)N1CCOCC1)[OH]"</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>fg_df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>descriptor_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"descriptor_df.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"similarity_ltri_rcdk.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>similarity_matrix <span class="ot">&lt;-</span> <span class="fu">make_similarity_matrix_fun</span>(similarity_ltri_rcdk_df)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># names of dissociated groups at low pH</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>dissociated_groups <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Anions</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sulfonic_acid"</span>, <span class="st">"Sulfinic_acid"</span>, <span class="st">"Sulfenic_acid"</span>, <span class="st">"Sulfuric_acid"</span>, <span class="st">"Sulfuric_monoester"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonic_acid"</span>, <span class="st">"Phosphoric_acid"</span>, <span class="st">"Phosphoric_monoester"</span>, <span class="st">"Phosphinic_acid"</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonous_acid"</span>, <span class="st">"Phosphinous_acid"</span>, <span class="st">"Carbothioic_acid"</span>, <span class="st">"Carbodithioic_acid"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cations</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Primary_aliph_amine"</span>, <span class="st">"Secondary_aliph_amine"</span>, <span class="st">"Tertiary_aliph_amine"</span>, </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Quaternary_aliph_ammonium"</span>, <span class="st">"Primary_arom_amine"</span>, <span class="st">"Secondary_arom_amine"</span>, </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_arom_amine"</span>, <span class="st">"Quaternary_arom_ammonium"</span>, <span class="st">"Secondary_mixed_amine"</span>, </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_mixed_amine"</span>, <span class="st">"Quaternary_mixed_ammonium"</span>, <span class="st">"Oxonium"</span>, </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Immonium"</span>, <span class="st">"Sulfonium"</span>, <span class="st">"Phosphonium"</span>, <span class="st">"Hetero_N_basic_H"</span>, <span class="st">"Hetero_N_basic_no_H"</span>, <span class="st">"Amidine"</span>, <span class="st">"Guanidine"</span>, <span class="st">"Hydrazine"</span>, <span class="st">"Hydroxylamine"</span>, </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diazonium"</span>, <span class="st">"N-Oxide"</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data">Prepare data</h2>
<div class="cell" data-hash="model-development-050_cache/html/prepare-data_5ae5a30332b2c2a4af4d2c3efcfef559">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(analytes_names) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> fg_df <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.) <span class="sc">||</span> <span class="sc">!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(id1,id2, SMILES, Anion, Kation, Ammonium))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> <span class="fu">colnames</span>(functional_groups)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="initial-estimates" class="level2">
<h2 class="anchored" data-anchor-id="initial-estimates">Initial estimates</h2>
<div class="cell" data-hash="model-development-050_cache/html/initial-estimates_a19cef8da3208fb8b2e86b3d8c7af575">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">S1 =</span> <span class="fu">if_else</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">1</span>,<span class="sc">-</span><span class="dv">16</span>,<span class="fu">polyfit</span>(fi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> fi), logk, <span class="dv">1</span>)[<span class="dv">1</span>]),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">logkw =</span> <span class="fu">if_else</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span> <span class="sc">*</span> fi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> fi), logk, <span class="dv">0</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">polyfit</span>(fi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> fi), logk, <span class="dv">1</span>)[<span class="dv">2</span>]),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2 =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(logkw, S2, S1) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">S1 =</span> <span class="sc">-</span>S1 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory data analysis</h1>
<p>A series of plots to better understand our data can be found here:</p>
<p><a href="eda.html" title="EDA">Exploratory Plots</a></p>
</section>
<section id="data-analysis" class="level1">
<h1>Data analysis</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The logarythm of retention factor (<span class="math inline">\(\small lok_{i,j}\)</span>) was modeled using the Neue model<span class="citation" data-cites="nikitas_20091737"><sup><a href="#ref-nikitas_20091737" role="doc-biblioref">8</a></sup></span>:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk_{i,j}=logkw_{i} - S_{1,i} \cdot (1 + S_{2}) \cdot \varphi_{i,j} / (1 + S_{2} \cdot \varphi_{i,j})
\end{aligned}
\]</span> where <span class="math inline">\(\small j\)</span> denotes observation, <span class="math inline">\(\small i\)</span> denote analyte, <span class="math inline">\(\small logkw_{i}\)</span> represents logarithm of retention factors extrapolated to 0% of organic modifier content <span class="math inline">\(\small S_{1,i}\)</span> and <span class="math inline">\(\small S2\)</span> are the slopes in the Neue equation. In this parametrization of the Neue equation, <span class="math inline">\(\small S1\)</span> reflects the difference between logarithm of retention factors corresponding to water (0% of organic modifier content) and 100% of organic modifier content as eluents.</p>
<p>The statistical model has the following hierarchical structure:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \log k_{obs_{i,j}} \sim student_t(\nu_{obs},logk_{i,j},\sigma) \\
&amp; R_{i} \sim \text{MN}(\theta_R  + \beta \cdot log P_i +\pi_{R1} \cdot X_{1i}  +\pi_{R2} \cdot X_{2i}, K, \Omega) \\
&amp; \pi_{R1,k} \sim N(0,\kappa_{R1}) \\
&amp; \pi_{R2,k} \sim N(0,\kappa_{R2})
\end{aligned}
\]</span> where <span class="math inline">\(\small R_i=(logkw_{i}, S_{1,i})\)</span> is a vector of analyte-specific parameters, <span class="math inline">\(\small logk_{i,j}\)</span> corresponds to the above Neue equation, <span class="math inline">\(\small MN\)</span> is a matrix normal distribution, <span class="math inline">\(\small \theta_R\)</span> is a vector of typical values of <span class="math inline">\(\small R_i\)</span>, <span class="math inline">\(\small \beta_R\)</span> is a vector of slopes between <span class="math inline">\(\small R_i\)</span> and <span class="math inline">\(\small logP_i\)</span>, <span class="math inline">\(\small \pi_{R,1}\)</span> and <span class="math inline">\(\small \pi_{R,2}\)</span> is a vector of slopes between <span class="math inline">\(\small R_i\)</span> and functional groups: non-dissociated forms <span class="math inline">\(\small X_{1i}\)</span> and dissociated forms <span class="math inline">\(\small X_{2i}\)</span>. In turn, <span class="math inline">\(\small \nu_{obs}\)</span> and <span class="math inline">\(\small \sigma\)</span> is the normality parameters and scale of the residuals, <span class="math inline">\(\small K\)</span> and <span class="math inline">\(\small \Omega\)</span> are the scale matrices for the row and column covariance structures. <span class="math inline">\(\small \Omega\)</span> and <span class="math inline">\(\small K\)</span> were decomposed to:</p>
<p><span class="math display">\[
\begin{aligned}
\Omega_1 = diag(\omega) \cdot LL' \cdot diag(\omega) \\
K = 2*\alpha* (S-0.5)+ (1-\alpha)*I \\
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\small LL'\)</span> denotes correlation a correlation matrix, <span class="math inline">\(\small \omega\)</span> denotes standard deviation for between analyte variability, S is a similarity matrix and I is an Identify matrix. In this work the similarity matrix was simplified assuming S=0 for <span class="math inline">\(\small S&lt;0.5\)</span> (analytes are essentially uncorrelated) and the values of S for <span class="math inline">\(\small S \geq 0.5\)</span> were scaled by alpha using the above equation.</p>
<p>A matrix normal distribution models random matrices, with parameters including a mean matrix and two covariance matrices, one for rows (analytes) and one for columns (<span class="math inline">\(\small logkw\)</span> and <span class="math inline">\(\small S\)</span> parameters). These covariance matrices, denoted here as <span class="math inline">\(\small K\)</span> and <span class="math inline">\(\Omega\)</span>, capture the dependencies between rows and columns of the random matrix, respectively. The row covariance can be naturally related to similarity matrix approximating its structure.</p>
</section>
<section id="priors" class="level2">
<h2 class="anchored" data-anchor-id="priors">Priors</h2>
<p>The priors were specified as follows:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \theta_{logkw} \sim normal(2, 4), \\
&amp; \theta_{S1} \sim normal(4, 2), \\
&amp; \theta_{S2} \sim lognormal(0.693, 0.125), \\
&amp; \nu_{obs} = 7,\\
&amp; \omega_{logkw},\omega_{S1} \sim normal_+(0, 1), \\
&amp; \beta_{logkw} \sim  normal(0.7, 0.125), \\
&amp; \beta_{S1} \sim  normal(0.5, 0.125), \\
&amp; \kappa_{logkw},\kappa_{S1} \sim  normal(0, 0.1), \\
&amp; \sigma \sim normal_+(0,0.05), \\
&amp; \alpha \sim normal(0.5,0.25)T[0,1], \\
&amp; p(LL') \propto LKJ(2) \cdot \Pi_u N(c_u, 0.125), \\
&amp; c_u = [0.75]
\end{aligned}
\]</span></p>
<p>LKJ(2) ensure that the density is uniform over correlation matrices of order 2 and u denotes the unique lower triangular elements of correlation matrix (<a href="http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/" class="uri">http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/</a>)</p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell" data-hash="model-development-050_cache/html/stan-setup_8e3de90d0dfdf2362703866c9b39df1f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set: data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">=</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>idx_diss <span class="ot">=</span> <span class="fu">which</span>(functional_groups_names <span class="sc">%in%</span> dissociated_groups)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>idx_nondiss <span class="ot">=</span> <span class="fu">which</span>(functional_groups_names <span class="sc">%notin%</span> dissociated_groups)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">nearPD</span>(similarity_matrix, <span class="at">corr =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>mat)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_subset<span class="ot">&lt;-</span><span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(similarity<span class="sc">&gt;=</span><span class="fl">0.5</span>, row<span class="sc">!=</span>col)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>uid <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(similarity_ltri_rcdk_subset<span class="sc">$</span>row,similarity_ltri_rcdk_subset<span class="sc">$</span>col))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> uid,<span class="at">label =</span> <span class="fu">paste</span>(uid))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">from =</span> similarity_ltri_rcdk_subset<span class="sc">$</span>row,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">to =</span> similarity_ltri_rcdk_subset<span class="sc">$</span>col, </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width =</span> similarity_ltri_rcdk_subset<span class="sc">$</span>similarity,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">round</span>(similarity_ltri_rcdk_subset<span class="sc">$</span>similarity,<span class="dv">2</span>)))</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> edges, <span class="at">vertices =</span> nodes, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>nodes<span class="sc">$</span>group <span class="ot">=</span> <span class="fu">cluster_louvain</span>(g)<span class="sc">$</span>membership</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> nodes <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(id)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>idx_corelatted <span class="ot">=</span> <span class="fu">unique</span>(nodes<span class="sc">$</span>id)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>idx_uncorelatted <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(similarity_ltri_rcdk_df<span class="sc">$</span>row), idx_corelatted)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>group <span class="ot">=</span> nodes<span class="sc">$</span>group</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> nodes</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  group_sizes <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(group, <span class="at">name =</span> <span class="st">"size"</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(group_sizes<span class="sc">$</span>size <span class="sc">&gt;=</span> <span class="dv">45</span>)) <span class="cf">break</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  smallest <span class="ot">&lt;-</span> group_sizes <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(size) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  from <span class="ot">&lt;-</span> smallest<span class="sc">$</span>group[<span class="dv">2</span>]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  to <span class="ot">&lt;-</span> smallest<span class="sc">$</span>group[<span class="dv">1</span>]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>group[df<span class="sc">$</span>group <span class="sc">==</span> from] <span class="ot">&lt;-</span> to</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>nodes<span class="sc">$</span>group_combined <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(df<span class="sc">$</span>group))</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected[similarity_matrix_corrected<span class="sc">&lt;</span><span class="fl">0.5</span>]<span class="ot">=</span><span class="fl">0.5</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">nearPD</span>(similarity_matrix_corrected, <span class="at">corr =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>mat)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>sim_mat_masked <span class="ot">&lt;-</span>similarity_matrix_corrected</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_corr=</span><span class="fu">length</span>(idx_corelatted),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_uncorr=</span><span class="fu">length</span>(idx_uncorelatted),</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_corr =</span> idx_corelatted,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_uncorr =</span> idx_uncorelatted,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nfg_diss =</span> <span class="fu">length</span>(idx_diss),</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nfg_nondiss =</span> <span class="fu">length</span>(idx_nondiss),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_diss =</span> idx_diss,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_nondiss =</span> idx_nondiss,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>descriptor_df<span class="sc">$</span>LogP,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">similarity_x =</span> sim_mat_masked,</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> nodes<span class="sc">$</span>group_combined,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mGroup =</span> <span class="fu">length</span>(<span class="fu">unique</span>(nodes<span class="sc">$</span>group_combined)),</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>          <span class="at">param_corr =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw[idx_corelatted],init_aprox<span class="sc">$</span>S1[idx_corelatted]),</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">param_uncorr =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw[idx_uncorelatted],init_aprox<span class="sc">$</span>S1[idx_uncorelatted]),</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fu">max</span>(<span class="fl">0.1</span>,<span class="fu">min</span>(<span class="fl">0.95</span>,<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.25</span>))),</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<div class="cell" data-hash="model-development-050_cache/html/mod-settings_09e06b63d1dd13e3ff4855a07e437394">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod50"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="optimization" class="level4">
<h4 class="anchored" data-anchor-id="optimization">Optimization</h4>
<p>I’ve compiled the model using cmdstanr and used optimization for initial testing of the code.</p>
<div class="cell" data-hash="model-development-050_cache/html/stan-compile_ab92749310dfa8dde2c2267319177e4d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod50 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/stan-optimize_9045e13295b7088cc8881b410f1fb643">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod50<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="st">"mod50-opt"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">3000</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/plots-optimize_76baf9da5188bbd30eb46668ac338514">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-opt-1.csv"</span>)))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  variable estimate
 logkwHat      4.26
 S1Hat         4.99
 dlogkwHat    -0.35
 dS1Hat        0.26
 beta[1]       1.03
 beta[2]       0.78
 S2Hat         2.90
 omega[1]      1.59
 omega[2]      1.34
 rho[1,2]      0.89
 sigma         0.03
 alpha         0.75
 sdpi[1]       0.01

 # showing 13 of 16 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID),<span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/plots-optimize-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="local-sampling-not-used" class="level4">
<h4 class="anchored" data-anchor-id="local-sampling-not-used">Local sampling (not used)</h4>
<div class="cell" data-hash="model-development-050_cache/html/stan-sample_aa5cb42e8315bccef2a7a445bc8a0a89">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod50<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="st">"mod50-loc"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tryton" class="level4">
<h4 class="anchored" data-anchor-id="tryton">Tryton</h4>
<p>Computations were carried out at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>.</p>
<ol type="1">
<li>dump the necessary data to .json format</li>
</ol>
<div class="cell" data-hash="model-development-050_cache/html/dump-files_cca738de5341925f886e8d009fe5fcb5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>run the model using the batch file:</li>
</ol>
<pre> 
#!/bin/bash -l

#SBATCH --job-name=cmdstan_conda
#SBATCH -N 1
#SBATCH -n 8
#SBATCH -p batch
#SBATCH --time=12:00:00
#SBATCH --mem=2gb 

# load
module load trytonp/cmdstan/2.34.1

export STAN_THREADS=false

# model name
export CMDSTAN_MODEL_NAME="mod50cv"

# paths
export MODEL_SRC_DIR="/users/project1/pt01268/izo50cv"
cd ${CMDSTAN_DIR}

# build/compile
[ -f ${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} ] &amp;&amp; echo "Model " ${CMDSTAN_MODEL_NAME} " exists." || make STANCFLAGS=--O1 ${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME}

wait

cd ${MODEL_SRC_DIR}

${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-1.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-1.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-2.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-2.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-3.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-3.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-4.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-4.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-5.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-5.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-6.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-6.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-7.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-7.csv &amp;
${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-8.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-8.csv &amp;
wait
</pre>
<ol start="3" type="1">
<li>loaded the output files using cmdstanr::as_cmdstan_fit:</li>
</ol>
<div class="cell" data-hash="model-development-050_cache/html/stan-load_b4df5a7cace987c9e20b1eceb52a1e37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>check the diagnostics of samples based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell" data-hash="model-development-050_cache/html/stan-diagnose_d148f4982a678bd086217e1bcbcd6373">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(mod_output_dir)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod50-1.csv mod50-2.csv mod50-3.csv mod50-4.csv mod50-5.csv mod50-6.csv mod50-7.csv mod50-8.csv'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Output is copied here to save time.</p>
<pre> [1] "Checking sampler transitions treedepth."        
 [2] "Treedepth satisfactory for all transitions."      
 [4] "Checking sampler transitions for divergences."  
 [5] "No divergent transitions found."  [7] "Checking E-BFMI - sampler transitions HMC potential energy."
 [8] "E-BFMI satisfactory."                       
[10] "Rank-normalized split effective sample size satisfactory for all parameters."
[12] "The following parameters had rank-normalized split R-hat greater than 1.01:" 
[13] "  S2Hat, param_corr[252,1], param_corr[328,1], param_corr[405,1], param_corr[530,1], param_corr[328,2], param_corr[405,2], param_uncorr[14,1], logkx[621], logkx[622], logkx[2346], logkx[2347], logkx[2864], logkx[3365], logkx[3366], logkx[4237], logkx[4238], param[95,1], param[394,1], param[510,1], param[626,1], param[832,1], param[510,2], param[626,2], lprior"
[14] "Such high values indicate incomplete mixing and biased estimation."  
[15] "You should consider regularizating your model with additional prior information or a more effective parameterization."
</pre>
</section>
</section>
<section id="genereted-quantitites" class="level3">
<h3 class="anchored" data-anchor-id="genereted-quantitites">Genereted quantitites</h3>
<p>Most of the quantities of interest were generated using generate_quantities method from a fitted model without re-running the sampler.</p>
<div class="cell" data-hash="model-development-050_cache/html/generete-quntities_c55afd1f8c84710ca8a4c06864e4d6d8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod50gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fitgq  <span class="ot">&lt;-</span> mod50gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="load-results" class="level4">
<h4 class="anchored" data-anchor-id="load-results">Load Results</h4>
<div class="cell" data-hash="model-development-050_cache/html/eta-load_1ade538c639a8b71426cf09b773e3155">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#draws_gen_df &lt;- as_draws_df(fitgq$draws())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="summary-of-model-parameters-table" class="level1">
<h1>Summary of model parameters (table):</h1>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell" data-hash="model-development-050_cache/html/summary_d384ddd14478a7147e8de45914f65324">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  variable  mean median   sd  mad    q5   q95 rhat ess_bulk ess_tail
 logkwHat   3.05   3.05 0.19 0.19  2.74  3.36 1.00     2926     3497
 S1Hat      3.67   3.67 0.16 0.16  3.40  3.94 1.00     2598     3029
 dlogkwHat -0.35  -0.35 0.12 0.12 -0.55 -0.15 1.00     4163     3537
 dS1Hat     0.30   0.30 0.09 0.09  0.16  0.45 1.00     3403     3506
 beta[1]    0.86   0.86 0.05 0.06  0.77  0.95 1.00     3235     3620
 beta[2]    0.62   0.62 0.05 0.05  0.54  0.70 1.00     3131     3035
 S2Hat      2.90   2.90 0.03 0.03  2.85  2.95 1.02      430      935
 omega[1]   1.41   1.41 0.04 0.04  1.35  1.47 1.00     2650     2471
 omega[2]   1.13   1.13 0.03 0.03  1.08  1.18 1.00     2317     3017
 rho[1,2]   0.88   0.88 0.01 0.01  0.87  0.90 1.00     1933     2928
 sigma      0.05   0.05 0.00 0.00  0.05  0.05 1.00     1880     2927
 alpha      0.71   0.71 0.04 0.04  0.64  0.77 1.00     5245     3475
 sdpi[1]    0.15   0.14 0.02 0.02  0.11  0.18 1.01      655     1162
 sdpi[2]    0.13   0.13 0.02 0.02  0.10  0.17 1.01      641     1372
 sdpi[3]    0.34   0.33 0.06 0.06  0.23  0.44 1.00     2816     3270

 # showing 15 of 16 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="trace-plots" class="level1">
<h1>Trace plots</h1>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell" data-hash="model-development-050_cache/html/trace-plots_050ae17e43e0b1149bd08fc1e1781c07">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level1">
<h1>Summary of model parameters (figures)</h1>
<div class="cell" data-hash="model-development-050_cache/html/mcmc-intervals_9a0120a747785cb2561c0e69e13373f0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>, <span class="st">"alpha"</span>)))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-functional-groups-effects-figures" class="level1">
<h1>Summary of functional groups effects (figures)</h1>
<div class="cell" data-hash="model-development-050_cache/html/functinoal-group-effects_f3fb4cc021c911358543078281d10526">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>idx1 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>idx2 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>p_common <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)<span class="sc">+</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>p_uncommon <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param) <span class="sc">+</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>p_uncommon <span class="sc">+</span> p_common</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/functinoal-group-effects-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="fits" class="level1">
<h1>Fits</h1>
<div class="cell" data-hash="model-development-050_cache/html/ind-pop-gof-plots_619c07ee0c104dff90e90d319865c698">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-gof-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="model-development-050_cache/html/ind-predictions_572c46a193b4a94e9842cdb27d9aedfe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="model-development-050_cache/html/pop-predictions_c007de858e41e8c418eeeb1da4aa04c3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/pop-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="model-development-050_cache/html/pop-predictions-vpc_6a15e18985d1c10cb99c01d30ec8452e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi))<span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draw=</span>.draw)<span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(draw, fi)<span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mlogk =</span> <span class="fu">mean</span>(logk),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">llogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">ulogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fi)<span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mmlogk =</span> <span class="fu">mean</span>(mlogk),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">mllogk =</span> <span class="fu">quantile</span>(llogk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">mulogk =</span> <span class="fu">quantile</span>(ulogk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mmlogk))<span class="sc">+</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mllogk))<span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mulogk))<span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/pop-predictions-vpc-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-and-etaplots" class="level1">
<h1>Individual Parameters and etaplots</h1>
<p>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</p>
<section id="individual-parameters" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters">Individual parameters</h2>
<div class="cell" data-hash="model-development-050_cache/html/iparam_e1a7113dc809b17305d71c410faf9b32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sparam_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2, param1<span class="sc">-</span>param2, datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logka'</span>[i]), <span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/iparam-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="etas" class="level2">
<h2 class="anchored" data-anchor-id="etas">Etas</h2>
<div class="cell" data-hash="model-development-050_cache/html/ieta_c4c38aba05deedf67a488eab12657581">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,param1<span class="sc">-</span>param2,datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etalogka'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ieta-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="effect-of-functional-groups-screening" class="level2">
<h2 class="anchored" data-anchor-id="effect-of-functional-groups-screening">Effect of functional groups (screening)</h2>
<div class="cell" data-hash="model-development-050_cache/html/effect-fg-screening_56eba011601dfdc1ffcb7735a484774e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>valid_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">map</span>(valid_indices, <span class="cf">function</span>(i) {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract functional group as a factor</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  nrgroups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(functional_groups[, i])</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for plotting</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">param1 =</span> param1,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">param2 =</span> param2,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">param3=</span> param1<span class="sc">-</span>param2,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrgroups =</span> nrgroups</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="sc">%&gt;%</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(param1, param2, param3), </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"name"</span>, </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">etaname =</span> <span class="fu">recode</span>(name, </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param1 =</span> <span class="st">"etalogkw"</span>, </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param2 =</span> <span class="st">"etaS"</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param3 =</span> <span class="st">"etalogka"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> nrgroups)) <span class="sc">+</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>etaname) <span class="sc">+</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> functional_groups_names[i], </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Nr of functional groups"</span>, </span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"eta"</span>)<span class="sc">+</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>plot_groups <span class="ot">&lt;-</span> <span class="fu">split</span>(plots, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(plots) <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each group of up to four plots</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(plot_groups, <span class="cf">function</span>(group) {</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(group, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-8.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-9.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-10.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-11.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-12.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-13.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-14.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-15.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-16.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-17.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-18.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/effect-fg-screening-19.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
<section id="posterior-correlations" class="level1">
<h1>Posterior correlations</h1>
<div class="cell" data-hash="model-development-050_cache/html/posterior-corelations_00c5486f1ab7bdc0c6550ab47d79c3df">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_subset<span class="ot">&lt;-</span> <span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(row<span class="sc">!=</span>col)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>etas <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>etas_subset <span class="ot">&lt;-</span> etas[, <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">d+,1</span><span class="sc">\\</span><span class="st">]"</span>, <span class="fu">names</span>(etas))]</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(etas_subset, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># exclude .draw column</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>etas_decor <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_decorr_ind"</span>))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>etas_decor_subset <span class="ot">&lt;-</span> etas_decor[, <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">d+,1</span><span class="sc">\\</span><span class="st">]"</span>, <span class="fu">names</span>(etas_decor))]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>cor_matrix_decorrelated <span class="ot">&lt;-</span> <span class="fu">cor</span>(etas_decor_subset, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># exclude .draw column</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix_decorrelated) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix_decorrelated) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(similarity_matrix_corrected[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/posterior-corelations-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/posterior-corelations-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix_decorrelated[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/posterior-corelations-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix)<span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(similarity_ltri_rcdk_df) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Correlation"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix_decorrelated)<span class="sc">%&gt;%</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(similarity_ltri_rcdk_df) <span class="sc">%&gt;%</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity)) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># cleaner theme</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Correlation"</span>,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1<span class="sc">+</span>p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/posterior-corelations-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix)<span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected)) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nodes<span class="sc">%&gt;%</span><span class="fu">rename</span>(<span class="at">row=</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_combined =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(group_combined),<span class="dv">0</span>,group_combined))<span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_combined) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups_joined =</span> <span class="fu">case_when</span>( group_combined <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Uncorrelated"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Group 1"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Group 2"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Group 3"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Group 4"</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Group 5"</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Group 6"</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Group 7"</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Group 8"</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Group 9"</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Group 10"</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                                    )) <span class="sc">%&gt;%</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity, <span class="at">color =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># cleaner theme</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">"Correlation"</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>groups_joined)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/posterior-corelations-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix_decorrelated)<span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected)) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nodes<span class="sc">%&gt;%</span><span class="fu">rename</span>(<span class="at">row=</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_combined =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(group_combined),<span class="dv">0</span>,group_combined))<span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_combined) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups_joined =</span> <span class="fu">case_when</span>( group_combined <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Uncorrelated"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Group 1"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Group 2"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Group 3"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Group 4"</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Group 5"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Group 6"</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Group 7"</span>,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Group 8"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Group 9"</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Group 10"</span>,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                                    )) <span class="sc">%&gt;%</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity, <span class="at">color =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># cleaner theme</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Correlation (decorelated)"</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>groups_joined)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/posterior-corelations-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="effect-of-similairty" class="level1">
<h1>Effect of similairty</h1>
<p>Predict retention times for a set of analytes based on their similarity to other analytes and studied descriptors.</p>
<div class="cell" data-hash="model-development-050_cache/html/datastruct-cv_4ed45ae540c45f8ee14ad36962f55d47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">=</span> nodes</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> foo <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(id)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>datastructcv <span class="ot">=</span> datastruct;</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>initcv<span class="ot">=</span>init;</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>idx_analytes_out <span class="ot">=</span> <span class="fu">sort</span>(idx)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>idx_analytes_in <span class="ot">=</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(datastructcv<span class="sc">$</span>analyte),idx_analytes_out)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>datax <span class="ot">&lt;-</span>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="fu">here</span>(<span class="st">"model/stan/mod50cv/standata.json"</span>))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">unique</span>(datax<span class="sc">$</span>analyte) <span class="sc">%notin%</span> <span class="fu">unique</span>(datax<span class="sc">$</span>analyte[datax<span class="sc">$</span>idxcv]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   26   51   53   54   55   72  113  169  174  225  271  299  311  351  371
[16]  384  393  396  403  418  423  479  534  574  604  615  633  721  758  798
[31]  816  818  833  835  860  894  899  917  923  927  932  951  952  969  977
[46]  979  981  982  983  985 1020</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>idx_analytes_out <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">unique</span>(datax<span class="sc">$</span>analyte) <span class="sc">%notin%</span> <span class="fu">unique</span>(datax<span class="sc">$</span>analyte[datax<span class="sc">$</span>idxcv]))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>idx_analytes_in <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">unique</span>(datax<span class="sc">$</span>analyte) <span class="sc">%in%</span> <span class="fu">unique</span>(datax<span class="sc">$</span>analyte[datax<span class="sc">$</span>idxcv]))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>idxcv <span class="ot">=</span>  <span class="fu">which</span>(datastructcv<span class="sc">$</span>analyte <span class="sc">%in%</span> idx_analytes_in)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>nObscv <span class="ot">=</span> <span class="fu">length</span>(idxcv);</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>idxcv <span class="ot">=</span> idxcv;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>nObscv <span class="ot">=</span> nObscv;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fitting-the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="fitting-the-model-1">Fitting the model</h2>
<div class="cell" data-hash="model-development-050_cache/html/mod-settings-cv_6341b5d92c703cbe8adc1c13d67942e2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod50cv"</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/stan-compile-cv_b0f45825e125bc5c489ca6c195d30c7b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mod50cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/dump-files-cv_bc6006c02bb80d476c509220c38e406f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastructcv, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/stan-load-cv_c4fba54fd1d47989483416c447c5e2bf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fitcv <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="genereted-quantitites-1" class="level2">
<h2 class="anchored" data-anchor-id="genereted-quantitites-1">Genereted quantitites</h2>
<div class="cell" data-hash="model-development-050_cache/html/generete-quntities-cv_5edd27416be6a3a51314ebaddadf209e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mod50cvgq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fitcvgq  <span class="ot">&lt;-</span> mod50cvgq<span class="sc">$</span><span class="fu">generate_quantities</span>(fitcv,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastructcv,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="model-development-050_cache/html/eta-load-cv_6bc8481a8b49176a294b5b296264dc58">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-model-parameters-table-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table-1">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell" data-hash="model-development-050_cache/html/summary-cv_3d13743ee42cbdf93010734b67b6fbf8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fitcv<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  variable  mean median   sd  mad    q5   q95 rhat ess_bulk ess_tail
 logkwHat   3.07   3.08 0.19 0.19  2.75  3.39 1.00     2953     3175
 S1Hat      3.72   3.73 0.16 0.16  3.45  3.99 1.00     2975     2929
 dlogkwHat -0.33  -0.33 0.12 0.12 -0.54 -0.13 1.00     3484     3527
 dS1Hat     0.32   0.32 0.09 0.08  0.18  0.46 1.00     2982     2828
 beta[1]    0.86   0.86 0.05 0.05  0.77  0.95 1.00     3498     3155
 beta[2]    0.62   0.62 0.05 0.05  0.55  0.70 1.00     3470     3356
 S2Hat      2.90   2.89 0.04 0.04  2.84  2.96 1.02      376      929
 omega[1]   1.43   1.43 0.04 0.04  1.36  1.49 1.00     2485     3432
 omega[2]   1.14   1.14 0.03 0.03  1.09  1.20 1.00     2120     3273
 rho[1,2]   0.89   0.89 0.01 0.01  0.87  0.90 1.00     2058     2705
 sigma      0.05   0.05 0.00 0.00  0.05  0.05 1.00     1943     2527
 alpha      0.69   0.70 0.04 0.04  0.62  0.76 1.00     3814     3640
 sdpi[1]    0.14   0.14 0.02 0.02  0.11  0.18 1.01      625     1296
 sdpi[2]    0.13   0.13 0.02 0.02  0.10  0.16 1.01      604     1283
 sdpi[3]    0.34   0.33 0.06 0.06  0.24  0.45 1.00     2672     2925

 # showing 15 of 16 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="predictions" class="level2">
<h2 class="anchored" data-anchor-id="predictions">Predictions</h2>
<div class="cell" data-hash="model-development-050_cache/html/ind-pop-predictions-cv_68e51d7f8ab8355f021218dcd03a1bbf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fun_plot_ind_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">.analytes_idx=</span>analytes_idx){</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> .analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkind =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkpop =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkind), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkpop), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> .analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte, <span class="at">ncol=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual and population)"</span>) <span class="sc">+</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p1)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">31</span><span class="sc">:</span><span class="dv">40</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">41</span><span class="sc">:</span><span class="dv">50</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-8.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">31</span><span class="sc">:</span><span class="dv">40</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-9.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">41</span><span class="sc">:</span><span class="dv">50</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-050_files/figure-html/ind-pop-predictions-cv-10.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>The work demonstrates a general framework for integrating molecular similarity into the retention modeling workflow.</p>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-kamedulska_toward_2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">(1) </div><div class="csl-right-inline">Kamedulska, A.; Kubik, Ł.; Jacyna, J.; Struck-Lewicka, W.; Markuszewski, M. J.; Wiczling, P. Toward the General Mechanistic Model of Liquid Chromatographic Retention. <em>Analytical Chemistry</em> <strong>2022</strong>, <em>94</em> (31), 11070–11080. <a href="https://doi.org/10.1021/acs.analchem.2c02034">https://doi.org/10.1021/acs.analchem.2c02034</a>.</div>
</div>
<div id="ref-kamedulska_statistical_2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">(2) </div><div class="csl-right-inline">Kamedulska, A.; Kubik, Ł.; Wiczling, P. Statistical Analysis of Isocratic Chromatographic Data Using Bayesian Modeling. <em>Analytical and Bioanalytical Chemistry</em> <strong>2022</strong>, <em>414</em> (11), 3471–3348. <a href="https://doi.org/10.1007/s00216-022-03968-x">https://doi.org/10.1007/s00216-022-03968-x</a>.</div>
</div>
<div id="ref-wiczling_application_2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">(3) </div><div class="csl-right-inline">Wiczling, P.; Kamedulska, A.; Kubik, Ł. Application of Bayesian Multilevel Modeling in the Quantitative Structure–Retention Relationship Studies of Heterogeneous Compounds. <em>Analytical Chemistry</em> <strong>2021</strong>, <em>93</em> (18), 6961–6971. <a href="https://doi.org/10.1021/acs.analchem.0c05227">https://doi.org/10.1021/acs.analchem.0c05227</a>.</div>
</div>
<div id="ref-kubik_analysis_2018" class="csl-entry" role="listitem">
<div class="csl-left-margin">(4) </div><div class="csl-right-inline">Kubik, Ł.; Kaliszan, R.; Wiczling, P. Analysis of <span>Isocratic</span>-<span>Chromatographic</span>-<span>Retention</span> <span>Data</span> Using <span>Bayesian</span> <span>Multilevel</span> <span>Modeling</span>. <em>Analytical Chemistry</em> <strong>2018</strong>, <em>90</em> (22), 13670–13679. <a href="https://doi.org/10.1021/acs.analchem.8b04033">https://doi.org/10.1021/acs.analchem.8b04033</a>.</div>
</div>
<div id="ref-BOSWELL20116732" class="csl-entry" role="listitem">
<div class="csl-left-margin">(5) </div><div class="csl-right-inline">Boswell, P. G.; Schellenberg, J. R.; Carr, P. W.; Cohen, J. D.; Hegeman, A. D. A Study on Retention <span>“Projection”</span> as a Supplementary Means for Compound Identification by Liquid Chromatography–Mass Spectrometry Capable of Predicting Retention with Different Gradients, Flow Rates, and Instruments. <em>Journal of Chromatography A</em> <strong>2011</strong>, <em>1218</em> (38), 6732–6741. https://doi.org/<a href="https://doi.org/10.1016/j.chroma.2011.07.105">https://doi.org/10.1016/j.chroma.2011.07.105</a>.</div>
</div>
<div id="ref-BOSWELL20116742" class="csl-entry" role="listitem">
<div class="csl-left-margin">(6) </div><div class="csl-right-inline">Boswell, P. G.; Schellenberg, J. R.; Carr, P. W.; Cohen, J. D.; Hegeman, A. D. Easy and Accurate High-Performance Liquid Chromatography Retention Prediction with Different Gradients, Flow Rates, and Instruments by Back-Calculation of Gradient and Flow Rate Profiles. <em>Journal of Chromatography A</em> <strong>2011</strong>, <em>1218</em> (38), 6742–6749. https://doi.org/<a href="https://doi.org/10.1016/j.chroma.2011.07.070">https://doi.org/10.1016/j.chroma.2011.07.070</a>.</div>
</div>
<div id="ref-greg_landrum_2025_15773589" class="csl-entry" role="listitem">
<div class="csl-left-margin">(7) </div><div class="csl-right-inline">Landrum, G.; Tosco, P.; Kelley, B.; Rodriguez, R.; Cosgrove, D.; Vianello, R.; sriniker; Gedeck, P.; Jones, G.; Kawashima, E.; NadineSchneider; Nealschneider, D.; Dalke, A.; Swain, M.; Cole, B.; tadhurst-cdd; Turk, S.; Savelev, A.; Vaucher, A.; Wójcikowski, M.; Take, I.; Walker, R.; Scalfani, V. F.; Faara, H.; Ujihara, K.; Probst, D.; Maeder, N.; Monat, J.; Lehtivarjo, J.; godin, guillaume. Rdkit/Rdkit: 2025_03_4 (Q1 2025) Release, 2025. <a href="https://doi.org/10.5281/zenodo.15773589">https://doi.org/10.5281/zenodo.15773589</a>.</div>
</div>
<div id="ref-nikitas_20091737" class="csl-entry" role="listitem">
<div class="csl-left-margin">(8) </div><div class="csl-right-inline">Nikitas, P.; Pappa-Louisi, A. Retention Models for Isocratic and Gradient Elution in Reversed-Phase Liquid Chromatography. <em>Journal of Chromatography A</em> <strong>2009</strong>, <em>1216</em> (10), 1737–1755. https://doi.org/<a href="https://doi.org/10.1016/j.chroma.2008.09.051">https://doi.org/10.1016/j.chroma.2008.09.051</a>.</div>
</div>
</div>
</section>
<section id="licenses" class="level1 unnumbered">
<h1 class="unnumbered">Licenses</h1>
<ul>
<li>Code &amp; copy; 2025, Paweł Wiczling, licensed under BSD-3.</li>
<li>Text &amp; copy; 2025, Paweł Wiczling, licensed under CC-BY-NC 4.0.</li>
</ul>
</section>
<section id="original-computing-environment" class="level1 unnumbered">
<h1 class="unnumbered">Original Computing Environment</h1>
<div class="cell" data-hash="model-development-050_cache/html/unnamed-chunk-1_7f5af89835877b6c01da78fae65e2608">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19045)

Matrix products: default


locale:
[1] LC_COLLATE=Polish_Poland.utf8  LC_CTYPE=Polish_Poland.utf8   
[3] LC_MONETARY=Polish_Poland.utf8 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.utf8    

time zone: Europe/Warsaw
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggcorrplot_0.1.4.1  ggraph_2.2.1        igraph_2.1.4       
 [4] GGally_2.2.1        mrgmisc_0.2.2       pracma_2.4.4       
 [7] reshape2_1.4.4      tidybayes_3.0.7     bayesplot_1.11.1   
[10] posterior_1.6.0     cmdstanr_0.8.0.9000 here_1.0.1         
[13] whisker_0.4.1       glue_1.7.0          lubridate_1.9.3    
[16] forcats_1.0.0       stringr_1.5.1       purrr_1.0.2        
[19] readr_2.1.5         tidyr_1.3.1         tibble_3.2.1       
[22] tidyverse_2.0.0     data.table_1.15.4   knitr_1.46         
[25] naniar_1.1.0        gridExtra_2.3       patchwork_1.2.0    
[28] ggplot2_3.5.1       dplyr_1.1.4        

loaded via a namespace (and not attached):
 [1] svUnit_1.0.6         tidyselect_1.2.1     viridisLite_0.4.2   
 [4] farver_2.1.2         viridis_0.6.5        fastmap_1.2.0       
 [7] tensorA_0.36.2.1     tweenr_2.0.3         digest_0.6.35       
[10] timechange_0.3.0     lifecycle_1.0.4      processx_3.8.4      
[13] magrittr_2.0.3       compiler_4.3.1       rlang_1.1.3         
[16] tools_4.3.1          utf8_1.2.4           yaml_2.3.8          
[19] labeling_0.4.3       graphlayouts_1.2.2   htmlwidgets_1.6.4   
[22] plyr_1.8.9           RColorBrewer_1.1-3   abind_1.4-8         
[25] withr_3.0.2          grid_4.3.1           polyclip_1.10-7     
[28] fansi_1.0.6          colorspace_2.1-0     scales_1.3.0        
[31] MASS_7.3-60          cli_3.6.2            rmarkdown_2.27      
[34] ragg_1.3.2           generics_0.1.3       rstudioapi_0.16.0   
[37] tzdb_0.4.0           cachem_1.1.0         ggforce_0.4.2       
[40] matrixStats_1.3.0    vctrs_0.6.5          Matrix_1.6-5        
[43] jsonlite_1.8.8       hms_1.1.3            arrayhelpers_1.1-0  
[46] visdat_0.6.0         ggrepel_0.9.6        systemfonts_1.1.0   
[49] ggdist_3.3.2         codetools_0.2-19     ggstats_0.8.0       
[52] ps_1.7.6             distributional_0.4.0 stringi_1.8.4       
[55] gtable_0.3.5         munsell_0.5.1        pillar_1.9.0        
[58] htmltools_0.5.8.1    R6_2.5.1             textshaping_0.4.0   
[61] tidygraph_1.3.1      rprojroot_2.0.4      evaluate_1.0.3      
[64] lattice_0.21-8       backports_1.5.0      memoise_2.0.1       
[67] Rcpp_1.0.12          coda_0.19-4.1        checkmate_2.3.1     
[70] xfun_0.44            pkgconfig_2.0.3     </code></pre>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bayesian Multilevel Modeling of Retention Data Informed by Structural Similarity of Analytes"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> analytical-chemistry.csl</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introductions</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>This work focuses on multilevel modeling of isocratic HPLC retention data <span class="co">[</span><span class="ot">@kamedulska_toward_2022,</span><span class="co">] [@kamedulska_statistical_2022,]</span> <span class="co">[</span><span class="ot">@wiczling_application_2021,</span><span class="co">] [@kubik_analysis_2018]</span>, incorporating structural similarity between analytes. Structural similarity (such as Taniomoto similairty metric) can be easily calculated from SMILES representations and help predicting analyte retention if experimental data of structurally similar analytes is available.</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggplot2))</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(patchwork))</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(gridExtra))</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(naniar))</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(knitr))</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(data.table))</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(glue))</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(whisker))</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(here))</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(cmdstanr))</span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(posterior))</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(bayesplot))</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(tidybayes))</span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(reshape2))</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(pracma))</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(mrgmisc))</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(GGally))</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(igraph))</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggraph))</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggcorrplot))</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("metrumresearchgroup/mrgmisc")</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/GUMed/.cmdstan/cmdstan-2.36.0"</span>)</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10271998</span>)</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a>select<span class="ot">&lt;-</span>dplyr<span class="sc">::</span>select</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"helper-functions.R"</span>)</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r settings}</span></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a>model_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>,<span class="st">"stan"</span>)  </span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a>tables_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_dir)) <span class="fu">dir.create</span>(tables_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a>data_deliv_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"deliv"</span>)</span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a>data_derived_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"derived"</span>)</span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_deliv_dir)) <span class="fu">dir.create</span>(data_deliv_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_derived_dir)) <span class="fu">dir.create</span>(data_derived_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a>figures_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a>tables_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_eda_dir)) <span class="fu">dir.create</span>(figures_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_eda_dir)) <span class="fu">dir.create</span>(tables_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35°C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient <span class="co">[</span><span class="ot">@BOSWELL20116732, @BOSWELL20116742</span><span class="co">]</span>.</span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a>The 2D structures of analytes, Tanimoto similarity matrix, log P and the number of functional groups were calculated using RDkit toolkit <span class="co">[</span><span class="ot">@greg_landrum_2025_15773589</span><span class="co">]</span>:</span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">RDKit-based predcitors</span><span class="co">](functional-groups-rdkit.html "rdkit")</span></span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">2D-structures</span><span class="co">](print-analytes-structures.html "Structures")</span></span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a>The Tanimoto coefficient is a common metric used to assess the structural similarity between molecules in cheminformatics. It quantifies the overlap of structural features, represented as binary fingerprints, between two molecules, with a higher coefficient indicating greater similarity (0 indicates no similarity and 1 indicates identical structures). </span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load data</span></span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir, <span class="st">"database_logk_1026.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-98"><a href="#cb61-98" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"database_logk_1026_analyte_names.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a>analytes_names<span class="sc">$</span>Analyte <span class="ot">&lt;-</span> <span class="fu">iconv</span>(analytes_names<span class="sc">$</span>Analyte, <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">"byte"</span>)</span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"smiles1026.smi"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a>smiles<span class="ot">&lt;-</span>smiles <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ID=</span>V2,<span class="at">smiles=</span>V1) <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID,smiles)</span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">905</span>] <span class="ot">=</span> <span class="st">"CN(C1CCCCC1N1CCCC1)C(=O)Cc1ccc(c(c1)Cl)Cl"</span> <span class="co"># remove tartrate moiety </span></span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">425</span>] <span class="ot">=</span> <span class="st">"CC(Cc1ccc(cc1)OCC(=O)O)NCC(c1cccc(c1)Cl)O"</span> <span class="co"># remove Na+ and dissociation</span></span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">501</span>] <span class="ot">=</span> <span class="st">"c1ccc(cc1)C1(c2ccccc2)C(=O)NC(=N1)O"</span></span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">401</span>]<span class="ot">=</span> <span class="st">"CC(C)(C)c1c(CC(C(=O)[OH])[NH2])c(=O)[nH]o1"</span></span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">686</span>] <span class="ot">=</span> <span class="st">"CCCCCCCCCCCCCCCC(=O)OC(CC(=O)[OH])C[N+](C)(C)C"</span></span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">901</span>] <span class="ot">=</span> <span class="st">"CCOC(=Nc1c[n+](no1)N1CCOCC1)[OH]"</span></span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>fg_df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a>descriptor_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"descriptor_df.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"similarity_ltri_rcdk.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a>similarity_matrix <span class="ot">&lt;-</span> <span class="fu">make_similarity_matrix_fun</span>(similarity_ltri_rcdk_df)</span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a><span class="co"># names of dissociated groups at low pH</span></span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a>dissociated_groups <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Anions</span></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sulfonic_acid"</span>, <span class="st">"Sulfinic_acid"</span>, <span class="st">"Sulfenic_acid"</span>, <span class="st">"Sulfuric_acid"</span>, <span class="st">"Sulfuric_monoester"</span>,</span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonic_acid"</span>, <span class="st">"Phosphoric_acid"</span>, <span class="st">"Phosphoric_monoester"</span>, <span class="st">"Phosphinic_acid"</span>,</span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonous_acid"</span>, <span class="st">"Phosphinous_acid"</span>, <span class="st">"Carbothioic_acid"</span>, <span class="st">"Carbodithioic_acid"</span>,</span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cations</span></span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Primary_aliph_amine"</span>, <span class="st">"Secondary_aliph_amine"</span>, <span class="st">"Tertiary_aliph_amine"</span>, </span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Quaternary_aliph_ammonium"</span>, <span class="st">"Primary_arom_amine"</span>, <span class="st">"Secondary_arom_amine"</span>, </span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_arom_amine"</span>, <span class="st">"Quaternary_arom_ammonium"</span>, <span class="st">"Secondary_mixed_amine"</span>, </span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_mixed_amine"</span>, <span class="st">"Quaternary_mixed_ammonium"</span>, <span class="st">"Oxonium"</span>, </span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Immonium"</span>, <span class="st">"Sulfonium"</span>, <span class="st">"Phosphonium"</span>, <span class="st">"Hetero_N_basic_H"</span>, <span class="st">"Hetero_N_basic_no_H"</span>, <span class="st">"Amidine"</span>, <span class="st">"Guanidine"</span>, <span class="st">"Hydrazine"</span>, <span class="st">"Hydroxylamine"</span>, </span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diazonium"</span>, <span class="st">"N-Oxide"</span></span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-131"><a href="#cb61-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prepare data</span></span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prepare-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(analytes_names) </span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> fg_df <span class="sc">%&gt;%</span></span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.) <span class="sc">||</span> <span class="sc">!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(id1,id2, SMILES, Anion, Kation, Ammonium))</span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> <span class="fu">colnames</span>(functional_groups)</span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial estimates</span></span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">S1 =</span> <span class="fu">if_else</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">1</span>,<span class="sc">-</span><span class="dv">16</span>,<span class="fu">polyfit</span>(fi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> fi), logk, <span class="dv">1</span>)[<span class="dv">1</span>]),</span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">logkw =</span> <span class="fu">if_else</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span> <span class="sc">*</span> fi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> fi), logk, <span class="dv">0</span>), </span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">polyfit</span>(fi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> fi), logk, <span class="dv">1</span>)[<span class="dv">2</span>]),</span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2 =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(logkw, S2, S1) <span class="sc">%&gt;%</span></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">S1 =</span> <span class="sc">-</span>S1 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory data analysis</span></span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a>A series of plots to better understand our data can be found here:</span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Exploratory Plots</span><span class="co">](eda.html "EDA")</span></span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data analysis</span></span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a>The logarythm of retention factor ($\small lok_{i,j}$) was modeled using the Neue model <span class="co">[</span><span class="ot">@nikitas_20091737</span><span class="co">]</span>:</span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb61-174"><a href="#cb61-174" aria-hidden="true" tabindex="-1"></a>&amp; logk_{i,j}=logkw_{i} - S_{1,i} \cdot (1 + S_{2}) \cdot \varphi_{i,j} / (1 + S_{2} \cdot \varphi_{i,j})</span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a>where $\small j$ denotes observation, $\small i$ denote analyte, $\small logkw_{i}$ represents logarithm of retention factors extrapolated to 0% of organic modifier content $\small S_{1,i}$ and $\small S2$ are the slopes in the Neue equation. In this parametrization of the Neue equation, $\small S1$ reflects the difference between logarithm of retention factors corresponding to water (0% of organic modifier content) and 100% of organic modifier content as eluents.</span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a>The statistical model has the following hierarchical structure:</span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a>&amp; \log k_{obs_{i,j}} \sim student_t(\nu_{obs},logk_{i,j},\sigma) <span class="sc">\\</span></span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a>&amp; R_{i} \sim \text{MN}(\theta_R  + \beta \cdot log P_i +\pi_{R1} \cdot X_{1i}  +\pi_{R2} \cdot X_{2i}, K, \Omega) <span class="sc">\\</span></span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a>&amp; \pi_{R1,k} \sim N(0,\kappa_{R1}) <span class="sc">\\</span></span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a>&amp; \pi_{R2,k} \sim N(0,\kappa_{R2})</span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a>where $\small R_i=(logkw_{i}, S_{1,i})$ is a vector of analyte-specific parameters, $\small logk_{i,j}$ corresponds to the above Neue equation, $\small MN$ is a matrix normal distribution, $\small \theta_R$ is a vector of typical values of $\small R_i$, $\small \beta_R$ is a vector of slopes between $\small R_i$ and $\small logP_i$,  $\small \pi_{R,1}$ and  $\small \pi_{R,2}$ is a vector of slopes between $\small R_i$ and functional groups: non-dissociated forms $\small X_{1i}$ and dissociated forms $\small X_{2i}$. In turn, $\small \nu_{obs}$ and $\small \sigma$ is the normality parameters and scale of the residuals, $\small K$ and $\small \Omega$ are the scale matrices for the row and column covariance structures. $\small \Omega$ and $\small K$ were decomposed to:</span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a>\Omega_1 = diag(\omega) \cdot LL' \cdot diag(\omega) <span class="sc">\\</span></span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a>K = 2*\alpha* (S-0.5)+ (1-\alpha)*I <span class="sc">\\</span></span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-198"><a href="#cb61-198" aria-hidden="true" tabindex="-1"></a>where $\small LL'$ denotes correlation a correlation matrix, $\small \omega$ denotes standard deviation for between analyte variability, S is a similarity matrix and I is an Identify matrix. In this work the similarity matrix was simplified assuming S=0 for $\small S&lt;0.5$ (analytes are essentially uncorrelated) and the values of S for $\small S \geq 0.5$ were scaled by alpha using the above equation.</span>
<span id="cb61-199"><a href="#cb61-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a>A matrix normal distribution models random matrices, with parameters including a mean matrix and two covariance matrices, one for rows (analytes) and one for columns ($\small logkw$ and $\small S$ parameters). These covariance matrices, denoted here as $\small K$ and $\Omega$, capture the dependencies between rows and columns of the random matrix, respectively. The row covariance can be naturally related to similarity matrix approximating its structure.</span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Priors</span></span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a>The priors were specified as follows:</span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{logkw} \sim normal(2, 4), <span class="sc">\\</span></span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{S1} \sim normal(4, 2), <span class="sc">\\</span></span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{S2} \sim lognormal(0.693, 0.125), <span class="sc">\\</span></span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a>&amp; \nu_{obs} = 7,<span class="sc">\\</span></span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{logkw},\omega_{S1} \sim normal_+(0, 1), <span class="sc">\\</span></span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a>&amp; \beta_{logkw} \sim  normal(0.7, 0.125), <span class="sc">\\</span></span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a>&amp; \beta_{S1} \sim  normal(0.5, 0.125), <span class="sc">\\</span></span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a>&amp; \kappa_{logkw},\kappa_{S1} \sim  normal(0, 0.1), <span class="sc">\\</span></span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a>&amp; \sigma \sim normal_+(0,0.05), <span class="sc">\\</span></span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a>&amp; \alpha \sim normal(0.5,0.25)T<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>, <span class="sc">\\</span></span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a>&amp; p(LL') \propto LKJ(2) \cdot \Pi_u N(c_u, 0.125), <span class="sc">\\</span></span>
<span id="cb61-219"><a href="#cb61-219" aria-hidden="true" tabindex="-1"></a>&amp; c_u = <span class="co">[</span><span class="ot">0.75</span><span class="co">]</span></span>
<span id="cb61-220"><a href="#cb61-220" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a>LKJ(2) ensure that the density is uniform over correlation matrices of order 2 and u denotes the unique lower triangular elements of correlation matrix (<span class="ot">&lt;http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/&gt;</span>)</span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb61-230"><a href="#cb61-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-231"><a href="#cb61-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-setup}</span></span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set: data</span></span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">=</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a>idx_diss <span class="ot">=</span> <span class="fu">which</span>(functional_groups_names <span class="sc">%in%</span> dissociated_groups)</span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a>idx_nondiss <span class="ot">=</span> <span class="fu">which</span>(functional_groups_names <span class="sc">%notin%</span> dissociated_groups)</span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">nearPD</span>(similarity_matrix, <span class="at">corr =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>mat)</span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_subset<span class="ot">&lt;-</span><span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(similarity<span class="sc">&gt;=</span><span class="fl">0.5</span>, row<span class="sc">!=</span>col)</span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a>uid <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(similarity_ltri_rcdk_subset<span class="sc">$</span>row,similarity_ltri_rcdk_subset<span class="sc">$</span>col))</span>
<span id="cb61-245"><a href="#cb61-245" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> uid,<span class="at">label =</span> <span class="fu">paste</span>(uid))</span>
<span id="cb61-246"><a href="#cb61-246" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">from =</span> similarity_ltri_rcdk_subset<span class="sc">$</span>row,</span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a>                    <span class="at">to =</span> similarity_ltri_rcdk_subset<span class="sc">$</span>col, </span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width =</span> similarity_ltri_rcdk_subset<span class="sc">$</span>similarity,</span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">round</span>(similarity_ltri_rcdk_subset<span class="sc">$</span>similarity,<span class="dv">2</span>)))</span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> edges, <span class="at">vertices =</span> nodes, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a>nodes<span class="sc">$</span>group <span class="ot">=</span> <span class="fu">cluster_louvain</span>(g)<span class="sc">$</span>membership</span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> nodes <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(id)</span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a>idx_corelatted <span class="ot">=</span> <span class="fu">unique</span>(nodes<span class="sc">$</span>id)</span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a>idx_uncorelatted <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(similarity_ltri_rcdk_df<span class="sc">$</span>row), idx_corelatted)</span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a>group <span class="ot">=</span> nodes<span class="sc">$</span>group</span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> nodes</span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a>  group_sizes <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(group, <span class="at">name =</span> <span class="st">"size"</span>)</span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(group_sizes<span class="sc">$</span>size <span class="sc">&gt;=</span> <span class="dv">45</span>)) <span class="cf">break</span></span>
<span id="cb61-263"><a href="#cb61-263" aria-hidden="true" tabindex="-1"></a>  smallest <span class="ot">&lt;-</span> group_sizes <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(size) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb61-264"><a href="#cb61-264" aria-hidden="true" tabindex="-1"></a>  from <span class="ot">&lt;-</span> smallest<span class="sc">$</span>group[<span class="dv">2</span>]</span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a>  to <span class="ot">&lt;-</span> smallest<span class="sc">$</span>group[<span class="dv">1</span>]</span>
<span id="cb61-266"><a href="#cb61-266" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>group[df<span class="sc">$</span>group <span class="sc">==</span> from] <span class="ot">&lt;-</span> to</span>
<span id="cb61-267"><a href="#cb61-267" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a>nodes<span class="sc">$</span>group_combined <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(df<span class="sc">$</span>group))</span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected[similarity_matrix_corrected<span class="sc">&lt;</span><span class="fl">0.5</span>]<span class="ot">=</span><span class="fl">0.5</span></span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">nearPD</span>(similarity_matrix_corrected, <span class="at">corr =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>mat)</span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a>sim_mat_masked <span class="ot">&lt;-</span>similarity_matrix_corrected</span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_corr=</span><span class="fu">length</span>(idx_corelatted),</span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_uncorr=</span><span class="fu">length</span>(idx_uncorelatted),</span>
<span id="cb61-279"><a href="#cb61-279" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_corr =</span> idx_corelatted,</span>
<span id="cb61-280"><a href="#cb61-280" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_uncorr =</span> idx_uncorelatted,</span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nfg_diss =</span> <span class="fu">length</span>(idx_diss),</span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nfg_nondiss =</span> <span class="fu">length</span>(idx_nondiss),</span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_diss =</span> idx_diss,</span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_nondiss =</span> idx_nondiss,</span>
<span id="cb61-285"><a href="#cb61-285" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb61-286"><a href="#cb61-286" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>descriptor_df<span class="sc">$</span>LogP,</span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb61-290"><a href="#cb61-290" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb61-291"><a href="#cb61-291" aria-hidden="true" tabindex="-1"></a>                       <span class="at">similarity_x =</span> sim_mat_masked,</span>
<span id="cb61-292"><a href="#cb61-292" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb61-294"><a href="#cb61-294" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb61-295"><a href="#cb61-295" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> nodes<span class="sc">$</span>group_combined,</span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mGroup =</span> <span class="fu">length</span>(<span class="fu">unique</span>(nodes<span class="sc">$</span>group_combined)),</span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb61-301"><a href="#cb61-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb61-302"><a href="#cb61-302" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb61-303"><a href="#cb61-303" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb61-307"><a href="#cb61-307" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb61-308"><a href="#cb61-308" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb61-309"><a href="#cb61-309" aria-hidden="true" tabindex="-1"></a>          <span class="at">param_corr =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw[idx_corelatted],init_aprox<span class="sc">$</span>S1[idx_corelatted]),</span>
<span id="cb61-310"><a href="#cb61-310" aria-hidden="true" tabindex="-1"></a>          <span class="at">param_uncorr =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw[idx_uncorelatted],init_aprox<span class="sc">$</span>S1[idx_uncorelatted]),</span>
<span id="cb61-311"><a href="#cb61-311" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fu">max</span>(<span class="fl">0.1</span>,<span class="fu">min</span>(<span class="fl">0.95</span>,<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.25</span>))),</span>
<span id="cb61-312"><a href="#cb61-312" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb61-313"><a href="#cb61-313" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb61-314"><a href="#cb61-314" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb61-315"><a href="#cb61-315" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb61-316"><a href="#cb61-316" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-317"><a href="#cb61-317" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-318"><a href="#cb61-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-319"><a href="#cb61-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-320"><a href="#cb61-320" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb61-321"><a href="#cb61-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-322"><a href="#cb61-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mod-settings}</span></span>
<span id="cb61-323"><a href="#cb61-323" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod50"</span></span>
<span id="cb61-324"><a href="#cb61-324" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb61-325"><a href="#cb61-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-326"><a href="#cb61-326" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb61-327"><a href="#cb61-327" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb61-328"><a href="#cb61-328" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb61-329"><a href="#cb61-329" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb61-330"><a href="#cb61-330" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb61-331"><a href="#cb61-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-332"><a href="#cb61-332" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb61-333"><a href="#cb61-333" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb61-334"><a href="#cb61-334" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb61-335"><a href="#cb61-335" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb61-336"><a href="#cb61-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-337"><a href="#cb61-337" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb61-338"><a href="#cb61-338" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb61-339"><a href="#cb61-339" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb61-340"><a href="#cb61-340" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb61-341"><a href="#cb61-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-342"><a href="#cb61-342" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb61-343"><a href="#cb61-343" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span>
<span id="cb61-344"><a href="#cb61-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-345"><a href="#cb61-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-346"><a href="#cb61-346" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Optimization</span></span>
<span id="cb61-347"><a href="#cb61-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-348"><a href="#cb61-348" aria-hidden="true" tabindex="-1"></a>I've compiled the model using cmdstanr and used optimization for initial testing of the code.</span>
<span id="cb61-349"><a href="#cb61-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-350"><a href="#cb61-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-compile, eval = FALSE}</span></span>
<span id="cb61-351"><a href="#cb61-351" aria-hidden="true" tabindex="-1"></a>mod50 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb61-352"><a href="#cb61-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-353"><a href="#cb61-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-354"><a href="#cb61-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-optimize, eval = FALSE}</span></span>
<span id="cb61-355"><a href="#cb61-355" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod50<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb61-356"><a href="#cb61-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb61-357"><a href="#cb61-357" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb61-358"><a href="#cb61-358" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="st">"mod50-opt"</span>,</span>
<span id="cb61-359"><a href="#cb61-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb61-360"><a href="#cb61-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">3000</span></span>
<span id="cb61-361"><a href="#cb61-361" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-362"><a href="#cb61-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-363"><a href="#cb61-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-364"><a href="#cb61-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plots-optimize}</span></span>
<span id="cb61-365"><a href="#cb61-365" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-opt-1.csv"</span>)))</span>
<span id="cb61-366"><a href="#cb61-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-367"><a href="#cb61-367" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">13</span>)</span>
<span id="cb61-368"><a href="#cb61-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-369"><a href="#cb61-369" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb61-370"><a href="#cb61-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-371"><a href="#cb61-371" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb61-372"><a href="#cb61-372" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb61-373"><a href="#cb61-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID),<span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-374"><a href="#cb61-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-375"><a href="#cb61-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-376"><a href="#cb61-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb61-377"><a href="#cb61-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb61-378"><a href="#cb61-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb61-379"><a href="#cb61-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte) <span class="sc">+</span></span>
<span id="cb61-380"><a href="#cb61-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb61-381"><a href="#cb61-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb61-382"><a href="#cb61-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, </span>
<span id="cb61-383"><a href="#cb61-383" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb61-384"><a href="#cb61-384" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb61-385"><a href="#cb61-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-386"><a href="#cb61-386" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb61-387"><a href="#cb61-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-388"><a href="#cb61-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-389"><a href="#cb61-389" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Local sampling (not used)</span></span>
<span id="cb61-390"><a href="#cb61-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-391"><a href="#cb61-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-sample, eval = FALSE}</span></span>
<span id="cb61-392"><a href="#cb61-392" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod50<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb61-393"><a href="#cb61-393" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb61-394"><a href="#cb61-394" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb61-395"><a href="#cb61-395" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="st">"mod50-loc"</span>,</span>
<span id="cb61-396"><a href="#cb61-396" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb61-397"><a href="#cb61-397" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb61-398"><a href="#cb61-398" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb61-399"><a href="#cb61-399" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb61-400"><a href="#cb61-400" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb61-401"><a href="#cb61-401" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb61-402"><a href="#cb61-402" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb61-403"><a href="#cb61-403" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb61-404"><a href="#cb61-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-405"><a href="#cb61-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-406"><a href="#cb61-406" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tryton</span></span>
<span id="cb61-407"><a href="#cb61-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-408"><a href="#cb61-408" aria-hidden="true" tabindex="-1"></a>Computations were carried out at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>.</span>
<span id="cb61-409"><a href="#cb61-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-410"><a href="#cb61-410" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>dump the necessary data to .json format</span>
<span id="cb61-411"><a href="#cb61-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-412"><a href="#cb61-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dump-files, eval = FALSE}</span></span>
<span id="cb61-413"><a href="#cb61-413" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-414"><a href="#cb61-414" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-415"><a href="#cb61-415" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-416"><a href="#cb61-416" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-417"><a href="#cb61-417" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-418"><a href="#cb61-418" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-419"><a href="#cb61-419" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-420"><a href="#cb61-420" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-421"><a href="#cb61-421" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-422"><a href="#cb61-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-423"><a href="#cb61-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-424"><a href="#cb61-424" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>run the model using the batch file:</span>
<span id="cb61-425"><a href="#cb61-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-426"><a href="#cb61-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb61-427"><a href="#cb61-427" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb61-428"><a href="#cb61-428" aria-hidden="true" tabindex="-1"></a><span class="in">#!/bin/bash -l</span></span>
<span id="cb61-429"><a href="#cb61-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-430"><a href="#cb61-430" aria-hidden="true" tabindex="-1"></a><span class="in">#SBATCH --job-name=cmdstan_conda</span></span>
<span id="cb61-431"><a href="#cb61-431" aria-hidden="true" tabindex="-1"></a><span class="in">#SBATCH -N 1</span></span>
<span id="cb61-432"><a href="#cb61-432" aria-hidden="true" tabindex="-1"></a><span class="in">#SBATCH -n 8</span></span>
<span id="cb61-433"><a href="#cb61-433" aria-hidden="true" tabindex="-1"></a><span class="in">#SBATCH -p batch</span></span>
<span id="cb61-434"><a href="#cb61-434" aria-hidden="true" tabindex="-1"></a><span class="in">#SBATCH --time=12:00:00</span></span>
<span id="cb61-435"><a href="#cb61-435" aria-hidden="true" tabindex="-1"></a><span class="in">#SBATCH --mem=2gb </span></span>
<span id="cb61-436"><a href="#cb61-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-437"><a href="#cb61-437" aria-hidden="true" tabindex="-1"></a><span class="in"># load</span></span>
<span id="cb61-438"><a href="#cb61-438" aria-hidden="true" tabindex="-1"></a><span class="in">module load trytonp/cmdstan/2.34.1</span></span>
<span id="cb61-439"><a href="#cb61-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-440"><a href="#cb61-440" aria-hidden="true" tabindex="-1"></a><span class="in">export STAN_THREADS=false</span></span>
<span id="cb61-441"><a href="#cb61-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-442"><a href="#cb61-442" aria-hidden="true" tabindex="-1"></a><span class="in"># model name</span></span>
<span id="cb61-443"><a href="#cb61-443" aria-hidden="true" tabindex="-1"></a><span class="in">export CMDSTAN_MODEL_NAME="mod50cv"</span></span>
<span id="cb61-444"><a href="#cb61-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-445"><a href="#cb61-445" aria-hidden="true" tabindex="-1"></a><span class="in"># paths</span></span>
<span id="cb61-446"><a href="#cb61-446" aria-hidden="true" tabindex="-1"></a><span class="in">export MODEL_SRC_DIR="/users/project1/pt01268/izo50cv"</span></span>
<span id="cb61-447"><a href="#cb61-447" aria-hidden="true" tabindex="-1"></a><span class="in">cd ${CMDSTAN_DIR}</span></span>
<span id="cb61-448"><a href="#cb61-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-449"><a href="#cb61-449" aria-hidden="true" tabindex="-1"></a><span class="in"># build/compile</span></span>
<span id="cb61-450"><a href="#cb61-450" aria-hidden="true" tabindex="-1"></a><span class="in">[ -f ${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} ] &amp;&amp; echo "Model " ${CMDSTAN_MODEL_NAME} " exists." || make STANCFLAGS=--O1 ${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME}</span></span>
<span id="cb61-451"><a href="#cb61-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-452"><a href="#cb61-452" aria-hidden="true" tabindex="-1"></a><span class="in">wait</span></span>
<span id="cb61-453"><a href="#cb61-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-454"><a href="#cb61-454" aria-hidden="true" tabindex="-1"></a><span class="in">cd ${MODEL_SRC_DIR}</span></span>
<span id="cb61-455"><a href="#cb61-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-456"><a href="#cb61-456" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-1.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-1.csv &amp;</span></span>
<span id="cb61-457"><a href="#cb61-457" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-2.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-2.csv &amp;</span></span>
<span id="cb61-458"><a href="#cb61-458" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-3.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-3.csv &amp;</span></span>
<span id="cb61-459"><a href="#cb61-459" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-4.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-4.csv &amp;</span></span>
<span id="cb61-460"><a href="#cb61-460" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-5.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-5.csv &amp;</span></span>
<span id="cb61-461"><a href="#cb61-461" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-6.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-6.csv &amp;</span></span>
<span id="cb61-462"><a href="#cb61-462" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-7.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-7.csv &amp;</span></span>
<span id="cb61-463"><a href="#cb61-463" aria-hidden="true" tabindex="-1"></a><span class="in">${MODEL_SRC_DIR}/${CMDSTAN_MODEL_NAME} sample num_samples=500 num_warmup=1000 algorithm=hmc engine=nuts max_depth=10 stepsize=0.01 adapt delta=0.9 data file=$MODEL_SRC_DIR/standata.json init=$MODEL_SRC_DIR/init-8.json  output file=$MODEL_SRC_DIR/${CMDSTAN_MODEL_NAME}-8.csv &amp;</span></span>
<span id="cb61-464"><a href="#cb61-464" aria-hidden="true" tabindex="-1"></a><span class="in">wait</span></span>
<span id="cb61-465"><a href="#cb61-465" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb61-466"><a href="#cb61-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-467"><a href="#cb61-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-468"><a href="#cb61-468" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>loaded the output files using cmdstanr::as_cmdstan_fit: </span>
<span id="cb61-469"><a href="#cb61-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-470"><a href="#cb61-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-load}</span></span>
<span id="cb61-471"><a href="#cb61-471" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb61-472"><a href="#cb61-472" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb61-473"><a href="#cb61-473" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb61-474"><a href="#cb61-474" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb61-475"><a href="#cb61-475" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb61-476"><a href="#cb61-476" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb61-477"><a href="#cb61-477" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb61-478"><a href="#cb61-478" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb61-479"><a href="#cb61-479" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb61-480"><a href="#cb61-480" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb61-481"><a href="#cb61-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-482"><a href="#cb61-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-483"><a href="#cb61-483" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>check the diagnostics of samples based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb61-484"><a href="#cb61-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-485"><a href="#cb61-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-diagnose, eval = FALSE}</span></span>
<span id="cb61-486"><a href="#cb61-486" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb61-487"><a href="#cb61-487" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(mod_output_dir)</span>
<span id="cb61-488"><a href="#cb61-488" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod50-1.csv mod50-2.csv mod50-3.csv mod50-4.csv mod50-5.csv mod50-6.csv mod50-7.csv mod50-8.csv'</span>)</span>
<span id="cb61-489"><a href="#cb61-489" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-490"><a href="#cb61-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-491"><a href="#cb61-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-492"><a href="#cb61-492" aria-hidden="true" tabindex="-1"></a>Output is copied here to save time.</span>
<span id="cb61-493"><a href="#cb61-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-494"><a href="#cb61-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb61-495"><a href="#cb61-495" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb61-496"><a href="#cb61-496" aria-hidden="true" tabindex="-1"></a><span class="in"> [1] "Checking sampler transitions treedepth."        </span></span>
<span id="cb61-497"><a href="#cb61-497" aria-hidden="true" tabindex="-1"></a><span class="in"> [2] "Treedepth satisfactory for all transitions."      </span></span>
<span id="cb61-498"><a href="#cb61-498" aria-hidden="true" tabindex="-1"></a><span class="in"> [4] "Checking sampler transitions for divergences."  </span></span>
<span id="cb61-499"><a href="#cb61-499" aria-hidden="true" tabindex="-1"></a><span class="in"> [5] "No divergent transitions found."  [7] "Checking E-BFMI - sampler transitions HMC potential energy."</span></span>
<span id="cb61-500"><a href="#cb61-500" aria-hidden="true" tabindex="-1"></a><span class="in"> [8] "E-BFMI satisfactory."                       </span></span>
<span id="cb61-501"><a href="#cb61-501" aria-hidden="true" tabindex="-1"></a><span class="in">[10] "Rank-normalized split effective sample size satisfactory for all parameters."</span></span>
<span id="cb61-502"><a href="#cb61-502" aria-hidden="true" tabindex="-1"></a><span class="in">[12] "The following parameters had rank-normalized split R-hat greater than 1.01:" </span></span>
<span id="cb61-503"><a href="#cb61-503" aria-hidden="true" tabindex="-1"></a><span class="in">[13] "  S2Hat, param_corr[252,1], param_corr[328,1], param_corr[405,1], param_corr[530,1], param_corr[328,2], param_corr[405,2], param_uncorr[14,1], logkx[621], logkx[622], logkx[2346], logkx[2347], logkx[2864], logkx[3365], logkx[3366], logkx[4237], logkx[4238], param[95,1], param[394,1], param[510,1], param[626,1], param[832,1], param[510,2], param[626,2], lprior"</span></span>
<span id="cb61-504"><a href="#cb61-504" aria-hidden="true" tabindex="-1"></a><span class="in">[14] "Such high values indicate incomplete mixing and biased estimation."  </span></span>
<span id="cb61-505"><a href="#cb61-505" aria-hidden="true" tabindex="-1"></a><span class="in">[15] "You should consider regularizating your model with additional prior information or a more effective parameterization."</span></span>
<span id="cb61-506"><a href="#cb61-506" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb61-507"><a href="#cb61-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-508"><a href="#cb61-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-509"><a href="#cb61-509" aria-hidden="true" tabindex="-1"></a><span class="fu">### Genereted quantitites</span></span>
<span id="cb61-510"><a href="#cb61-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-511"><a href="#cb61-511" aria-hidden="true" tabindex="-1"></a>Most of the quantities of interest were generated using generate_quantities method from a fitted model without re-running the sampler.</span>
<span id="cb61-512"><a href="#cb61-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-513"><a href="#cb61-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities, eval=FALSE}</span></span>
<span id="cb61-514"><a href="#cb61-514" aria-hidden="true" tabindex="-1"></a>mod50gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb61-515"><a href="#cb61-515" aria-hidden="true" tabindex="-1"></a>fitgq  <span class="ot">&lt;-</span> mod50gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb61-516"><a href="#cb61-516" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb61-517"><a href="#cb61-517" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb61-518"><a href="#cb61-518" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb61-519"><a href="#cb61-519" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb61-520"><a href="#cb61-520" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span>
<span id="cb61-521"><a href="#cb61-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-522"><a href="#cb61-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-523"><a href="#cb61-523" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Load Results</span></span>
<span id="cb61-524"><a href="#cb61-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eta-load}</span></span>
<span id="cb61-525"><a href="#cb61-525" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb61-526"><a href="#cb61-526" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb61-527"><a href="#cb61-527" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb61-528"><a href="#cb61-528" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb61-529"><a href="#cb61-529" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb61-530"><a href="#cb61-530" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb61-531"><a href="#cb61-531" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb61-532"><a href="#cb61-532" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb61-533"><a href="#cb61-533" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb61-534"><a href="#cb61-534" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb61-535"><a href="#cb61-535" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb61-536"><a href="#cb61-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-537"><a href="#cb61-537" aria-hidden="true" tabindex="-1"></a><span class="co">#draws_gen_df &lt;- as_draws_df(fitgq$draws())</span></span>
<span id="cb61-538"><a href="#cb61-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-539"><a href="#cb61-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-540"><a href="#cb61-540" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary of model parameters (table):</span></span>
<span id="cb61-541"><a href="#cb61-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-542"><a href="#cb61-542" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb61-543"><a href="#cb61-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-544"><a href="#cb61-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb61-545"><a href="#cb61-545" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">15</span>)</span>
<span id="cb61-546"><a href="#cb61-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-547"><a href="#cb61-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-548"><a href="#cb61-548" aria-hidden="true" tabindex="-1"></a><span class="fu"># Trace plots</span></span>
<span id="cb61-549"><a href="#cb61-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-550"><a href="#cb61-550" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb61-551"><a href="#cb61-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-552"><a href="#cb61-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb61-553"><a href="#cb61-553" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb61-554"><a href="#cb61-554" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>))) </span>
<span id="cb61-555"><a href="#cb61-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-556"><a href="#cb61-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-557"><a href="#cb61-557" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary of model parameters (figures)</span></span>
<span id="cb61-558"><a href="#cb61-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-559"><a href="#cb61-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb61-560"><a href="#cb61-560" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb61-561"><a href="#cb61-561" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>, <span class="st">"alpha"</span>)))</span>
<span id="cb61-562"><a href="#cb61-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-563"><a href="#cb61-563" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb61-564"><a href="#cb61-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-565"><a href="#cb61-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-566"><a href="#cb61-566" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary of functional groups effects (figures)</span></span>
<span id="cb61-567"><a href="#cb61-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functinoal-group-effects}</span></span>
<span id="cb61-568"><a href="#cb61-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb61-569"><a href="#cb61-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb61-570"><a href="#cb61-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-571"><a href="#cb61-571" aria-hidden="true" tabindex="-1"></a>idx1 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb61-572"><a href="#cb61-572" aria-hidden="true" tabindex="-1"></a>idx2 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb61-573"><a href="#cb61-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-574"><a href="#cb61-574" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb61-575"><a href="#cb61-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-576"><a href="#cb61-576" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb61-577"><a href="#cb61-577" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb61-578"><a href="#cb61-578" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb61-579"><a href="#cb61-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-580"><a href="#cb61-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb61-581"><a href="#cb61-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-582"><a href="#cb61-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb61-583"><a href="#cb61-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-584"><a href="#cb61-584" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb61-585"><a href="#cb61-585" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb61-586"><a href="#cb61-586" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb61-587"><a href="#cb61-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb61-588"><a href="#cb61-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb61-589"><a href="#cb61-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb61-590"><a href="#cb61-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb61-591"><a href="#cb61-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-592"><a href="#cb61-592" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb61-593"><a href="#cb61-593" aria-hidden="true" tabindex="-1"></a>p_common <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb61-594"><a href="#cb61-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb61-595"><a href="#cb61-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb61-596"><a href="#cb61-596" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb61-597"><a href="#cb61-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb61-598"><a href="#cb61-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)<span class="sc">+</span></span>
<span id="cb61-599"><a href="#cb61-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb61-600"><a href="#cb61-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-601"><a href="#cb61-601" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb61-602"><a href="#cb61-602" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb61-603"><a href="#cb61-603" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb61-604"><a href="#cb61-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-605"><a href="#cb61-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb61-606"><a href="#cb61-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-607"><a href="#cb61-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb61-608"><a href="#cb61-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-609"><a href="#cb61-609" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb61-610"><a href="#cb61-610" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb61-611"><a href="#cb61-611" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb61-612"><a href="#cb61-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb61-613"><a href="#cb61-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb61-614"><a href="#cb61-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb61-615"><a href="#cb61-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb61-616"><a href="#cb61-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-617"><a href="#cb61-617" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb61-618"><a href="#cb61-618" aria-hidden="true" tabindex="-1"></a>p_uncommon <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb61-619"><a href="#cb61-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb61-620"><a href="#cb61-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb61-621"><a href="#cb61-621" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb61-622"><a href="#cb61-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb61-623"><a href="#cb61-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param) <span class="sc">+</span></span>
<span id="cb61-624"><a href="#cb61-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb61-625"><a href="#cb61-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-626"><a href="#cb61-626" aria-hidden="true" tabindex="-1"></a>p_uncommon <span class="sc">+</span> p_common</span>
<span id="cb61-627"><a href="#cb61-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-628"><a href="#cb61-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-629"><a href="#cb61-629" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fits</span></span>
<span id="cb61-630"><a href="#cb61-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-631"><a href="#cb61-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-gof-plots}</span></span>
<span id="cb61-632"><a href="#cb61-632" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-633"><a href="#cb61-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-634"><a href="#cb61-634" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb61-635"><a href="#cb61-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb61-636"><a href="#cb61-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb61-637"><a href="#cb61-637" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb61-638"><a href="#cb61-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb61-639"><a href="#cb61-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-640"><a href="#cb61-640" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-641"><a href="#cb61-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-642"><a href="#cb61-642" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb61-643"><a href="#cb61-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb61-644"><a href="#cb61-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb61-645"><a href="#cb61-645" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb61-646"><a href="#cb61-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb61-647"><a href="#cb61-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-648"><a href="#cb61-648" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb61-649"><a href="#cb61-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb61-650"><a href="#cb61-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-651"><a href="#cb61-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb61-652"><a href="#cb61-652" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb61-653"><a href="#cb61-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-654"><a href="#cb61-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb61-655"><a href="#cb61-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb61-656"><a href="#cb61-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb61-657"><a href="#cb61-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-658"><a href="#cb61-658" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb61-659"><a href="#cb61-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb61-660"><a href="#cb61-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-661"><a href="#cb61-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb61-662"><a href="#cb61-662" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb61-663"><a href="#cb61-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-664"><a href="#cb61-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb61-665"><a href="#cb61-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb61-666"><a href="#cb61-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb61-667"><a href="#cb61-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-668"><a href="#cb61-668" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb61-669"><a href="#cb61-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-670"><a href="#cb61-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-671"><a href="#cb61-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-672"><a href="#cb61-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-predictions}</span></span>
<span id="cb61-673"><a href="#cb61-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-674"><a href="#cb61-674" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb61-675"><a href="#cb61-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-676"><a href="#cb61-676" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-677"><a href="#cb61-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-678"><a href="#cb61-678" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb61-679"><a href="#cb61-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb61-680"><a href="#cb61-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-681"><a href="#cb61-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb61-682"><a href="#cb61-682" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-683"><a href="#cb61-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb61-684"><a href="#cb61-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb61-685"><a href="#cb61-685" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-686"><a href="#cb61-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-687"><a href="#cb61-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb61-688"><a href="#cb61-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb61-689"><a href="#cb61-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb61-690"><a href="#cb61-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb61-691"><a href="#cb61-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-692"><a href="#cb61-692" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb61-693"><a href="#cb61-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-694"><a href="#cb61-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-695"><a href="#cb61-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions}</span></span>
<span id="cb61-696"><a href="#cb61-696" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb61-697"><a href="#cb61-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-698"><a href="#cb61-698" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-699"><a href="#cb61-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-700"><a href="#cb61-700" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb61-701"><a href="#cb61-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb61-702"><a href="#cb61-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-703"><a href="#cb61-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb61-704"><a href="#cb61-704" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-705"><a href="#cb61-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb61-706"><a href="#cb61-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb61-707"><a href="#cb61-707" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-708"><a href="#cb61-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-709"><a href="#cb61-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb61-710"><a href="#cb61-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb61-711"><a href="#cb61-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb61-712"><a href="#cb61-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb61-713"><a href="#cb61-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-714"><a href="#cb61-714" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb61-715"><a href="#cb61-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-716"><a href="#cb61-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-717"><a href="#cb61-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-718"><a href="#cb61-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions-vpc}</span></span>
<span id="cb61-719"><a href="#cb61-719" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-720"><a href="#cb61-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-721"><a href="#cb61-721" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb61-722"><a href="#cb61-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb61-723"><a href="#cb61-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-724"><a href="#cb61-724" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-725"><a href="#cb61-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi))<span class="sc">%&gt;%</span></span>
<span id="cb61-726"><a href="#cb61-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draw=</span>.draw)<span class="sc">%&gt;%</span></span>
<span id="cb61-727"><a href="#cb61-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(draw, fi)<span class="sc">%&gt;%</span></span>
<span id="cb61-728"><a href="#cb61-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mlogk =</span> <span class="fu">mean</span>(logk),</span>
<span id="cb61-729"><a href="#cb61-729" aria-hidden="true" tabindex="-1"></a>            <span class="at">llogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb61-730"><a href="#cb61-730" aria-hidden="true" tabindex="-1"></a>            <span class="at">ulogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb61-731"><a href="#cb61-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fi)<span class="sc">%&gt;%</span></span>
<span id="cb61-732"><a href="#cb61-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mmlogk =</span> <span class="fu">mean</span>(mlogk),</span>
<span id="cb61-733"><a href="#cb61-733" aria-hidden="true" tabindex="-1"></a>            <span class="at">mllogk =</span> <span class="fu">quantile</span>(llogk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb61-734"><a href="#cb61-734" aria-hidden="true" tabindex="-1"></a>            <span class="at">mulogk =</span> <span class="fu">quantile</span>(ulogk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb61-735"><a href="#cb61-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb61-736"><a href="#cb61-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mmlogk))<span class="sc">+</span></span>
<span id="cb61-737"><a href="#cb61-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mllogk))<span class="sc">+</span></span>
<span id="cb61-738"><a href="#cb61-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mulogk))<span class="sc">+</span></span>
<span id="cb61-739"><a href="#cb61-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-740"><a href="#cb61-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb61-741"><a href="#cb61-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb61-742"><a href="#cb61-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-743"><a href="#cb61-743" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb61-744"><a href="#cb61-744" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-745"><a href="#cb61-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-746"><a href="#cb61-746" aria-hidden="true" tabindex="-1"></a><span class="fu"># Individual Parameters and etaplots</span></span>
<span id="cb61-747"><a href="#cb61-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-748"><a href="#cb61-748" aria-hidden="true" tabindex="-1"></a>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</span>
<span id="cb61-749"><a href="#cb61-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-750"><a href="#cb61-750" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual parameters</span></span>
<span id="cb61-751"><a href="#cb61-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-752"><a href="#cb61-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iparam}</span></span>
<span id="cb61-753"><a href="#cb61-753" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-754"><a href="#cb61-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sparam_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-755"><a href="#cb61-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb61-756"><a href="#cb61-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb61-757"><a href="#cb61-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-758"><a href="#cb61-758" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb61-759"><a href="#cb61-759" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb61-760"><a href="#cb61-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-761"><a href="#cb61-761" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2, param1<span class="sc">-</span>param2, datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb61-762"><a href="#cb61-762" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logka'</span>[i]), <span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb61-763"><a href="#cb61-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-764"><a href="#cb61-764" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb61-765"><a href="#cb61-765" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb61-766"><a href="#cb61-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-767"><a href="#cb61-767" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb61-768"><a href="#cb61-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-769"><a href="#cb61-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-770"><a href="#cb61-770" aria-hidden="true" tabindex="-1"></a><span class="fu">## Etas</span></span>
<span id="cb61-771"><a href="#cb61-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ieta}</span></span>
<span id="cb61-772"><a href="#cb61-772" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-773"><a href="#cb61-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-774"><a href="#cb61-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb61-775"><a href="#cb61-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb61-776"><a href="#cb61-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-777"><a href="#cb61-777" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb61-778"><a href="#cb61-778" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb61-779"><a href="#cb61-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-780"><a href="#cb61-780" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,param1<span class="sc">-</span>param2,datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb61-781"><a href="#cb61-781" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etalogka'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb61-782"><a href="#cb61-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-783"><a href="#cb61-783" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb61-784"><a href="#cb61-784" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb61-785"><a href="#cb61-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-786"><a href="#cb61-786" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb61-787"><a href="#cb61-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-788"><a href="#cb61-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-789"><a href="#cb61-789" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect of functional groups (screening)</span></span>
<span id="cb61-790"><a href="#cb61-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r effect-fg-screening}</span></span>
<span id="cb61-791"><a href="#cb61-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-792"><a href="#cb61-792" aria-hidden="true" tabindex="-1"></a>valid_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb61-793"><a href="#cb61-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-794"><a href="#cb61-794" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">map</span>(valid_indices, <span class="cf">function</span>(i) {</span>
<span id="cb61-795"><a href="#cb61-795" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract functional group as a factor</span></span>
<span id="cb61-796"><a href="#cb61-796" aria-hidden="true" tabindex="-1"></a>  nrgroups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(functional_groups[, i])</span>
<span id="cb61-797"><a href="#cb61-797" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-798"><a href="#cb61-798" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for plotting</span></span>
<span id="cb61-799"><a href="#cb61-799" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-800"><a href="#cb61-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">param1 =</span> param1,</span>
<span id="cb61-801"><a href="#cb61-801" aria-hidden="true" tabindex="-1"></a>    <span class="at">param2 =</span> param2,</span>
<span id="cb61-802"><a href="#cb61-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">param3=</span> param1<span class="sc">-</span>param2,</span>
<span id="cb61-803"><a href="#cb61-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrgroups =</span> nrgroups</span>
<span id="cb61-804"><a href="#cb61-804" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-805"><a href="#cb61-805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-806"><a href="#cb61-806" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="sc">%&gt;%</span></span>
<span id="cb61-807"><a href="#cb61-807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(param1, param2, param3), </span>
<span id="cb61-808"><a href="#cb61-808" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"name"</span>, </span>
<span id="cb61-809"><a href="#cb61-809" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-810"><a href="#cb61-810" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">etaname =</span> <span class="fu">recode</span>(name, </span>
<span id="cb61-811"><a href="#cb61-811" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param1 =</span> <span class="st">"etalogkw"</span>, </span>
<span id="cb61-812"><a href="#cb61-812" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param2 =</span> <span class="st">"etaS"</span>,</span>
<span id="cb61-813"><a href="#cb61-813" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param3 =</span> <span class="st">"etalogka"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-814"><a href="#cb61-814" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> nrgroups)) <span class="sc">+</span></span>
<span id="cb61-815"><a href="#cb61-815" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb61-816"><a href="#cb61-816" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>etaname) <span class="sc">+</span></span>
<span id="cb61-817"><a href="#cb61-817" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> functional_groups_names[i], </span>
<span id="cb61-818"><a href="#cb61-818" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Nr of functional groups"</span>, </span>
<span id="cb61-819"><a href="#cb61-819" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"eta"</span>)<span class="sc">+</span></span>
<span id="cb61-820"><a href="#cb61-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb61-821"><a href="#cb61-821" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb61-822"><a href="#cb61-822" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb61-823"><a href="#cb61-823" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-824"><a href="#cb61-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-825"><a href="#cb61-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-826"><a href="#cb61-826" aria-hidden="true" tabindex="-1"></a>plot_groups <span class="ot">&lt;-</span> <span class="fu">split</span>(plots, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(plots) <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb61-827"><a href="#cb61-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-828"><a href="#cb61-828" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each group of up to four plots</span></span>
<span id="cb61-829"><a href="#cb61-829" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(plot_groups, <span class="cf">function</span>(group) {</span>
<span id="cb61-830"><a href="#cb61-830" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(group, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb61-831"><a href="#cb61-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb61-832"><a href="#cb61-832" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-833"><a href="#cb61-833" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-834"><a href="#cb61-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-835"><a href="#cb61-835" aria-hidden="true" tabindex="-1"></a><span class="fu"># Posterior correlations</span></span>
<span id="cb61-836"><a href="#cb61-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-corelations}</span></span>
<span id="cb61-837"><a href="#cb61-837" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_subset<span class="ot">&lt;-</span> <span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(row<span class="sc">!=</span>col)</span>
<span id="cb61-838"><a href="#cb61-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-839"><a href="#cb61-839" aria-hidden="true" tabindex="-1"></a>etas <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-840"><a href="#cb61-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>))</span>
<span id="cb61-841"><a href="#cb61-841" aria-hidden="true" tabindex="-1"></a>etas_subset <span class="ot">&lt;-</span> etas[, <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">d+,1</span><span class="sc">\\</span><span class="st">]"</span>, <span class="fu">names</span>(etas))]</span>
<span id="cb61-842"><a href="#cb61-842" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(etas_subset, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># exclude .draw column</span></span>
<span id="cb61-843"><a href="#cb61-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-844"><a href="#cb61-844" aria-hidden="true" tabindex="-1"></a>etas_decor <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-845"><a href="#cb61-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_decorr_ind"</span>))</span>
<span id="cb61-846"><a href="#cb61-846" aria-hidden="true" tabindex="-1"></a>etas_decor_subset <span class="ot">&lt;-</span> etas_decor[, <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">d+,1</span><span class="sc">\\</span><span class="st">]"</span>, <span class="fu">names</span>(etas_decor))]</span>
<span id="cb61-847"><a href="#cb61-847" aria-hidden="true" tabindex="-1"></a>cor_matrix_decorrelated <span class="ot">&lt;-</span> <span class="fu">cor</span>(etas_decor_subset, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># exclude .draw column</span></span>
<span id="cb61-848"><a href="#cb61-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-849"><a href="#cb61-849" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb61-850"><a href="#cb61-850" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb61-851"><a href="#cb61-851" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix_decorrelated) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb61-852"><a href="#cb61-852" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix_decorrelated) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span></span>
<span id="cb61-853"><a href="#cb61-853" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(similarity_matrix_corrected[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb61-854"><a href="#cb61-854" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb61-855"><a href="#cb61-855" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix_decorrelated[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb61-856"><a href="#cb61-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-857"><a href="#cb61-857" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix)<span class="sc">%&gt;%</span></span>
<span id="cb61-858"><a href="#cb61-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb61-859"><a href="#cb61-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(similarity_ltri_rcdk_df) <span class="sc">%&gt;%</span></span>
<span id="cb61-860"><a href="#cb61-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb61-861"><a href="#cb61-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb61-862"><a href="#cb61-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity)) <span class="sc">+</span></span>
<span id="cb61-863"><a href="#cb61-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-864"><a href="#cb61-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb61-865"><a href="#cb61-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Correlation"</span>,</span>
<span id="cb61-866"><a href="#cb61-866" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb61-867"><a href="#cb61-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb61-868"><a href="#cb61-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb61-869"><a href="#cb61-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-870"><a href="#cb61-870" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix_decorrelated)<span class="sc">%&gt;%</span></span>
<span id="cb61-871"><a href="#cb61-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb61-872"><a href="#cb61-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(similarity_ltri_rcdk_df) <span class="sc">%&gt;%</span></span>
<span id="cb61-873"><a href="#cb61-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb61-874"><a href="#cb61-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb61-875"><a href="#cb61-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity)) <span class="sc">+</span></span>
<span id="cb61-876"><a href="#cb61-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-877"><a href="#cb61-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># cleaner theme</span></span>
<span id="cb61-878"><a href="#cb61-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Correlation"</span>,</span>
<span id="cb61-879"><a href="#cb61-879" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb61-880"><a href="#cb61-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb61-881"><a href="#cb61-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb61-882"><a href="#cb61-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-883"><a href="#cb61-883" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1<span class="sc">+</span>p2)</span>
<span id="cb61-884"><a href="#cb61-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-885"><a href="#cb61-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-886"><a href="#cb61-886" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix)<span class="sc">%&gt;%</span></span>
<span id="cb61-887"><a href="#cb61-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb61-888"><a href="#cb61-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected)) <span class="sc">%&gt;%</span></span>
<span id="cb61-889"><a href="#cb61-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb61-890"><a href="#cb61-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nodes<span class="sc">%&gt;%</span><span class="fu">rename</span>(<span class="at">row=</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb61-891"><a href="#cb61-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_combined =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(group_combined),<span class="dv">0</span>,group_combined))<span class="sc">%&gt;%</span></span>
<span id="cb61-892"><a href="#cb61-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_combined) <span class="sc">%&gt;%</span></span>
<span id="cb61-893"><a href="#cb61-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb61-894"><a href="#cb61-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups_joined =</span> <span class="fu">case_when</span>( group_combined <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Uncorrelated"</span>,</span>
<span id="cb61-895"><a href="#cb61-895" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Group 1"</span>,</span>
<span id="cb61-896"><a href="#cb61-896" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Group 2"</span>,</span>
<span id="cb61-897"><a href="#cb61-897" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Group 3"</span>,</span>
<span id="cb61-898"><a href="#cb61-898" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Group 4"</span>,</span>
<span id="cb61-899"><a href="#cb61-899" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Group 5"</span>,</span>
<span id="cb61-900"><a href="#cb61-900" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Group 6"</span>,</span>
<span id="cb61-901"><a href="#cb61-901" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Group 7"</span>,</span>
<span id="cb61-902"><a href="#cb61-902" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Group 8"</span>,</span>
<span id="cb61-903"><a href="#cb61-903" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Group 9"</span>,</span>
<span id="cb61-904"><a href="#cb61-904" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Group 10"</span>,</span>
<span id="cb61-905"><a href="#cb61-905" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb61-906"><a href="#cb61-906" aria-hidden="true" tabindex="-1"></a>                                    )) <span class="sc">%&gt;%</span></span>
<span id="cb61-907"><a href="#cb61-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity, <span class="at">color =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb61-908"><a href="#cb61-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-909"><a href="#cb61-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># cleaner theme</span></span>
<span id="cb61-910"><a href="#cb61-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">"Correlation"</span>,</span>
<span id="cb61-911"><a href="#cb61-911" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb61-912"><a href="#cb61-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb61-913"><a href="#cb61-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>groups_joined)</span>
<span id="cb61-914"><a href="#cb61-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-915"><a href="#cb61-915" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span>
<span id="cb61-916"><a href="#cb61-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-917"><a href="#cb61-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-918"><a href="#cb61-918" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">=</span><span class="fu">similarity_to_ltr_fun</span>(cor_matrix_decorrelated)<span class="sc">%&gt;%</span></span>
<span id="cb61-919"><a href="#cb61-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corr =</span> similarity) <span class="sc">%&gt;%</span></span>
<span id="cb61-920"><a href="#cb61-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">similarity_to_ltr_fun</span>(similarity_matrix_corrected)) <span class="sc">%&gt;%</span></span>
<span id="cb61-921"><a href="#cb61-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">!=</span>col) <span class="sc">%&gt;%</span></span>
<span id="cb61-922"><a href="#cb61-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nodes<span class="sc">%&gt;%</span><span class="fu">rename</span>(<span class="at">row=</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb61-923"><a href="#cb61-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_combined =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(group_combined),<span class="dv">0</span>,group_combined))<span class="sc">%&gt;%</span></span>
<span id="cb61-924"><a href="#cb61-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_combined) <span class="sc">%&gt;%</span></span>
<span id="cb61-925"><a href="#cb61-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(col <span class="sc">%in%</span> row) <span class="sc">%&gt;%</span></span>
<span id="cb61-926"><a href="#cb61-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups_joined =</span> <span class="fu">case_when</span>( group_combined <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Uncorrelated"</span>,</span>
<span id="cb61-927"><a href="#cb61-927" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Group 1"</span>,</span>
<span id="cb61-928"><a href="#cb61-928" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Group 2"</span>,</span>
<span id="cb61-929"><a href="#cb61-929" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Group 3"</span>,</span>
<span id="cb61-930"><a href="#cb61-930" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Group 4"</span>,</span>
<span id="cb61-931"><a href="#cb61-931" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Group 5"</span>,</span>
<span id="cb61-932"><a href="#cb61-932" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Group 6"</span>,</span>
<span id="cb61-933"><a href="#cb61-933" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Group 7"</span>,</span>
<span id="cb61-934"><a href="#cb61-934" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Group 8"</span>,</span>
<span id="cb61-935"><a href="#cb61-935" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Group 9"</span>,</span>
<span id="cb61-936"><a href="#cb61-936" aria-hidden="true" tabindex="-1"></a>                                    group_combined <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Group 10"</span>,</span>
<span id="cb61-937"><a href="#cb61-937" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb61-938"><a href="#cb61-938" aria-hidden="true" tabindex="-1"></a>                                    )) <span class="sc">%&gt;%</span></span>
<span id="cb61-939"><a href="#cb61-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> corr, <span class="at">x =</span> similarity, <span class="at">color =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb61-940"><a href="#cb61-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-941"><a href="#cb61-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># cleaner theme</span></span>
<span id="cb61-942"><a href="#cb61-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Correlation (decorelated)"</span>,</span>
<span id="cb61-943"><a href="#cb61-943" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb61-944"><a href="#cb61-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb61-945"><a href="#cb61-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>groups_joined)</span>
<span id="cb61-946"><a href="#cb61-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-947"><a href="#cb61-947" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span>
<span id="cb61-948"><a href="#cb61-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-949"><a href="#cb61-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-950"><a href="#cb61-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-951"><a href="#cb61-951" aria-hidden="true" tabindex="-1"></a><span class="fu"># Effect of similairty</span></span>
<span id="cb61-952"><a href="#cb61-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-953"><a href="#cb61-953" aria-hidden="true" tabindex="-1"></a>Predict retention times for a set of analytes based on their similarity to other analytes and studied descriptors.</span>
<span id="cb61-954"><a href="#cb61-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-955"><a href="#cb61-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{r datastruct-cv}</span></span>
<span id="cb61-956"><a href="#cb61-956" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb61-957"><a href="#cb61-957" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">=</span> nodes</span>
<span id="cb61-958"><a href="#cb61-958" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> foo <span class="sc">%&gt;%</span></span>
<span id="cb61-959"><a href="#cb61-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb61-960"><a href="#cb61-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb61-961"><a href="#cb61-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(id)</span>
<span id="cb61-962"><a href="#cb61-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-963"><a href="#cb61-963" aria-hidden="true" tabindex="-1"></a>datastructcv <span class="ot">=</span> datastruct;</span>
<span id="cb61-964"><a href="#cb61-964" aria-hidden="true" tabindex="-1"></a>initcv<span class="ot">=</span>init;</span>
<span id="cb61-965"><a href="#cb61-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-966"><a href="#cb61-966" aria-hidden="true" tabindex="-1"></a>idx_analytes_out <span class="ot">=</span> <span class="fu">sort</span>(idx)</span>
<span id="cb61-967"><a href="#cb61-967" aria-hidden="true" tabindex="-1"></a>idx_analytes_in <span class="ot">=</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(datastructcv<span class="sc">$</span>analyte),idx_analytes_out)</span>
<span id="cb61-968"><a href="#cb61-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-969"><a href="#cb61-969" aria-hidden="true" tabindex="-1"></a>datax <span class="ot">&lt;-</span>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="fu">here</span>(<span class="st">"model/stan/mod50cv/standata.json"</span>))</span>
<span id="cb61-970"><a href="#cb61-970" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">unique</span>(datax<span class="sc">$</span>analyte) <span class="sc">%notin%</span> <span class="fu">unique</span>(datax<span class="sc">$</span>analyte[datax<span class="sc">$</span>idxcv]))</span>
<span id="cb61-971"><a href="#cb61-971" aria-hidden="true" tabindex="-1"></a>idx_analytes_out <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">unique</span>(datax<span class="sc">$</span>analyte) <span class="sc">%notin%</span> <span class="fu">unique</span>(datax<span class="sc">$</span>analyte[datax<span class="sc">$</span>idxcv]))</span>
<span id="cb61-972"><a href="#cb61-972" aria-hidden="true" tabindex="-1"></a>idx_analytes_in <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">unique</span>(datax<span class="sc">$</span>analyte) <span class="sc">%in%</span> <span class="fu">unique</span>(datax<span class="sc">$</span>analyte[datax<span class="sc">$</span>idxcv]))</span>
<span id="cb61-973"><a href="#cb61-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-974"><a href="#cb61-974" aria-hidden="true" tabindex="-1"></a>idxcv <span class="ot">=</span>  <span class="fu">which</span>(datastructcv<span class="sc">$</span>analyte <span class="sc">%in%</span> idx_analytes_in)</span>
<span id="cb61-975"><a href="#cb61-975" aria-hidden="true" tabindex="-1"></a>nObscv <span class="ot">=</span> <span class="fu">length</span>(idxcv);</span>
<span id="cb61-976"><a href="#cb61-976" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>idxcv <span class="ot">=</span> idxcv;</span>
<span id="cb61-977"><a href="#cb61-977" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>nObscv <span class="ot">=</span> nObscv;</span>
<span id="cb61-978"><a href="#cb61-978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-979"><a href="#cb61-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-980"><a href="#cb61-980" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting the model</span></span>
<span id="cb61-981"><a href="#cb61-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-982"><a href="#cb61-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mod-settings-cv}</span></span>
<span id="cb61-983"><a href="#cb61-983" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod50cv"</span></span>
<span id="cb61-984"><a href="#cb61-984" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb61-985"><a href="#cb61-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-986"><a href="#cb61-986" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb61-987"><a href="#cb61-987" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb61-988"><a href="#cb61-988" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb61-989"><a href="#cb61-989" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb61-990"><a href="#cb61-990" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb61-991"><a href="#cb61-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-992"><a href="#cb61-992" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb61-993"><a href="#cb61-993" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb61-994"><a href="#cb61-994" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb61-995"><a href="#cb61-995" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb61-996"><a href="#cb61-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-997"><a href="#cb61-997" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb61-998"><a href="#cb61-998" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb61-999"><a href="#cb61-999" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb61-1000"><a href="#cb61-1000" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb61-1001"><a href="#cb61-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1002"><a href="#cb61-1002" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb61-1003"><a href="#cb61-1003" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span>
<span id="cb61-1004"><a href="#cb61-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1005"><a href="#cb61-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1006"><a href="#cb61-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-compile-cv, eval = FALSE}</span></span>
<span id="cb61-1007"><a href="#cb61-1007" aria-hidden="true" tabindex="-1"></a>mod50cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb61-1008"><a href="#cb61-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1009"><a href="#cb61-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1010"><a href="#cb61-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dump-files-cv, eval = FALSE}</span></span>
<span id="cb61-1011"><a href="#cb61-1011" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastructcv, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1012"><a href="#cb61-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1013"><a href="#cb61-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1014"><a href="#cb61-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1015"><a href="#cb61-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1016"><a href="#cb61-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1017"><a href="#cb61-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1018"><a href="#cb61-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1019"><a href="#cb61-1019" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-1020"><a href="#cb61-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1021"><a href="#cb61-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1022"><a href="#cb61-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-load-cv}</span></span>
<span id="cb61-1023"><a href="#cb61-1023" aria-hidden="true" tabindex="-1"></a>fitcv <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb61-1024"><a href="#cb61-1024" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb61-1025"><a href="#cb61-1025" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb61-1026"><a href="#cb61-1026" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb61-1027"><a href="#cb61-1027" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb61-1028"><a href="#cb61-1028" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb61-1029"><a href="#cb61-1029" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb61-1030"><a href="#cb61-1030" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb61-1031"><a href="#cb61-1031" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb61-1032"><a href="#cb61-1032" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb61-1033"><a href="#cb61-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1034"><a href="#cb61-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1035"><a href="#cb61-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">## Genereted quantitites</span></span>
<span id="cb61-1036"><a href="#cb61-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1037"><a href="#cb61-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities-cv, eval=FALSE}</span></span>
<span id="cb61-1038"><a href="#cb61-1038" aria-hidden="true" tabindex="-1"></a>mod50cvgq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb61-1039"><a href="#cb61-1039" aria-hidden="true" tabindex="-1"></a>fitcvgq  <span class="ot">&lt;-</span> mod50cvgq<span class="sc">$</span><span class="fu">generate_quantities</span>(fitcv,</span>
<span id="cb61-1040"><a href="#cb61-1040" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastructcv,</span>
<span id="cb61-1041"><a href="#cb61-1041" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb61-1042"><a href="#cb61-1042" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb61-1043"><a href="#cb61-1043" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb61-1044"><a href="#cb61-1044" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span>
<span id="cb61-1045"><a href="#cb61-1045" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1046"><a href="#cb61-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1047"><a href="#cb61-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eta-load-cv}</span></span>
<span id="cb61-1048"><a href="#cb61-1048" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb61-1049"><a href="#cb61-1049" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb61-1050"><a href="#cb61-1050" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb61-1051"><a href="#cb61-1051" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb61-1052"><a href="#cb61-1052" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb61-1053"><a href="#cb61-1053" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb61-1054"><a href="#cb61-1054" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb61-1055"><a href="#cb61-1055" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb61-1056"><a href="#cb61-1056" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb61-1057"><a href="#cb61-1057" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb61-1058"><a href="#cb61-1058" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb61-1059"><a href="#cb61-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1060"><a href="#cb61-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1061"><a href="#cb61-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb61-1062"><a href="#cb61-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1063"><a href="#cb61-1063" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters.</span>
<span id="cb61-1064"><a href="#cb61-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1065"><a href="#cb61-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary-cv}</span></span>
<span id="cb61-1066"><a href="#cb61-1066" aria-hidden="true" tabindex="-1"></a>fitcv<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">15</span>)</span>
<span id="cb61-1067"><a href="#cb61-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1068"><a href="#cb61-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1069"><a href="#cb61-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictions</span></span>
<span id="cb61-1070"><a href="#cb61-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-predictions-cv}</span></span>
<span id="cb61-1071"><a href="#cb61-1071" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb61-1072"><a href="#cb61-1072" aria-hidden="true" tabindex="-1"></a>fun_plot_ind_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">.analytes_idx=</span>analytes_idx){</span>
<span id="cb61-1073"><a href="#cb61-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1074"><a href="#cb61-1074" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-1075"><a href="#cb61-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-1076"><a href="#cb61-1076" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb61-1077"><a href="#cb61-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb61-1078"><a href="#cb61-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-1079"><a href="#cb61-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> .analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb61-1080"><a href="#cb61-1080" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1081"><a href="#cb61-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkind =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1082"><a href="#cb61-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkpop =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1083"><a href="#cb61-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb61-1084"><a href="#cb61-1084" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkind), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-1085"><a href="#cb61-1085" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkpop), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-1086"><a href="#cb61-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> .analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span></span>
<span id="cb61-1087"><a href="#cb61-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte, <span class="at">ncol=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb61-1088"><a href="#cb61-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual and population)"</span>) <span class="sc">+</span></span>
<span id="cb61-1089"><a href="#cb61-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb61-1090"><a href="#cb61-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb61-1091"><a href="#cb61-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p1)</span>
<span id="cb61-1092"><a href="#cb61-1092" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-1093"><a href="#cb61-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1094"><a href="#cb61-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb61-1095"><a href="#cb61-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb61-1096"><a href="#cb61-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>])</span>
<span id="cb61-1097"><a href="#cb61-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">31</span><span class="sc">:</span><span class="dv">40</span>])</span>
<span id="cb61-1098"><a href="#cb61-1098" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">41</span><span class="sc">:</span><span class="dv">50</span>])</span>
<span id="cb61-1099"><a href="#cb61-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb61-1100"><a href="#cb61-1100" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb61-1101"><a href="#cb61-1101" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>])</span>
<span id="cb61-1102"><a href="#cb61-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">31</span><span class="sc">:</span><span class="dv">40</span>])</span>
<span id="cb61-1103"><a href="#cb61-1103" aria-hidden="true" tabindex="-1"></a><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">41</span><span class="sc">:</span><span class="dv">50</span>])</span>
<span id="cb61-1104"><a href="#cb61-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1105"><a href="#cb61-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1106"><a href="#cb61-1106" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusions</span></span>
<span id="cb61-1107"><a href="#cb61-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1108"><a href="#cb61-1108" aria-hidden="true" tabindex="-1"></a>The work demonstrates a general framework for integrating molecular similarity into the retention modeling workflow.</span>
<span id="cb61-1109"><a href="#cb61-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1110"><a href="#cb61-1110" aria-hidden="true" tabindex="-1"></a><span class="fu"># References {.unnumbered}</span></span>
<span id="cb61-1111"><a href="#cb61-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1112"><a href="#cb61-1112" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb61-1113"><a href="#cb61-1113" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1114"><a href="#cb61-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1115"><a href="#cb61-1115" aria-hidden="true" tabindex="-1"></a><span class="fu"># Licenses {.unnumbered}</span></span>
<span id="cb61-1116"><a href="#cb61-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1117"><a href="#cb61-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Code &amp; copy; 2025, Paweł Wiczling, licensed under BSD-3.</span>
<span id="cb61-1118"><a href="#cb61-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Text &amp; copy; 2025, Paweł Wiczling, licensed under CC-BY-NC 4.0.</span>
<span id="cb61-1119"><a href="#cb61-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1120"><a href="#cb61-1120" aria-hidden="true" tabindex="-1"></a><span class="fu"># Original Computing Environment {.unnumbered}</span></span>
<span id="cb61-1121"><a href="#cb61-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1124"><a href="#cb61-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1125"><a href="#cb61-1125" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb61-1126"><a href="#cb61-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>