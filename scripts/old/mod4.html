<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2024-02-22">

<title>QSRR revisited. Hierarchical models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mod4_files/libs/clipboard/clipboard.min.js"></script>
<script src="mod4_files/libs/quarto-html/quarto.js"></script>
<script src="mod4_files/libs/quarto-html/popper.min.js"></script>
<script src="mod4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mod4_files/libs/quarto-html/anchor.min.js"></script>
<link href="mod4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mod4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mod4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mod4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mod4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory data analysis</a></li>
  <li><a href="#prepare-data-for-calculations" id="toc-prepare-data-for-calculations" class="nav-link" data-scroll-target="#prepare-data-for-calculations">Prepare data for calculations</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">QSRR revisited. Hierarchical models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<p>The packages we will use are listed below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod4_cache/html/paths_c97150d6bfda2d17f3f8ec0dd1aec26e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod4"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>stanfiles_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"stanfiles"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>stan_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tabels_dir)) <span class="fu">dir.create</span>(tabels_dir)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(stanfiles_dir)) <span class="fu">dir.create</span>(stanfiles_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35^{}C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient.</p>
<div class="cell" data-hash="mod4_cache/html/rxnsim-similarity_085adfc25d98a6e716d8138f1ef2dc95">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher to run Rxnsim (will fix later)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod4_cache/html/load-data_2b34baedcbef6988bbae03160ccc3a62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>makeSymm <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    m[<span class="fu">upper.tri</span>(m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(m)[<span class="fu">upper.tri</span>(m)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(m)}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">makeSymm</span>(simMat)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory data analysis</h1>
<p>During the exploratory data analysis phase, we create a series of plots to better understand our data.</p>
<div class="cell" data-hash="mod4_cache/html/similarity-matrixplot_b1b18f432e104b0cadc22b15fad3468d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/similarity-matrixplot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[101:200,101:200])</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[201:300,201:300])</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[301:400,301:400])</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[401:500,401:500])</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[501:600,501:600])</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[601:700,601:700])</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[701:800,701:800])</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[801:900,801:900])</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[901:1026,901:1026])</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.95</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[selected_compounds,selected_compounds])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/similarity-matrixplot-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod4_cache/html/clusterring_b361f943425600ce95db3dd9816f8efe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">hclust</span>(<span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span>simMat), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/clusterring-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cut_avg <span class="ot">&lt;-</span> <span class="fu">cutree</span>(x, <span class="at">k =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod4_cache/html/raw-data_9d0c7c80f8c56d44c47aeaf6b3943258">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/raw-data-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</p>
<div class="cell" data-hash="mod4_cache/html/pH-plot_9bac25e0c7eea4df971b2e1562298ae6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/pH-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The values of molecular mass MM were added to the dataset. They were calculated using <a href="www.acdlabs.com">ACD/Labs program</a> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</p>
<div class="cell" data-hash="mod4_cache/html/hist-MW-logP_0bc9090229283881323bac5b378a9563">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/hist-MW-logP-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</p>
<div class="cell" data-hash="mod4_cache/html/functional-group-summary_2b2f8df6bb1e5e8cc813328bf36194ac">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/functional-group-summary-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="prepare-data-for-calculations" class="level1">
<h1>Prepare data for calculations</h1>
<div class="cell" data-hash="mod4_cache/html/unnamed-chunk-1_50ae4c48c7e57905fa746118f03c3951">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod4_cache/html/initial-estimates_b1876a95dbec76b1947a9ee07eff2662">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod4_cache/html/initial-estimates-plot_6f64220df0bb48fbf828763bffcd7cc4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/initial-estimates-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a …</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk  = logk_w - S_1 \cdot (1 + S_2) \cdot \varphi / (1 + S_2 \cdot \varphi)
\end{aligned}
\]</span></p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell" data-hash="mod4_cache/html/stansetup_9e803607072973f61e92b5f0d317c01a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">maxR=</span><span class="fu">max</span>(R),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">R=</span>R,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsA=</span>nGroupsA,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsB=</span>nGroupsB,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitA=</span>pKaslitA,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitB=</span>pKaslitB,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsA=</span>idxGroupsA,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsB=</span>idxGroupsB,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>data<span class="sc">$</span>logk,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">K =</span> K,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nA0 =</span> nA0,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nB0 =</span> nB0,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxA0 =</span> idxA0,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxB0 =</span> idxB0,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat   =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">kappa =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.125</span>)),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">paramN =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,K),</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,K),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwA0 =</span> <span class="fu">rnorm</span>(nA0,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1A0 =</span> <span class="fu">rnorm</span>(nA0,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwB0 =</span> <span class="fu">rnorm</span>(nB0,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1B0 =</span> <span class="fu">rnorm</span>(nB0,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwA =</span> <span class="fu">rnorm</span>(nGroupsA,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1A =</span> <span class="fu">rnorm</span>(nGroupsA,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwB =</span> <span class="fu">rnorm</span>(nGroupsB,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1B =</span> <span class="fu">rnorm</span>(nGroupsB,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<p>We compiled the model using cmdstanr:</p>
<div class="cell" data-hash="mod4_cache/html/stancompile_1677cee54051879720454e84b3c37d03">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(model_dir,<span class="st">".stan"</span>), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used optimization for initial testing:</p>
<div class="cell" data-hash="mod4_cache/html/stanoptimize_3259a1e48fb3554b58a630272f84e9a1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-opt"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">5000</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod4_cache/html/optplots_56ed9dfde62b62a3483e2aee9a827dc8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For local computations one can use cmdstanr:</p>
<div class="cell" data-hash="mod4_cache/html/stansample_5b3079064892d16974ac11e8e0b9f41f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-loc"</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We performed out computations at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>. In this case:</p>
<ol type="1">
<li>we dumped the necessary data to .json format</li>
</ol>
<div class="cell" data-hash="mod4_cache/html/dumpfiles_2e4020629c232121ed3295d7f327d629">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>we run the model using the batch file:</li>
</ol>
<pre> 
</pre>
<ol start="3" type="1">
<li>After calculations, we loaded the output files using cmdstanr.</li>
</ol>
<div class="cell" data-hash="mod4_cache/html/stanload_54dfe4f0b46035a602c1a953a618bc56">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell" data-hash="mod4_cache/html/standiagnose_3af52f2c53a4f50a64683d6fadf5051e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(stanfiles_dir)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod1_*.csv'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The diagnostics are reasonable given model complexity. Output copied here to save time:</p>
<pre></pre>
</section>
<section id="summary-of-model-parameters-table" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell" data-hash="mod4_cache/html/summary_e0524862566ec24cbb029adfda1d07e4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    variable     mean   median    sd   mad       q5      q95 rhat ess_bulk
 lp__        10873.24 10873.45 59.48 60.64 10777.58 10970.30 1.02      636
 logkwHat        1.70     1.70  0.12  0.12     1.50     1.90 1.02      590
 S1Hat           2.90     2.90  0.11  0.11     2.72     3.07 1.01      793
 dlogkwHat      -0.53    -0.54  0.10  0.10    -0.69    -0.36 1.08      100
 dS1Hat          0.41     0.40  0.09  0.09     0.26     0.56 1.07      100
 S2Hat           2.82     2.82  0.03  0.03     2.76     2.87 1.03      309
 beta[1]         0.89     0.89  0.03  0.03     0.85     0.94 1.00     2901
 beta[2]         0.70     0.70  0.02  0.02     0.66     0.74 1.00     2255
 omega[1]        1.40     1.40  0.04  0.04     1.34     1.46 1.00     1536
 omega[2]        1.18     1.18  0.03  0.03     1.12     1.24 1.01     1521
 kappa[1]        0.27     0.28  0.09  0.09     0.11     0.41 1.13       47
 kappa[2]        0.56     0.56  0.04  0.04     0.49     0.63 1.02      438
 rho[1,1]        1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 rho[2,1]        0.93     0.93  0.01  0.01     0.92     0.94 1.01     1308
 rho[1,2]        0.93     0.93  0.01  0.01     0.92     0.94 1.01     1308
 rho[2,2]        1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 sigma           0.05     0.05  0.00  0.00     0.05     0.05 1.00     1851
 pilogkw[1]      0.01     0.01  0.22  0.22    -0.34     0.38 1.00     8333
 pilogkw[2]      0.29     0.29  0.10  0.10     0.12     0.45 1.00     4226
 pilogkw[3]     -0.24    -0.24  0.24  0.23    -0.64     0.12 1.00     5756
 pilogkw[4]      0.09     0.09  0.22  0.22    -0.27     0.45 1.00     7431
 pilogkw[5]     -0.11    -0.10  0.22  0.22    -0.47     0.24 1.00     6288
 pilogkw[6]      0.01     0.01  0.19  0.19    -0.29     0.32 1.00     6746
 pilogkw[7]      0.21     0.20  0.21  0.21    -0.14     0.58 1.00     5977
 pilogkw[8]      0.23     0.23  0.23  0.23    -0.15     0.62 1.00     5794
 pilogkw[9]      0.22     0.22  0.15  0.15    -0.03     0.48 1.00     4715
 pilogkw[10]     0.11     0.11  0.20  0.19    -0.22     0.43 1.00     6570
 pilogkw[11]    -0.05    -0.05  0.21  0.21    -0.41     0.30 1.00     6905
 pilogkw[12]     0.14     0.13  0.22  0.21    -0.22     0.50 1.00     5950
 pilogkw[13]    -0.04    -0.04  0.18  0.17    -0.33     0.26 1.00     5708
 pilogkw[14]     0.06     0.05  0.19  0.19    -0.26     0.37 1.00     6198
 pilogkw[15]     0.04     0.04  0.20  0.19    -0.28     0.36 1.00     5886
 pilogkw[16]     0.05     0.05  0.14  0.15    -0.18     0.29 1.00     5641
 pilogkw[17]     0.24     0.24  0.10  0.10     0.08     0.40 1.00     3879
 pilogkw[18]     0.09     0.09  0.15  0.15    -0.15     0.34 1.00     4589
 pilogkw[19]     0.44     0.44  0.15  0.15     0.20     0.69 1.00     3892
 pilogkw[20]    -0.04    -0.04  0.19  0.19    -0.34     0.27 1.00     6604
 pilogkw[21]    -0.08    -0.08  0.07  0.07    -0.20     0.03 1.00     4652
 pilogkw[22]    -0.14    -0.14  0.16  0.16    -0.41     0.13 1.00     5043
 pilogkw[23]     0.33     0.33  0.15  0.14     0.08     0.57 1.00     3985
 pilogkw[24]     0.22     0.22  0.05  0.05     0.14     0.31 1.00     3515
 pilogkw[25]     0.31     0.30  0.17  0.17     0.04     0.59 1.00     3691
 pilogkw[26]     0.27     0.27  0.16  0.16     0.01     0.53 1.01     4333
 pilogkw[27]     0.04     0.04  0.23  0.23    -0.34     0.42 1.00     8052
 pilogkw[28]     0.12     0.12  0.18  0.17    -0.17     0.43 1.00     4414
 pilogkw[29]    -0.03    -0.03  0.22  0.21    -0.40     0.33 1.00     7774
 pilogkw[30]    -0.05    -0.05  0.17  0.16    -0.32     0.22 1.00     2581
 pilogkw[31]    -0.14    -0.14  0.13  0.13    -0.35     0.07 1.00     4323
 pilogkw[32]    -0.23    -0.22  0.17  0.16    -0.50     0.03 1.00     1992
 pilogkw[33]    -0.08    -0.08  0.15  0.16    -0.33     0.18 1.00     5803
 pilogkw[34]    -0.05    -0.05  0.19  0.19    -0.37     0.26 1.00     5898
 pilogkw[35]    -0.21    -0.20  0.12  0.12    -0.41    -0.01 1.02      356
 pilogkw[36]     0.00     0.00  0.14  0.14    -0.24     0.24 1.00     4558
 pilogkw[37]     0.32     0.31  0.22  0.22    -0.03     0.69 1.01     1607
 pilogkw[38]    -0.01    -0.01  0.23  0.23    -0.38     0.36 1.00     7168
 pilogkw[39]    -0.13    -0.13  0.19  0.19    -0.46     0.18 1.00     5737
 pilogkw[40]     0.02     0.02  0.18  0.18    -0.29     0.32 1.00     6465
 pilogkw[41]     0.01     0.01  0.22  0.22    -0.35     0.37 1.00     6856
 pilogkw[42]     0.29     0.29  0.13  0.13     0.09     0.51 1.00     4511
 pilogkw[43]     0.11     0.11  0.07  0.07    -0.01     0.23 1.00     4844
 pilogkw[44]    -0.08    -0.08  0.19  0.19    -0.38     0.23 1.00     5226
 pilogkw[45]    -0.08    -0.08  0.19  0.19    -0.39     0.23 1.00     7100
 pilogkw[46]     0.22     0.21  0.23  0.23    -0.15     0.60 1.00     5497
 pilogkw[47]     0.08     0.08  0.10  0.10    -0.09     0.25 1.00     4651
 pilogkw[48]     0.38     0.38  0.10  0.10     0.21     0.56 1.00     3244
 pilogkw[49]     0.11     0.11  0.17  0.17    -0.17     0.40 1.00     5151
 pilogkw[50]    -0.01    -0.01  0.19  0.18    -0.32     0.29 1.00     6667
 pilogkw[51]     0.35     0.35  0.12  0.12     0.16     0.54 1.00     2620
 pilogkw[52]     0.11     0.10  0.15  0.15    -0.13     0.34 1.00     4620
 pilogkw[53]     0.00     0.00  0.17  0.18    -0.29     0.28 1.00     5507
 pilogkw[54]     0.03     0.03  0.21  0.20    -0.30     0.37 1.00     6960
 pilogkw[55]    -0.08    -0.07  0.23  0.22    -0.46     0.28 1.00     7531
 pilogkw[56]    -0.25    -0.24  0.19  0.19    -0.55     0.06 1.00     3421
 pilogkw[57]     0.21     0.21  0.18  0.18    -0.09     0.52 1.00     4147
 pilogkw[58]    -0.05    -0.05  0.22  0.22    -0.42     0.31 1.00     8502
 pilogkw[59]    -0.06    -0.06  0.21  0.20    -0.40     0.28 1.00     6652
 pilogkw[60]     0.12     0.12  0.10  0.10    -0.04     0.28 1.00     3750
 pilogkw[61]    -0.16    -0.15  0.21  0.21    -0.51     0.19 1.00     6051
 pilogkw[62]     0.13     0.13  0.19  0.18    -0.18     0.44 1.00     6864
 pilogkw[63]     0.01     0.01  0.20  0.19    -0.31     0.34 1.00     7197
 pilogkw[64]     0.12     0.12  0.20  0.20    -0.20     0.45 1.00     6938
 pilogkw[65]     0.02     0.01  0.23  0.22    -0.36     0.40 1.00     7674
 pilogkw[66]    -0.18    -0.17  0.23  0.23    -0.57     0.18 1.00     6869
 pilogkw[67]     0.10     0.10  0.19  0.19    -0.22     0.42 1.00     6064
 pilogkw[68]     0.04     0.03  0.15  0.15    -0.21     0.29 1.00     6111
 pilogkw[69]     0.04     0.03  0.21  0.21    -0.31     0.40 1.00     7065
 pilogkw[70]     0.09     0.08  0.21  0.20    -0.25     0.44 1.00     6533
 pilogkw[71]     0.11     0.11  0.15  0.16    -0.13     0.37 1.00     5775
 pilogkw[72]     0.02     0.03  0.23  0.22    -0.35     0.40 1.00     8034
 pilogkw[73]     0.03     0.03  0.22  0.21    -0.33     0.38 1.00     8139
 pilogkw[74]    -0.13    -0.13  0.21  0.20    -0.47     0.20 1.00     6180
 pilogkw[75]    -0.40    -0.40  0.18  0.18    -0.70    -0.11 1.00     3943
 pilogkw[76]     0.09     0.08  0.23  0.23    -0.29     0.49 1.00     6777
 pilogkw[77]     0.01     0.01  0.22  0.22    -0.35     0.37 1.00     7045
 pilogkw[78]     0.09     0.09  0.23  0.22    -0.28     0.47 1.00     6357
 pilogkw[79]     0.03     0.02  0.23  0.24    -0.36     0.42 1.00     7517
 pilogkw[80]     0.16     0.15  0.16  0.16    -0.11     0.43 1.00     4715
 pilogkw[81]     0.07     0.06  0.23  0.22    -0.31     0.45 1.00     8694
 pilogkw[82]     0.02     0.02  0.21  0.21    -0.33     0.36 1.00     5873
 pilogkw[83]     0.22     0.21  0.23  0.22    -0.15     0.60 1.00     4823
 pilogkw[84]     0.21     0.21  0.15  0.15    -0.03     0.45 1.00     4417
 pilogkw[85]     0.00    -0.01  0.23  0.23    -0.38     0.38 1.00     7772
 pilogkw[86]     0.10     0.10  0.21  0.21    -0.23     0.45 1.00     5792
 pilogkw[87]    -0.11    -0.11  0.21  0.21    -0.46     0.24 1.00     6585
 pilogkw[88]     0.04     0.03  0.23  0.23    -0.35     0.42 1.00     7374
 pilogkw[89]     0.14     0.14  0.18  0.18    -0.14     0.44 1.00     5470
 pilogkw[90]    -0.02    -0.02  0.19  0.18    -0.33     0.28 1.00     6362
 pilogkw[91]     0.39     0.38  0.19  0.19     0.09     0.71 1.00     3012
 pilogkw[92]     0.07     0.07  0.21  0.21    -0.27     0.43 1.00     6061
 pilogkw[93]     0.22     0.22  0.25  0.25    -0.18     0.65 1.00     5616
 pilogkw[94]    -0.01     0.00  0.23  0.22    -0.38     0.37 1.00     7558
 pilogkw[95]     0.13     0.13  0.07  0.07     0.01     0.24 1.00     4419
 pilogkw[96]    -0.03    -0.03  0.17  0.17    -0.32     0.26 1.00     5987
 pilogkw[97]     0.07     0.07  0.20  0.19    -0.26     0.40 1.00     6111
 pilogkw[98]     0.26     0.26  0.20  0.19    -0.06     0.59 1.00     5176
 piS1[1]        -0.08    -0.07  0.23  0.23    -0.45     0.30 1.00     7183
 piS1[2]         0.23     0.24  0.09  0.09     0.09     0.37 1.00     4255
 piS1[3]         0.47     0.47  0.27  0.26     0.04     0.92 1.00     5645
 piS1[4]        -0.21    -0.21  0.26  0.26    -0.65     0.21 1.00     7624
 piS1[5]         0.64     0.63  0.23  0.23     0.26     1.03 1.00     4268
 piS1[6]         0.05     0.04  0.18  0.18    -0.24     0.34 1.00     6486
 piS1[7]        -0.06    -0.06  0.21  0.21    -0.40     0.28 1.00     5579
 piS1[8]        -0.19    -0.19  0.26  0.25    -0.62     0.21 1.00     6639
 piS1[9]         0.07     0.07  0.14  0.14    -0.17     0.30 1.00     4490
 piS1[10]        0.03     0.03  0.19  0.18    -0.28     0.33 1.00     6612
 piS1[11]        0.02     0.02  0.23  0.23    -0.36     0.40 1.00     5933
 piS1[12]       -0.17    -0.17  0.24  0.25    -0.57     0.22 1.00     5773
 piS1[13]        0.06     0.06  0.17  0.17    -0.22     0.33 1.00     5713
 piS1[14]        0.05     0.05  0.18  0.18    -0.25     0.34 1.00     5901
 piS1[15]       -0.13    -0.13  0.19  0.19    -0.43     0.18 1.00     6443
 piS1[16]        0.16     0.16  0.13  0.13    -0.05     0.36 1.00     4997
 piS1[17]        0.51     0.51  0.09  0.09     0.36     0.66 1.00     3629
 piS1[18]        0.20     0.19  0.14  0.14    -0.03     0.42 1.00     3923
 piS1[19]        0.07     0.07  0.13  0.13    -0.14     0.28 1.00     3626
 piS1[20]        0.15     0.15  0.19  0.18    -0.16     0.46 1.00     4375
 piS1[21]        0.03     0.03  0.06  0.06    -0.06     0.13 1.00     4331
 piS1[22]       -0.02    -0.02  0.15  0.14    -0.27     0.22 1.00     4708
 piS1[23]        0.33     0.33  0.13  0.13     0.12     0.55 1.00     4211
 piS1[24]        0.22     0.22  0.05  0.05     0.14     0.29 1.00     3658
 piS1[25]        0.33     0.32  0.15  0.15     0.08     0.58 1.00     4038
 piS1[26]        0.28     0.28  0.14  0.14     0.05     0.52 1.00     4328
 piS1[27]       -0.03    -0.02  0.27  0.27    -0.48     0.42 1.00     6181
 piS1[28]        0.33     0.32  0.17  0.18     0.05     0.61 1.00     4212
 piS1[29]       -0.04    -0.04  0.24  0.24    -0.43     0.34 1.00     6897
 piS1[30]        0.23     0.23  0.17  0.17    -0.05     0.49 1.00     3036
 piS1[31]        0.34     0.34  0.12  0.12     0.14     0.53 1.00     3887
 piS1[32]        0.21     0.21  0.17  0.16    -0.06     0.48 1.00     2490
 piS1[33]        0.03     0.02  0.14  0.14    -0.20     0.26 1.00     5386
 piS1[34]       -0.16    -0.16  0.18  0.18    -0.46     0.15 1.00     5244
 piS1[35]        0.26     0.26  0.11  0.11     0.08     0.45 1.02      542
 piS1[36]       -0.04    -0.04  0.13  0.13    -0.27     0.17 1.00     3765
 piS1[37]        1.38     1.38  0.23  0.23     1.02     1.76 1.01     1358
 piS1[38]       -0.03    -0.03  0.24  0.24    -0.43     0.36 1.00     5875
 piS1[39]        0.06     0.05  0.19  0.19    -0.26     0.37 1.00     6208
 piS1[40]        0.13     0.13  0.17  0.16    -0.14     0.41 1.00     6017
 piS1[41]       -0.02    -0.02  0.26  0.25    -0.44     0.41 1.00     8026
 piS1[42]        0.40     0.40  0.11  0.12     0.21     0.59 1.00     3535
 piS1[43]        0.11     0.11  0.06  0.06     0.01     0.22 1.00     4745
 piS1[44]       -0.07    -0.07  0.18  0.17    -0.37     0.22 1.00     5307
 piS1[45]        0.08     0.08  0.19  0.19    -0.23     0.39 1.00     5397
 piS1[46]       -0.05    -0.05  0.26  0.25    -0.47     0.37 1.00     7495
 piS1[47]        0.26     0.26  0.09  0.10     0.11     0.42 1.00     4221
 piS1[48]        0.38     0.38  0.09  0.09     0.23     0.53 1.00     3274
 piS1[49]        0.00     0.00  0.16  0.16    -0.26     0.26 1.00     4772
 piS1[50]        0.01     0.01  0.18  0.18    -0.28     0.31 1.00     4556
 piS1[51]        0.43     0.43  0.10  0.10     0.27     0.59 1.00     2650
 piS1[52]        0.16     0.16  0.13  0.13    -0.05     0.39 1.00     4654
 piS1[53]        0.09     0.09  0.16  0.16    -0.18     0.35 1.00     5112
 piS1[54]       -0.29    -0.29  0.21  0.22    -0.65     0.05 1.00     5411
 piS1[55]        0.14     0.14  0.26  0.25    -0.30     0.57 1.01     7130
 piS1[56]        0.07     0.07  0.18  0.18    -0.23     0.36 1.00     4070
 piS1[57]        0.23     0.23  0.17  0.17    -0.04     0.51 1.00     4174
 piS1[58]        0.15     0.15  0.26  0.26    -0.27     0.59 1.00     6220
 piS1[59]        0.23     0.22  0.23  0.23    -0.15     0.61 1.00     7129
 piS1[60]        0.23     0.23  0.09  0.09     0.09     0.37 1.00     3432
 piS1[61]        0.12     0.12  0.22  0.23    -0.25     0.49 1.00     6285
 piS1[62]        0.07     0.07  0.20  0.20    -0.26     0.41 1.00     6061
 piS1[63]        0.01     0.01  0.22  0.21    -0.35     0.37 1.00     7038
 piS1[64]        0.06     0.06  0.22  0.21    -0.30     0.42 1.00     6352
 piS1[65]       -0.02    -0.01  0.26  0.26    -0.45     0.40 1.00     7362
 ess_tail
     1477
     1568
     1621
      245
      295
      624
     2974
     3065
     2481
     2711
       97
     1137
       NA
     2542
     2542
       NA
     2493
     3040
     3316
     2540
     2939
     3355
     3544
     2915
     3034
     3166
     3104
     2589
     3124
     3004
     2921
     2959
     3350
     3229
     2989
     3415
     3131
     3534
     3701
     2539
     3189
     3190
     2851
     3011
     3190
     2935
     2997
     3033
     2954
     3293
     3049
     1091
     2842
     2295
     2989
     3576
     3024
     3060
     2832
     3152
     2735
     3459
     3168
     3374
     3114
     3149
     2682
     2926
     3046
     3316
     3454
     2951
     2697
     3372
     3336
     3080
     2742
     3099
     2905
     3094
     2909
     3106
     3163
     3236
     3379
     3284
     3093
     2946
     2757
     3039
     3126
     2874
     2912
     2788
     3306
     3093
     3111
     2605
     3034
     2881
     3150
     3196
     2843
     3082
     3307
     3150
     3345
     2616
     2802
     2598
     3019
     2943
     3216
     2835
     2946
     2867
     3073
     3364
     2993
     3328
     2962
     2857
     3031
     3272
     2899
     3168
     3256
     2840
     2979
     3173
     3244
     3197
     2623
     3393
     3390
     3411
     3159
     3027
     3337
     3004
     3515
     3006
     3227
     3052
     3092
     2719
     2895
     2828
     3195
     1694
     2980
     2308
     3140
     3507
     3168
     3037
     3211
     3157
     3234
     3251
     2769
     3041
     3204
     3082
     3041
     3286
     2701
     3195
     3349
     2832
     3036
     3262
     3840
     3621
     3130
     2717
     3127
     2857
     2820
     2778

 # showing 180 of 19402 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="trace-plots" class="level2">
<h2 class="anchored" data-anchor-id="trace-plots">Trace plots</h2>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell" data-hash="mod4_cache/html/trace-plots_1f427a67a21ae8dab53b337aea437099">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-figures">Summary of model parameters (figures)</h2>
<div class="cell" data-hash="mod4_cache/html/mcmc-intervals_8d01d873e1f26a9737eb0e71337f1a66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod4_files/figure-html/mcmc-intervals-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod4_cache/html/info_e5e03d323dea37f33d84597996d10e22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.3 (2022-03-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22631)

Matrix products: default

locale:
[1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
[3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.1250    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggcorrplot_0.1.4.1 here_1.0.1         pracma_2.4.4       reshape2_1.4.4    
 [5] GGally_2.2.0       bayesplot_1.10.0   posterior_1.5.0    dplyr_1.1.3       
 [9] tidyr_1.3.0        rstan_2.32.5       StanHeaders_2.32.5 patchwork_1.2.0   
[13] gridExtra_2.3      ggplot2_3.4.4      cmdstanr_0.5.3    

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.12          QuickJSR_1.0.9       rprojroot_2.0.4     
 [4] digest_0.6.34        utf8_1.2.3           R6_2.5.1            
 [7] plyr_1.8.9           backports_1.4.1      stats4_4.1.3        
[10] evaluate_0.23        pillar_1.9.0         rlang_1.1.0         
[13] rstudioapi_0.15.0    checkmate_2.2.0      rmarkdown_2.25      
[16] labeling_0.4.3       textshaping_0.3.7    stringr_1.5.1       
[19] htmlwidgets_1.6.4    loo_2.6.0            munsell_0.5.0       
[22] compiler_4.1.3       xfun_0.41            pkgconfig_2.0.3     
[25] systemfonts_1.0.5    pkgbuild_1.4.3       ggstats_0.5.1       
[28] htmltools_0.5.7      tidyselect_1.2.0     tibble_3.2.1        
[31] tensorA_0.36.2       codetools_0.2-18     matrixStats_1.2.0   
[34] fansi_1.0.4          withr_3.0.0          grid_4.1.3          
[37] distributional_0.3.2 jsonlite_1.8.8       gtable_0.3.4        
[40] lifecycle_1.0.4      magrittr_2.0.3       scales_1.3.0        
[43] RcppParallel_5.1.7   cli_3.6.1            stringi_1.8.3       
[46] farver_2.1.1         ragg_1.2.7           generics_0.1.3      
[49] vctrs_0.6.2          RColorBrewer_1.1-3   tools_4.1.3         
[52] glue_1.6.2           purrr_1.0.1          abind_1.4-5         
[55] parallel_4.1.3       fastmap_1.1.1        yaml_2.3.8          
[58] inline_0.3.19        colorspace_2.0-3     knitr_1.45          </code></pre>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb32" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "QSRR revisited. Hierarchical models"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>The packages we will use are listed below.</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r paths}</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod4"</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>stanfiles_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"stanfiles"</span>)</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>stan_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>)</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir)</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tabels_dir)) <span class="fu">dir.create</span>(tabels_dir)</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir)</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(stanfiles_dir)) <span class="fu">dir.create</span>(stanfiles_dir)</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35\^{\circ}C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient.</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rxnsim-similarity, eval=FALSE}</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher to run Rxnsim (will fix later)</span></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>makeSymm <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>    m[<span class="fu">upper.tri</span>(m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(m)[<span class="fu">upper.tri</span>(m)]</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(m)}</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">makeSymm</span>(simMat)</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory data analysis</span></span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>During the exploratory data analysis phase, we create a series of plots to better understand our data.</span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r similarity-matrixplot}</span></span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[101:200,101:200])</span></span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[201:300,201:300])</span></span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[301:400,301:400])</span></span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[401:500,401:500])</span></span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[501:600,501:600])</span></span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[601:700,601:700])</span></span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[701:800,701:800])</span></span>
<span id="cb32-143"><a href="#cb32-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[801:900,801:900])</span></span>
<span id="cb32-144"><a href="#cb32-144" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[901:1026,901:1026])</span></span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-146"><a href="#cb32-146" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.95</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-147"><a href="#cb32-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb32-149"><a href="#cb32-149" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb32-150"><a href="#cb32-150" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb32-151"><a href="#cb32-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-152"><a href="#cb32-152" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[selected_compounds,selected_compounds])</span>
<span id="cb32-153"><a href="#cb32-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-154"><a href="#cb32-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-155"><a href="#cb32-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clusterring}</span></span>
<span id="cb32-156"><a href="#cb32-156" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">hclust</span>(<span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span>simMat), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb32-157"><a href="#cb32-157" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span>
<span id="cb32-158"><a href="#cb32-158" aria-hidden="true" tabindex="-1"></a>cut_avg <span class="ot">&lt;-</span> <span class="fu">cutree</span>(x, <span class="at">k =</span> <span class="dv">15</span>)</span>
<span id="cb32-159"><a href="#cb32-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-160"><a href="#cb32-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-161"><a href="#cb32-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb32-162"><a href="#cb32-162" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb32-163"><a href="#cb32-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb32-164"><a href="#cb32-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-165"><a href="#cb32-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb32-166"><a href="#cb32-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span>
<span id="cb32-167"><a href="#cb32-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-168"><a href="#cb32-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-169"><a href="#cb32-169" aria-hidden="true" tabindex="-1"></a>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</span>
<span id="cb32-170"><a href="#cb32-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-171"><a href="#cb32-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pH-plot, message=FALSE, warning=FALSE}</span></span>
<span id="cb32-172"><a href="#cb32-172" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-173"><a href="#cb32-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-174"><a href="#cb32-174" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb32-175"><a href="#cb32-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb32-176"><a href="#cb32-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb32-177"><a href="#cb32-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb32-178"><a href="#cb32-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span>
<span id="cb32-179"><a href="#cb32-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-180"><a href="#cb32-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-181"><a href="#cb32-181" aria-hidden="true" tabindex="-1"></a>The values of molecular mass MM were added to the dataset. They were calculated using <span class="co">[</span><span class="ot">ACD/Labs program</span><span class="co">](www.acdlabs.com)</span> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</span>
<span id="cb32-182"><a href="#cb32-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-183"><a href="#cb32-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hist-MW-logP,message=FALSE, warning=FALSE}</span></span>
<span id="cb32-184"><a href="#cb32-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-185"><a href="#cb32-185" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb32-186"><a href="#cb32-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-187"><a href="#cb32-187" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb32-188"><a href="#cb32-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb32-189"><a href="#cb32-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb32-190"><a href="#cb32-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb32-191"><a href="#cb32-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-192"><a href="#cb32-192" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb32-193"><a href="#cb32-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb32-194"><a href="#cb32-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb32-195"><a href="#cb32-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb32-196"><a href="#cb32-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-197"><a href="#cb32-197" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb32-198"><a href="#cb32-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-199"><a href="#cb32-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-200"><a href="#cb32-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-201"><a href="#cb32-201" aria-hidden="true" tabindex="-1"></a>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</span>
<span id="cb32-202"><a href="#cb32-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-203"><a href="#cb32-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-204"><a href="#cb32-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functional-group-summary, message=FALSE, warning=FALSE}</span></span>
<span id="cb32-205"><a href="#cb32-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-206"><a href="#cb32-206" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb32-207"><a href="#cb32-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-208"><a href="#cb32-208" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb32-209"><a href="#cb32-209" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb32-210"><a href="#cb32-210" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb32-211"><a href="#cb32-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-212"><a href="#cb32-212" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb32-213"><a href="#cb32-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-214"><a href="#cb32-214" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb32-215"><a href="#cb32-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb32-216"><a href="#cb32-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb32-217"><a href="#cb32-217" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb32-218"><a href="#cb32-218" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb32-219"><a href="#cb32-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb32-220"><a href="#cb32-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb32-221"><a href="#cb32-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-222"><a href="#cb32-222" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb32-223"><a href="#cb32-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb32-224"><a href="#cb32-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb32-225"><a href="#cb32-225" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb32-226"><a href="#cb32-226" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb32-227"><a href="#cb32-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb32-228"><a href="#cb32-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-229"><a href="#cb32-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb32-230"><a href="#cb32-230" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span>
<span id="cb32-231"><a href="#cb32-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-232"><a href="#cb32-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-233"><a href="#cb32-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-234"><a href="#cb32-234" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prepare data for calculations</span></span>
<span id="cb32-235"><a href="#cb32-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-238"><a href="#cb32-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-239"><a href="#cb32-239" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb32-240"><a href="#cb32-240" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb32-241"><a href="#cb32-241" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb32-242"><a href="#cb32-242" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb32-243"><a href="#cb32-243" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb32-244"><a href="#cb32-244" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb32-245"><a href="#cb32-245" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb32-246"><a href="#cb32-246" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb32-247"><a href="#cb32-247" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb32-248"><a href="#cb32-248" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb32-249"><a href="#cb32-249" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-250"><a href="#cb32-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-251"><a href="#cb32-251" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb32-252"><a href="#cb32-252" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb32-253"><a href="#cb32-253" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb32-254"><a href="#cb32-254" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb32-255"><a href="#cb32-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-256"><a href="#cb32-256" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb32-257"><a href="#cb32-257" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb32-258"><a href="#cb32-258" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb32-259"><a href="#cb32-259" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb32-260"><a href="#cb32-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-261"><a href="#cb32-261" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb32-262"><a href="#cb32-262" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb32-263"><a href="#cb32-263" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb32-264"><a href="#cb32-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-265"><a href="#cb32-265" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb32-266"><a href="#cb32-266" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb32-267"><a href="#cb32-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-268"><a href="#cb32-268" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb32-269"><a href="#cb32-269" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb32-270"><a href="#cb32-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-271"><a href="#cb32-271" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb32-272"><a href="#cb32-272" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb32-273"><a href="#cb32-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-274"><a href="#cb32-274" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb32-275"><a href="#cb32-275" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb32-276"><a href="#cb32-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-277"><a href="#cb32-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-278"><a href="#cb32-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-279"><a href="#cb32-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb32-280"><a href="#cb32-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-281"><a href="#cb32-281" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb32-282"><a href="#cb32-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-283"><a href="#cb32-283" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb32-284"><a href="#cb32-284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb32-285"><a href="#cb32-285" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb32-286"><a href="#cb32-286" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb32-287"><a href="#cb32-287" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb32-288"><a href="#cb32-288" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb32-289"><a href="#cb32-289" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-290"><a href="#cb32-290" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-291"><a href="#cb32-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-292"><a href="#cb32-292" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb32-293"><a href="#cb32-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-294"><a href="#cb32-294" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb32-295"><a href="#cb32-295" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb32-296"><a href="#cb32-296" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb32-297"><a href="#cb32-297" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb32-298"><a href="#cb32-298" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span>
<span id="cb32-299"><a href="#cb32-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-300"><a href="#cb32-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-301"><a href="#cb32-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates-plot}</span></span>
<span id="cb32-302"><a href="#cb32-302" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb32-303"><a href="#cb32-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb32-304"><a href="#cb32-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb32-305"><a href="#cb32-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span>
<span id="cb32-306"><a href="#cb32-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-307"><a href="#cb32-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-308"><a href="#cb32-308" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb32-309"><a href="#cb32-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-310"><a href="#cb32-310" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb32-311"><a href="#cb32-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-312"><a href="#cb32-312" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a ...</span>
<span id="cb32-313"><a href="#cb32-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-314"><a href="#cb32-314" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb32-315"><a href="#cb32-315" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb32-316"><a href="#cb32-316" aria-hidden="true" tabindex="-1"></a>&amp; logk  = logk_w - S_1 \cdot (1 + S_2) \cdot \varphi / (1 + S_2 \cdot \varphi)</span>
<span id="cb32-317"><a href="#cb32-317" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb32-318"><a href="#cb32-318" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb32-319"><a href="#cb32-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-320"><a href="#cb32-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-321"><a href="#cb32-321" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb32-322"><a href="#cb32-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-323"><a href="#cb32-323" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb32-324"><a href="#cb32-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-325"><a href="#cb32-325" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb32-326"><a href="#cb32-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-327"><a href="#cb32-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansetup}</span></span>
<span id="cb32-328"><a href="#cb32-328" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb32-329"><a href="#cb32-329" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb32-330"><a href="#cb32-330" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb32-331"><a href="#cb32-331" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb32-332"><a href="#cb32-332" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb32-333"><a href="#cb32-333" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb32-334"><a href="#cb32-334" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb32-335"><a href="#cb32-335" aria-hidden="true" tabindex="-1"></a>                       <span class="at">maxR=</span><span class="fu">max</span>(R),</span>
<span id="cb32-336"><a href="#cb32-336" aria-hidden="true" tabindex="-1"></a>                       <span class="at">R=</span>R,</span>
<span id="cb32-337"><a href="#cb32-337" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsA=</span>nGroupsA,</span>
<span id="cb32-338"><a href="#cb32-338" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsB=</span>nGroupsB,</span>
<span id="cb32-339"><a href="#cb32-339" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitA=</span>pKaslitA,</span>
<span id="cb32-340"><a href="#cb32-340" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitB=</span>pKaslitB,</span>
<span id="cb32-341"><a href="#cb32-341" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsA=</span>idxGroupsA,</span>
<span id="cb32-342"><a href="#cb32-342" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsB=</span>idxGroupsB,</span>
<span id="cb32-343"><a href="#cb32-343" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>data<span class="sc">$</span>logk,</span>
<span id="cb32-344"><a href="#cb32-344" aria-hidden="true" tabindex="-1"></a>                       <span class="at">K =</span> K,</span>
<span id="cb32-345"><a href="#cb32-345" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb32-346"><a href="#cb32-346" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nA0 =</span> nA0,</span>
<span id="cb32-347"><a href="#cb32-347" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nB0 =</span> nB0,</span>
<span id="cb32-348"><a href="#cb32-348" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxA0 =</span> idxA0,</span>
<span id="cb32-349"><a href="#cb32-349" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxB0 =</span> idxB0,</span>
<span id="cb32-350"><a href="#cb32-350" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb32-351"><a href="#cb32-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-352"><a href="#cb32-352" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb32-353"><a href="#cb32-353" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb32-354"><a href="#cb32-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb32-355"><a href="#cb32-355" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>),</span>
<span id="cb32-356"><a href="#cb32-356" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb32-357"><a href="#cb32-357" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat   =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb32-358"><a href="#cb32-358" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb32-359"><a href="#cb32-359" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb32-360"><a href="#cb32-360" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb32-361"><a href="#cb32-361" aria-hidden="true" tabindex="-1"></a>          <span class="at">kappa =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.125</span>)),</span>
<span id="cb32-362"><a href="#cb32-362" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb32-363"><a href="#cb32-363" aria-hidden="true" tabindex="-1"></a>          <span class="at">paramN =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb32-364"><a href="#cb32-364" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,K),</span>
<span id="cb32-365"><a href="#cb32-365" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,K),</span>
<span id="cb32-366"><a href="#cb32-366" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb32-367"><a href="#cb32-367" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwA0 =</span> <span class="fu">rnorm</span>(nA0,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb32-368"><a href="#cb32-368" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1A0 =</span> <span class="fu">rnorm</span>(nA0,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb32-369"><a href="#cb32-369" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwB0 =</span> <span class="fu">rnorm</span>(nB0,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb32-370"><a href="#cb32-370" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1B0 =</span> <span class="fu">rnorm</span>(nB0,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb32-371"><a href="#cb32-371" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwA =</span> <span class="fu">rnorm</span>(nGroupsA,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb32-372"><a href="#cb32-372" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1A =</span> <span class="fu">rnorm</span>(nGroupsA,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb32-373"><a href="#cb32-373" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadlogkwB =</span> <span class="fu">rnorm</span>(nGroupsB,<span class="dv">0</span>,<span class="fl">0.125</span>),</span>
<span id="cb32-374"><a href="#cb32-374" aria-hidden="true" tabindex="-1"></a>          <span class="at">etadS1B =</span> <span class="fu">rnorm</span>(nGroupsB,<span class="dv">0</span>,<span class="fl">0.125</span>), </span>
<span id="cb32-375"><a href="#cb32-375" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb32-376"><a href="#cb32-376" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-377"><a href="#cb32-377" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-378"><a href="#cb32-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-379"><a href="#cb32-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-380"><a href="#cb32-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-381"><a href="#cb32-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb32-382"><a href="#cb32-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-383"><a href="#cb32-383" aria-hidden="true" tabindex="-1"></a>We compiled the model using cmdstanr:</span>
<span id="cb32-384"><a href="#cb32-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-385"><a href="#cb32-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stancompile, eval = FALSE}</span></span>
<span id="cb32-386"><a href="#cb32-386" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(model_dir,<span class="st">".stan"</span>), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb32-387"><a href="#cb32-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-388"><a href="#cb32-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-389"><a href="#cb32-389" aria-hidden="true" tabindex="-1"></a>We used optimization for initial testing:</span>
<span id="cb32-390"><a href="#cb32-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-391"><a href="#cb32-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanoptimize, eval = FALSE}</span></span>
<span id="cb32-392"><a href="#cb32-392" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb32-393"><a href="#cb32-393" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb32-394"><a href="#cb32-394" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb32-395"><a href="#cb32-395" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-opt"</span>),</span>
<span id="cb32-396"><a href="#cb32-396" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb32-397"><a href="#cb32-397" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">5000</span></span>
<span id="cb32-398"><a href="#cb32-398" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-399"><a href="#cb32-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-400"><a href="#cb32-400" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span>
<span id="cb32-401"><a href="#cb32-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-402"><a href="#cb32-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-403"><a href="#cb32-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r optplots, eval=FALSE}</span></span>
<span id="cb32-404"><a href="#cb32-404" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb32-405"><a href="#cb32-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-406"><a href="#cb32-406" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb32-407"><a href="#cb32-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-408"><a href="#cb32-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb32-409"><a href="#cb32-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb32-410"><a href="#cb32-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb32-411"><a href="#cb32-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb32-412"><a href="#cb32-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb32-413"><a href="#cb32-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb32-414"><a href="#cb32-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb32-415"><a href="#cb32-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-416"><a href="#cb32-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-417"><a href="#cb32-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-418"><a href="#cb32-418" aria-hidden="true" tabindex="-1"></a>For local computations one can use cmdstanr:</span>
<span id="cb32-419"><a href="#cb32-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-420"><a href="#cb32-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansample, eval = FALSE}</span></span>
<span id="cb32-421"><a href="#cb32-421" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb32-422"><a href="#cb32-422" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb32-423"><a href="#cb32-423" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb32-424"><a href="#cb32-424" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-loc"</span>),</span>
<span id="cb32-425"><a href="#cb32-425" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb32-426"><a href="#cb32-426" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb32-427"><a href="#cb32-427" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb32-428"><a href="#cb32-428" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb32-429"><a href="#cb32-429" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb32-430"><a href="#cb32-430" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb32-431"><a href="#cb32-431" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb32-432"><a href="#cb32-432" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb32-433"><a href="#cb32-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-434"><a href="#cb32-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-435"><a href="#cb32-435" aria-hidden="true" tabindex="-1"></a>We performed out computations at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>. In this case:</span>
<span id="cb32-436"><a href="#cb32-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-437"><a href="#cb32-437" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we dumped the necessary data to .json format</span>
<span id="cb32-438"><a href="#cb32-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-439"><a href="#cb32-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dumpfiles, eval = FALSE}</span></span>
<span id="cb32-440"><a href="#cb32-440" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-441"><a href="#cb32-441" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-442"><a href="#cb32-442" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-443"><a href="#cb32-443" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-444"><a href="#cb32-444" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-445"><a href="#cb32-445" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-446"><a href="#cb32-446" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-447"><a href="#cb32-447" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-448"><a href="#cb32-448" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-449"><a href="#cb32-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-450"><a href="#cb32-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-451"><a href="#cb32-451" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we run the model using the batch file:</span>
<span id="cb32-452"><a href="#cb32-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-453"><a href="#cb32-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb32-454"><a href="#cb32-454" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb32-455"><a href="#cb32-455" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb32-456"><a href="#cb32-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-457"><a href="#cb32-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-458"><a href="#cb32-458" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb32-459"><a href="#cb32-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-460"><a href="#cb32-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanload}</span></span>
<span id="cb32-461"><a href="#cb32-461" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb32-462"><a href="#cb32-462" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb32-463"><a href="#cb32-463" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb32-464"><a href="#cb32-464" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb32-465"><a href="#cb32-465" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb32-466"><a href="#cb32-466" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb32-467"><a href="#cb32-467" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb32-468"><a href="#cb32-468" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb32-469"><a href="#cb32-469" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb32-470"><a href="#cb32-470" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb32-471"><a href="#cb32-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-472"><a href="#cb32-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-473"><a href="#cb32-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-474"><a href="#cb32-474" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb32-475"><a href="#cb32-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-476"><a href="#cb32-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r standiagnose, eval = FALSE}</span></span>
<span id="cb32-477"><a href="#cb32-477" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb32-478"><a href="#cb32-478" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(stanfiles_dir)</span>
<span id="cb32-479"><a href="#cb32-479" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod1_*.csv'</span>)</span>
<span id="cb32-480"><a href="#cb32-480" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-481"><a href="#cb32-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-482"><a href="#cb32-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-483"><a href="#cb32-483" aria-hidden="true" tabindex="-1"></a>The diagnostics are reasonable given model complexity. Output copied here to save time:</span>
<span id="cb32-484"><a href="#cb32-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-485"><a href="#cb32-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb32-486"><a href="#cb32-486" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb32-487"><a href="#cb32-487" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb32-488"><a href="#cb32-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-489"><a href="#cb32-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-490"><a href="#cb32-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb32-491"><a href="#cb32-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-492"><a href="#cb32-492" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb32-493"><a href="#cb32-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-494"><a href="#cb32-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-495"><a href="#cb32-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb32-496"><a href="#cb32-496" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb32-497"><a href="#cb32-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-498"><a href="#cb32-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-499"><a href="#cb32-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trace plots</span></span>
<span id="cb32-500"><a href="#cb32-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-501"><a href="#cb32-501" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb32-502"><a href="#cb32-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-503"><a href="#cb32-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb32-504"><a href="#cb32-504" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb32-505"><a href="#cb32-505" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span>
<span id="cb32-506"><a href="#cb32-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-507"><a href="#cb32-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-508"><a href="#cb32-508" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (figures)</span></span>
<span id="cb32-509"><a href="#cb32-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-510"><a href="#cb32-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb32-511"><a href="#cb32-511" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb32-512"><a href="#cb32-512" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span>
<span id="cb32-513"><a href="#cb32-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-514"><a href="#cb32-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-515"><a href="#cb32-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r info}</span></span>
<span id="cb32-516"><a href="#cb32-516" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb32-517"><a href="#cb32-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>