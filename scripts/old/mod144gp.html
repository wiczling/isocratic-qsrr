<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2024-03-15">

<title>QSRR revisited. Hierarchical models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mod144gp_files/libs/clipboard/clipboard.min.js"></script>
<script src="mod144gp_files/libs/quarto-html/quarto.js"></script>
<script src="mod144gp_files/libs/quarto-html/popper.min.js"></script>
<script src="mod144gp_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mod144gp_files/libs/quarto-html/anchor.min.js"></script>
<link href="mod144gp_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mod144gp_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mod144gp_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mod144gp_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mod144gp_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory data analysis</a></li>
  <li><a href="#prepare-data-for-calculations" id="toc-prepare-data-for-calculations" class="nav-link" data-scroll-target="#prepare-data-for-calculations">Prepare data for calculations</a></li>
  <li><a href="#matri-normal-distribution" id="toc-matri-normal-distribution" class="nav-link" data-scroll-target="#matri-normal-distribution">Matri normal distribution</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  </ul></li>
  <li><a href="#genereted-quantitites" id="toc-genereted-quantitites" class="nav-link" data-scroll-target="#genereted-quantitites">Genereted quantitites</a>
  <ul class="collapse">
  <li><a href="#load" id="toc-load" class="nav-link" data-scroll-target="#load">Load</a></li>
  <li><a href="#fits" id="toc-fits" class="nav-link" data-scroll-target="#fits">Fits</a></li>
  <li><a href="#individual-parameters-and-etaplots" id="toc-individual-parameters-and-etaplots" class="nav-link" data-scroll-target="#individual-parameters-and-etaplots">Individual Parameters and etaplots</a>
  <ul class="collapse">
  <li><a href="#individual-parameters" id="toc-individual-parameters" class="nav-link" data-scroll-target="#individual-parameters">Individual parameters</a></li>
  <li><a href="#etas" id="toc-etas" class="nav-link" data-scroll-target="#etas">Etas</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#functional-groups" id="toc-functional-groups" class="nav-link" data-scroll-target="#functional-groups">Functional groups</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">QSRR revisited. Hierarchical models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<p>The packages we will use are listed below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/paths_ce33340e20ed46e7e517faa0e30431c6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod144gp"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>stanfiles_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"stanfiles"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>stan_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tabels_dir)) <span class="fu">dir.create</span>(tabels_dir)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(stanfiles_dir)) <span class="fu">dir.create</span>(stanfiles_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35^{}C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient.</p>
<div class="cell" data-hash="mod144gp_cache/html/rxnsim-similarity_b99a2788c5b8b0f89e58c8913f2cf5a5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher to run Rxnsim (will fix later)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/load-data_8330552bfeb2c8d925b32f6d7590bf23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>makeSymm <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    m[<span class="fu">upper.tri</span>(m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(m)[<span class="fu">upper.tri</span>(m)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(m)}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">makeSymm</span>(simMat)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">&lt;-</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory data analysis</h1>
<p>During the exploratory data analysis phase, we create a series of plots to better understand our data.</p>
<div class="cell" data-hash="mod144gp_cache/html/clusterring_20180b71551d0ca3711517bef653c21c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">=</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(simMat)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">hclust</span>(<span class="fu">as.dist</span>(distance), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/clusterring-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cut_avg <span class="ot">&lt;-</span> <span class="fu">cutree</span>(x, <span class="at">k =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/similarity-matrixplot_ff12d4e6768b53041fa8b6930ba4f046">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/similarity-matrixplot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[101:200,101:200])</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[201:300,201:300])</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[301:400,301:400])</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[401:500,401:500])</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[501:600,501:600])</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[601:700,601:700])</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[701:800,701:800])</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[801:900,801:900])</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[901:1026,901:1026])</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.975</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[selected_compounds,selected_compounds],<span class="at">tl.cex=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/similarity-matrixplot-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod144gp_cache/html/raw-data_07c6453049075a8e8f35228004462acc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/raw-data-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</p>
<div class="cell" data-hash="mod144gp_cache/html/pH-plot_f8c3b1cd20f6d1c0887281e4ade9db76">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/pH-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The values of molecular mass MM were added to the dataset. They were calculated using <a href="www.acdlabs.com">ACD/Labs program</a> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</p>
<div class="cell" data-hash="mod144gp_cache/html/hist-MW-logP_dab9d7b761b08f4d27763de2688ab412">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/hist-MW-logP-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</p>
<div class="cell" data-hash="mod144gp_cache/html/functional-group-summary_373bd0668168aa007b4877e493b1845d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/functional-group-summary-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="prepare-data-for-calculations" class="level1">
<h1>Prepare data for calculations</h1>
<div class="cell" data-hash="mod144gp_cache/html/unnamed-chunk-1_ca931c16faf1497833ac69ec5c4d597e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/initial-estimates_1bebf96646b11b2c88bdebcbae3bd2cf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/initial-estimates-plot_84725c463792ae53a62af6c8e26f1858">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/initial-estimates-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logPobs,<span class="at">y=</span>logkw,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/initial-estimates-plot-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logPobs,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/initial-estimates-plot-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="matri-normal-distribution" class="level1">
<h1>Matri normal distribution</h1>
<div class="cell" data-hash="mod144gp_cache/html/simulate-from-matrix-normal-halfcentered_1529bd86c9fa8ceebcbdd4a6593e6edb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' non centered</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>rho1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">0.9</span>,n<span class="sc">*</span>n), <span class="at">nrow=</span>n)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rho1 = matrix(c(1,0.9,0.9,1), nrow=2)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(rho1) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>L_rho1 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho1))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>rho2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>L_rho2 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho2))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> (<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2) <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(L_rho1); </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>pred_two_analytes <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span>  <span class="fu">t</span>((<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2) <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(L_rho1))</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">c</span>(f[<span class="dv">1</span>,<span class="dv">1</span>],f[<span class="dv">1</span>,<span class="dv">2</span>],f[<span class="dv">2</span>,<span class="dv">1</span>]))</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3000</span>), <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a> x[i,] <span class="ot">=</span> <span class="fu">pred_two_analytes</span>();</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/simulate-from-matrix-normal-halfcentered-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sd_logkw1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">1</span>])</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sd_S1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">2</span>])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>sd_logkw2 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">3</span>])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>rho_logkw1_S1 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>rho_logkw1_logkw2 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_loggkw1 = %.2f: true = 2.0"</span>, sd_logkw1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated sd_loggkw1 = 2.02: true = 2.0"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_S1 = %.2f: true = 2.0"</span>, sd_S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated sd_S1 = 2.02: true = 2.0"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_logkw2 = %.2f: true = 2.0"</span>, sd_logkw2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated sd_logkw2 = 2.01: true = 2.0"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_S1 = %.2f: true = 0.75"</span>, rho_logkw1_S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated rho_logkw1_S1 = 0.75: true = 0.75"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_logkw2 = %.2f: true = 0.90"</span>, rho_logkw1_logkw2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated rho_logkw1_logkw2 = 0.90: true = 0.90"</code></pre>
</div>
</div>
<div class="cell" data-hash="mod144gp_cache/html/simulate-from-matrix-noncentered_a717acdfacfcec35acbd6945ebbed788">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' non centered</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>rho1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">0.9</span>,n<span class="sc">*</span>n), <span class="at">nrow=</span>n)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rho1 = matrix(c(1,0.9,0.9,1), nrow=2)</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(rho1) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>L_rho1 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho1))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>rho2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>L_rho2 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho2))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> L_rho1 <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2);  </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>pred_two_analytes <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> L_rho1 <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2);</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">c</span>(f[<span class="dv">1</span>,<span class="dv">1</span>],f[<span class="dv">1</span>,<span class="dv">2</span>],f[<span class="dv">2</span>,<span class="dv">1</span>]))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3000</span>), <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a> x[i,] <span class="ot">=</span> <span class="fu">pred_two_analytes</span>();</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/simulate-from-matrix-noncentered-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>sd_logkw1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">1</span>])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>sd_S1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">2</span>])</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>sd_logkw2 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">3</span>])</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>rho_logkw1_S1 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>rho_logkw1_logkw2 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_loggkw1 = %.2f: true = 2.0"</span>, sd_logkw1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated sd_loggkw1 = 2.02: true = 2.0"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_S1 = %.2f: true = 2.0"</span>, sd_S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated sd_S1 = 2.02: true = 2.0"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_logkw2 = %.2f: true = 2.0"</span>, sd_logkw2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated sd_logkw2 = 2.01: true = 2.0"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_S1 = %.2f: true = 0.75"</span>, rho_logkw1_S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated rho_logkw1_S1 = 0.75: true = 0.75"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_logkw2 = %.2f: true = 0.90"</span>, rho_logkw1_logkw2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "simulated rho_logkw1_logkw2 = 0.90: true = 0.90"</code></pre>
</div>
</div>
<div class="cell" data-hash="mod144gp_cache/html/simulate-from-matrix-normal_abd0f7e858a887090f62472f6c4a551e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' similarity matrix can be considered as a distance matrix.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' select analytes with similarity index &lt; 0.5</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>K_no_diag <span class="ot">&lt;-</span> simMat</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(K_no_diag)<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>maxes <span class="ot">=</span> <span class="fu">apply</span>(K_no_diag,<span class="dv">2</span>,max)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span>, <span class="at">y=</span>maxes), <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/simulate-from-matrix-normal-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>idx_corelatted <span class="ot">=</span> <span class="fu">which</span>(maxes<span class="sc">&gt;</span><span class="fl">0.6</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>idx_uncorelatted <span class="ot">=</span> <span class="fu">which</span>(maxes<span class="sc">&lt;=</span><span class="fl">0.6</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>simMat_adj <span class="ot">&lt;-</span> simMat</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>simMat_adj[simMat_adj<span class="sc">&lt;=</span><span class="fl">0.6</span>]<span class="ot">=</span><span class="fl">0.6</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">*</span>(simMat_adj[idx_corelatted,idx_corelatted]<span class="sc">-</span><span class="fl">0.6</span>)<span class="sc">/</span><span class="fl">0.6</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(K)<span class="ot">&lt;-</span><span class="fl">1.00001</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>L_K<span class="ot">=</span><span class="fu">t</span>(<span class="fu">chol</span>(K))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(K[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>],<span class="at">tl.cex=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/simulate-from-matrix-normal-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[idx_corelatted,idx_corelatted][<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>],<span class="at">tl.cex=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/simulate-from-matrix-normal-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a …</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk  = logk_w - S_1 \cdot (1 + S_2) \cdot \varphi / (1 + S_2 \cdot \varphi)
\end{aligned}
\]</span></p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell" data-hash="mod144gp_cache/html/stansetup_3f42bab9132638e91637ba562316142c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_corr=</span><span class="fu">length</span>(idx_corelatted),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_uncorr=</span><span class="fu">length</span>(idx_uncorelatted),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_corr =</span> idx_corelatted,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_uncorr =</span> idx_uncorelatted,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">maxR=</span><span class="fu">max</span>(R),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">R=</span>R,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsA=</span>nGroupsA,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsB=</span>nGroupsB,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitA=</span>pKaslitA,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitB=</span>pKaslitB,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsA=</span>idxGroupsA,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsB=</span>idxGroupsB,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>data<span class="sc">$</span>logk,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nA0 =</span> nA0,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nB0 =</span> nB0,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxA0 =</span> idxA0,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxB0 =</span> idxB0,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">simmat =</span> simMat_adj[idx_corelatted,idx_corelatted],</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>),</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>),</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat   =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.25</span>),</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)),</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">rhoc =</span>  <span class="fu">t</span>(<span class="fu">chol</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>))),</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">eta =</span> <span class="fu">cbind</span>((init_aprox<span class="sc">$</span>logkw<span class="sc">-</span><span class="fu">mean</span>(init_aprox<span class="sc">$</span>logkw))<span class="sc">/</span><span class="fu">sd</span>(init_aprox<span class="sc">$</span>logkw),</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>                      (init_aprox<span class="sc">$</span>S1<span class="sc">-</span><span class="fu">mean</span>(init_aprox<span class="sc">$</span>S1))<span class="sc">/</span><span class="fu">sd</span>(init_aprox<span class="sc">$</span>S1)), <span class="co">#matrix(rep(0,nAnalytes*2), nrow=nAnalytes),</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<p>We compiled the model using cmdstanr:</p>
<div class="cell" data-hash="mod144gp_cache/html/stancompile_c7e39b1931f085f6d42c2238465b0c46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(model_dir,<span class="st">".stan"</span>), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used optimization for initial testing:</p>
<div class="cell" data-hash="mod144gp_cache/html/stanoptimize_183723ab9939389e142a0337c71b1cdd">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-opt"</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">2000</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/optplots_c91b57497f0eddb7e3b9337c03bc9e94">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">120</span><span class="sc">:</span><span class="dv">130</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For local computations one can use cmdstanr:</p>
<div class="cell" data-hash="mod144gp_cache/html/variational_4970afa0803344fddf529005d797a6b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fit_var <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">variational</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-var"</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>fit_var<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod144gp_cache/html/stansample_9906d7326904fdc0f70052245f901716">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-loc"</span>),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We performed out computations at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>. In this case:</p>
<ol type="1">
<li>we dumped the necessary data to .json format</li>
</ol>
<div class="cell" data-hash="mod144gp_cache/html/dumpfiles_66fcc5d3f032296615242eab9d88a73f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>we run the model using the batch file:</li>
</ol>
<pre> 
</pre>
<ol start="3" type="1">
<li>After calculations, we loaded the output files using cmdstanr.</li>
</ol>
<div class="cell" data-hash="mod144gp_cache/html/stanload_9ebbb629c977e49a3e62ac872ec29509">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="co">#paste0(stanfiles_dir,"/",  model_name, "-3.csv"),</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell" data-hash="mod144gp_cache/html/standiagnose_5828ebd4f5791f91960fe5c927c955d0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(stanfiles_dir)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod1_*.csv'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The diagnostics are reasonable given model complexity. Output copied here to save time:</p>
<pre></pre>
</section>
<section id="summary-of-model-parameters-table" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell" data-hash="mod144gp_cache/html/summary_28d85f5ccc76a2b8397ed64a1706b7f8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    variable     mean   median    sd   mad      q5      q95 rhat ess_bulk
 lp__        10057.56 10058.60 62.95 63.38 9953.83 10160.12 1.01      373
 logkwHat        4.08     4.08  0.11  0.11    3.89     4.27 1.04      207
 S1Hat           4.84     4.84  0.10  0.10    4.67     5.00 1.03      245
 dlogkwHat      -0.89    -0.89  0.10  0.10   -1.06    -0.73 1.01      354
 dS1Hat          0.09     0.09  0.08  0.08   -0.04     0.23 1.01      860
 S2Hat           2.68     2.68  0.03  0.03    2.62     2.74 1.00     4759
 beta[1]         0.82     0.82  0.03  0.03    0.78     0.87 1.00      565
 beta[2]         0.63     0.63  0.03  0.03    0.59     0.67 1.00      761
 omega[1]        1.38     1.38  0.04  0.04    1.32     1.45 1.01      460
 omega[2]        1.19     1.19  0.04  0.04    1.13     1.24 1.01      621
 rhoc[1,1]       1.00     1.00  0.00  0.00    1.00     1.00   NA       NA
 rhoc[2,1]       0.88     0.88  0.01  0.01    0.86     0.89 1.01     1113
 rhoc[1,2]       0.00     0.00  0.00  0.00    0.00     0.00   NA       NA
 rhoc[2,2]       0.48     0.48  0.02  0.02    0.45     0.51 1.01     1113
 sigma           0.07     0.07  0.00  0.00    0.07     0.07 1.00     1377
 pilogkw[1]      0.02     0.02  0.19  0.19   -0.28     0.33 1.00     6249
 pilogkw[2]      0.21     0.21  0.10  0.10    0.05     0.37 1.01      639
 pilogkw[3]     -0.13    -0.12  0.19  0.17   -0.45     0.16 1.00     3815
 pilogkw[4]      0.04     0.04  0.19  0.19   -0.27     0.37 1.01     9668
 pilogkw[5]     -0.05    -0.05  0.19  0.18   -0.36     0.25 1.00     6633
 pilogkw[6]      0.00     0.01  0.17  0.17   -0.27     0.28 1.00     3481
 pilogkw[7]      0.20     0.20  0.19  0.18   -0.08     0.52 1.00     2196
 pilogkw[8]      0.13     0.12  0.20  0.19   -0.19     0.46 1.01     4557
 pilogkw[9]      0.19     0.19  0.15  0.15   -0.06     0.44 1.01     1187
 pilogkw[10]     0.04     0.04  0.18  0.17   -0.26     0.34 1.00     4500
 pilogkw[11]    -0.04    -0.04  0.18  0.18   -0.35     0.25 1.00     5076
 pilogkw[12]     0.09     0.08  0.19  0.18   -0.20     0.40 1.00     5880
 pilogkw[13]    -0.01    -0.01  0.16  0.16   -0.27     0.25 1.00     3319
 pilogkw[14]     0.10     0.10  0.17  0.17   -0.17     0.37 1.00     3399
 pilogkw[15]     0.01     0.01  0.18  0.18   -0.29     0.30 1.00     3929
 pilogkw[16]     0.00     0.00  0.14  0.13   -0.23     0.22 1.00      980
 pilogkw[17]     0.17     0.18  0.10  0.10    0.01     0.33 1.01      953
 pilogkw[18]     0.04     0.04  0.15  0.14   -0.20     0.28 1.00     1216
 pilogkw[19]     0.33     0.33  0.15  0.15    0.10     0.57 1.00     1429
 pilogkw[20]     0.03     0.03  0.17  0.16   -0.24     0.31 1.00     1692
 pilogkw[21]    -0.06    -0.06  0.07  0.07   -0.17     0.06 1.01      605
 pilogkw[22]    -0.09    -0.09  0.14  0.14   -0.32     0.14 1.00     1063
 pilogkw[23]     0.16     0.15  0.14  0.14   -0.07     0.40 1.01      811
 pilogkw[24]     0.22     0.22  0.06  0.06    0.13     0.32 1.01      469
 pilogkw[25]     0.23     0.23  0.16  0.16   -0.02     0.50 1.00     1131
 pilogkw[26]     0.17     0.16  0.15  0.15   -0.07     0.42 1.01     1019
 pilogkw[27]     0.06     0.05  0.19  0.18   -0.24     0.37 1.01     6379
 pilogkw[28]     0.10     0.09  0.17  0.16   -0.17     0.38 1.01     1744
 pilogkw[29]    -0.03    -0.02  0.20  0.20   -0.35     0.30 1.00     7406
 pilogkw[30]     0.03     0.03  0.14  0.14   -0.21     0.27 1.01     1139
 pilogkw[31]    -0.02    -0.02  0.13  0.13   -0.22     0.19 1.00      700
 pilogkw[32]    -0.04    -0.04  0.15  0.15   -0.28     0.20 1.00     1117
 pilogkw[33]     0.03     0.03  0.15  0.14   -0.21     0.26 1.00     1084
 pilogkw[34]    -0.01    -0.01  0.16  0.16   -0.29     0.26 1.00     2553
 pilogkw[35]     0.03     0.04  0.12  0.12   -0.16     0.22 1.01      544
 pilogkw[36]     0.07     0.07  0.14  0.14   -0.14     0.31 1.01      761
 pilogkw[37]     0.29     0.27  0.21  0.20   -0.02     0.66 1.01      528
 pilogkw[38]    -0.02    -0.02  0.19  0.18   -0.33     0.28 1.00     6021
 pilogkw[39]    -0.15    -0.15  0.17  0.17   -0.44     0.13 1.00     3487
 pilogkw[40]     0.01     0.00  0.17  0.16   -0.27     0.28 1.01     2366
 pilogkw[41]     0.00     0.00  0.19  0.19   -0.32     0.31 1.00     6692
 pilogkw[42]     0.26     0.26  0.13  0.13    0.06     0.48 1.01      730
 pilogkw[43]     0.09     0.09  0.08  0.08   -0.03     0.22 1.02      480
 pilogkw[44]    -0.04    -0.04  0.16  0.16   -0.32     0.23 1.00     2391
 pilogkw[45]     0.00     0.00  0.17  0.17   -0.29     0.28 1.00     2726
 pilogkw[46]     0.14     0.13  0.21  0.20   -0.20     0.49 1.00     3891
 pilogkw[47]     0.09     0.08  0.10  0.10   -0.07     0.25 1.01      663
 pilogkw[48]     0.22     0.21  0.11  0.11    0.05     0.40 1.02      497
 pilogkw[49]     0.07     0.07  0.16  0.16   -0.20     0.34 1.00     2509
 pilogkw[50]    -0.01    -0.01  0.17  0.17   -0.30     0.27 1.00     1906
 pilogkw[51]     0.25     0.25  0.12  0.12    0.06     0.45 1.02      526
 pilogkw[52]     0.09     0.09  0.14  0.13   -0.13     0.31 1.01      809
 pilogkw[53]     0.02     0.02  0.15  0.15   -0.22     0.27 1.00     1991
 pilogkw[54]     0.01     0.01  0.18  0.18   -0.29     0.32 1.00     4701
 pilogkw[55]    -0.03    -0.03  0.19  0.18   -0.35     0.28 1.00     6845
 pilogkw[56]    -0.16    -0.16  0.17  0.17   -0.44     0.11 1.01     1331
 pilogkw[57]     0.14     0.14  0.16  0.16   -0.11     0.42 1.00     1134
 pilogkw[58]    -0.04    -0.04  0.19  0.19   -0.36     0.27 1.01     7913
 pilogkw[59]    -0.01    -0.01  0.19  0.18   -0.33     0.31 1.00     7942
 pilogkw[60]    -0.01    -0.01  0.10  0.10   -0.18     0.16 1.01      574
 pilogkw[61]    -0.11    -0.11  0.18  0.18   -0.42     0.18 1.00     3315
 pilogkw[62]     0.08     0.08  0.17  0.16   -0.19     0.36 1.00     2545
 pilogkw[63]    -0.02    -0.02  0.18  0.17   -0.32     0.27 1.00     3849
 pilogkw[64]     0.10     0.09  0.17  0.17   -0.18     0.39 1.00     3310
 pilogkw[65]     0.02     0.02  0.20  0.19   -0.30     0.35 1.00     8585
 pilogkw[66]    -0.09    -0.08  0.19  0.19   -0.41     0.23 1.00     5605
 pilogkw[67]     0.05     0.05  0.17  0.17   -0.22     0.34 1.00     2922
 pilogkw[68]     0.00     0.00  0.14  0.14   -0.24     0.23 1.01     1057
 pilogkw[69]     0.03     0.02  0.18  0.18   -0.27     0.32 1.00     6579
 pilogkw[70]     0.04     0.04  0.18  0.17   -0.24     0.33 1.00     4770
 pilogkw[71]     0.09     0.09  0.15  0.15   -0.14     0.34 1.01      805
 pilogkw[72]    -0.03    -0.03  0.20  0.19   -0.36     0.29 1.01     8284
 pilogkw[73]     0.02     0.02  0.19  0.18   -0.28     0.33 1.00     6013
 pilogkw[74]    -0.12    -0.12  0.18  0.17   -0.42     0.17 1.00     2722
 pilogkw[75]    -0.20    -0.20  0.16  0.16   -0.46     0.06 1.00     1545
 pilogkw[76]     0.05     0.05  0.19  0.18   -0.26     0.37 1.01     7055
 pilogkw[77]     0.03     0.03  0.19  0.17   -0.28     0.33 1.01     8369
 pilogkw[78]     0.08     0.07  0.20  0.19   -0.23     0.40 1.01     5678
 pilogkw[79]     0.02     0.02  0.18  0.18   -0.28     0.33 1.00     8663
 pilogkw[80]     0.08     0.08  0.15  0.15   -0.16     0.33 1.01     1588
 pilogkw[81]     0.02     0.02  0.19  0.18   -0.29     0.33 1.01     7399
 pilogkw[82]     0.02     0.02  0.18  0.17   -0.26     0.33 1.00     5046
 pilogkw[83]     0.19     0.18  0.19  0.18   -0.11     0.52 1.00     1928
 pilogkw[84]     0.12     0.12  0.14  0.14   -0.10     0.36 1.00      924
 pilogkw[85]     0.01     0.01  0.19  0.19   -0.30     0.32 1.00     8063
 pilogkw[86]     0.02     0.02  0.18  0.17   -0.26     0.32 1.00     3990
 pilogkw[87]    -0.04    -0.04  0.19  0.18   -0.35     0.27 1.00     6729
 pilogkw[88]     0.05     0.05  0.20  0.19   -0.27     0.37 1.01     6306
 pilogkw[89]     0.10     0.10  0.17  0.16   -0.16     0.39 1.01     1363
 pilogkw[90]    -0.03    -0.02  0.17  0.17   -0.31     0.26 1.00     3659
 pilogkw[91]     0.30     0.29  0.18  0.18    0.03     0.61 1.01      551
 pilogkw[92]     0.05     0.06  0.18  0.18   -0.24     0.36 1.00     6520
 pilogkw[93]     0.29     0.27  0.22  0.22   -0.05     0.69 1.00      957
 pilogkw[94]     0.00    -0.01  0.19  0.19   -0.32     0.31 1.01     8085
 pilogkw[95]     0.10     0.10  0.07  0.07   -0.02     0.22 1.01      744
 pilogkw[96]    -0.01    -0.01  0.15  0.15   -0.27     0.24 1.00     1845
 pilogkw[97]     0.08     0.07  0.16  0.16   -0.18     0.36 1.00     2011
 pilogkw[98]     0.18     0.17  0.17  0.17   -0.11     0.47 1.00     3157
 piS1[1]        -0.09    -0.09  0.25  0.24   -0.49     0.32 1.00     5035
 piS1[2]         0.16     0.16  0.09  0.09    0.00     0.31 1.01      693
 piS1[3]         0.38     0.38  0.29  0.29   -0.09     0.86 1.00     5087
 piS1[4]        -0.18    -0.18  0.28  0.27   -0.66     0.29 1.00     7715
 piS1[5]         0.58     0.58  0.24  0.24    0.19     0.97 1.00     4341
 piS1[6]         0.05     0.05  0.19  0.19   -0.26     0.36 1.00     3184
 piS1[7]        -0.12    -0.13  0.22  0.22   -0.48     0.24 1.00     4671
 piS1[8]        -0.13    -0.13  0.27  0.27   -0.59     0.31 1.00     6681
 piS1[9]         0.06     0.06  0.15  0.15   -0.19     0.31 1.01     1663
 piS1[10]        0.07     0.07  0.20  0.20   -0.27     0.40 1.00     5231
 piS1[11]        0.04     0.03  0.23  0.23   -0.33     0.42 1.00     5947
 piS1[12]       -0.18    -0.17  0.25  0.25   -0.60     0.22 1.00     5195
 piS1[13]        0.10     0.10  0.17  0.17   -0.18     0.38 1.00     3296
 piS1[14]       -0.08    -0.08  0.18  0.18   -0.38     0.22 1.00     3103
 piS1[15]       -0.14    -0.13  0.21  0.21   -0.48     0.19 1.00     3662
 piS1[16]        0.10     0.10  0.13  0.13   -0.13     0.32 1.00     1342
 piS1[17]        0.43     0.43  0.10  0.10    0.27     0.59 1.01     1125
 piS1[18]        0.17     0.17  0.14  0.14   -0.06     0.40 1.00     1461
 piS1[19]       -0.02    -0.02  0.14  0.14   -0.25     0.20 1.00     1979
 piS1[20]        0.25     0.25  0.18  0.17   -0.04     0.55 1.00     2264
 piS1[21]        0.08     0.08  0.06  0.06   -0.03     0.18 1.01      695
 piS1[22]        0.04     0.04  0.14  0.14   -0.19     0.28 1.00     1339
 piS1[23]        0.21     0.20  0.13  0.13   -0.01     0.43 1.02      955
 piS1[24]        0.23     0.24  0.05  0.05    0.15     0.32 1.01      563
 piS1[25]        0.23     0.22  0.15  0.15   -0.02     0.48 1.00     1564
 piS1[26]        0.31     0.31  0.15  0.15    0.08     0.56 1.01     1295
 piS1[27]       -0.09    -0.09  0.27  0.27   -0.54     0.36 1.00     7084
 piS1[28]        0.35     0.35  0.18  0.18    0.07     0.65 1.00     2074
 piS1[29]       -0.06    -0.06  0.25  0.24   -0.47     0.35 1.00     8152
 piS1[30]        0.24     0.24  0.16  0.16   -0.02     0.51 1.00     1444
 piS1[31]        0.34     0.34  0.12  0.12    0.16     0.53 1.00      986
 piS1[32]        0.33     0.34  0.15  0.15    0.10     0.57 1.01     1494
 piS1[33]       -0.04    -0.04  0.14  0.15   -0.27     0.21 1.00     1196
 piS1[34]       -0.16    -0.16  0.18  0.18   -0.46     0.14 1.00     2218
 piS1[35]        0.41     0.41  0.11  0.11    0.23     0.58 1.01      706
 piS1[36]       -0.03    -0.03  0.13  0.13   -0.24     0.19 1.00     1096
 piS1[37]        1.50     1.49  0.24  0.24    1.11     1.93 1.02      636
 piS1[38]       -0.04    -0.03  0.26  0.26   -0.46     0.39 1.00     6898
 piS1[39]        0.34     0.34  0.21  0.21    0.00     0.71 1.00     4755
 piS1[40]        0.13     0.12  0.17  0.17   -0.16     0.41 1.00     2532
 piS1[41]       -0.02    -0.03  0.28  0.27   -0.48     0.43 1.00     8135
 piS1[42]        0.36     0.36  0.12  0.12    0.18     0.56 1.01      972
 piS1[43]        0.05     0.05  0.07  0.07   -0.06     0.17 1.01      529
 piS1[44]       -0.11    -0.10  0.18  0.18   -0.40     0.18 1.00     2737
 piS1[45]       -0.03    -0.03  0.19  0.19   -0.34     0.29 1.00     2812
 piS1[46]       -0.06    -0.07  0.28  0.28   -0.52     0.39 1.00     8056
 piS1[47]        0.26     0.26  0.09  0.10    0.11     0.42 1.01      847
 piS1[48]        0.25     0.25  0.10  0.10    0.09     0.42 1.02      668
 piS1[49]       -0.09    -0.09  0.17  0.17   -0.37     0.19 1.00     2128
 piS1[50]        0.06     0.06  0.19  0.19   -0.26     0.37 1.00     2570
 piS1[51]        0.34     0.34  0.11  0.11    0.16     0.53 1.02      678
 piS1[52]        0.19     0.19  0.13  0.13   -0.02     0.40 1.00     1114
 piS1[53]        0.19     0.19  0.16  0.17   -0.07     0.47 1.00     2212
 piS1[54]       -0.34    -0.34  0.23  0.23   -0.72     0.04 1.00     3530
 piS1[55]        0.08     0.08  0.27  0.27   -0.37     0.55 1.01     8909
 piS1[56]        0.16     0.16  0.17  0.17   -0.12     0.44 1.01     1779
 piS1[57]        0.19     0.19  0.18  0.17   -0.09     0.49 1.00     2076
 piS1[58]        0.17     0.17  0.27  0.26   -0.28     0.62 1.00     8672
 piS1[59]        0.10     0.10  0.27  0.27   -0.35     0.56 1.00     7975
 piS1[60]        0.14     0.15  0.09  0.09   -0.01     0.30 1.01      591
 piS1[61]        0.15     0.15  0.23  0.23   -0.23     0.54 1.00     4162
 piS1[62]        0.00     0.00  0.21  0.21   -0.34     0.35 1.00     4944
 piS1[63]        0.02     0.02  0.23  0.22   -0.35     0.40 1.00     4792
 piS1[64]       -0.02    -0.02  0.23  0.23   -0.38     0.36 1.00     4362
 piS1[65]       -0.05    -0.05  0.27  0.26   -0.51     0.39 1.00     7726
 piS1[66]        0.21     0.21  0.29  0.28   -0.26     0.70 1.00     6110
 piS1[67]       -0.01    -0.02  0.19  0.19   -0.32     0.30 1.00     3425
 ess_tail
      621
      513
      728
      696
     1499
     2739
     1053
     1192
     1247
     1468
       NA
     1754
       NA
     1754
     2147
     2545
     1367
     2067
     2327
     2359
     2505
     2095
     1989
     1787
     2411
     2567
     2524
     2625
     2695
     2427
     1487
     1926
     1632
     2317
     1877
     1166
     1411
      999
      997
     1530
     1199
     1940
     1723
     2205
     1529
     1193
     1688
     1505
     2154
     1000
     1298
      966
     2108
     2253
     1953
     2300
     1542
      923
     2219
     2404
     2165
     1167
     1124
     2147
     2084
      904
     1617
     2439
     2403
     2368
     1619
     1783
     2400
     2350
      937
     2103
     2398
     2405
     2640
     2560
     2612
     2308
     1430
     2404
     2663
      894
     2235
     2383
     2112
     2253
     2313
     2497
     2115
     2734
     2063
     2504
     2872
     1805
     1566
     1972
     2641
     2992
     2290
     1438
     2334
     1301
     2461
     1310
     2243
     1263
     2014
     2103
     2299
     2714
     1644
     2407
     2443
     2495
     2869
     2640
     2613
     2141
     3105
     3118
     2919
     2944
     2749
     2634
     1882
     2119
     2389
     2306
     2766
     1194
     1969
     1264
     1238
     2097
     2059
     2312
     2305
     2801
     2275
     1419
     1899
     1486
     2691
     1410
     1497
     1727
     2468
     2845
     2752
     3018
     1957
     1074
     2643
     2644
     2756
     1563
     1432
     2134
     2586
     1262
     1821
     2539
     2543
     2576
     2091
     2467
     2624
     2483
     1115
     2632
     2631
     2905
     2723
     2502
     2356
     2763

 # showing 180 of 19675 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="trace-plots" class="level2">
<h2 class="anchored" data-anchor-id="trace-plots">Trace plots</h2>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell" data-hash="mod144gp_cache/html/trace-plots_61c6003a621c5b62a2f21347ed9228b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rhoc[2,1]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-figures">Summary of model parameters (figures)</h2>
<div class="cell" data-hash="mod144gp_cache/html/mcmc-intervals_d2fd79e1f8783ae1e6e9a69ccf20a17f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rhoc[2,1]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/mcmc-intervals-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
<section id="genereted-quantitites" class="level1">
<h1>Genereted quantitites</h1>
<div class="cell" data-hash="mod144gp_cache/html/generete-quntities_6d56afc0271a5ea4c07a00932ea31cdd">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>model_gen <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(stan_dir, <span class="st">"/"</span>, model_name, <span class="st">"-gen.stan"</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fit_gen  <span class="ot">&lt;-</span> model_gen<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-gen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="load" class="level2">
<h2 class="anchored" data-anchor-id="load">Load</h2>
<div class="cell" data-hash="mod144gp_cache/html/etaload_b22d0ef62e4c5f2bd277d97fd9c1f4b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-1.csv"</span>),</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-2.csv"</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-4.csv"</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-5.csv"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fits" class="level2">
<h2 class="anchored" data-anchor-id="fits">Fits</h2>
<div class="cell" data-hash="mod144gp_cache/html/ind-pop-gof-plots_10e5a8cab40c833737fa79f36203e3eb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogkHat_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogkHat_ind) <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogkHat_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogkHat_pop) <span class="sc">%&gt;%</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/ind-pop-gof-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod144gp_cache/html/ind-predictions_20c350b43804d54cc67ff93a1e82c009">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>); <span class="co">#c(1:9, 501,510, 626) (100:120)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_ind[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_ind) <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/ind-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod144gp_cache/html/pop-predictions_9e358b524b2f7c8374bfa350d2db3130">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">120</span>);</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_pop[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_pop) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/pop-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-and-etaplots" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters-and-etaplots">Individual Parameters and etaplots</h2>
<p>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</p>
<section id="individual-parameters" class="level3">
<h3 class="anchored" data-anchor-id="individual-parameters">Individual parameters</h3>
<div class="cell" data-hash="mod144gp_cache/html/iparam-column-neutral_3d23a58e8e0bf637d13b0d8b3b4d8d2f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^sparam_ind"</span>, </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>chargesA0<span class="sc">+</span>chargesB0</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/iparam-column-neutral-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="etas" class="level3">
<h3 class="anchored" data-anchor-id="etas">Etas</h3>
<div class="cell" data-hash="mod144gp_cache/html/ieta_7a6a3af6388c35df2e3ebf2eb7c03bf6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^seta_ind"</span>, </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>chargesA0<span class="sc">+</span>chargesB0</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), </span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/ieta-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
</section>
<section id="functional-groups" class="level1">
<h1>Functional groups</h1>
<div class="cell" data-hash="mod144gp_cache/html/functinoal-group-effects_bd2acdfcdfb88581bec373016a6f9f29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names<span class="sc">$</span>functional.group.name)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names<span class="sc">$</span>functional.group.name)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>param <span class="sc">%&gt;%</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod144gp_files/figure-html/functinoal-group-effects-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod144gp_cache/html/info_e95d995160e7576cd9a26e0d5f98e3f3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.3 (2022-03-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22631)

Matrix products: default

locale:
[1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
[3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.1250    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggcorrplot_0.1.4.1 here_1.0.1         pracma_2.4.4       reshape2_1.4.4    
 [5] GGally_2.2.0       bayesplot_1.10.0   posterior_1.5.0    dplyr_1.1.3       
 [9] tidyr_1.3.0        rstan_2.32.5       StanHeaders_2.32.5 patchwork_1.2.0   
[13] gridExtra_2.3      ggplot2_3.4.4      cmdstanr_0.5.3    

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.12          lattice_0.20-45      QuickJSR_1.0.9      
 [4] rprojroot_2.0.4      digest_0.6.34        utf8_1.2.3          
 [7] R6_2.5.1             plyr_1.8.9           backports_1.4.1     
[10] stats4_4.1.3         coda_0.19-4          evaluate_0.23       
[13] pillar_1.9.0         tidybayes_3.0.6      rlang_1.1.0         
[16] data.table_1.14.10   rstudioapi_0.15.0    checkmate_2.2.0     
[19] rmarkdown_2.25       labeling_0.4.3       textshaping_0.3.7   
[22] stringr_1.5.1        htmlwidgets_1.6.4    loo_2.6.0           
[25] munsell_0.5.0        compiler_4.1.3       xfun_0.41           
[28] pkgconfig_2.0.3      systemfonts_1.0.5    pkgbuild_1.4.3      
[31] ggstats_0.5.1        htmltools_0.5.7      tidyselect_1.2.0    
[34] tibble_3.2.1         tensorA_0.36.2       arrayhelpers_1.1-0  
[37] codetools_0.2-18     matrixStats_1.2.0    viridisLite_0.4.2   
[40] fansi_1.0.4          withr_3.0.0          ggdist_3.3.1        
[43] grid_4.1.3           distributional_0.3.2 jsonlite_1.8.8      
[46] gtable_0.3.4         lifecycle_1.0.4      magrittr_2.0.3      
[49] scales_1.3.0         RcppParallel_5.1.7   cli_3.6.1           
[52] stringi_1.8.3        farver_2.1.1         ragg_1.2.7          
[55] generics_0.1.3       vctrs_0.6.2          RColorBrewer_1.1-3  
[58] tools_4.1.3          svUnit_1.0.6         glue_1.6.2          
[61] purrr_1.0.1          abind_1.4-5          parallel_4.1.3      
[64] fastmap_1.1.1        yaml_2.3.8           inline_0.3.19       
[67] colorspace_2.0-3     knitr_1.45          </code></pre>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb68" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "QSRR revisited. Hierarchical models"</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>The packages we will use are listed below.</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r paths}</span></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod144gp"</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>stanfiles_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"stanfiles"</span>)</span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>stan_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>)</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir)</span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tabels_dir)) <span class="fu">dir.create</span>(tabels_dir)</span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir)</span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(stanfiles_dir)) <span class="fu">dir.create</span>(stanfiles_dir)</span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35\^{\circ}C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient.</span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rxnsim-similarity, eval=FALSE}</span></span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher to run Rxnsim (will fix later)</span></span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb68-70"><a href="#cb68-70" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-71"><a href="#cb68-71" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb68-72"><a href="#cb68-72" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span>
<span id="cb68-73"><a href="#cb68-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-74"><a href="#cb68-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-75"><a href="#cb68-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb68-76"><a href="#cb68-76" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb68-77"><a href="#cb68-77" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-78"><a href="#cb68-78" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-79"><a href="#cb68-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-80"><a href="#cb68-80" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-81"><a href="#cb68-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-82"><a href="#cb68-82" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb68-83"><a href="#cb68-83" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb68-84"><a href="#cb68-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb68-85"><a href="#cb68-85" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb68-86"><a href="#cb68-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-87"><a href="#cb68-87" aria-hidden="true" tabindex="-1"></a>makeSymm <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb68-88"><a href="#cb68-88" aria-hidden="true" tabindex="-1"></a>    m[<span class="fu">upper.tri</span>(m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(m)[<span class="fu">upper.tri</span>(m)]</span>
<span id="cb68-89"><a href="#cb68-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(m)}</span>
<span id="cb68-90"><a href="#cb68-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-91"><a href="#cb68-91" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">makeSymm</span>(simMat)</span>
<span id="cb68-92"><a href="#cb68-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-93"><a href="#cb68-93" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb68-94"><a href="#cb68-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb68-95"><a href="#cb68-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb68-96"><a href="#cb68-96" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb68-97"><a href="#cb68-97" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb68-98"><a href="#cb68-98" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb68-99"><a href="#cb68-99" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb68-100"><a href="#cb68-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-101"><a href="#cb68-101" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb68-102"><a href="#cb68-102" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb68-103"><a href="#cb68-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-104"><a href="#cb68-104" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb68-105"><a href="#cb68-105" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb68-106"><a href="#cb68-106" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb68-107"><a href="#cb68-107" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb68-108"><a href="#cb68-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-109"><a href="#cb68-109" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb68-110"><a href="#cb68-110" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb68-111"><a href="#cb68-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-112"><a href="#cb68-112" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb68-113"><a href="#cb68-113" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb68-114"><a href="#cb68-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-115"><a href="#cb68-115" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb68-116"><a href="#cb68-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-117"><a href="#cb68-117" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb68-118"><a href="#cb68-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-119"><a href="#cb68-119" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb68-120"><a href="#cb68-120" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb68-121"><a href="#cb68-121" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb68-122"><a href="#cb68-122" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb68-123"><a href="#cb68-123" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">&lt;-</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb68-124"><a href="#cb68-124" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb68-125"><a href="#cb68-125" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span>
<span id="cb68-126"><a href="#cb68-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-127"><a href="#cb68-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-128"><a href="#cb68-128" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory data analysis</span></span>
<span id="cb68-129"><a href="#cb68-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-130"><a href="#cb68-130" aria-hidden="true" tabindex="-1"></a>During the exploratory data analysis phase, we create a series of plots to better understand our data.</span>
<span id="cb68-131"><a href="#cb68-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-132"><a href="#cb68-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clusterring}</span></span>
<span id="cb68-133"><a href="#cb68-133" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">=</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(simMat)</span>
<span id="cb68-134"><a href="#cb68-134" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">hclust</span>(<span class="fu">as.dist</span>(distance), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb68-135"><a href="#cb68-135" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span>
<span id="cb68-136"><a href="#cb68-136" aria-hidden="true" tabindex="-1"></a>cut_avg <span class="ot">&lt;-</span> <span class="fu">cutree</span>(x, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb68-137"><a href="#cb68-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-138"><a href="#cb68-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-139"><a href="#cb68-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r similarity-matrixplot}</span></span>
<span id="cb68-140"><a href="#cb68-140" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb68-141"><a href="#cb68-141" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb68-142"><a href="#cb68-142" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[101:200,101:200])</span></span>
<span id="cb68-143"><a href="#cb68-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[201:300,201:300])</span></span>
<span id="cb68-144"><a href="#cb68-144" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[301:400,301:400])</span></span>
<span id="cb68-145"><a href="#cb68-145" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[401:500,401:500])</span></span>
<span id="cb68-146"><a href="#cb68-146" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[501:600,501:600])</span></span>
<span id="cb68-147"><a href="#cb68-147" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[601:700,601:700])</span></span>
<span id="cb68-148"><a href="#cb68-148" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[701:800,701:800])</span></span>
<span id="cb68-149"><a href="#cb68-149" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[801:900,801:900])</span></span>
<span id="cb68-150"><a href="#cb68-150" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[901:1026,901:1026])</span></span>
<span id="cb68-151"><a href="#cb68-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-152"><a href="#cb68-152" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.975</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-153"><a href="#cb68-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-154"><a href="#cb68-154" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb68-155"><a href="#cb68-155" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb68-156"><a href="#cb68-156" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb68-157"><a href="#cb68-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-158"><a href="#cb68-158" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[selected_compounds,selected_compounds],<span class="at">tl.cex=</span><span class="dv">6</span>)</span>
<span id="cb68-159"><a href="#cb68-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-160"><a href="#cb68-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-161"><a href="#cb68-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-162"><a href="#cb68-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-163"><a href="#cb68-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb68-164"><a href="#cb68-164" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb68-165"><a href="#cb68-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb68-166"><a href="#cb68-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-167"><a href="#cb68-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb68-168"><a href="#cb68-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span>
<span id="cb68-169"><a href="#cb68-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-170"><a href="#cb68-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-171"><a href="#cb68-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-172"><a href="#cb68-172" aria-hidden="true" tabindex="-1"></a>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</span>
<span id="cb68-173"><a href="#cb68-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-174"><a href="#cb68-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pH-plot, message=FALSE, warning=FALSE}</span></span>
<span id="cb68-175"><a href="#cb68-175" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-176"><a href="#cb68-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-177"><a href="#cb68-177" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb68-178"><a href="#cb68-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb68-179"><a href="#cb68-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb68-180"><a href="#cb68-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb68-181"><a href="#cb68-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span>
<span id="cb68-182"><a href="#cb68-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-183"><a href="#cb68-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-184"><a href="#cb68-184" aria-hidden="true" tabindex="-1"></a>The values of molecular mass MM were added to the dataset. They were calculated using <span class="co">[</span><span class="ot">ACD/Labs program</span><span class="co">](www.acdlabs.com)</span> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</span>
<span id="cb68-185"><a href="#cb68-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-186"><a href="#cb68-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hist-MW-logP,message=FALSE, warning=FALSE}</span></span>
<span id="cb68-187"><a href="#cb68-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-188"><a href="#cb68-188" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb68-189"><a href="#cb68-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-190"><a href="#cb68-190" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb68-191"><a href="#cb68-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb68-192"><a href="#cb68-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb68-193"><a href="#cb68-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb68-194"><a href="#cb68-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-195"><a href="#cb68-195" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb68-196"><a href="#cb68-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb68-197"><a href="#cb68-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb68-198"><a href="#cb68-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb68-199"><a href="#cb68-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-200"><a href="#cb68-200" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb68-201"><a href="#cb68-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-202"><a href="#cb68-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-203"><a href="#cb68-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-204"><a href="#cb68-204" aria-hidden="true" tabindex="-1"></a>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</span>
<span id="cb68-205"><a href="#cb68-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-206"><a href="#cb68-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-207"><a href="#cb68-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functional-group-summary, message=FALSE, warning=FALSE}</span></span>
<span id="cb68-208"><a href="#cb68-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-209"><a href="#cb68-209" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb68-210"><a href="#cb68-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-211"><a href="#cb68-211" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb68-212"><a href="#cb68-212" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb68-213"><a href="#cb68-213" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb68-214"><a href="#cb68-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-215"><a href="#cb68-215" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb68-216"><a href="#cb68-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-217"><a href="#cb68-217" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb68-218"><a href="#cb68-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb68-219"><a href="#cb68-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb68-220"><a href="#cb68-220" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-221"><a href="#cb68-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb68-222"><a href="#cb68-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb68-223"><a href="#cb68-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb68-224"><a href="#cb68-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-225"><a href="#cb68-225" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb68-226"><a href="#cb68-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb68-227"><a href="#cb68-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb68-228"><a href="#cb68-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb68-229"><a href="#cb68-229" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb68-230"><a href="#cb68-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb68-231"><a href="#cb68-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-232"><a href="#cb68-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb68-233"><a href="#cb68-233" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span>
<span id="cb68-234"><a href="#cb68-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-235"><a href="#cb68-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-236"><a href="#cb68-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-237"><a href="#cb68-237" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prepare data for calculations</span></span>
<span id="cb68-238"><a href="#cb68-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-241"><a href="#cb68-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb68-242"><a href="#cb68-242" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb68-243"><a href="#cb68-243" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb68-244"><a href="#cb68-244" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb68-245"><a href="#cb68-245" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb68-246"><a href="#cb68-246" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb68-247"><a href="#cb68-247" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb68-248"><a href="#cb68-248" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb68-249"><a href="#cb68-249" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb68-250"><a href="#cb68-250" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb68-251"><a href="#cb68-251" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb68-252"><a href="#cb68-252" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-253"><a href="#cb68-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-254"><a href="#cb68-254" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb68-255"><a href="#cb68-255" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb68-256"><a href="#cb68-256" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb68-257"><a href="#cb68-257" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb68-258"><a href="#cb68-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-259"><a href="#cb68-259" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb68-260"><a href="#cb68-260" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb68-261"><a href="#cb68-261" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb68-262"><a href="#cb68-262" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb68-263"><a href="#cb68-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-264"><a href="#cb68-264" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb68-265"><a href="#cb68-265" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb68-266"><a href="#cb68-266" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb68-267"><a href="#cb68-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-268"><a href="#cb68-268" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb68-269"><a href="#cb68-269" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>),<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb68-270"><a href="#cb68-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-271"><a href="#cb68-271" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb68-272"><a href="#cb68-272" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb68-273"><a href="#cb68-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-274"><a href="#cb68-274" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb68-275"><a href="#cb68-275" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb68-276"><a href="#cb68-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-277"><a href="#cb68-277" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb68-278"><a href="#cb68-278" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb68-279"><a href="#cb68-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-280"><a href="#cb68-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-281"><a href="#cb68-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-282"><a href="#cb68-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb68-283"><a href="#cb68-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-284"><a href="#cb68-284" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb68-285"><a href="#cb68-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-286"><a href="#cb68-286" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb68-287"><a href="#cb68-287" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb68-288"><a href="#cb68-288" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb68-289"><a href="#cb68-289" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb68-290"><a href="#cb68-290" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb68-291"><a href="#cb68-291" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb68-292"><a href="#cb68-292" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-293"><a href="#cb68-293" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-294"><a href="#cb68-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-295"><a href="#cb68-295" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb68-296"><a href="#cb68-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-297"><a href="#cb68-297" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb68-298"><a href="#cb68-298" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb68-299"><a href="#cb68-299" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb68-300"><a href="#cb68-300" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb68-301"><a href="#cb68-301" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span>
<span id="cb68-302"><a href="#cb68-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-303"><a href="#cb68-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-304"><a href="#cb68-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates-plot}</span></span>
<span id="cb68-305"><a href="#cb68-305" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb68-306"><a href="#cb68-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb68-307"><a href="#cb68-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb68-308"><a href="#cb68-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span>
<span id="cb68-309"><a href="#cb68-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-310"><a href="#cb68-310" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb68-311"><a href="#cb68-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logPobs,<span class="at">y=</span>logkw,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb68-312"><a href="#cb68-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb68-313"><a href="#cb68-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span>
<span id="cb68-314"><a href="#cb68-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-315"><a href="#cb68-315" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb68-316"><a href="#cb68-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logPobs,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb68-317"><a href="#cb68-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb68-318"><a href="#cb68-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span>
<span id="cb68-319"><a href="#cb68-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-320"><a href="#cb68-320" aria-hidden="true" tabindex="-1"></a><span class="fu"># Matri normal distribution</span></span>
<span id="cb68-321"><a href="#cb68-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-322"><a href="#cb68-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simulate-from-matrix-normal-halfcentered}</span></span>
<span id="cb68-323"><a href="#cb68-323" aria-hidden="true" tabindex="-1"></a><span class="co">#' non centered</span></span>
<span id="cb68-324"><a href="#cb68-324" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb68-325"><a href="#cb68-325" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb68-326"><a href="#cb68-326" aria-hidden="true" tabindex="-1"></a>rho1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">0.9</span>,n<span class="sc">*</span>n), <span class="at">nrow=</span>n)</span>
<span id="cb68-327"><a href="#cb68-327" aria-hidden="true" tabindex="-1"></a><span class="co"># rho1 = matrix(c(1,0.9,0.9,1), nrow=2)</span></span>
<span id="cb68-328"><a href="#cb68-328" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(rho1) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb68-329"><a href="#cb68-329" aria-hidden="true" tabindex="-1"></a>L_rho1 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho1))</span>
<span id="cb68-330"><a href="#cb68-330" aria-hidden="true" tabindex="-1"></a>rho2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb68-331"><a href="#cb68-331" aria-hidden="true" tabindex="-1"></a>L_rho2 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho2))</span>
<span id="cb68-332"><a href="#cb68-332" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n))</span>
<span id="cb68-333"><a href="#cb68-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-334"><a href="#cb68-334" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> (<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2) <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(L_rho1); </span>
<span id="cb68-335"><a href="#cb68-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-336"><a href="#cb68-336" aria-hidden="true" tabindex="-1"></a>pred_two_analytes <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb68-337"><a href="#cb68-337" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n))</span>
<span id="cb68-338"><a href="#cb68-338" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span>  <span class="fu">t</span>((<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2) <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(L_rho1))</span>
<span id="cb68-339"><a href="#cb68-339" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">c</span>(f[<span class="dv">1</span>,<span class="dv">1</span>],f[<span class="dv">1</span>,<span class="dv">2</span>],f[<span class="dv">2</span>,<span class="dv">1</span>]))</span>
<span id="cb68-340"><a href="#cb68-340" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-341"><a href="#cb68-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-342"><a href="#cb68-342" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3000</span>), <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb68-343"><a href="#cb68-343" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb68-344"><a href="#cb68-344" aria-hidden="true" tabindex="-1"></a> x[i,] <span class="ot">=</span> <span class="fu">pred_two_analytes</span>();</span>
<span id="cb68-345"><a href="#cb68-345" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-346"><a href="#cb68-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-347"><a href="#cb68-347" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb68-348"><a href="#cb68-348" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb68-349"><a href="#cb68-349" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span>
<span id="cb68-350"><a href="#cb68-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-351"><a href="#cb68-351" aria-hidden="true" tabindex="-1"></a>sd_logkw1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">1</span>])</span>
<span id="cb68-352"><a href="#cb68-352" aria-hidden="true" tabindex="-1"></a>sd_S1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">2</span>])</span>
<span id="cb68-353"><a href="#cb68-353" aria-hidden="true" tabindex="-1"></a>sd_logkw2 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">3</span>])</span>
<span id="cb68-354"><a href="#cb68-354" aria-hidden="true" tabindex="-1"></a>rho_logkw1_S1 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb68-355"><a href="#cb68-355" aria-hidden="true" tabindex="-1"></a>rho_logkw1_logkw2 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span>
<span id="cb68-356"><a href="#cb68-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-357"><a href="#cb68-357" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_loggkw1 = %.2f: true = 2.0"</span>, sd_logkw1)</span>
<span id="cb68-358"><a href="#cb68-358" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_S1 = %.2f: true = 2.0"</span>, sd_S1)</span>
<span id="cb68-359"><a href="#cb68-359" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_logkw2 = %.2f: true = 2.0"</span>, sd_logkw2)</span>
<span id="cb68-360"><a href="#cb68-360" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_S1 = %.2f: true = 0.75"</span>, rho_logkw1_S1)</span>
<span id="cb68-361"><a href="#cb68-361" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_logkw2 = %.2f: true = 0.90"</span>, rho_logkw1_logkw2)</span>
<span id="cb68-362"><a href="#cb68-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-363"><a href="#cb68-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-364"><a href="#cb68-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-365"><a href="#cb68-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simulate-from-matrix-noncentered}</span></span>
<span id="cb68-366"><a href="#cb68-366" aria-hidden="true" tabindex="-1"></a><span class="co">#' non centered</span></span>
<span id="cb68-367"><a href="#cb68-367" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb68-368"><a href="#cb68-368" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb68-369"><a href="#cb68-369" aria-hidden="true" tabindex="-1"></a>rho1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">0.9</span>,n<span class="sc">*</span>n), <span class="at">nrow=</span>n)</span>
<span id="cb68-370"><a href="#cb68-370" aria-hidden="true" tabindex="-1"></a><span class="co"># rho1 = matrix(c(1,0.9,0.9,1), nrow=2)</span></span>
<span id="cb68-371"><a href="#cb68-371" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(rho1) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb68-372"><a href="#cb68-372" aria-hidden="true" tabindex="-1"></a>L_rho1 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho1))</span>
<span id="cb68-373"><a href="#cb68-373" aria-hidden="true" tabindex="-1"></a>rho2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb68-374"><a href="#cb68-374" aria-hidden="true" tabindex="-1"></a>L_rho2 <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(rho2))</span>
<span id="cb68-375"><a href="#cb68-375" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n)</span>
<span id="cb68-376"><a href="#cb68-376" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> L_rho1 <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2);  </span>
<span id="cb68-377"><a href="#cb68-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-378"><a href="#cb68-378" aria-hidden="true" tabindex="-1"></a>pred_two_analytes <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb68-379"><a href="#cb68-379" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow=</span>n)</span>
<span id="cb68-380"><a href="#cb68-380" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> L_rho1 <span class="sc">%*%</span> eta <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">%*%</span> L_rho2);</span>
<span id="cb68-381"><a href="#cb68-381" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">c</span>(f[<span class="dv">1</span>,<span class="dv">1</span>],f[<span class="dv">1</span>,<span class="dv">2</span>],f[<span class="dv">2</span>,<span class="dv">1</span>]))</span>
<span id="cb68-382"><a href="#cb68-382" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-383"><a href="#cb68-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-384"><a href="#cb68-384" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3000</span>), <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb68-385"><a href="#cb68-385" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb68-386"><a href="#cb68-386" aria-hidden="true" tabindex="-1"></a> x[i,] <span class="ot">=</span> <span class="fu">pred_two_analytes</span>();</span>
<span id="cb68-387"><a href="#cb68-387" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-388"><a href="#cb68-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-389"><a href="#cb68-389" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb68-390"><a href="#cb68-390" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb68-391"><a href="#cb68-391" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span>
<span id="cb68-392"><a href="#cb68-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-393"><a href="#cb68-393" aria-hidden="true" tabindex="-1"></a>sd_logkw1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">1</span>])</span>
<span id="cb68-394"><a href="#cb68-394" aria-hidden="true" tabindex="-1"></a>sd_S1 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">2</span>])</span>
<span id="cb68-395"><a href="#cb68-395" aria-hidden="true" tabindex="-1"></a>sd_logkw2 <span class="ot">=</span> <span class="fu">sd</span>(x[,<span class="dv">3</span>])</span>
<span id="cb68-396"><a href="#cb68-396" aria-hidden="true" tabindex="-1"></a>rho_logkw1_S1 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">2</span>])</span>
<span id="cb68-397"><a href="#cb68-397" aria-hidden="true" tabindex="-1"></a>rho_logkw1_logkw2 <span class="ot">=</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>],x[,<span class="dv">3</span>])</span>
<span id="cb68-398"><a href="#cb68-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-399"><a href="#cb68-399" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_loggkw1 = %.2f: true = 2.0"</span>, sd_logkw1)</span>
<span id="cb68-400"><a href="#cb68-400" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_S1 = %.2f: true = 2.0"</span>, sd_S1)</span>
<span id="cb68-401"><a href="#cb68-401" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated sd_logkw2 = %.2f: true = 2.0"</span>, sd_logkw2)</span>
<span id="cb68-402"><a href="#cb68-402" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_S1 = %.2f: true = 0.75"</span>, rho_logkw1_S1)</span>
<span id="cb68-403"><a href="#cb68-403" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"simulated rho_logkw1_logkw2 = %.2f: true = 0.90"</span>, rho_logkw1_logkw2)</span>
<span id="cb68-404"><a href="#cb68-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-405"><a href="#cb68-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-406"><a href="#cb68-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simulate-from-matrix-normal}</span></span>
<span id="cb68-407"><a href="#cb68-407" aria-hidden="true" tabindex="-1"></a><span class="co">#' similarity matrix can be considered as a distance matrix.</span></span>
<span id="cb68-408"><a href="#cb68-408" aria-hidden="true" tabindex="-1"></a><span class="co">#' select analytes with similarity index &lt; 0.5</span></span>
<span id="cb68-409"><a href="#cb68-409" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb68-410"><a href="#cb68-410" aria-hidden="true" tabindex="-1"></a>K_no_diag <span class="ot">&lt;-</span> simMat</span>
<span id="cb68-411"><a href="#cb68-411" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(K_no_diag)<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb68-412"><a href="#cb68-412" aria-hidden="true" tabindex="-1"></a>maxes <span class="ot">=</span> <span class="fu">apply</span>(K_no_diag,<span class="dv">2</span>,max)</span>
<span id="cb68-413"><a href="#cb68-413" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1026</span>, <span class="at">y=</span>maxes), <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb68-414"><a href="#cb68-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb68-415"><a href="#cb68-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"red"</span>)</span>
<span id="cb68-416"><a href="#cb68-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-417"><a href="#cb68-417" aria-hidden="true" tabindex="-1"></a>idx_corelatted <span class="ot">=</span> <span class="fu">which</span>(maxes<span class="sc">&gt;</span><span class="fl">0.6</span>)</span>
<span id="cb68-418"><a href="#cb68-418" aria-hidden="true" tabindex="-1"></a>idx_uncorelatted <span class="ot">=</span> <span class="fu">which</span>(maxes<span class="sc">&lt;=</span><span class="fl">0.6</span>)</span>
<span id="cb68-419"><a href="#cb68-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-420"><a href="#cb68-420" aria-hidden="true" tabindex="-1"></a>simMat_adj <span class="ot">&lt;-</span> simMat</span>
<span id="cb68-421"><a href="#cb68-421" aria-hidden="true" tabindex="-1"></a>simMat_adj[simMat_adj<span class="sc">&lt;=</span><span class="fl">0.6</span>]<span class="ot">=</span><span class="fl">0.6</span></span>
<span id="cb68-422"><a href="#cb68-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-423"><a href="#cb68-423" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">*</span>(simMat_adj[idx_corelatted,idx_corelatted]<span class="sc">-</span><span class="fl">0.6</span>)<span class="sc">/</span><span class="fl">0.6</span></span>
<span id="cb68-424"><a href="#cb68-424" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(K)<span class="ot">&lt;-</span><span class="fl">1.00001</span></span>
<span id="cb68-425"><a href="#cb68-425" aria-hidden="true" tabindex="-1"></a>L_K<span class="ot">=</span><span class="fu">t</span>(<span class="fu">chol</span>(K))</span>
<span id="cb68-426"><a href="#cb68-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-427"><a href="#cb68-427" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(K[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>],<span class="at">tl.cex=</span><span class="dv">4</span>)</span>
<span id="cb68-428"><a href="#cb68-428" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[idx_corelatted,idx_corelatted][<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>],<span class="at">tl.cex=</span><span class="dv">4</span>)</span>
<span id="cb68-429"><a href="#cb68-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-430"><a href="#cb68-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-431"><a href="#cb68-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-432"><a href="#cb68-432" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb68-433"><a href="#cb68-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-434"><a href="#cb68-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb68-435"><a href="#cb68-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-436"><a href="#cb68-436" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a ...</span>
<span id="cb68-437"><a href="#cb68-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-438"><a href="#cb68-438" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb68-439"><a href="#cb68-439" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb68-440"><a href="#cb68-440" aria-hidden="true" tabindex="-1"></a>&amp; logk  = logk_w - S_1 \cdot (1 + S_2) \cdot \varphi / (1 + S_2 \cdot \varphi)</span>
<span id="cb68-441"><a href="#cb68-441" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb68-442"><a href="#cb68-442" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb68-443"><a href="#cb68-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-444"><a href="#cb68-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-445"><a href="#cb68-445" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb68-446"><a href="#cb68-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-447"><a href="#cb68-447" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb68-448"><a href="#cb68-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-449"><a href="#cb68-449" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb68-450"><a href="#cb68-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-451"><a href="#cb68-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansetup}</span></span>
<span id="cb68-452"><a href="#cb68-452" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb68-453"><a href="#cb68-453" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb68-454"><a href="#cb68-454" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb68-455"><a href="#cb68-455" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_corr=</span><span class="fu">length</span>(idx_corelatted),</span>
<span id="cb68-456"><a href="#cb68-456" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nAnalytes_uncorr=</span><span class="fu">length</span>(idx_uncorelatted),</span>
<span id="cb68-457"><a href="#cb68-457" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_corr =</span> idx_corelatted,</span>
<span id="cb68-458"><a href="#cb68-458" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idx_uncorr =</span> idx_uncorelatted,</span>
<span id="cb68-459"><a href="#cb68-459" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb68-460"><a href="#cb68-460" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb68-461"><a href="#cb68-461" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb68-462"><a href="#cb68-462" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb68-463"><a href="#cb68-463" aria-hidden="true" tabindex="-1"></a>                       <span class="at">maxR=</span><span class="fu">max</span>(R),</span>
<span id="cb68-464"><a href="#cb68-464" aria-hidden="true" tabindex="-1"></a>                       <span class="at">R=</span>R,</span>
<span id="cb68-465"><a href="#cb68-465" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsA=</span>nGroupsA,</span>
<span id="cb68-466"><a href="#cb68-466" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsB=</span>nGroupsB,</span>
<span id="cb68-467"><a href="#cb68-467" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitA=</span>pKaslitA,</span>
<span id="cb68-468"><a href="#cb68-468" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitB=</span>pKaslitB,</span>
<span id="cb68-469"><a href="#cb68-469" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsA=</span>idxGroupsA,</span>
<span id="cb68-470"><a href="#cb68-470" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsB=</span>idxGroupsB,</span>
<span id="cb68-471"><a href="#cb68-471" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>data<span class="sc">$</span>logk,</span>
<span id="cb68-472"><a href="#cb68-472" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb68-473"><a href="#cb68-473" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb68-474"><a href="#cb68-474" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nA0 =</span> nA0,</span>
<span id="cb68-475"><a href="#cb68-475" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nB0 =</span> nB0,</span>
<span id="cb68-476"><a href="#cb68-476" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxA0 =</span> idxA0,</span>
<span id="cb68-477"><a href="#cb68-477" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxB0 =</span> idxB0,</span>
<span id="cb68-478"><a href="#cb68-478" aria-hidden="true" tabindex="-1"></a>                       <span class="at">simmat =</span> simMat_adj[idx_corelatted,idx_corelatted],</span>
<span id="cb68-479"><a href="#cb68-479" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb68-480"><a href="#cb68-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-481"><a href="#cb68-481" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb68-482"><a href="#cb68-482" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb68-483"><a href="#cb68-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>),</span>
<span id="cb68-484"><a href="#cb68-484" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>),</span>
<span id="cb68-485"><a href="#cb68-485" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb68-486"><a href="#cb68-486" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat   =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.25</span>),</span>
<span id="cb68-487"><a href="#cb68-487" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb68-488"><a href="#cb68-488" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb68-489"><a href="#cb68-489" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)),</span>
<span id="cb68-490"><a href="#cb68-490" aria-hidden="true" tabindex="-1"></a>          <span class="at">rhoc =</span>  <span class="fu">t</span>(<span class="fu">chol</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>))),</span>
<span id="cb68-491"><a href="#cb68-491" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb68-492"><a href="#cb68-492" aria-hidden="true" tabindex="-1"></a>          <span class="at">eta =</span> <span class="fu">cbind</span>((init_aprox<span class="sc">$</span>logkw<span class="sc">-</span><span class="fu">mean</span>(init_aprox<span class="sc">$</span>logkw))<span class="sc">/</span><span class="fu">sd</span>(init_aprox<span class="sc">$</span>logkw),</span>
<span id="cb68-493"><a href="#cb68-493" aria-hidden="true" tabindex="-1"></a>                      (init_aprox<span class="sc">$</span>S1<span class="sc">-</span><span class="fu">mean</span>(init_aprox<span class="sc">$</span>S1))<span class="sc">/</span><span class="fu">sd</span>(init_aprox<span class="sc">$</span>S1)), <span class="co">#matrix(rep(0,nAnalytes*2), nrow=nAnalytes),</span></span>
<span id="cb68-494"><a href="#cb68-494" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb68-495"><a href="#cb68-495" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb68-496"><a href="#cb68-496" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb68-497"><a href="#cb68-497" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb68-498"><a href="#cb68-498" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-499"><a href="#cb68-499" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-500"><a href="#cb68-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-501"><a href="#cb68-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-502"><a href="#cb68-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-503"><a href="#cb68-503" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb68-504"><a href="#cb68-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-505"><a href="#cb68-505" aria-hidden="true" tabindex="-1"></a>We compiled the model using cmdstanr:</span>
<span id="cb68-506"><a href="#cb68-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-507"><a href="#cb68-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stancompile, eval = FALSE}</span></span>
<span id="cb68-508"><a href="#cb68-508" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(model_dir,<span class="st">".stan"</span>), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb68-509"><a href="#cb68-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-510"><a href="#cb68-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-511"><a href="#cb68-511" aria-hidden="true" tabindex="-1"></a>We used optimization for initial testing:</span>
<span id="cb68-512"><a href="#cb68-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-513"><a href="#cb68-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanoptimize, eval = FALSE}</span></span>
<span id="cb68-514"><a href="#cb68-514" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb68-515"><a href="#cb68-515" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb68-516"><a href="#cb68-516" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb68-517"><a href="#cb68-517" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-opt"</span>),</span>
<span id="cb68-518"><a href="#cb68-518" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb68-519"><a href="#cb68-519" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">2000</span></span>
<span id="cb68-520"><a href="#cb68-520" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-521"><a href="#cb68-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-522"><a href="#cb68-522" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span>
<span id="cb68-523"><a href="#cb68-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-524"><a href="#cb68-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-525"><a href="#cb68-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r optplots, eval=FALSE}</span></span>
<span id="cb68-526"><a href="#cb68-526" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb68-527"><a href="#cb68-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-528"><a href="#cb68-528" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb68-529"><a href="#cb68-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">120</span><span class="sc">:</span><span class="dv">130</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-530"><a href="#cb68-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb68-531"><a href="#cb68-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb68-532"><a href="#cb68-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb68-533"><a href="#cb68-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb68-534"><a href="#cb68-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb68-535"><a href="#cb68-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb68-536"><a href="#cb68-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb68-537"><a href="#cb68-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-538"><a href="#cb68-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-539"><a href="#cb68-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-540"><a href="#cb68-540" aria-hidden="true" tabindex="-1"></a>For local computations one can use cmdstanr:</span>
<span id="cb68-541"><a href="#cb68-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-542"><a href="#cb68-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r variational, eval = FALSE}</span></span>
<span id="cb68-543"><a href="#cb68-543" aria-hidden="true" tabindex="-1"></a>fit_var <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">variational</span>(</span>
<span id="cb68-544"><a href="#cb68-544" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb68-545"><a href="#cb68-545" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb68-546"><a href="#cb68-546" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-var"</span>),</span>
<span id="cb68-547"><a href="#cb68-547" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb68-548"><a href="#cb68-548" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb68-549"><a href="#cb68-549" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb68-550"><a href="#cb68-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-551"><a href="#cb68-551" aria-hidden="true" tabindex="-1"></a>fit_var<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb68-552"><a href="#cb68-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-553"><a href="#cb68-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-554"><a href="#cb68-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansample, eval = FALSE}</span></span>
<span id="cb68-555"><a href="#cb68-555" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb68-556"><a href="#cb68-556" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb68-557"><a href="#cb68-557" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb68-558"><a href="#cb68-558" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-loc"</span>),</span>
<span id="cb68-559"><a href="#cb68-559" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb68-560"><a href="#cb68-560" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb68-561"><a href="#cb68-561" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb68-562"><a href="#cb68-562" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb68-563"><a href="#cb68-563" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb68-564"><a href="#cb68-564" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb68-565"><a href="#cb68-565" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb68-566"><a href="#cb68-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-567"><a href="#cb68-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-568"><a href="#cb68-568" aria-hidden="true" tabindex="-1"></a>We performed out computations at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>. In this case:</span>
<span id="cb68-569"><a href="#cb68-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-570"><a href="#cb68-570" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we dumped the necessary data to .json format</span>
<span id="cb68-571"><a href="#cb68-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-572"><a href="#cb68-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dumpfiles, eval = FALSE}</span></span>
<span id="cb68-573"><a href="#cb68-573" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-574"><a href="#cb68-574" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-575"><a href="#cb68-575" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-576"><a href="#cb68-576" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-577"><a href="#cb68-577" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-578"><a href="#cb68-578" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-579"><a href="#cb68-579" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-580"><a href="#cb68-580" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-581"><a href="#cb68-581" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-582"><a href="#cb68-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-583"><a href="#cb68-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-584"><a href="#cb68-584" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we run the model using the batch file:</span>
<span id="cb68-585"><a href="#cb68-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-586"><a href="#cb68-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb68-587"><a href="#cb68-587" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb68-588"><a href="#cb68-588" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb68-589"><a href="#cb68-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-590"><a href="#cb68-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-591"><a href="#cb68-591" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb68-592"><a href="#cb68-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-593"><a href="#cb68-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanload}</span></span>
<span id="cb68-594"><a href="#cb68-594" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb68-595"><a href="#cb68-595" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb68-596"><a href="#cb68-596" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb68-597"><a href="#cb68-597" aria-hidden="true" tabindex="-1"></a>                                  <span class="co">#paste0(stanfiles_dir,"/",  model_name, "-3.csv"),</span></span>
<span id="cb68-598"><a href="#cb68-598" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb68-599"><a href="#cb68-599" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb68-600"><a href="#cb68-600" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb68-601"><a href="#cb68-601" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb68-602"><a href="#cb68-602" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb68-603"><a href="#cb68-603" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb68-604"><a href="#cb68-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-605"><a href="#cb68-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-606"><a href="#cb68-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-607"><a href="#cb68-607" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb68-608"><a href="#cb68-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-609"><a href="#cb68-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{r standiagnose, eval = FALSE}</span></span>
<span id="cb68-610"><a href="#cb68-610" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb68-611"><a href="#cb68-611" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(stanfiles_dir)</span>
<span id="cb68-612"><a href="#cb68-612" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod1_*.csv'</span>)</span>
<span id="cb68-613"><a href="#cb68-613" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb68-614"><a href="#cb68-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-615"><a href="#cb68-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-616"><a href="#cb68-616" aria-hidden="true" tabindex="-1"></a>The diagnostics are reasonable given model complexity. Output copied here to save time:</span>
<span id="cb68-617"><a href="#cb68-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-618"><a href="#cb68-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb68-619"><a href="#cb68-619" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb68-620"><a href="#cb68-620" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb68-621"><a href="#cb68-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-622"><a href="#cb68-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-623"><a href="#cb68-623" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb68-624"><a href="#cb68-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-625"><a href="#cb68-625" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb68-626"><a href="#cb68-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-627"><a href="#cb68-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-628"><a href="#cb68-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb68-629"><a href="#cb68-629" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb68-630"><a href="#cb68-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-631"><a href="#cb68-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-632"><a href="#cb68-632" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trace plots</span></span>
<span id="cb68-633"><a href="#cb68-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-634"><a href="#cb68-634" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb68-635"><a href="#cb68-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-636"><a href="#cb68-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb68-637"><a href="#cb68-637" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb68-638"><a href="#cb68-638" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rhoc[2,1]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>))) </span>
<span id="cb68-639"><a href="#cb68-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-640"><a href="#cb68-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-641"><a href="#cb68-641" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (figures)</span></span>
<span id="cb68-642"><a href="#cb68-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-643"><a href="#cb68-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb68-644"><a href="#cb68-644" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb68-645"><a href="#cb68-645" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rhoc[2,1]"</span>,<span class="st">"sigma"</span>,<span class="st">"alpha"</span>)))</span>
<span id="cb68-646"><a href="#cb68-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-647"><a href="#cb68-647" aria-hidden="true" tabindex="-1"></a><span class="fu"># Genereted quantitites</span></span>
<span id="cb68-648"><a href="#cb68-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-649"><a href="#cb68-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities, eval=FALSE}</span></span>
<span id="cb68-650"><a href="#cb68-650" aria-hidden="true" tabindex="-1"></a>model_gen <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(stan_dir, <span class="st">"/"</span>, model_name, <span class="st">"-gen.stan"</span>))</span>
<span id="cb68-651"><a href="#cb68-651" aria-hidden="true" tabindex="-1"></a>fit_gen  <span class="ot">&lt;-</span> model_gen<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb68-652"><a href="#cb68-652" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb68-653"><a href="#cb68-653" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb68-654"><a href="#cb68-654" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb68-655"><a href="#cb68-655" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb68-656"><a href="#cb68-656" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-gen"</span>))</span>
<span id="cb68-657"><a href="#cb68-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-658"><a href="#cb68-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-659"><a href="#cb68-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-660"><a href="#cb68-660" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load</span></span>
<span id="cb68-661"><a href="#cb68-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-662"><a href="#cb68-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r etaload}</span></span>
<span id="cb68-663"><a href="#cb68-663" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb68-664"><a href="#cb68-664" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-1.csv"</span>),</span>
<span id="cb68-665"><a href="#cb68-665" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-2.csv"</span>),</span>
<span id="cb68-666"><a href="#cb68-666" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-4.csv"</span>),</span>
<span id="cb68-667"><a href="#cb68-667" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-5.csv"</span>)</span>
<span id="cb68-668"><a href="#cb68-668" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb68-669"><a href="#cb68-669" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb68-670"><a href="#cb68-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-671"><a href="#cb68-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-672"><a href="#cb68-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-673"><a href="#cb68-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-674"><a href="#cb68-674" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fits</span></span>
<span id="cb68-675"><a href="#cb68-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-676"><a href="#cb68-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-gof-plots}</span></span>
<span id="cb68-677"><a href="#cb68-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-678"><a href="#cb68-678" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb68-679"><a href="#cb68-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-680"><a href="#cb68-680" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogkHat_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb68-681"><a href="#cb68-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb68-682"><a href="#cb68-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb68-683"><a href="#cb68-683" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogkHat_ind) <span class="sc">%&gt;%</span></span>
<span id="cb68-684"><a href="#cb68-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb68-685"><a href="#cb68-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-686"><a href="#cb68-686" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb68-687"><a href="#cb68-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-688"><a href="#cb68-688" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogkHat_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb68-689"><a href="#cb68-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb68-690"><a href="#cb68-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb68-691"><a href="#cb68-691" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogkHat_pop) <span class="sc">%&gt;%</span></span>
<span id="cb68-692"><a href="#cb68-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb68-693"><a href="#cb68-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-694"><a href="#cb68-694" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb68-695"><a href="#cb68-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb68-696"><a href="#cb68-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb68-697"><a href="#cb68-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb68-698"><a href="#cb68-698" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb68-699"><a href="#cb68-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-700"><a href="#cb68-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb68-701"><a href="#cb68-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb68-702"><a href="#cb68-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb68-703"><a href="#cb68-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-704"><a href="#cb68-704" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb68-705"><a href="#cb68-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb68-706"><a href="#cb68-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb68-707"><a href="#cb68-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb68-708"><a href="#cb68-708" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb68-709"><a href="#cb68-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-710"><a href="#cb68-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb68-711"><a href="#cb68-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb68-712"><a href="#cb68-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb68-713"><a href="#cb68-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-714"><a href="#cb68-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-715"><a href="#cb68-715" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb68-716"><a href="#cb68-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-717"><a href="#cb68-717" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-718"><a href="#cb68-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-719"><a href="#cb68-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-720"><a href="#cb68-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-predictions}</span></span>
<span id="cb68-721"><a href="#cb68-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-722"><a href="#cb68-722" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>); <span class="co">#c(1:9, 501,510, 626) (100:120)</span></span>
<span id="cb68-723"><a href="#cb68-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-724"><a href="#cb68-724" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb68-725"><a href="#cb68-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-726"><a href="#cb68-726" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_ind[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb68-727"><a href="#cb68-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_ind) <span class="sc">%&gt;%</span></span>
<span id="cb68-728"><a href="#cb68-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb68-729"><a href="#cb68-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb68-730"><a href="#cb68-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb68-731"><a href="#cb68-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb68-732"><a href="#cb68-732" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-733"><a href="#cb68-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb68-734"><a href="#cb68-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb68-735"><a href="#cb68-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb68-736"><a href="#cb68-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb68-737"><a href="#cb68-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb68-738"><a href="#cb68-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-739"><a href="#cb68-739" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb68-740"><a href="#cb68-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-741"><a href="#cb68-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-742"><a href="#cb68-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions}</span></span>
<span id="cb68-743"><a href="#cb68-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-744"><a href="#cb68-744" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">120</span>);</span>
<span id="cb68-745"><a href="#cb68-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-746"><a href="#cb68-746" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb68-747"><a href="#cb68-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-748"><a href="#cb68-748" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_pop[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb68-749"><a href="#cb68-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_pop) <span class="sc">%&gt;%</span></span>
<span id="cb68-750"><a href="#cb68-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb68-751"><a href="#cb68-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb68-752"><a href="#cb68-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb68-753"><a href="#cb68-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb68-754"><a href="#cb68-754" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-755"><a href="#cb68-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb68-756"><a href="#cb68-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb68-757"><a href="#cb68-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb68-758"><a href="#cb68-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb68-759"><a href="#cb68-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb68-760"><a href="#cb68-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-761"><a href="#cb68-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-762"><a href="#cb68-762" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb68-763"><a href="#cb68-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-764"><a href="#cb68-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-765"><a href="#cb68-765" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual Parameters and etaplots</span></span>
<span id="cb68-766"><a href="#cb68-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-767"><a href="#cb68-767" aria-hidden="true" tabindex="-1"></a>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</span>
<span id="cb68-768"><a href="#cb68-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-769"><a href="#cb68-769" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual parameters</span></span>
<span id="cb68-770"><a href="#cb68-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-771"><a href="#cb68-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iparam-column-neutral}</span></span>
<span id="cb68-772"><a href="#cb68-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-773"><a href="#cb68-773" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^sparam_ind"</span>, </span>
<span id="cb68-774"><a href="#cb68-774" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb68-775"><a href="#cb68-775" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb68-776"><a href="#cb68-776" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb68-777"><a href="#cb68-777" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb68-778"><a href="#cb68-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-779"><a href="#cb68-779" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>chargesA0<span class="sc">+</span>chargesB0</span>
<span id="cb68-780"><a href="#cb68-780" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb68-781"><a href="#cb68-781" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb68-782"><a href="#cb68-782" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb68-783"><a href="#cb68-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-784"><a href="#cb68-784" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb68-785"><a href="#cb68-785" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb68-786"><a href="#cb68-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-787"><a href="#cb68-787" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb68-788"><a href="#cb68-788" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb68-789"><a href="#cb68-789" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb68-790"><a href="#cb68-790" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb68-791"><a href="#cb68-791" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb68-792"><a href="#cb68-792" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb68-793"><a href="#cb68-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-794"><a href="#cb68-794" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb68-795"><a href="#cb68-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-796"><a href="#cb68-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-797"><a href="#cb68-797" aria-hidden="true" tabindex="-1"></a><span class="fu">### Etas</span></span>
<span id="cb68-798"><a href="#cb68-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-799"><a href="#cb68-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ieta}</span></span>
<span id="cb68-800"><a href="#cb68-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-801"><a href="#cb68-801" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^seta_ind"</span>, </span>
<span id="cb68-802"><a href="#cb68-802" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb68-803"><a href="#cb68-803" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb68-804"><a href="#cb68-804" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb68-805"><a href="#cb68-805" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb68-806"><a href="#cb68-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-807"><a href="#cb68-807" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>chargesA0<span class="sc">+</span>chargesB0</span>
<span id="cb68-808"><a href="#cb68-808" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb68-809"><a href="#cb68-809" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb68-810"><a href="#cb68-810" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb68-811"><a href="#cb68-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-812"><a href="#cb68-812" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb68-813"><a href="#cb68-813" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb68-814"><a href="#cb68-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-815"><a href="#cb68-815" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), </span>
<span id="cb68-816"><a href="#cb68-816" aria-hidden="true" tabindex="-1"></a>           <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb68-817"><a href="#cb68-817" aria-hidden="true" tabindex="-1"></a>           <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb68-818"><a href="#cb68-818" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb68-819"><a href="#cb68-819" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb68-820"><a href="#cb68-820" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb68-821"><a href="#cb68-821" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb68-822"><a href="#cb68-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-823"><a href="#cb68-823" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb68-824"><a href="#cb68-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-825"><a href="#cb68-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-826"><a href="#cb68-826" aria-hidden="true" tabindex="-1"></a><span class="fu"># Functional groups</span></span>
<span id="cb68-827"><a href="#cb68-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-828"><a href="#cb68-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functinoal-group-effects}</span></span>
<span id="cb68-829"><a href="#cb68-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb68-830"><a href="#cb68-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb68-831"><a href="#cb68-831" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb68-832"><a href="#cb68-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-833"><a href="#cb68-833" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb68-834"><a href="#cb68-834" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb68-835"><a href="#cb68-835" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb68-836"><a href="#cb68-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-837"><a href="#cb68-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb68-838"><a href="#cb68-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names<span class="sc">$</span>functional.group.name)</span>
<span id="cb68-839"><a href="#cb68-839" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb68-840"><a href="#cb68-840" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb68-841"><a href="#cb68-841" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb68-842"><a href="#cb68-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb68-843"><a href="#cb68-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb68-844"><a href="#cb68-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names<span class="sc">$</span>functional.group.name)</span>
<span id="cb68-845"><a href="#cb68-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-846"><a href="#cb68-846" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb68-847"><a href="#cb68-847" aria-hidden="true" tabindex="-1"></a>param <span class="sc">%&gt;%</span></span>
<span id="cb68-848"><a href="#cb68-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb68-849"><a href="#cb68-849" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb68-850"><a href="#cb68-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb68-851"><a href="#cb68-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)</span>
<span id="cb68-852"><a href="#cb68-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb68-853"><a href="#cb68-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-854"><a href="#cb68-854" aria-hidden="true" tabindex="-1"></a><span class="in">```{r info}</span></span>
<span id="cb68-855"><a href="#cb68-855" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb68-856"><a href="#cb68-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>