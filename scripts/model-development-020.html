<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2025-06-05">

<title>QSRR revisited. Model 004. GP attempt</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="model-development-020_files/libs/clipboard/clipboard.min.js"></script>
<script src="model-development-020_files/libs/quarto-html/quarto.js"></script>
<script src="model-development-020_files/libs/quarto-html/popper.min.js"></script>
<script src="model-development-020_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="model-development-020_files/libs/quarto-html/anchor.min.js"></script>
<link href="model-development-020_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="model-development-020_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model-development-020_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model-development-020_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model-development-020_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introductions" id="toc-introductions" class="nav-link active" data-scroll-target="#introductions">Introductions</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#prepare-data" id="toc-prepare-data" class="nav-link" data-scroll-target="#prepare-data">Prepare data</a></li>
  <li><a href="#initial-estimates" id="toc-initial-estimates" class="nav-link" data-scroll-target="#initial-estimates">Initial estimates</a></li>
  </ul></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data analysis</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#priors" id="toc-priors" class="nav-link" data-scroll-target="#priors">Priors</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  </ul></li>
  <li><a href="#genereted-quantitites" id="toc-genereted-quantitites" class="nav-link" data-scroll-target="#genereted-quantitites">Genereted quantitites</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#load" id="toc-load" class="nav-link" data-scroll-target="#load">Load</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  <li><a href="#functional-groups-effect" id="toc-functional-groups-effect" class="nav-link" data-scroll-target="#functional-groups-effect">Functional groups effect</a></li>
  <li><a href="#fits" id="toc-fits" class="nav-link" data-scroll-target="#fits">Fits</a></li>
  <li><a href="#individual-parameters-and-etaplots" id="toc-individual-parameters-and-etaplots" class="nav-link" data-scroll-target="#individual-parameters-and-etaplots">Individual Parameters and etaplots</a>
  <ul class="collapse">
  <li><a href="#individual-parameters" id="toc-individual-parameters" class="nav-link" data-scroll-target="#individual-parameters">Individual parameters</a></li>
  <li><a href="#etas" id="toc-etas" class="nav-link" data-scroll-target="#etas">Etas</a></li>
  <li><a href="#effect-of-functional-groups-screening" id="toc-effect-of-functional-groups-screening" class="nav-link" data-scroll-target="#effect-of-functional-groups-screening">Effect of functional groups (screening)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#simulations-cv-based" id="toc-simulations-cv-based" class="nav-link" data-scroll-target="#simulations-cv-based">Simulations (CV-based)</a>
  <ul class="collapse">
  <li><a href="#fitting-the-model-1" id="toc-fitting-the-model-1" class="nav-link" data-scroll-target="#fitting-the-model-1">Fitting the model</a></li>
  <li><a href="#summary-of-model-parameters-table-1" id="toc-summary-of-model-parameters-table-1" class="nav-link" data-scroll-target="#summary-of-model-parameters-table-1">Summary of model parameters (table):</a></li>
  <li><a href="#genereted-quantitites-1" id="toc-genereted-quantitites-1" class="nav-link" data-scroll-target="#genereted-quantitites-1">Genereted quantitites</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a>
  <ul class="collapse">
  <li><a href="#load-1" id="toc-load-1" class="nav-link" data-scroll-target="#load-1">Load</a></li>
  <li><a href="#fits-1" id="toc-fits-1" class="nav-link" data-scroll-target="#fits-1">Fits</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">QSRR revisited. Model 004. GP attempt</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 5, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introductions" class="level1">
<h1>Introductions</h1>
<p>GP model. Test</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr.bayes)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'dplyr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'ggplot2' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'patchwork' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'gridExtra' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'naniar' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'knitr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tidyverse' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tibble' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tidyr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'readr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'purrr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'stringr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'forcats' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'lubridate' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'glue' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(whisker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'whisker' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'here' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'posterior' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'bayesplot' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tidybayes' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'reshape2' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'pracma' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mrgmisc)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'GGally' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("metrumresearchgroup/mrgmisc")</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/GUMed/.cmdstan/cmdstan-2.36.0"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10271998</span>) <span class="do">## not required but assures repeatable results</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>select<span class="ot">&lt;-</span>dplyr<span class="sc">::</span>select</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"helper-functions.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>model_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>,<span class="st">"stan"</span>)  </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>tables_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_dir)) <span class="fu">dir.create</span>(tables_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>data_deliv_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"deliv"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>data_derived_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"derived"</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_deliv_dir)) <span class="fu">dir.create</span>(data_deliv_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_derived_dir)) <span class="fu">dir.create</span>(data_derived_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>figures_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>tables_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_eda_dir)) <span class="fu">dir.create</span>(figures_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_eda_dir)) <span class="fu">dir.create</span>(tables_eda_dir, <span class="at">recursive =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35^{}C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient.</p>
<p>The values of molecular mass MM were added to the dataset. They were calculated using <a href="www.acdlabs.com">ACD/Labs program</a> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8. The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</p>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir, <span class="st">"database_logk_1026.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"database_logk_1026_analyte_names.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"smiles1026.smi"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">'ACD_pKas.csv'</span>))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"pH.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(logP_ACD)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>MW <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(MW_ACD)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(data_ACD<span class="sc">$</span>logP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>fg_df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>descriptor_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"descriptor_df.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>distance_ltri_rcdk_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"distance_ltri_rcdk.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="fu">make_distance_matrix_fun</span>(distance_ltri_rcdk_df)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"similarity_ltri_rcdk.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>similarity_matrix <span class="ot">&lt;-</span> <span class="fu">make_similarity_matrix_fun</span>(similarity_ltri_rcdk_df)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>smiles<span class="ot">&lt;-</span>smiles <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ID=</span>V2,<span class="at">smiles=</span>V1) <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID,smiles)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">905</span>] <span class="ot">=</span> <span class="st">"CN(C1CCCCC1N1CCCC1)C(=O)Cc1ccc(c(c1)Cl)Cl"</span> <span class="co"># remove tartrate moiety </span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">425</span>] <span class="ot">=</span> <span class="st">"CC(Cc1ccc(cc1)OCC(=O)O)NCC(c1cccc(c1)Cl)O"</span> <span class="co"># remove Na+ and dissociation</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">501</span>] <span class="ot">=</span> <span class="st">"c1ccc(cc1)C1(c2ccccc2)C(=O)NC(=N1)O"</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">401</span>]<span class="ot">=</span> <span class="st">"CC(C)(C)c1c(CC(C(=O)[OH])[NH2])c(=O)[nH]o1"</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">686</span>] <span class="ot">=</span> <span class="st">"CCCCCCCCCCCCCCCC(=O)OC(CC(=O)[OH])C[N+](C)(C)C"</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">901</span>] <span class="ot">=</span> <span class="st">"CCOC(=Nc1c[n+](no1)N1CCOCC1)[OH]"</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>analytes_names<span class="sc">$</span>Analyte <span class="ot">&lt;-</span> <span class="fu">iconv</span>(analytes_names<span class="sc">$</span>Analyte, <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">"byte"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data">Prepare data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> fg_df <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.) <span class="sc">||</span> <span class="sc">!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(id1,id2,SMILES, Anion, Kation,Ammonium))</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> <span class="fu">colnames</span>(functional_groups)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>dissociation <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="at">pKaslit =</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>],           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="at">pKasliterror =</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>],    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="at">chargesA =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>]),    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="at">chargesB =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]))   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>charges <span class="ot">=</span> dissociation<span class="sc">$</span>chargesA<span class="sc">+</span>dissociation<span class="sc">$</span>chargesB                  <span class="co"># absolute charge</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsA <span class="ot">=</span> (dissociation<span class="sc">$</span>chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsB <span class="ot">=</span> <span class="sc">-</span>(dissociation<span class="sc">$</span>chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># number of dissociation steps</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groups <span class="ot">=</span> dissociation<span class="sc">$</span>groupsB<span class="sc">-</span>dissociation<span class="sc">$</span>groupsA</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>logPobs <span class="ot">=</span>data_ACD<span class="sc">$</span>logP</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>MW <span class="ot">=</span>data_ACD<span class="sc">$</span>MW</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsA)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitA<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsA]</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsB)</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitB<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsB]</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span>]</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesB[,<span class="fu">max</span>(dissociation<span class="sc">$</span>R)]</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxA0)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxB0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="initial-estimates" class="level2">
<h2 class="anchored" data-anchor-id="initial-estimates">Initial estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-analysis" class="level1">
<h1>Data analysis</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a …</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk_{i,j}  = logkw_{i} - S_{1,i} \cdot (1 + S_{2}) \cdot \varphi_{i,j} / (1 + S_{2} \cdot \varphi_{i,j})
\end{aligned}
\]</span> The statistical model has the following structure (hierarchical model):</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \log k_{obs_{i,j}} \sim student_t(\nu,logk_{i,j},\sigma) \\
&amp; R_{i} \sim \text{MVN}(\theta_R  + \beta \cdot log P_i +\pi_R \cdot X_i , \Omega) \\
&amp; \pi_{R,k} \sim N(0,\kappa_R)
\end{aligned}
\]</span> Needs improvements!! where <span class="math inline">\(R_i=(logkw_{i}, S_{1,i})\)</span> is a vector of subject-specific parameters, <span class="math inline">\(logk_{i,j}\)</span> corresponds to the above Neue equation, <span class="math inline">\(MVN\)</span> is a multivariate normal distribution, <span class="math inline">\(\theta_R\)</span> is a vector of typical values of <span class="math inline">\(R_i\)</span>, <span class="math inline">\(\beta_R\)</span> is a vector of slopes between <span class="math inline">\(R_i\)</span> and <span class="math inline">\(logP_i\)</span>, and <span class="math inline">\(\pi_R\)</span> is a vector of slopes between <span class="math inline">\(R_i\)</span> and functional group vector <span class="math inline">\(Xi\)</span>. In turn, <span class="math inline">\(\sigma\)</span> is the scale and <span class="math inline">\(\Omega\)</span> is the scale matrix for the random effects related to the residual and unexplained between-analyte variability. <span class="math inline">\(\Omega\)</span> was decomposed to:</p>
<p><span class="math display">\[
\Omega = diag(\omega) \cdot \rho \cdot diag(\omega)
\]</span></p>
<p>where <span class="math inline">\(\rho\)</span> denotes correlation a correlation matrix and <span class="math inline">\(\omega\)</span> denotes standard deviation for between analyte variability.</p>
</section>
<section id="priors" class="level2">
<h2 class="anchored" data-anchor-id="priors">Priors</h2>
<p>The priors were specified as follows:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \theta_{logkw} \sim normal(2, 4), \\
&amp; \theta_{S1} \sim normal(4, 2), \\
&amp; \theta_{S2} \sim lognormal(0.693, 0.125), \\
&amp; \nu = 7,\\
&amp; \omega_{logkw},\omega_{S1} \sim normal_+(0, 1), \\
&amp; \beta_{logkw} \sim  normal(0.7, 0.125), \\
&amp; \beta_{S1} \sim  normal(0.5, 0.125), \\
&amp; \kappa_{logkw},\kappa_{S1} \sim  normal(0, 0.1), \\
&amp; \sigma \sim normal_+(0,0.05), \\
&amp; p(\rho) \propto LKJ(2) \cdot \Pi_u N(c_u, 0.125), \\
&amp; c_u = [0.75]
\end{aligned}
\]</span></p>
<p>LKJ(2) ensure that the density is uniform over correlation matrices of order 2 and u denotes the unique lower triangular elements of correlation matrix (<a href="http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/" class="uri">http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/</a>)</p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set: data</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">=</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">nearPD</span>(similarity_matrix, <span class="at">corr =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>mat)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>data_ACD<span class="sc">$</span>logP,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">distance_x =</span> <span class="dv">1</span><span class="sc">-</span>similarity_matrix_corrected,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>          <span class="co"># eta = cbind((init_aprox$logkw-mean(init_aprox$logkw))/sd(init_aprox$logkw),</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>          <span class="co">#             (init_aprox$S1-mean(init_aprox$S1))/sd(init_aprox$S1)),</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<p>We compiled the model using cmdstanr:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod20"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mod20 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used optimization for initial testing:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod20<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="st">"mod20-opt"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">3000</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-opt-1.csv"</span>)))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID),<span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/plots-optimize-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>For local computations one can use cmdstanr:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod20<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="st">"mod20-loc"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a> fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="fu">here</span>(mod_output_dir,<span class="st">"mod20-loc.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We performed out computations at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>. In this case:</p>
<ol type="1">
<li>we dumped the necessary data to .json format</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>we run the model using the batch file:</li>
</ol>
<pre> 
</pre>
<ol start="3" type="1">
<li>After calculations, we loaded the output files using cmdstanr.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(mod_output_dir)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod20-*.csv'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The diagnostics are reasonable given model complexity. Output copied here to save time:</p>
<pre></pre>
</section>
<section id="summary-of-model-parameters-table" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     variable    mean  median    sd   mad      q5     q95 rhat ess_bulk
 lp__         9526.17 9525.08 45.51 45.86 9453.53 9602.23 1.01      473
 logkwHat        2.39    2.39  0.17  0.17    2.10    2.66 1.00     1819
 S1Hat           3.02    3.02  0.15  0.15    2.77    3.27 1.00     1714
 S2Hat           2.90    2.90  0.03  0.03    2.84    2.95 1.03      240
 beta[1]         0.59    0.59  0.04  0.04    0.53    0.66 1.00     1663
 beta[2]         0.36    0.36  0.03  0.03    0.30    0.41 1.00     1496
 omega[1]        1.40    1.40  0.04  0.04    1.34    1.46 1.00     1493
 omega[2]        1.15    1.15  0.03  0.03    1.09    1.20 1.03      279
 rho[1,1]        1.00    1.00  0.00  0.00    1.00    1.00   NA       NA
 rho[2,1]        0.89    0.89  0.01  0.01    0.87    0.90 1.01     1405
 rho[1,2]        0.89    0.89  0.01  0.01    0.87    0.90 1.01     1405
 rho[2,2]        1.00    1.00  0.00  0.00    1.00    1.00   NA       NA
 sigma           0.05    0.05  0.00  0.00    0.05    0.05 1.01      949
 pilogkw[1]      0.28    0.28  0.04  0.04    0.21    0.35 1.00     2613
 pilogkw[2]      0.28    0.28  0.02  0.02    0.24    0.33 1.00     2013
 pilogkw[3]     -0.13   -0.13  0.07  0.07   -0.24   -0.01 1.00     3651
 pilogkw[4]      0.01    0.01  0.11  0.11   -0.17    0.18 1.00     4246
 pilogkw[5]      0.05    0.05  0.07  0.07   -0.07    0.17 1.00     3179
 pilogkw[6]     -0.04   -0.03  0.18  0.18   -0.33    0.25 1.00     3487
 pilogkw[7]      0.07    0.07  0.16  0.16   -0.19    0.34 1.00     3937
 pilogkw[8]      0.31    0.31  0.10  0.10    0.15    0.48 1.00     3829
 pilogkw[9]      0.03    0.03  0.25  0.24   -0.37    0.44 1.01     3835
 pilogkw[10]     0.00    0.00  0.14  0.14   -0.23    0.24 1.01     3322
 pilogkw[11]     0.20    0.20  0.10  0.10    0.03    0.36 1.00     3138
 pilogkw[12]    -0.03   -0.03  0.16  0.16   -0.30    0.23 1.01     4155
 pilogkw[13]     0.15    0.14  0.15  0.15   -0.09    0.39 1.00     3426
 pilogkw[14]     0.22    0.22  0.19  0.19   -0.07    0.55 1.00     2407
 pilogkw[15]     0.20    0.20  0.06  0.06    0.11    0.29 1.00     4312
 pilogkw[16]     0.19    0.19  0.17  0.17   -0.09    0.47 1.00     3094
 pilogkw[17]     0.15    0.16  0.19  0.19   -0.17    0.46 1.00     4203
 pilogkw[18]     0.05    0.06  0.22  0.22   -0.31    0.41 1.00     3640
 pilogkw[19]    -0.63   -0.63  0.17  0.17   -0.91   -0.37 1.00     2943
 pilogkw[20]    -0.85   -0.85  0.15  0.15   -1.09   -0.60 1.01     2130
 pilogkw[21]    -0.89   -0.89  0.11  0.11   -1.07   -0.71 1.00     2058
 pilogkw[22]     0.21    0.21  0.19  0.19   -0.09    0.53 1.00     3253
 pilogkw[23]    -0.16   -0.16  0.13  0.13   -0.38    0.06 1.00     4471
 pilogkw[24]     0.01    0.01  0.22  0.23   -0.35    0.38 1.01     2928
 pilogkw[25]     0.02    0.02  0.20  0.19   -0.30    0.35 1.00     4857
 pilogkw[26]    -0.06   -0.06  0.17  0.17   -0.36    0.23 1.00     4057
 pilogkw[27]    -0.25   -0.25  0.26  0.26   -0.69    0.16 1.00     2531
 pilogkw[28]     0.02    0.02  0.24  0.24   -0.37    0.41 1.00     3211
 pilogkw[29]    -0.06   -0.05  0.16  0.16   -0.32    0.22 1.01     4667
 pilogkw[30]     0.32    0.31  0.15  0.15    0.07    0.58 1.01     3564
 pilogkw[31]     0.19    0.19  0.26  0.26   -0.22    0.63 1.00     4174
 pilogkw[32]     0.08    0.07  0.24  0.23   -0.31    0.49 1.00     3468
 pilogkw[33]     0.22    0.22  0.11  0.11    0.04    0.40 1.00     4289
 pilogkw[34]    -0.19   -0.18  0.24  0.24   -0.60    0.20 1.01     3343
 pilogkw[35]     0.04    0.03  0.26  0.26   -0.39    0.49 1.00     3527
 pilogkw[36]     0.05    0.05  0.20  0.21   -0.28    0.38 1.00     3487
 pilogkw[37]     0.10    0.10  0.20  0.20   -0.22    0.42 1.01     4236
 pilogkw[38]     0.12    0.12  0.27  0.27   -0.32    0.58 1.01     2669
 pilogkw[39]    -0.16   -0.16  0.19  0.19   -0.46    0.15 1.01     3951
 pilogkw[40]     0.16    0.16  0.20  0.19   -0.16    0.49 1.01     4001
 pilogkw[41]    -0.02   -0.02  0.18  0.17   -0.32    0.26 1.00     4760
 pilogkw[42]     0.06    0.06  0.23  0.23   -0.30    0.43 1.00     4717
 pilogkw[43]     0.06    0.07  0.22  0.22   -0.30    0.44 1.00     5147
 pilogkw[44]    -0.16   -0.15  0.26  0.26   -0.59    0.25 1.01     3537
 pilogkw[45]     0.06    0.06  0.19  0.19   -0.25    0.38 1.00     3393
 pilogkw[46]    -0.01    0.00  0.24  0.24   -0.41    0.39 1.00     3922
 pilogkw[47]     0.05    0.05  0.19  0.19   -0.27    0.35 1.00     3655
 pilogkw[48]     0.04    0.04  0.19  0.19   -0.29    0.35 1.00     3860
 pilogkw[49]     0.01    0.01  0.24  0.23   -0.39    0.39 1.00     3796
 pilogkw[50]     0.24    0.24  0.19  0.19   -0.06    0.55 1.00     4258
 pilogkw[51]     0.04    0.03  0.26  0.25   -0.38    0.47 1.01     4341
 pilogkw[52]    -0.09   -0.09  0.11  0.11   -0.27    0.10 1.01     3891
 pilogkw[53]     0.12    0.12  0.10  0.10   -0.05    0.30 1.00     3044
 pilogkw[54]     0.06    0.06  0.18  0.17   -0.23    0.35 1.00     4189
 pilogkw[55]    -0.06   -0.06  0.24  0.25   -0.45    0.34 1.00     4251
 pilogkw[56]    -0.11   -0.11  0.20  0.19   -0.45    0.22 1.01     4376
 pilogkw[57]     0.00    0.00  0.12  0.12   -0.19    0.20 1.00     4582
 pilogkw[58]     0.03    0.03  0.16  0.16   -0.22    0.29 1.00     5080
 pilogkw[59]    -0.08   -0.08  0.15  0.15   -0.33    0.17 1.00     4440
 pilogkw[60]     0.05    0.05  0.20  0.20   -0.27    0.38 1.01     3782
 pilogkw[61]    -0.04   -0.04  0.22  0.21   -0.40    0.31 1.00     3294
 pilogkw[62]    -0.04   -0.04  0.25  0.24   -0.45    0.37 1.01     3577
 pilogkw[63]    -0.59   -0.59  0.19  0.19   -0.92   -0.28 1.00     3069
 pilogkw[64]    -0.08   -0.08  0.25  0.25   -0.50    0.33 1.00     3108
 pilogkw[65]     0.03    0.03  0.26  0.25   -0.41    0.45 1.00     3227
 pilogkw[66]     0.00    0.00  0.26  0.26   -0.44    0.44 1.01     3898
 pilogkw[67]    -0.11   -0.10  0.24  0.23   -0.50    0.28 1.00     4202
 pilogkw[68]     0.29    0.29  0.14  0.15    0.05    0.52 1.00     3487
 pilogkw[69]     0.21    0.20  0.25  0.24   -0.20    0.61 1.01     3233
 pilogkw[70]    -0.30   -0.30  0.14  0.14   -0.54   -0.06 1.01     3513
 pilogkw[71]     0.15    0.16  0.19  0.19   -0.18    0.46 1.00     3687
 pilogkw[72]     0.02    0.02  0.19  0.20   -0.31    0.33 1.00     4562
 pilogkw[73]     0.28    0.28  0.22  0.23   -0.08    0.66 1.00     3070
 pilogkw[74]    -0.04   -0.04  0.25  0.25   -0.47    0.37 1.01     4161
 pilogkw[75]     0.22    0.22  0.23  0.23   -0.15    0.62 1.00     3551
 pilogkw[76]    -0.05   -0.05  0.26  0.26   -0.47    0.38 1.01     3376
 pilogkw[77]     0.01    0.01  0.26  0.26   -0.41    0.43 1.01     3389
 pilogkw[78]     0.07    0.07  0.19  0.19   -0.23    0.37 1.00     3369
 pilogkw[79]    -0.02   -0.02  0.26  0.26   -0.46    0.42 1.00     3047
 pilogkw[80]    -0.03   -0.03  0.15  0.15   -0.29    0.22 1.01     3579
 pilogkw[81]    -0.06   -0.06  0.24  0.24   -0.45    0.33 1.01     3857
 pilogkw[82]     0.01    0.01  0.24  0.23   -0.38    0.40 1.00     3696
 pilogkw[83]    -0.33   -0.33  0.19  0.20   -0.65   -0.01 1.00     2570
 pilogkw[84]    -0.49   -0.49  0.18  0.18   -0.79   -0.17 1.00     3070
 pilogkw[85]     0.06    0.06  0.15  0.15   -0.19    0.31 1.01     4253
 pilogkw[86]     0.06    0.06  0.23  0.24   -0.32    0.44 1.00     2990
 pilogkw[87]     0.00    0.00  0.24  0.22   -0.38    0.40 1.00     3148
 pilogkw[88]     0.11    0.11  0.26  0.25   -0.31    0.53 1.01     3495
 pilogkw[89]    -0.20   -0.20  0.07  0.07   -0.31   -0.07 1.01     3462
 pilogkw[90]    -0.10   -0.10  0.16  0.16   -0.37    0.16 1.00     3240
 pilogkw[91]     0.29    0.29  0.08  0.08    0.15    0.42 1.01     3089
 pilogkw[92]     0.19    0.19  0.13  0.13   -0.02    0.41 1.00     3938
 pilogkw[93]     0.02    0.02  0.18  0.18   -0.27    0.32 1.00     4022
 pilogkw[94]    -0.04   -0.04  0.19  0.19   -0.36    0.29 1.00     3758
 pilogkw[95]     0.10    0.09  0.26  0.26   -0.32    0.54 1.01     3596
 pilogkw[96]    -0.34   -0.33  0.24  0.24   -0.75    0.04 1.00     3737
 pilogkw[97]    -0.08   -0.08  0.14  0.14   -0.30    0.15 1.00     3849
 pilogkw[98]    -0.37   -0.37  0.15  0.15   -0.62   -0.12 1.00     3249
 pilogkw[99]     0.12    0.12  0.15  0.15   -0.13    0.38 1.00     3658
 pilogkw[100]   -0.21   -0.20  0.14  0.14   -0.43    0.02 1.00     2957
 pilogkw[101]    0.22    0.22  0.16  0.16   -0.05    0.49 1.00     3083
 pilogkw[102]    0.08    0.08  0.19  0.18   -0.22    0.39 1.00     3305
 pilogkw[103]   -0.17   -0.18  0.13  0.13   -0.38    0.03 1.01     3004
 pilogkw[104]    0.00    0.00  0.26  0.25   -0.41    0.41 1.01     3588
 pilogkw[105]    0.23    0.23  0.17  0.17   -0.04    0.51 1.00     4367
 pilogkw[106]    0.01    0.00  0.25  0.25   -0.42    0.44 1.01     3519
 pilogkw[107]    0.06    0.07  0.25  0.25   -0.33    0.45 1.01     3159
 pilogkw[108]    0.02    0.03  0.25  0.25   -0.40    0.43 1.00     3433
 pilogkw[109]   -0.05   -0.05  0.25  0.24   -0.46    0.36 1.01     3443
 pilogkw[110]   -0.19   -0.20  0.24  0.24   -0.59    0.20 1.00     3405
 pilogkw[111]    0.07    0.07  0.25  0.24   -0.35    0.47 1.00     3298
 pilogkw[112]    0.01    0.01  0.23  0.23   -0.35    0.37 1.00     3782
 pilogkw[113]   -0.19   -0.19  0.24  0.23   -0.58    0.20 1.00     3594
 pilogkw[114]   -0.08   -0.08  0.25  0.24   -0.50    0.31 1.00     3624
 pilogkw[115]    0.07    0.08  0.23  0.23   -0.29    0.45 1.00     4170
 pilogkw[116]    0.07    0.07  0.22  0.21   -0.31    0.44 1.00     3825
 pilogkw[117]   -0.03   -0.03  0.18  0.17   -0.32    0.25 1.00     4244
 pilogkw[118]   -0.02   -0.02  0.25  0.24   -0.43    0.39 1.01     3629
 pilogkw[119]    0.38    0.38  0.27  0.28   -0.04    0.83 1.01     3148
 pilogkw[120]    0.04    0.03  0.27  0.27   -0.40    0.48 1.00     3623
 pilogkw[121]    0.06    0.06  0.25  0.25   -0.35    0.46 1.01     3053
 pilogkw[122]    0.03    0.03  0.23  0.23   -0.35    0.42 1.01     3097
 pilogkw[123]    0.00    0.01  0.26  0.25   -0.44    0.41 1.01     3398
 pilogkw[124]    0.01    0.01  0.25  0.25   -0.39    0.43 1.01     3985
 pilogkw[125]    0.04    0.04  0.25  0.24   -0.36    0.47 1.01     3234
 pilogkw[126]   -0.08   -0.07  0.25  0.25   -0.48    0.32 1.01     2760
 pilogkw[127]    0.11    0.11  0.02  0.02    0.09    0.14 1.00     2052
 pilogkw[128]    0.12    0.12  0.06  0.06    0.03    0.22 1.00     3081
 pilogkw[129]    0.07    0.07  0.18  0.19   -0.24    0.36 1.00     3246
 pilogkw[130]    0.23    0.23  0.17  0.17   -0.06    0.52 1.01     4760
 pilogkw[131]   -0.10   -0.10  0.04  0.04   -0.17   -0.04 1.00     3362
 pilogkw[132]    0.10    0.10  0.12  0.12   -0.11    0.30 1.00     3864
 pilogkw[133]   -0.04   -0.04  0.20  0.20   -0.38    0.29 1.00     4120
 pilogkw[134]    0.15    0.15  0.21  0.22   -0.20    0.49 1.00     3636
 pilogkw[135]    0.11    0.11  0.27  0.28   -0.30    0.56 1.00     3538
 pilogkw[136]    0.08    0.08  0.03  0.03    0.03    0.13 1.00     3636
 pilogkw[137]    0.09    0.09  0.15  0.15   -0.16    0.33 1.00     4389
 pilogkw[138]   -0.06   -0.06  0.25  0.26   -0.48    0.34 1.01     3025
 pilogkw[139]    0.18    0.18  0.25  0.25   -0.23    0.60 1.01     4122
 pilogkw[140]   -0.18   -0.18  0.27  0.27   -0.61    0.26 1.01     3369
 pilogkw[141]    0.21    0.21  0.23  0.23   -0.16    0.58 1.00     3455
 pilogkw[142]   -0.08   -0.08  0.09  0.09   -0.23    0.07 1.00     3489
 pilogkw[143]    0.16    0.16  0.22  0.22   -0.17    0.52 1.00     3408
 piS1[1]         0.26    0.26  0.04  0.04    0.21    0.32 1.00     2491
 piS1[2]         0.29    0.29  0.02  0.02    0.26    0.33 1.00     2070
 piS1[3]        -0.03   -0.03  0.06  0.06   -0.13    0.07 1.00     3384
 piS1[4]         0.03    0.03  0.09  0.09   -0.11    0.17 1.00     4048
 piS1[5]         0.15    0.15  0.06  0.06    0.04    0.26 1.02      381
 piS1[6]         0.10    0.10  0.15  0.15   -0.13    0.34 1.00     3666
 piS1[7]         0.15    0.15  0.13  0.13   -0.06    0.36 1.00     3622
 piS1[8]         0.32    0.32  0.08  0.08    0.19    0.45 1.00     3421
 piS1[9]        -0.02   -0.02  0.19  0.20   -0.34    0.30 1.01     3482
 piS1[10]        0.01    0.01  0.12  0.12   -0.19    0.21 1.01     4532
 piS1[11]        0.23    0.23  0.09  0.09    0.08    0.38 1.00     3224
 piS1[12]       -0.02   -0.02  0.13  0.13   -0.23    0.19 1.00     3686
 piS1[13]        0.21    0.21  0.12  0.12    0.02    0.41 1.00     2995
 piS1[14]        0.52    0.53  0.17  0.17    0.25    0.80 1.00     1619
 piS1[15]        0.19    0.19  0.05  0.05    0.11    0.27 1.00     4148
 piS1[16]        0.12    0.12  0.14  0.13   -0.10    0.35 1.00     3404
 piS1[17]        0.12    0.12  0.15  0.15   -0.12    0.37 1.00     4123
 piS1[18]        0.06    0.06  0.17  0.17   -0.22    0.34 1.00     3705
 piS1[19]        0.35    0.35  0.14  0.13    0.12    0.57 1.00     2698
 piS1[20]        0.43    0.43  0.12  0.13    0.23    0.64 1.00     1685
 piS1[21]        0.26    0.26  0.09  0.10    0.11    0.42 1.00     2188
 piS1[22]        0.50    0.50  0.17  0.17    0.23    0.80 1.01     1276
 piS1[23]        0.13    0.13  0.11  0.11   -0.06    0.32 1.00     4030
 piS1[24]        0.00    0.00  0.17  0.17   -0.27    0.27 1.00     3611
 ess_tail
      939
     1684
     1658
      446
     1784
     1797
     1792
     1340
       NA
     1739
     1739
       NA
     1680
     1860
     1569
     1762
     1717
     1730
     1659
     1583
     1491
     1314
     1460
     1516
     1258
     1617
     1646
     1637
     1475
     1537
     1345
     1589
     2010
     1749
     1839
     1692
     1622
     1539
     1794
     1597
     1770
     1767
     1541
     1817
     1431
     1675
     1167
     1274
     1527
     1374
     1463
     1804
     1157
     1338
     1605
     1536
     1584
     1623
     1632
     1713
     1378
     1570
     1673
     1398
     1714
     1878
     1491
     1619
     1515
     1582
     1742
     1967
     1653
     1865
     1443
     1305
     1429
     1497
     1116
     1433
     1752
     1519
     1456
     1718
     1624
     1779
     1551
     1636
     1360
     1597
     1696
     1284
     1613
     1412
     1513
     1649
     1576
     1379
     1508
     1378
     1182
     1896
     1603
     1780
     1832
     1641
     1664
     1431
     1662
     1692
     1762
     1825
     1638
     1654
     1853
     1415
     1366
     1433
     1448
     1167
     1553
     1475
     1524
     1742
     1649
     1474
     1524
     1526
     1573
     1473
     1603
     1533
     1390
     1258
     1307
     1285
     1150
     1282
     1331
     1728
     1550
     1624
     1549
     1634
     1843
     1551
     1771
     1571
     1537
     1616
     1418
     1469
     1681
     1475
     1700
     1589
     2064
     1713
     1843
     1841
     1251
     1617
     1526
     1437
     1396
     1665
     1386
     1591
     1611
     1236
     1782
     1291
     1886
     1684
     1873
     1578
     1704
     1626
     1525
     1494

 # showing 180 of 9506 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
</section>
<section id="genereted-quantitites" class="level1">
<h1>Genereted quantitites</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mod20gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fitgq  <span class="ot">&lt;-</span> mod20gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="load" class="level2">
<h2 class="anchored" data-anchor-id="load">Load</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="trace-plots" class="level2">
<h2 class="anchored" data-anchor-id="trace-plots">Trace plots</h2>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-figures">Summary of model parameters (figures)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/mcmc-intervals-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="functional-groups-effect" class="level2">
<h2 class="anchored" data-anchor-id="functional-groups-effect">Functional groups effect</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>idx1 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>idx2 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>p_common <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)<span class="sc">+</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>p_uncommon <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param) <span class="sc">+</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a>p_uncommon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/functinoal-group-effects-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>p_common</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/functinoal-group-effects-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="fits" class="level2">
<h2 class="anchored" data-anchor-id="fits">Fits</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/ind-pop-gof-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/ind-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/pop-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi))<span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draw=</span>.draw)<span class="sc">%&gt;%</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(draw, fi)<span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mlogk =</span> <span class="fu">mean</span>(logk),</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">llogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">ulogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fi)<span class="sc">%&gt;%</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mmlogk =</span> <span class="fu">mean</span>(mlogk),</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">mllogk =</span> <span class="fu">quantile</span>(llogk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">mulogk =</span> <span class="fu">quantile</span>(ulogk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mmlogk))<span class="sc">+</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mllogk))<span class="sc">+</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mulogk))<span class="sc">+</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/pop-predictions-vpc-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-and-etaplots" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters-and-etaplots">Individual Parameters and etaplots</h2>
<p>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</p>
<section id="individual-parameters" class="level3">
<h3 class="anchored" data-anchor-id="individual-parameters">Individual parameters</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sparam_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2, param1<span class="sc">-</span>param2, datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logka'</span>[i]), <span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/iparam-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="etas" class="level3">
<h3 class="anchored" data-anchor-id="etas">Etas</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,param1<span class="sc">-</span>param2,datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etalogka'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/ieta-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="effect-of-functional-groups-screening" class="level3">
<h3 class="anchored" data-anchor-id="effect-of-functional-groups-screening">Effect of functional groups (screening)</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>valid_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">map</span>(valid_indices, <span class="cf">function</span>(i) {</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract functional group as a factor</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  nrgroups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(functional_groups[, i])</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for plotting</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">param1 =</span> param1,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">param2 =</span> param2,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">param3=</span> param1<span class="sc">-</span>param2,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrgroups =</span> nrgroups</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="sc">%&gt;%</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(param1, param2, param3), </span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"name"</span>, </span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">etaname =</span> <span class="fu">recode</span>(name, </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param1 =</span> <span class="st">"etalogkw"</span>, </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param2 =</span> <span class="st">"etaS"</span>,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param3 =</span> <span class="st">"etalogka"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> nrgroups)) <span class="sc">+</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>etaname) <span class="sc">+</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> functional_groups_names[i], </span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Nr of functional groups"</span>, </span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"eta"</span>)<span class="sc">+</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>plot_groups <span class="ot">&lt;-</span> <span class="fu">split</span>(plots, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(plots) <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each group of up to four plots</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(plot_groups, <span class="cf">function</span>(group) {</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(group, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-8.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-9.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-10.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-11.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-12.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-13.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-14.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-15.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-16.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-17.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-18.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/effect-fg-screening-19.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
</section>
<section id="simulations-cv-based" class="level1">
<h1>Simulations (CV-based)</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>similarity_matrix_corrected  </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>upper_tri_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">upper.tri</span>(distance), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>upper_tri_values <span class="ot">&lt;-</span> distance[upper_tri_indices]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>top_100_indices <span class="ot">&lt;-</span> <span class="fu">order</span>(upper_tri_values)[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">1000</span>, <span class="at">by=</span><span class="dv">10</span>)]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>closest_pairs <span class="ot">&lt;-</span> upper_tri_indices[top_100_indices, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>closest_pairs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(closest_pairs)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(closest_pairs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>closest_pairs<span class="sc">$</span>distance <span class="ot">=</span> upper_tri_values[top_100_indices]</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(closest_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  row col     distance
1 110 114 2.111996e-06
2 110 113 2.111996e-06
3 112 113 2.111996e-06
4 107 110 2.111996e-06
5 710 719 2.111997e-06
6 488 502 5.818786e-03</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">=</span> <span class="fu">unique</span>(closest_pairs<span class="sc">$</span>col)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>datastructcv <span class="ot">=</span> datastruct;</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>initcv<span class="ot">=</span>init;</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>idx_analytes_out <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(closest_pairs<span class="sc">$</span>col))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>idx_analytes_in <span class="ot">=</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(datastructcv<span class="sc">$</span>analyte),idx_analytes_out)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>idxcv <span class="ot">=</span>  <span class="fu">which</span>(datastructcv<span class="sc">$</span>analyte <span class="sc">%in%</span> idx_analytes_in)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>nObscv <span class="ot">=</span> <span class="fu">length</span>(idxcv);</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>idxcv <span class="ot">=</span> idxcv;</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>nObscv <span class="ot">=</span> nObscv;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fitting-the-model-1" class="level2">
<h2 class="anchored" data-anchor-id="fitting-the-model-1">Fitting the model</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod20cv"</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mod20cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastructcv, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After calculations, we loaded the output files using cmdstanr.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fitcv <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-model-parameters-table-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table-1">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fitcv<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     variable    mean  median    sd   mad      q5     q95 rhat ess_bulk
 lp__         8692.04 8692.62 47.93 48.26 8610.02 8771.20 1.02      465
 logkwHat        2.39    2.39  0.17  0.16    2.10    2.66 1.01     1496
 S1Hat           3.00    3.01  0.15  0.15    2.75    3.23 1.01     1586
 S2Hat           2.86    2.86  0.04  0.04    2.80    2.92 1.06      186
 beta[1]         0.57    0.58  0.04  0.04    0.51    0.63 1.01     1715
 beta[2]         0.34    0.34  0.03  0.03    0.28    0.39 1.01     1137
 omega[1]        1.36    1.36  0.04  0.04    1.30    1.42 1.01     1250
 omega[2]        1.12    1.12  0.03  0.04    1.07    1.18 1.06       91
 rho[1,1]        1.00    1.00  0.00  0.00    1.00    1.00   NA       NA
 rho[2,1]        0.88    0.88  0.01  0.01    0.86    0.90 1.01      869
 rho[1,2]        0.88    0.88  0.01  0.01    0.86    0.90 1.01      869
 rho[2,2]        1.00    1.00  0.00  0.00    1.00    1.00   NA       NA
 sigma           0.05    0.05  0.00  0.00    0.05    0.05 1.01      868
 pilogkw[1]      0.30    0.30  0.04  0.04    0.23    0.37 1.00     2348
 pilogkw[2]      0.25    0.25  0.03  0.03    0.21    0.29 1.00     1973
 pilogkw[3]     -0.12   -0.12  0.07  0.07   -0.23    0.00 1.01     2930
 pilogkw[4]     -0.01   -0.01  0.11  0.11   -0.19    0.18 1.00     3564
 pilogkw[5]      0.08    0.08  0.08  0.08   -0.06    0.21 1.04      127
 pilogkw[6]     -0.03   -0.04  0.18  0.18   -0.33    0.27 1.00     4562
 pilogkw[7]      0.05    0.05  0.17  0.16   -0.22    0.32 1.00     4185
 pilogkw[8]      0.30    0.30  0.10  0.11    0.14    0.46 1.01     4383
 pilogkw[9]      0.03    0.03  0.25  0.25   -0.38    0.46 1.00     4754
 pilogkw[10]     0.05    0.05  0.14  0.14   -0.18    0.27 1.00     4639
 pilogkw[11]     0.21    0.21  0.10  0.10    0.05    0.37 1.00     3472
 pilogkw[12]    -0.02   -0.02  0.16  0.16   -0.29    0.23 1.00     4379
 pilogkw[13]     0.08    0.08  0.15  0.15   -0.15    0.32 1.00     4402
 pilogkw[14]     0.20    0.20  0.20  0.19   -0.11    0.55 1.00     2949
 pilogkw[15]     0.20    0.20  0.05  0.06    0.11    0.29 1.00     3709
 pilogkw[16]     0.21    0.20  0.17  0.17   -0.08    0.48 1.00     4832
 pilogkw[17]     0.19    0.19  0.19  0.19   -0.13    0.49 1.01     3886
 pilogkw[18]     0.03    0.04  0.22  0.22   -0.33    0.39 1.00     4666
 pilogkw[19]    -0.61   -0.61  0.17  0.17   -0.90   -0.34 1.00     3027
 pilogkw[20]    -0.84   -0.84  0.15  0.15   -1.10   -0.59 1.00     2501
 pilogkw[21]    -0.83   -0.83  0.12  0.12   -1.03   -0.64 1.00     2517
 pilogkw[22]     0.23    0.24  0.18  0.18   -0.06    0.54 1.00     3400
 pilogkw[23]    -0.16   -0.16  0.14  0.14   -0.39    0.07 1.00     4282
 pilogkw[24]     0.01    0.01  0.23  0.22   -0.35    0.39 1.01     4433
 pilogkw[25]     0.02    0.02  0.20  0.20   -0.30    0.36 1.00     4427
 pilogkw[26]    -0.09   -0.09  0.18  0.17   -0.38    0.21 1.00     4823
 pilogkw[27]    -0.24   -0.23  0.27  0.27   -0.69    0.19 1.00     3768
 pilogkw[28]     0.02    0.02  0.24  0.25   -0.37    0.42 1.01     3736
 pilogkw[29]    -0.08   -0.08  0.18  0.17   -0.38    0.21 1.00     3770
 pilogkw[30]     0.32    0.31  0.15  0.15    0.08    0.56 1.00     4068
 pilogkw[31]     0.21    0.21  0.26  0.26   -0.22    0.64 1.01     3705
 pilogkw[32]     0.05    0.06  0.26  0.25   -0.37    0.47 1.00     3645
 pilogkw[33]     0.21    0.20  0.12  0.12    0.02    0.41 1.00     3182
 pilogkw[34]    -0.17   -0.17  0.24  0.24   -0.58    0.23 1.01     3960
 pilogkw[35]     0.05    0.04  0.24  0.24   -0.34    0.47 1.01     3333
 pilogkw[36]     0.02    0.01  0.21  0.20   -0.32    0.38 1.00     4205
 pilogkw[37]     0.09    0.09  0.19  0.18   -0.23    0.39 1.00     4404
 pilogkw[38]     0.12    0.12  0.26  0.25   -0.32    0.56 1.01     3461
 pilogkw[39]    -0.16   -0.16  0.18  0.18   -0.47    0.13 1.01     3874
 pilogkw[40]     0.17    0.17  0.19  0.18   -0.14    0.49 1.00     3629
 pilogkw[41]    -0.02   -0.02  0.18  0.18   -0.32    0.28 1.00     4344
 pilogkw[42]     0.06    0.06  0.23  0.22   -0.33    0.43 1.01     4358
 pilogkw[43]     0.05    0.05  0.22  0.22   -0.31    0.41 1.00     4119
 pilogkw[44]    -0.13   -0.13  0.26  0.26   -0.55    0.28 1.01     4608
 pilogkw[45]     0.06    0.05  0.20  0.20   -0.27    0.40 1.00     5132
 pilogkw[46]     0.00    0.00  0.25  0.24   -0.42    0.39 1.00     3887
 pilogkw[47]     0.07    0.06  0.19  0.19   -0.26    0.38 1.00     3891
 pilogkw[48]     0.05    0.06  0.19  0.18   -0.27    0.35 1.01     3776
 pilogkw[49]     0.01    0.01  0.25  0.25   -0.39    0.41 1.01     4036
 pilogkw[50]     0.25    0.24  0.19  0.19   -0.07    0.57 1.00     3754
 pilogkw[51]     0.03    0.03  0.26  0.25   -0.37    0.47 1.00     5328
 pilogkw[52]    -0.09   -0.10  0.11  0.11   -0.27    0.09 1.00     3763
 pilogkw[53]     0.13    0.13  0.11  0.11   -0.06    0.32 1.00     3017
 pilogkw[54]     0.07    0.06  0.16  0.16   -0.20    0.33 1.00     4446
 pilogkw[55]    -0.06   -0.06  0.25  0.23   -0.47    0.34 1.00     3678
 pilogkw[56]    -0.13   -0.13  0.20  0.20   -0.47    0.20 1.00     4832
 pilogkw[57]     0.01    0.01  0.12  0.12   -0.19    0.21 1.00     3465
 pilogkw[58]     0.02    0.02  0.16  0.16   -0.23    0.26 1.00     5120
 pilogkw[59]    -0.10   -0.09  0.15  0.15   -0.35    0.16 1.00     4982
 pilogkw[60]     0.06    0.06  0.20  0.20   -0.27    0.41 1.01     5065
 pilogkw[61]    -0.04   -0.04  0.22  0.22   -0.41    0.32 1.00     3238
 pilogkw[62]    -0.04   -0.04  0.25  0.25   -0.46    0.36 1.00     4059
 pilogkw[63]    -0.59   -0.59  0.19  0.19   -0.89   -0.29 1.00     2984
 pilogkw[64]    -0.08   -0.08  0.26  0.25   -0.50    0.35 1.00     4102
 pilogkw[65]     0.03    0.03  0.25  0.24   -0.38    0.45 1.00     3809
 pilogkw[66]     0.01    0.00  0.25  0.24   -0.39    0.43 1.00     3394
 pilogkw[67]    -0.11   -0.10  0.24  0.25   -0.52    0.27 1.00     3883
 pilogkw[68]     0.25    0.24  0.15  0.14    0.01    0.49 1.00     3931
 pilogkw[69]     0.29    0.28  0.25  0.24   -0.10    0.70 1.00     3401
 pilogkw[70]    -0.32   -0.32  0.14  0.15   -0.55   -0.09 1.01     4151
 pilogkw[71]     0.14    0.13  0.19  0.18   -0.17    0.45 1.00     4320
 pilogkw[72]     0.02    0.02  0.20  0.20   -0.31    0.35 1.00     4899
 pilogkw[73]     0.31    0.31  0.21  0.21   -0.02    0.67 1.00     3816
 pilogkw[74]    -0.01   -0.01  0.26  0.26   -0.42    0.43 1.00     4021
 pilogkw[75]     0.15    0.15  0.24  0.24   -0.23    0.57 1.00     3960
 pilogkw[76]     0.00    0.00  0.26  0.26   -0.44    0.42 1.00     3757
 pilogkw[77]     0.01    0.00  0.26  0.26   -0.41    0.44 1.00     4285
 pilogkw[78]     0.08    0.08  0.18  0.19   -0.22    0.39 1.00     4257
 pilogkw[79]    -0.02   -0.02  0.25  0.25   -0.43    0.39 1.01     4375
 pilogkw[80]     0.00    0.00  0.15  0.15   -0.24    0.25 1.01     4811
 pilogkw[81]    -0.05   -0.04  0.23  0.23   -0.43    0.34 1.00     3659
 pilogkw[82]     0.02    0.02  0.24  0.24   -0.36    0.40 1.00     4296
 pilogkw[83]    -0.36   -0.36  0.20  0.20   -0.70   -0.04 1.00     3371
 pilogkw[84]    -0.46   -0.46  0.18  0.19   -0.76   -0.18 1.00     3338
 pilogkw[85]     0.04    0.04  0.15  0.15   -0.22    0.29 1.01     4139
 pilogkw[86]     0.06    0.06  0.25  0.24   -0.37    0.48 1.00     4680
 pilogkw[87]     0.03    0.02  0.24  0.24   -0.37    0.44 1.01     3047
 pilogkw[88]     0.12    0.11  0.26  0.26   -0.28    0.55 1.01     3498
 pilogkw[89]    -0.21   -0.21  0.08  0.08   -0.33   -0.08 1.00     3336
 pilogkw[90]    -0.09   -0.09  0.17  0.17   -0.35    0.20 1.00     4157
 pilogkw[91]     0.29    0.29  0.07  0.07    0.17    0.42 1.01     3236
 pilogkw[92]     0.22    0.22  0.12  0.12    0.02    0.41 1.01     4075
 pilogkw[93]    -0.01   -0.01  0.19  0.19   -0.33    0.29 1.00     4637
 pilogkw[94]     0.01    0.01  0.19  0.20   -0.31    0.33 1.00     4028
 pilogkw[95]     0.09    0.08  0.26  0.25   -0.32    0.51 1.00     3575
 pilogkw[96]    -0.34   -0.33  0.25  0.24   -0.75    0.05 1.01     3502
 pilogkw[97]    -0.08   -0.09  0.14  0.14   -0.32    0.15 1.00     4063
 pilogkw[98]    -0.38   -0.37  0.15  0.14   -0.64   -0.13 1.00     3617
 pilogkw[99]     0.14    0.13  0.15  0.15   -0.11    0.39 1.00     3417
 pilogkw[100]   -0.20   -0.20  0.14  0.14   -0.42    0.03 1.00     3011
 pilogkw[101]    0.20    0.20  0.17  0.17   -0.08    0.48 1.00     3472
 pilogkw[102]    0.06    0.06  0.19  0.18   -0.24    0.37 1.00     4597
 pilogkw[103]   -0.17   -0.17  0.13  0.12   -0.38    0.03 1.00     3053
 pilogkw[104]    0.02    0.02  0.26  0.26   -0.41    0.46 1.00     3846
 pilogkw[105]    0.25    0.25  0.16  0.15   -0.01    0.51 1.00     3718
 pilogkw[106]    0.02    0.01  0.26  0.27   -0.39    0.45 1.01     4159
 pilogkw[107]    0.14    0.13  0.26  0.26   -0.28    0.57 1.00     4559
 pilogkw[108]    0.02    0.02  0.26  0.27   -0.41    0.44 1.00     5529
 pilogkw[109]   -0.06   -0.06  0.26  0.26   -0.49    0.37 1.01     4663
 pilogkw[110]   -0.18   -0.18  0.25  0.25   -0.58    0.22 1.01     3971
 pilogkw[111]    0.05    0.05  0.26  0.26   -0.36    0.46 1.00     3061
 pilogkw[112]    0.00    0.00  0.23  0.23   -0.38    0.38 1.01     5619
 pilogkw[113]   -0.19   -0.19  0.25  0.25   -0.60    0.23 1.00     3527
 pilogkw[114]   -0.07   -0.07  0.24  0.24   -0.45    0.32 1.00     3920
 pilogkw[115]    0.07    0.07  0.24  0.23   -0.30    0.47 1.01     4300
 pilogkw[116]    0.08    0.07  0.24  0.25   -0.31    0.48 1.00     3831
 pilogkw[117]   -0.05   -0.06  0.17  0.18   -0.33    0.23 1.00     3684
 pilogkw[118]   -0.03   -0.03  0.24  0.25   -0.43    0.38 1.00     3787
 pilogkw[119]    0.38    0.37  0.27  0.28   -0.07    0.84 1.01     3529
 pilogkw[120]    0.04    0.04  0.26  0.26   -0.38    0.46 1.01     5283
 pilogkw[121]    0.05    0.05  0.26  0.26   -0.37    0.48 1.00     4232
 pilogkw[122]    0.03    0.03  0.23  0.23   -0.36    0.40 1.01     3527
 pilogkw[123]   -0.01   -0.01  0.25  0.23   -0.42    0.38 1.00     4140
 pilogkw[124]    0.00    0.00  0.26  0.26   -0.43    0.45 1.00     3732
 pilogkw[125]    0.03    0.03  0.23  0.23   -0.35    0.41 1.01     4257
 pilogkw[126]   -0.07   -0.07  0.26  0.26   -0.47    0.35 1.00     4299
 pilogkw[127]    0.11    0.11  0.01  0.01    0.09    0.14 1.01     1895
 pilogkw[128]    0.11    0.11  0.06  0.06    0.02    0.21 1.00     3158
 pilogkw[129]   -0.12   -0.12  0.22  0.21   -0.48    0.24 1.00     4085
 pilogkw[130]    0.29    0.30  0.17  0.17    0.02    0.56 1.01     4101
 pilogkw[131]   -0.10   -0.10  0.04  0.04   -0.18   -0.04 1.00     3273
 pilogkw[132]    0.14    0.14  0.12  0.12   -0.05    0.35 1.00     4471
 pilogkw[133]   -0.07   -0.06  0.19  0.19   -0.38    0.25 1.01     5062
 pilogkw[134]    0.16    0.16  0.22  0.22   -0.20    0.52 1.00     3389
 pilogkw[135]    0.11    0.11  0.27  0.27   -0.33    0.57 1.01     3724
 pilogkw[136]    0.07    0.07  0.03  0.03    0.02    0.12 1.00     2446
 pilogkw[137]    0.08    0.08  0.15  0.15   -0.17    0.32 1.00     4725
 pilogkw[138]   -0.07   -0.06  0.26  0.25   -0.49    0.34 1.00     3502
 pilogkw[139]    0.19    0.20  0.24  0.24   -0.20    0.58 1.00     3867
 pilogkw[140]   -0.20   -0.20  0.26  0.26   -0.65    0.23 1.00     3833
 pilogkw[141]    0.20    0.20  0.23  0.24   -0.17    0.59 1.01     5018
 pilogkw[142]   -0.03   -0.03  0.09  0.10   -0.19    0.12 1.00     3640
 pilogkw[143]    0.17    0.17  0.22  0.23   -0.19    0.53 1.00     4155
 piS1[1]         0.28    0.28  0.04  0.04    0.22    0.34 1.00     2164
 piS1[2]         0.27    0.27  0.02  0.02    0.23    0.30 1.00     1854
 piS1[3]        -0.02   -0.02  0.06  0.06   -0.12    0.08 1.01     3099
 piS1[4]         0.02    0.02  0.09  0.09   -0.14    0.17 1.00     3587
 piS1[5]         0.19    0.19  0.07  0.07    0.07    0.31 1.09       57
 piS1[6]         0.10    0.10  0.15  0.14   -0.16    0.35 1.00     3412
 piS1[7]         0.16    0.16  0.14  0.13   -0.07    0.38 1.01     3999
 piS1[8]         0.31    0.31  0.08  0.08    0.17    0.44 1.00     3730
 piS1[9]        -0.02   -0.02  0.21  0.20   -0.36    0.33 1.01     3722
 piS1[10]        0.02    0.02  0.12  0.12   -0.17    0.21 1.00     3241
 piS1[11]        0.25    0.24  0.09  0.09    0.09    0.39 1.00     3569
 piS1[12]       -0.01   -0.01  0.14  0.14   -0.24    0.20 1.01     3791
 piS1[13]        0.16    0.16  0.12  0.12   -0.04    0.37 1.00     3597
 piS1[14]        0.56    0.56  0.18  0.17    0.28    0.86 1.01     1635
 piS1[15]        0.19    0.19  0.05  0.05    0.12    0.27 1.00     3251
 piS1[16]        0.14    0.14  0.14  0.14   -0.08    0.37 1.00     3949
 piS1[17]        0.13    0.13  0.15  0.16   -0.12    0.38 1.00     4039
 piS1[18]        0.04    0.04  0.18  0.18   -0.26    0.32 1.00     4290
 piS1[19]        0.37    0.36  0.14  0.15    0.14    0.60 1.01     2045
 piS1[20]        0.42    0.42  0.13  0.13    0.20    0.65 1.00     2242
 piS1[21]        0.31    0.31  0.10  0.10    0.14    0.47 1.00     2380
 piS1[22]        0.50    0.50  0.18  0.17    0.22    0.79 1.01     1859
 piS1[23]        0.13    0.13  0.11  0.11   -0.06    0.31 1.00     3697
 piS1[24]        0.01    0.00  0.18  0.18   -0.29    0.30 1.00     3516
 ess_tail
      885
     1440
     1399
      391
     1626
     1590
     1440
      595
       NA
     1408
     1408
       NA
     1208
     1737
     1718
     1777
     1685
      433
     1695
     1501
     1475
     1409
     1531
     1698
     1808
     1623
     1729
     1283
     1450
     1724
     1647
     1985
     1818
     1580
     1808
     1806
     1770
     1416
     1482
     1789
     1354
     1803
     1587
     1357
     1428
     1734
     1636
     1360
     1534
     1782
     1394
     1384
     1717
     1680
     1572
     1549
     1409
     1883
     1311
     1825
     1419
     1573
     1745
     1315
     1491
     1678
     1619
     1389
     1652
     1351
     1616
     2016
     1780
     1604
     1510
     1619
     1334
     1560
     1395
     1510
     1709
     1538
     1840
     1639
     1808
     1738
     1057
     1437
     1705
     1587
     1695
     1308
     1540
     1776
     1562
     1742
     1726
     1744
     1442
     1654
     1464
     1693
     1325
     1563
     1609
     1426
     1761
     1457
     1775
     1536
     1896
     1966
     1644
     1669
     1709
     1530
     1539
     1741
     1548
     1594
     1471
     1466
     1353
     1289
     1550
     1566
     1558
     1124
     1604
     1647
     1376
     1535
     1522
     1490
     1336
     1338
     1497
     1616
     1448
     1615
     2071
     1448
     1516
     1718
     1679
     1813
     1703
     1356
     1745
     1901
     1401
     1310
     1456
     1607
     1565
     1667
     1568
     1676
     1827
     1835
     1287
     1481
     1482
     1619
     1360
     1692
     1535
     1875
     1632
     1547
     1678
     1601
     1873
     1645
     1556
     1301
     1650
     1615
     1884
     1666

 # showing 180 of 9506 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="genereted-quantitites-1" class="level2">
<h2 class="anchored" data-anchor-id="genereted-quantitites-1">Genereted quantitites</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>mod20cvgq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>fitcvgq  <span class="ot">&lt;-</span> mod20cvgq<span class="sc">$</span><span class="fu">generate_quantities</span>(fitcv,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastructcv,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results-1" class="level2">
<h2 class="anchored" data-anchor-id="results-1">Results</h2>
<section id="load-1" class="level3">
<h3 class="anchored" data-anchor-id="load-1">Load</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fits-1" class="level3">
<h3 class="anchored" data-anchor-id="fits-1">Fits</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>fun_plot_ind_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">.analytes_idx=</span>analytes_idx){</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> .analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkind =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkpop =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkind), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkpop), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> .analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual and population)"</span>) <span class="sc">+</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/ind-pop-predictions-cv-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-020_files/figure-html/ind-pop-predictions-cv-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
</section>
<section id="session-info" class="level1">
<h1>Session info</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19045)

Matrix products: default


locale:
[1] LC_COLLATE=Polish_Poland.utf8  LC_CTYPE=Polish_Poland.utf8   
[3] LC_MONETARY=Polish_Poland.utf8 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.utf8    

time zone: Europe/Warsaw
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] GGally_2.2.1        mrgmisc_0.2.2       pracma_2.4.4       
 [4] reshape2_1.4.4      tidybayes_3.0.7     bayesplot_1.11.1   
 [7] posterior_1.6.0     cmdstanr_0.8.0.9000 here_1.0.1         
[10] whisker_0.4.1       glue_1.7.0          lubridate_1.9.3    
[13] forcats_1.0.0       stringr_1.5.1       purrr_1.0.2        
[16] readr_2.1.5         tidyr_1.3.1         tibble_3.2.1       
[19] tidyverse_2.0.0     data.table_1.15.4   knitr_1.46         
[22] naniar_1.1.0        gridExtra_2.3       patchwork_1.2.0    
[25] ggplot2_3.5.1       dplyr_1.1.4         bbr.bayes_0.2.0    
[28] bbr_1.10.0         

loaded via a namespace (and not attached):
 [1] gtable_0.3.5         tensorA_0.36.2.1     xfun_0.44           
 [4] htmlwidgets_1.6.4    visdat_0.6.0         processx_3.8.4      
 [7] lattice_0.21-8       tzdb_0.4.0           vctrs_0.6.5         
[10] tools_4.3.1          ps_1.7.6             generics_0.1.3      
[13] fansi_1.0.6          pkgconfig_2.0.3      Matrix_1.6-5        
[16] checkmate_2.3.1      RColorBrewer_1.1-3   distributional_0.4.0
[19] lifecycle_1.0.4      farver_2.1.2         compiler_4.3.1      
[22] textshaping_0.4.0    munsell_0.5.1        htmltools_0.5.8.1   
[25] yaml_2.3.8           pillar_1.9.0         crayon_1.5.2        
[28] arrayhelpers_1.1-0   abind_1.4-8          ggstats_0.8.0       
[31] svUnit_1.0.6         tidyselect_1.2.1     digest_0.6.35       
[34] stringi_1.8.4        diffobj_0.3.5        labeling_0.4.3      
[37] rprojroot_2.0.4      fastmap_1.2.0        grid_4.3.1          
[40] colorspace_2.1-0     cli_3.6.2            magrittr_2.0.3      
[43] utf8_1.2.4           withr_3.0.2          scales_1.3.0        
[46] backports_1.5.0      timechange_0.3.0     rmarkdown_2.27      
[49] matrixStats_1.3.0    ragg_1.3.2           hms_1.1.3           
[52] coda_0.19-4.1        evaluate_1.0.3       ggdist_3.3.2        
[55] viridisLite_0.4.2    rlang_1.1.3          Rcpp_1.0.12         
[58] rstudioapi_0.16.0    jsonlite_1.8.8       plyr_1.8.9          
[61] R6_2.5.1             systemfonts_1.1.0    fs_1.6.4            </code></pre>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb86" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "QSRR revisited. Model 004. GP attempt"</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introductions</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>GP model. Test</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr.bayes)</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(whisker)</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mrgmisc)</span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("metrumresearchgroup/mrgmisc")</span></span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/GUMed/.cmdstan/cmdstan-2.36.0"</span>)</span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10271998</span>) <span class="do">## not required but assures repeatable results</span></span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>select<span class="ot">&lt;-</span>dplyr<span class="sc">::</span>select</span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"helper-functions.R"</span>)</span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r settings}</span></span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>model_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>,<span class="st">"stan"</span>)  </span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>tables_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_dir)) <span class="fu">dir.create</span>(tables_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a>data_deliv_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"deliv"</span>)</span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a>data_derived_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"derived"</span>)</span>
<span id="cb86-70"><a href="#cb86-70" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_deliv_dir)) <span class="fu">dir.create</span>(data_deliv_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-71"><a href="#cb86-71" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_derived_dir)) <span class="fu">dir.create</span>(data_derived_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-72"><a href="#cb86-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-73"><a href="#cb86-73" aria-hidden="true" tabindex="-1"></a>figures_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb86-74"><a href="#cb86-74" aria-hidden="true" tabindex="-1"></a>tables_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb86-75"><a href="#cb86-75" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_eda_dir)) <span class="fu">dir.create</span>(figures_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-76"><a href="#cb86-76" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_eda_dir)) <span class="fu">dir.create</span>(tables_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb86-77"><a href="#cb86-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-78"><a href="#cb86-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-79"><a href="#cb86-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-80"><a href="#cb86-80" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35\^{\circ}C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient.</span>
<span id="cb86-81"><a href="#cb86-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-82"><a href="#cb86-82" aria-hidden="true" tabindex="-1"></a>The values of molecular mass MM were added to the dataset. They were calculated using <span class="co">[</span><span class="ot">ACD/Labs program</span><span class="co">](www.acdlabs.com)</span> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8. The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</span>
<span id="cb86-83"><a href="#cb86-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-84"><a href="#cb86-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-85"><a href="#cb86-85" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load data</span></span>
<span id="cb86-86"><a href="#cb86-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb86-87"><a href="#cb86-87" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir, <span class="st">"database_logk_1026.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-88"><a href="#cb86-88" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"database_logk_1026_analyte_names.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-89"><a href="#cb86-89" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"smiles1026.smi"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-90"><a href="#cb86-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-91"><a href="#cb86-91" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">'ACD_pKas.csv'</span>))</span>
<span id="cb86-92"><a href="#cb86-92" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"pH.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-93"><a href="#cb86-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-94"><a href="#cb86-94" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(logP_ACD)</span>
<span id="cb86-95"><a href="#cb86-95" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>MW <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(MW_ACD)</span>
<span id="cb86-96"><a href="#cb86-96" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(data_ACD<span class="sc">$</span>logP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-97"><a href="#cb86-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-98"><a href="#cb86-98" aria-hidden="true" tabindex="-1"></a>fg_df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-99"><a href="#cb86-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-100"><a href="#cb86-100" aria-hidden="true" tabindex="-1"></a>descriptor_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"descriptor_df.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-101"><a href="#cb86-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-102"><a href="#cb86-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-103"><a href="#cb86-103" aria-hidden="true" tabindex="-1"></a>distance_ltri_rcdk_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"distance_ltri_rcdk.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-104"><a href="#cb86-104" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="fu">make_distance_matrix_fun</span>(distance_ltri_rcdk_df)</span>
<span id="cb86-105"><a href="#cb86-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-106"><a href="#cb86-106" aria-hidden="true" tabindex="-1"></a>similarity_ltri_rcdk_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"similarity_ltri_rcdk.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-107"><a href="#cb86-107" aria-hidden="true" tabindex="-1"></a>similarity_matrix <span class="ot">&lt;-</span> <span class="fu">make_similarity_matrix_fun</span>(similarity_ltri_rcdk_df)</span>
<span id="cb86-108"><a href="#cb86-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-109"><a href="#cb86-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-110"><a href="#cb86-110" aria-hidden="true" tabindex="-1"></a>smiles<span class="ot">&lt;-</span>smiles <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ID=</span>V2,<span class="at">smiles=</span>V1) <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID,smiles)</span>
<span id="cb86-111"><a href="#cb86-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-112"><a href="#cb86-112" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">905</span>] <span class="ot">=</span> <span class="st">"CN(C1CCCCC1N1CCCC1)C(=O)Cc1ccc(c(c1)Cl)Cl"</span> <span class="co"># remove tartrate moiety </span></span>
<span id="cb86-113"><a href="#cb86-113" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">425</span>] <span class="ot">=</span> <span class="st">"CC(Cc1ccc(cc1)OCC(=O)O)NCC(c1cccc(c1)Cl)O"</span> <span class="co"># remove Na+ and dissociation</span></span>
<span id="cb86-114"><a href="#cb86-114" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">501</span>] <span class="ot">=</span> <span class="st">"c1ccc(cc1)C1(c2ccccc2)C(=O)NC(=N1)O"</span></span>
<span id="cb86-115"><a href="#cb86-115" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">401</span>]<span class="ot">=</span> <span class="st">"CC(C)(C)c1c(CC(C(=O)[OH])[NH2])c(=O)[nH]o1"</span></span>
<span id="cb86-116"><a href="#cb86-116" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">686</span>] <span class="ot">=</span> <span class="st">"CCCCCCCCCCCCCCCC(=O)OC(CC(=O)[OH])C[N+](C)(C)C"</span></span>
<span id="cb86-117"><a href="#cb86-117" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">901</span>] <span class="ot">=</span> <span class="st">"CCOC(=Nc1c[n+](no1)N1CCOCC1)[OH]"</span></span>
<span id="cb86-118"><a href="#cb86-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-119"><a href="#cb86-119" aria-hidden="true" tabindex="-1"></a>analytes_names<span class="sc">$</span>Analyte <span class="ot">&lt;-</span> <span class="fu">iconv</span>(analytes_names<span class="sc">$</span>Analyte, <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">"byte"</span>)</span>
<span id="cb86-120"><a href="#cb86-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-121"><a href="#cb86-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-122"><a href="#cb86-122" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prepare data</span></span>
<span id="cb86-123"><a href="#cb86-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prepare-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb86-124"><a href="#cb86-124" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb86-125"><a href="#cb86-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-126"><a href="#cb86-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb86-127"><a href="#cb86-127" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb86-128"><a href="#cb86-128" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb86-129"><a href="#cb86-129" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb86-130"><a href="#cb86-130" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb86-131"><a href="#cb86-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-132"><a href="#cb86-132" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> fg_df <span class="sc">%&gt;%</span></span>
<span id="cb86-133"><a href="#cb86-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.) <span class="sc">||</span> <span class="sc">!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb86-134"><a href="#cb86-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(id1,id2,SMILES, Anion, Kation,Ammonium))</span>
<span id="cb86-135"><a href="#cb86-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-136"><a href="#cb86-136" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> <span class="fu">colnames</span>(functional_groups)</span>
<span id="cb86-137"><a href="#cb86-137" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb86-138"><a href="#cb86-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-139"><a href="#cb86-139" aria-hidden="true" tabindex="-1"></a>dissociation <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb86-140"><a href="#cb86-140" aria-hidden="true" tabindex="-1"></a><span class="at">pKaslit =</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>],           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb86-141"><a href="#cb86-141" aria-hidden="true" tabindex="-1"></a><span class="at">pKasliterror =</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>],    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb86-142"><a href="#cb86-142" aria-hidden="true" tabindex="-1"></a><span class="at">chargesA =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>]),    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb86-143"><a href="#cb86-143" aria-hidden="true" tabindex="-1"></a><span class="at">chargesB =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]))   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb86-144"><a href="#cb86-144" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>charges <span class="ot">=</span> dissociation<span class="sc">$</span>chargesA<span class="sc">+</span>dissociation<span class="sc">$</span>chargesB                  <span class="co"># absolute charge</span></span>
<span id="cb86-145"><a href="#cb86-145" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsA <span class="ot">=</span> (dissociation<span class="sc">$</span>chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb86-146"><a href="#cb86-146" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsB <span class="ot">=</span> <span class="sc">-</span>(dissociation<span class="sc">$</span>chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb86-147"><a href="#cb86-147" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># number of dissociation steps</span></span>
<span id="cb86-148"><a href="#cb86-148" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groups <span class="ot">=</span> dissociation<span class="sc">$</span>groupsB<span class="sc">-</span>dissociation<span class="sc">$</span>groupsA</span>
<span id="cb86-149"><a href="#cb86-149" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>logPobs <span class="ot">=</span>data_ACD<span class="sc">$</span>logP</span>
<span id="cb86-150"><a href="#cb86-150" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>MW <span class="ot">=</span>data_ACD<span class="sc">$</span>MW</span>
<span id="cb86-151"><a href="#cb86-151" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb86-152"><a href="#cb86-152" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb86-153"><a href="#cb86-153" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsA)</span>
<span id="cb86-154"><a href="#cb86-154" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitA<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsA]</span>
<span id="cb86-155"><a href="#cb86-155" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb86-156"><a href="#cb86-156" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb86-157"><a href="#cb86-157" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsB)</span>
<span id="cb86-158"><a href="#cb86-158" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitB<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsB]</span>
<span id="cb86-159"><a href="#cb86-159" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb86-160"><a href="#cb86-160" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span>]</span>
<span id="cb86-161"><a href="#cb86-161" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesB[,<span class="fu">max</span>(dissociation<span class="sc">$</span>R)]</span>
<span id="cb86-162"><a href="#cb86-162" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb86-163"><a href="#cb86-163" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb86-164"><a href="#cb86-164" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxA0)</span>
<span id="cb86-165"><a href="#cb86-165" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxB0)</span>
<span id="cb86-166"><a href="#cb86-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-167"><a href="#cb86-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-168"><a href="#cb86-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-169"><a href="#cb86-169" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial estimates</span></span>
<span id="cb86-170"><a href="#cb86-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb86-171"><a href="#cb86-171" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb86-172"><a href="#cb86-172" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb86-173"><a href="#cb86-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-174"><a href="#cb86-174" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb86-175"><a href="#cb86-175" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb86-176"><a href="#cb86-176" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb86-177"><a href="#cb86-177" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb86-178"><a href="#cb86-178" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb86-179"><a href="#cb86-179" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb86-180"><a href="#cb86-180" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-181"><a href="#cb86-181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-182"><a href="#cb86-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-183"><a href="#cb86-183" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb86-184"><a href="#cb86-184" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb86-185"><a href="#cb86-185" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb86-186"><a href="#cb86-186" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb86-187"><a href="#cb86-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-188"><a href="#cb86-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-189"><a href="#cb86-189" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data analysis</span></span>
<span id="cb86-190"><a href="#cb86-190" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb86-191"><a href="#cb86-191" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a ...</span>
<span id="cb86-192"><a href="#cb86-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-193"><a href="#cb86-193" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb86-194"><a href="#cb86-194" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb86-195"><a href="#cb86-195" aria-hidden="true" tabindex="-1"></a>&amp; logk_{i,j}  = logkw_{i} - S_{1,i} \cdot (1 + S_{2}) \cdot \varphi_{i,j} / (1 + S_{2} \cdot \varphi_{i,j})</span>
<span id="cb86-196"><a href="#cb86-196" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb86-197"><a href="#cb86-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb86-198"><a href="#cb86-198" aria-hidden="true" tabindex="-1"></a>The statistical model has the following structure (hierarchical model):</span>
<span id="cb86-199"><a href="#cb86-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-200"><a href="#cb86-200" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb86-201"><a href="#cb86-201" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb86-202"><a href="#cb86-202" aria-hidden="true" tabindex="-1"></a>&amp; \log k_{obs_{i,j}} \sim student_t(\nu,logk_{i,j},\sigma) <span class="sc">\\</span></span>
<span id="cb86-203"><a href="#cb86-203" aria-hidden="true" tabindex="-1"></a>&amp; R_{i} \sim \text{MVN}(\theta_R  + \beta \cdot log P_i +\pi_R \cdot X_i , \Omega) <span class="sc">\\</span></span>
<span id="cb86-204"><a href="#cb86-204" aria-hidden="true" tabindex="-1"></a>&amp; \pi_{R,k} \sim N(0,\kappa_R)</span>
<span id="cb86-205"><a href="#cb86-205" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb86-206"><a href="#cb86-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb86-207"><a href="#cb86-207" aria-hidden="true" tabindex="-1"></a>Needs improvements!! where $R_i=(logkw_{i}, S_{1,i})$ is a vector of subject-specific parameters, $logk_{i,j}$ corresponds to the above Neue equation, $MVN$ is a multivariate normal distribution, $\theta_R$ is a vector of typical values of $R_i$, $\beta_R$ is a vector of slopes between $R_i$ and $logP_i$, and $\pi_R$ is a vector of slopes between $R_i$ and functional group vector $Xi$. In turn, $\sigma$ is the scale and $\Omega$ is the scale matrix for the random effects related to the residual and unexplained between-analyte variability. $\Omega$ was decomposed to:</span>
<span id="cb86-208"><a href="#cb86-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-209"><a href="#cb86-209" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb86-210"><a href="#cb86-210" aria-hidden="true" tabindex="-1"></a>\Omega = diag(\omega) \cdot \rho \cdot diag(\omega) </span>
<span id="cb86-211"><a href="#cb86-211" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb86-212"><a href="#cb86-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-213"><a href="#cb86-213" aria-hidden="true" tabindex="-1"></a>where $\rho$ denotes correlation a correlation matrix and $\omega$ denotes standard deviation for between analyte variability.</span>
<span id="cb86-214"><a href="#cb86-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-215"><a href="#cb86-215" aria-hidden="true" tabindex="-1"></a><span class="fu">## Priors</span></span>
<span id="cb86-216"><a href="#cb86-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-217"><a href="#cb86-217" aria-hidden="true" tabindex="-1"></a>The priors were specified as follows:</span>
<span id="cb86-218"><a href="#cb86-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-219"><a href="#cb86-219" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb86-220"><a href="#cb86-220" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb86-221"><a href="#cb86-221" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{logkw} \sim normal(2, 4), <span class="sc">\\</span></span>
<span id="cb86-222"><a href="#cb86-222" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{S1} \sim normal(4, 2), <span class="sc">\\</span></span>
<span id="cb86-223"><a href="#cb86-223" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{S2} \sim lognormal(0.693, 0.125), <span class="sc">\\</span></span>
<span id="cb86-224"><a href="#cb86-224" aria-hidden="true" tabindex="-1"></a>&amp; \nu = 7,<span class="sc">\\</span></span>
<span id="cb86-225"><a href="#cb86-225" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{logkw},\omega_{S1} \sim normal_+(0, 1), <span class="sc">\\</span></span>
<span id="cb86-226"><a href="#cb86-226" aria-hidden="true" tabindex="-1"></a>&amp; \beta_{logkw} \sim  normal(0.7, 0.125), <span class="sc">\\</span></span>
<span id="cb86-227"><a href="#cb86-227" aria-hidden="true" tabindex="-1"></a>&amp; \beta_{S1} \sim  normal(0.5, 0.125), <span class="sc">\\</span></span>
<span id="cb86-228"><a href="#cb86-228" aria-hidden="true" tabindex="-1"></a>&amp; \kappa_{logkw},\kappa_{S1} \sim  normal(0, 0.1), <span class="sc">\\</span></span>
<span id="cb86-229"><a href="#cb86-229" aria-hidden="true" tabindex="-1"></a>&amp; \sigma \sim normal_+(0,0.05), <span class="sc">\\</span></span>
<span id="cb86-230"><a href="#cb86-230" aria-hidden="true" tabindex="-1"></a>&amp; p(\rho) \propto LKJ(2) \cdot \Pi_u N(c_u, 0.125), <span class="sc">\\</span></span>
<span id="cb86-231"><a href="#cb86-231" aria-hidden="true" tabindex="-1"></a>&amp; c_u = <span class="co">[</span><span class="ot">0.75</span><span class="co">]</span></span>
<span id="cb86-232"><a href="#cb86-232" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb86-233"><a href="#cb86-233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb86-234"><a href="#cb86-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-235"><a href="#cb86-235" aria-hidden="true" tabindex="-1"></a>LKJ(2) ensure that the density is uniform over correlation matrices of order 2 and u denotes the unique lower triangular elements of correlation matrix (<span class="ot">&lt;http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/&gt;</span>)</span>
<span id="cb86-236"><a href="#cb86-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-237"><a href="#cb86-237" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb86-238"><a href="#cb86-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-239"><a href="#cb86-239" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb86-240"><a href="#cb86-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-241"><a href="#cb86-241" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb86-242"><a href="#cb86-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-243"><a href="#cb86-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-setup}</span></span>
<span id="cb86-244"><a href="#cb86-244" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set: data</span></span>
<span id="cb86-245"><a href="#cb86-245" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb86-246"><a href="#cb86-246" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb86-247"><a href="#cb86-247" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb86-248"><a href="#cb86-248" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb86-249"><a href="#cb86-249" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">=</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb86-250"><a href="#cb86-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-251"><a href="#cb86-251" aria-hidden="true" tabindex="-1"></a>similarity_matrix_corrected <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">nearPD</span>(similarity_matrix, <span class="at">corr =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>mat)</span>
<span id="cb86-252"><a href="#cb86-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-253"><a href="#cb86-253" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb86-254"><a href="#cb86-254" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb86-255"><a href="#cb86-255" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb86-256"><a href="#cb86-256" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb86-257"><a href="#cb86-257" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb86-258"><a href="#cb86-258" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>data_ACD<span class="sc">$</span>logP,</span>
<span id="cb86-259"><a href="#cb86-259" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb86-260"><a href="#cb86-260" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups,</span>
<span id="cb86-261"><a href="#cb86-261" aria-hidden="true" tabindex="-1"></a>                       <span class="at">distance_x =</span> <span class="dv">1</span><span class="sc">-</span>similarity_matrix_corrected,</span>
<span id="cb86-262"><a href="#cb86-262" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb86-263"><a href="#cb86-263" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb86-264"><a href="#cb86-264" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb86-265"><a href="#cb86-265" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb86-266"><a href="#cb86-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-267"><a href="#cb86-267" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb86-268"><a href="#cb86-268" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb86-269"><a href="#cb86-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb86-270"><a href="#cb86-270" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb86-271"><a href="#cb86-271" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb86-272"><a href="#cb86-272" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb86-273"><a href="#cb86-273" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb86-274"><a href="#cb86-274" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb86-275"><a href="#cb86-275" aria-hidden="true" tabindex="-1"></a>          <span class="co"># eta = cbind((init_aprox$logkw-mean(init_aprox$logkw))/sd(init_aprox$logkw),</span></span>
<span id="cb86-276"><a href="#cb86-276" aria-hidden="true" tabindex="-1"></a>          <span class="co">#             (init_aprox$S1-mean(init_aprox$S1))/sd(init_aprox$S1)),</span></span>
<span id="cb86-277"><a href="#cb86-277" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb86-278"><a href="#cb86-278" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb86-279"><a href="#cb86-279" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb86-280"><a href="#cb86-280" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb86-281"><a href="#cb86-281" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb86-282"><a href="#cb86-282" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-283"><a href="#cb86-283" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-284"><a href="#cb86-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-285"><a href="#cb86-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-286"><a href="#cb86-286" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb86-287"><a href="#cb86-287" aria-hidden="true" tabindex="-1"></a>We compiled the model using cmdstanr:</span>
<span id="cb86-288"><a href="#cb86-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mod-settings}</span></span>
<span id="cb86-289"><a href="#cb86-289" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod20"</span></span>
<span id="cb86-290"><a href="#cb86-290" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb86-291"><a href="#cb86-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-292"><a href="#cb86-292" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb86-293"><a href="#cb86-293" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb86-294"><a href="#cb86-294" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb86-295"><a href="#cb86-295" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb86-296"><a href="#cb86-296" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb86-297"><a href="#cb86-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-298"><a href="#cb86-298" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb86-299"><a href="#cb86-299" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb86-300"><a href="#cb86-300" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb86-301"><a href="#cb86-301" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb86-302"><a href="#cb86-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-303"><a href="#cb86-303" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb86-304"><a href="#cb86-304" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb86-305"><a href="#cb86-305" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb86-306"><a href="#cb86-306" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb86-307"><a href="#cb86-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-308"><a href="#cb86-308" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb86-309"><a href="#cb86-309" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span>
<span id="cb86-310"><a href="#cb86-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-311"><a href="#cb86-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-312"><a href="#cb86-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-compile, eval = FALSE}</span></span>
<span id="cb86-313"><a href="#cb86-313" aria-hidden="true" tabindex="-1"></a>mod20 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb86-314"><a href="#cb86-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-315"><a href="#cb86-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-316"><a href="#cb86-316" aria-hidden="true" tabindex="-1"></a>We used optimization for initial testing:</span>
<span id="cb86-317"><a href="#cb86-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-318"><a href="#cb86-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-optimize, eval = FALSE}</span></span>
<span id="cb86-319"><a href="#cb86-319" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod20<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb86-320"><a href="#cb86-320" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb86-321"><a href="#cb86-321" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb86-322"><a href="#cb86-322" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="st">"mod20-opt"</span>,</span>
<span id="cb86-323"><a href="#cb86-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb86-324"><a href="#cb86-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">3000</span></span>
<span id="cb86-325"><a href="#cb86-325" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-326"><a href="#cb86-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-327"><a href="#cb86-327" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>,<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>), <span class="at">max_rows=</span><span class="dv">12</span>)</span>
<span id="cb86-328"><a href="#cb86-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-329"><a href="#cb86-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-330"><a href="#cb86-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-331"><a href="#cb86-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-332"><a href="#cb86-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plots-optimize}</span></span>
<span id="cb86-333"><a href="#cb86-333" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-opt-1.csv"</span>)))</span>
<span id="cb86-334"><a href="#cb86-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-335"><a href="#cb86-335" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb86-336"><a href="#cb86-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-337"><a href="#cb86-337" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb86-338"><a href="#cb86-338" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb86-339"><a href="#cb86-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID),<span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-340"><a href="#cb86-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-341"><a href="#cb86-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-342"><a href="#cb86-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb86-343"><a href="#cb86-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb86-344"><a href="#cb86-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb86-345"><a href="#cb86-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte) <span class="sc">+</span></span>
<span id="cb86-346"><a href="#cb86-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb86-347"><a href="#cb86-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb86-348"><a href="#cb86-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, </span>
<span id="cb86-349"><a href="#cb86-349" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb86-350"><a href="#cb86-350" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb86-351"><a href="#cb86-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-352"><a href="#cb86-352" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb86-353"><a href="#cb86-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-354"><a href="#cb86-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-355"><a href="#cb86-355" aria-hidden="true" tabindex="-1"></a>For local computations one can use cmdstanr:</span>
<span id="cb86-356"><a href="#cb86-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-357"><a href="#cb86-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-sample, eval = FALSE}</span></span>
<span id="cb86-358"><a href="#cb86-358" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod20<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb86-359"><a href="#cb86-359" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb86-360"><a href="#cb86-360" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb86-361"><a href="#cb86-361" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="st">"mod20-loc"</span>,</span>
<span id="cb86-362"><a href="#cb86-362" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb86-363"><a href="#cb86-363" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb86-364"><a href="#cb86-364" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb86-365"><a href="#cb86-365" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb86-366"><a href="#cb86-366" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb86-367"><a href="#cb86-367" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb86-368"><a href="#cb86-368" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb86-369"><a href="#cb86-369" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb86-370"><a href="#cb86-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-371"><a href="#cb86-371" aria-hidden="true" tabindex="-1"></a> fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="fu">here</span>(mod_output_dir,<span class="st">"mod20-loc.RDS"</span>))</span>
<span id="cb86-372"><a href="#cb86-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-373"><a href="#cb86-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-374"><a href="#cb86-374" aria-hidden="true" tabindex="-1"></a>We performed out computations at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>. In this case:</span>
<span id="cb86-375"><a href="#cb86-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-376"><a href="#cb86-376" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we dumped the necessary data to .json format</span>
<span id="cb86-377"><a href="#cb86-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-378"><a href="#cb86-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dump-files, eval = FALSE}</span></span>
<span id="cb86-379"><a href="#cb86-379" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-380"><a href="#cb86-380" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-381"><a href="#cb86-381" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-382"><a href="#cb86-382" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-383"><a href="#cb86-383" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-384"><a href="#cb86-384" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-385"><a href="#cb86-385" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-386"><a href="#cb86-386" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-387"><a href="#cb86-387" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-388"><a href="#cb86-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-389"><a href="#cb86-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-390"><a href="#cb86-390" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we run the model using the batch file:</span>
<span id="cb86-391"><a href="#cb86-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-392"><a href="#cb86-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb86-393"><a href="#cb86-393" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb86-394"><a href="#cb86-394" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb86-395"><a href="#cb86-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-396"><a href="#cb86-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-397"><a href="#cb86-397" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb86-398"><a href="#cb86-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-399"><a href="#cb86-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-load}</span></span>
<span id="cb86-400"><a href="#cb86-400" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb86-401"><a href="#cb86-401" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb86-402"><a href="#cb86-402" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb86-403"><a href="#cb86-403" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb86-404"><a href="#cb86-404" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb86-405"><a href="#cb86-405" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb86-406"><a href="#cb86-406" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb86-407"><a href="#cb86-407" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb86-408"><a href="#cb86-408" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb86-409"><a href="#cb86-409" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb86-410"><a href="#cb86-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-411"><a href="#cb86-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-412"><a href="#cb86-412" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb86-413"><a href="#cb86-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-414"><a href="#cb86-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-diagnose, eval = FALSE}</span></span>
<span id="cb86-415"><a href="#cb86-415" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb86-416"><a href="#cb86-416" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(mod_output_dir)</span>
<span id="cb86-417"><a href="#cb86-417" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod20-*.csv'</span>)</span>
<span id="cb86-418"><a href="#cb86-418" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb86-419"><a href="#cb86-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-420"><a href="#cb86-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-421"><a href="#cb86-421" aria-hidden="true" tabindex="-1"></a>The diagnostics are reasonable given model complexity. Output copied here to save time:</span>
<span id="cb86-422"><a href="#cb86-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-423"><a href="#cb86-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb86-424"><a href="#cb86-424" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb86-425"><a href="#cb86-425" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb86-426"><a href="#cb86-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-427"><a href="#cb86-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-428"><a href="#cb86-428" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb86-429"><a href="#cb86-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-430"><a href="#cb86-430" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb86-431"><a href="#cb86-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-432"><a href="#cb86-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb86-433"><a href="#cb86-433" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb86-434"><a href="#cb86-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-435"><a href="#cb86-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-436"><a href="#cb86-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-437"><a href="#cb86-437" aria-hidden="true" tabindex="-1"></a><span class="fu"># Genereted quantitites</span></span>
<span id="cb86-438"><a href="#cb86-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-439"><a href="#cb86-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities, eval=FALSE}</span></span>
<span id="cb86-440"><a href="#cb86-440" aria-hidden="true" tabindex="-1"></a>mod20gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb86-441"><a href="#cb86-441" aria-hidden="true" tabindex="-1"></a>fitgq  <span class="ot">&lt;-</span> mod20gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb86-442"><a href="#cb86-442" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb86-443"><a href="#cb86-443" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb86-444"><a href="#cb86-444" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb86-445"><a href="#cb86-445" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb86-446"><a href="#cb86-446" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span>
<span id="cb86-447"><a href="#cb86-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-448"><a href="#cb86-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-449"><a href="#cb86-449" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb86-450"><a href="#cb86-450" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load</span></span>
<span id="cb86-451"><a href="#cb86-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eta-load}</span></span>
<span id="cb86-452"><a href="#cb86-452" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb86-453"><a href="#cb86-453" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb86-454"><a href="#cb86-454" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb86-455"><a href="#cb86-455" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb86-456"><a href="#cb86-456" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb86-457"><a href="#cb86-457" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb86-458"><a href="#cb86-458" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb86-459"><a href="#cb86-459" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb86-460"><a href="#cb86-460" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb86-461"><a href="#cb86-461" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb86-462"><a href="#cb86-462" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb86-463"><a href="#cb86-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-464"><a href="#cb86-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-465"><a href="#cb86-465" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trace plots</span></span>
<span id="cb86-466"><a href="#cb86-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-467"><a href="#cb86-467" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb86-468"><a href="#cb86-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-469"><a href="#cb86-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb86-470"><a href="#cb86-470" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb86-471"><a href="#cb86-471" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>))) </span>
<span id="cb86-472"><a href="#cb86-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-473"><a href="#cb86-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-474"><a href="#cb86-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-475"><a href="#cb86-475" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (figures)</span></span>
<span id="cb86-476"><a href="#cb86-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-477"><a href="#cb86-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb86-478"><a href="#cb86-478" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb86-479"><a href="#cb86-479" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"sigma"</span>,<span class="st">"sdpi"</span>)))</span>
<span id="cb86-480"><a href="#cb86-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-481"><a href="#cb86-481" aria-hidden="true" tabindex="-1"></a><span class="fu">## Functional groups effect </span></span>
<span id="cb86-482"><a href="#cb86-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functinoal-group-effects}</span></span>
<span id="cb86-483"><a href="#cb86-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb86-484"><a href="#cb86-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb86-485"><a href="#cb86-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-486"><a href="#cb86-486" aria-hidden="true" tabindex="-1"></a>idx1 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb86-487"><a href="#cb86-487" aria-hidden="true" tabindex="-1"></a>idx2 <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb86-488"><a href="#cb86-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-489"><a href="#cb86-489" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb86-490"><a href="#cb86-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-491"><a href="#cb86-491" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb86-492"><a href="#cb86-492" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb86-493"><a href="#cb86-493" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb86-494"><a href="#cb86-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-495"><a href="#cb86-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb86-496"><a href="#cb86-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-497"><a href="#cb86-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb86-498"><a href="#cb86-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-499"><a href="#cb86-499" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb86-500"><a href="#cb86-500" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb86-501"><a href="#cb86-501" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb86-502"><a href="#cb86-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb86-503"><a href="#cb86-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb86-504"><a href="#cb86-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb86-505"><a href="#cb86-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx1])</span>
<span id="cb86-506"><a href="#cb86-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-507"><a href="#cb86-507" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb86-508"><a href="#cb86-508" aria-hidden="true" tabindex="-1"></a>p_common <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb86-509"><a href="#cb86-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb86-510"><a href="#cb86-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb86-511"><a href="#cb86-511" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb86-512"><a href="#cb86-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb86-513"><a href="#cb86-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)<span class="sc">+</span></span>
<span id="cb86-514"><a href="#cb86-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb86-515"><a href="#cb86-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-516"><a href="#cb86-516" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb86-517"><a href="#cb86-517" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb86-518"><a href="#cb86-518" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb86-519"><a href="#cb86-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-520"><a href="#cb86-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb86-521"><a href="#cb86-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-522"><a href="#cb86-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb86-523"><a href="#cb86-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-524"><a href="#cb86-524" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb86-525"><a href="#cb86-525" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb86-526"><a href="#cb86-526" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb86-527"><a href="#cb86-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb86-528"><a href="#cb86-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb86-529"><a href="#cb86-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)<span class="sc">%&gt;%</span></span>
<span id="cb86-530"><a href="#cb86-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional_groups_name <span class="sc">%in%</span> functional_groups_names[idx2])</span>
<span id="cb86-531"><a href="#cb86-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-532"><a href="#cb86-532" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb86-533"><a href="#cb86-533" aria-hidden="true" tabindex="-1"></a>p_uncommon <span class="ot">&lt;-</span> param <span class="sc">%&gt;%</span></span>
<span id="cb86-534"><a href="#cb86-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> <span class="fu">factor</span>(functional_groups_name, <span class="at">levels =</span> functional_groups_names)) <span class="sc">%&gt;%</span></span>
<span id="cb86-535"><a href="#cb86-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb86-536"><a href="#cb86-536" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb86-537"><a href="#cb86-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb86-538"><a href="#cb86-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param) <span class="sc">+</span></span>
<span id="cb86-539"><a href="#cb86-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span>
<span id="cb86-540"><a href="#cb86-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-541"><a href="#cb86-541" aria-hidden="true" tabindex="-1"></a>p_uncommon</span>
<span id="cb86-542"><a href="#cb86-542" aria-hidden="true" tabindex="-1"></a>p_common</span>
<span id="cb86-543"><a href="#cb86-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-544"><a href="#cb86-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-545"><a href="#cb86-545" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fits</span></span>
<span id="cb86-546"><a href="#cb86-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-547"><a href="#cb86-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-gof-plots}</span></span>
<span id="cb86-548"><a href="#cb86-548" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-549"><a href="#cb86-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-550"><a href="#cb86-550" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb86-551"><a href="#cb86-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb86-552"><a href="#cb86-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb86-553"><a href="#cb86-553" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb86-554"><a href="#cb86-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb86-555"><a href="#cb86-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-556"><a href="#cb86-556" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-557"><a href="#cb86-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-558"><a href="#cb86-558" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb86-559"><a href="#cb86-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb86-560"><a href="#cb86-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb86-561"><a href="#cb86-561" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb86-562"><a href="#cb86-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb86-563"><a href="#cb86-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-564"><a href="#cb86-564" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb86-565"><a href="#cb86-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb86-566"><a href="#cb86-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-567"><a href="#cb86-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb86-568"><a href="#cb86-568" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb86-569"><a href="#cb86-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb86-570"><a href="#cb86-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb86-571"><a href="#cb86-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb86-572"><a href="#cb86-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb86-573"><a href="#cb86-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-574"><a href="#cb86-574" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb86-575"><a href="#cb86-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb86-576"><a href="#cb86-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-577"><a href="#cb86-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb86-578"><a href="#cb86-578" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb86-579"><a href="#cb86-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb86-580"><a href="#cb86-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb86-581"><a href="#cb86-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb86-582"><a href="#cb86-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb86-583"><a href="#cb86-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-584"><a href="#cb86-584" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb86-585"><a href="#cb86-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-586"><a href="#cb86-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-587"><a href="#cb86-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-588"><a href="#cb86-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-predictions}</span></span>
<span id="cb86-589"><a href="#cb86-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-590"><a href="#cb86-590" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb86-591"><a href="#cb86-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-592"><a href="#cb86-592" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-593"><a href="#cb86-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-594"><a href="#cb86-594" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb86-595"><a href="#cb86-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb86-596"><a href="#cb86-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-597"><a href="#cb86-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb86-598"><a href="#cb86-598" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-599"><a href="#cb86-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb86-600"><a href="#cb86-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb86-601"><a href="#cb86-601" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb86-602"><a href="#cb86-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-603"><a href="#cb86-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb86-604"><a href="#cb86-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb86-605"><a href="#cb86-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb86-606"><a href="#cb86-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb86-607"><a href="#cb86-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-608"><a href="#cb86-608" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb86-609"><a href="#cb86-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-610"><a href="#cb86-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-611"><a href="#cb86-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions}</span></span>
<span id="cb86-612"><a href="#cb86-612" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb86-613"><a href="#cb86-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-614"><a href="#cb86-614" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-615"><a href="#cb86-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-616"><a href="#cb86-616" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb86-617"><a href="#cb86-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb86-618"><a href="#cb86-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-619"><a href="#cb86-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb86-620"><a href="#cb86-620" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-621"><a href="#cb86-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb86-622"><a href="#cb86-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb86-623"><a href="#cb86-623" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb86-624"><a href="#cb86-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-625"><a href="#cb86-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb86-626"><a href="#cb86-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb86-627"><a href="#cb86-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb86-628"><a href="#cb86-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb86-629"><a href="#cb86-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-630"><a href="#cb86-630" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb86-631"><a href="#cb86-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-632"><a href="#cb86-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions-vpc}</span></span>
<span id="cb86-633"><a href="#cb86-633" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-634"><a href="#cb86-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-635"><a href="#cb86-635" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb86-636"><a href="#cb86-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb86-637"><a href="#cb86-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-638"><a href="#cb86-638" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-639"><a href="#cb86-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi))<span class="sc">%&gt;%</span></span>
<span id="cb86-640"><a href="#cb86-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draw=</span>.draw)<span class="sc">%&gt;%</span></span>
<span id="cb86-641"><a href="#cb86-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(draw, fi)<span class="sc">%&gt;%</span></span>
<span id="cb86-642"><a href="#cb86-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mlogk =</span> <span class="fu">mean</span>(logk),</span>
<span id="cb86-643"><a href="#cb86-643" aria-hidden="true" tabindex="-1"></a>            <span class="at">llogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb86-644"><a href="#cb86-644" aria-hidden="true" tabindex="-1"></a>            <span class="at">ulogk =</span> <span class="fu">quantile</span>(logk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb86-645"><a href="#cb86-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fi)<span class="sc">%&gt;%</span></span>
<span id="cb86-646"><a href="#cb86-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mmlogk =</span> <span class="fu">mean</span>(mlogk),</span>
<span id="cb86-647"><a href="#cb86-647" aria-hidden="true" tabindex="-1"></a>            <span class="at">mllogk =</span> <span class="fu">quantile</span>(llogk, <span class="at">prob=</span><span class="fl">0.05</span>),</span>
<span id="cb86-648"><a href="#cb86-648" aria-hidden="true" tabindex="-1"></a>            <span class="at">mulogk =</span> <span class="fu">quantile</span>(ulogk, <span class="at">prob=</span><span class="fl">0.95</span>))<span class="sc">%&gt;%</span></span>
<span id="cb86-649"><a href="#cb86-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb86-650"><a href="#cb86-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mmlogk))<span class="sc">+</span></span>
<span id="cb86-651"><a href="#cb86-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mllogk))<span class="sc">+</span></span>
<span id="cb86-652"><a href="#cb86-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> mulogk))<span class="sc">+</span></span>
<span id="cb86-653"><a href="#cb86-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-654"><a href="#cb86-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb86-655"><a href="#cb86-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb86-656"><a href="#cb86-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-657"><a href="#cb86-657" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb86-658"><a href="#cb86-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-659"><a href="#cb86-659" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual Parameters and etaplots</span></span>
<span id="cb86-660"><a href="#cb86-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-661"><a href="#cb86-661" aria-hidden="true" tabindex="-1"></a>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</span>
<span id="cb86-662"><a href="#cb86-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-663"><a href="#cb86-663" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual parameters</span></span>
<span id="cb86-664"><a href="#cb86-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-665"><a href="#cb86-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iparam}</span></span>
<span id="cb86-666"><a href="#cb86-666" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-667"><a href="#cb86-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sparam_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-668"><a href="#cb86-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb86-669"><a href="#cb86-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb86-670"><a href="#cb86-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-671"><a href="#cb86-671" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb86-672"><a href="#cb86-672" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb86-673"><a href="#cb86-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-674"><a href="#cb86-674" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2, param1<span class="sc">-</span>param2, datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb86-675"><a href="#cb86-675" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logka'</span>[i]), <span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb86-676"><a href="#cb86-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-677"><a href="#cb86-677" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb86-678"><a href="#cb86-678" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb86-679"><a href="#cb86-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-680"><a href="#cb86-680" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb86-681"><a href="#cb86-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-682"><a href="#cb86-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-683"><a href="#cb86-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### Etas</span></span>
<span id="cb86-684"><a href="#cb86-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ieta}</span></span>
<span id="cb86-685"><a href="#cb86-685" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-686"><a href="#cb86-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-687"><a href="#cb86-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb86-688"><a href="#cb86-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb86-689"><a href="#cb86-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-690"><a href="#cb86-690" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb86-691"><a href="#cb86-691" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb86-692"><a href="#cb86-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-693"><a href="#cb86-693" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,param1<span class="sc">-</span>param2,datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb86-694"><a href="#cb86-694" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etalogka'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb86-695"><a href="#cb86-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-696"><a href="#cb86-696" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb86-697"><a href="#cb86-697" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb86-698"><a href="#cb86-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-699"><a href="#cb86-699" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb86-700"><a href="#cb86-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-701"><a href="#cb86-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-702"><a href="#cb86-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect of functional groups (screening)</span></span>
<span id="cb86-703"><a href="#cb86-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r effect-fg-screening}</span></span>
<span id="cb86-704"><a href="#cb86-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-705"><a href="#cb86-705" aria-hidden="true" tabindex="-1"></a>valid_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb86-706"><a href="#cb86-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-707"><a href="#cb86-707" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">map</span>(valid_indices, <span class="cf">function</span>(i) {</span>
<span id="cb86-708"><a href="#cb86-708" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract functional group as a factor</span></span>
<span id="cb86-709"><a href="#cb86-709" aria-hidden="true" tabindex="-1"></a>  nrgroups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(functional_groups[, i])</span>
<span id="cb86-710"><a href="#cb86-710" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-711"><a href="#cb86-711" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for plotting</span></span>
<span id="cb86-712"><a href="#cb86-712" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb86-713"><a href="#cb86-713" aria-hidden="true" tabindex="-1"></a>    <span class="at">param1 =</span> param1,</span>
<span id="cb86-714"><a href="#cb86-714" aria-hidden="true" tabindex="-1"></a>    <span class="at">param2 =</span> param2,</span>
<span id="cb86-715"><a href="#cb86-715" aria-hidden="true" tabindex="-1"></a>    <span class="at">param3=</span> param1<span class="sc">-</span>param2,</span>
<span id="cb86-716"><a href="#cb86-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrgroups =</span> nrgroups</span>
<span id="cb86-717"><a href="#cb86-717" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-718"><a href="#cb86-718" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-719"><a href="#cb86-719" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="sc">%&gt;%</span></span>
<span id="cb86-720"><a href="#cb86-720" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(param1, param2, param3), </span>
<span id="cb86-721"><a href="#cb86-721" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"name"</span>, </span>
<span id="cb86-722"><a href="#cb86-722" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-723"><a href="#cb86-723" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">etaname =</span> <span class="fu">recode</span>(name, </span>
<span id="cb86-724"><a href="#cb86-724" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param1 =</span> <span class="st">"etalogkw"</span>, </span>
<span id="cb86-725"><a href="#cb86-725" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param2 =</span> <span class="st">"etaS"</span>,</span>
<span id="cb86-726"><a href="#cb86-726" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param3 =</span> <span class="st">"etalogka"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-727"><a href="#cb86-727" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> nrgroups)) <span class="sc">+</span></span>
<span id="cb86-728"><a href="#cb86-728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb86-729"><a href="#cb86-729" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>etaname) <span class="sc">+</span></span>
<span id="cb86-730"><a href="#cb86-730" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> functional_groups_names[i], </span>
<span id="cb86-731"><a href="#cb86-731" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Nr of functional groups"</span>, </span>
<span id="cb86-732"><a href="#cb86-732" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"eta"</span>)<span class="sc">+</span></span>
<span id="cb86-733"><a href="#cb86-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb86-734"><a href="#cb86-734" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb86-735"><a href="#cb86-735" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb86-736"><a href="#cb86-736" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb86-737"><a href="#cb86-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-738"><a href="#cb86-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-739"><a href="#cb86-739" aria-hidden="true" tabindex="-1"></a>plot_groups <span class="ot">&lt;-</span> <span class="fu">split</span>(plots, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(plots) <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb86-740"><a href="#cb86-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-741"><a href="#cb86-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each group of up to four plots</span></span>
<span id="cb86-742"><a href="#cb86-742" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(plot_groups, <span class="cf">function</span>(group) {</span>
<span id="cb86-743"><a href="#cb86-743" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(group, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb86-744"><a href="#cb86-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb86-745"><a href="#cb86-745" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb86-746"><a href="#cb86-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-747"><a href="#cb86-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-748"><a href="#cb86-748" aria-hidden="true" tabindex="-1"></a><span class="fu">#  Simulations (CV-based)</span></span>
<span id="cb86-749"><a href="#cb86-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-752"><a href="#cb86-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb86-753"><a href="#cb86-753" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>similarity_matrix_corrected  </span>
<span id="cb86-754"><a href="#cb86-754" aria-hidden="true" tabindex="-1"></a>upper_tri_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">upper.tri</span>(distance), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-755"><a href="#cb86-755" aria-hidden="true" tabindex="-1"></a>upper_tri_values <span class="ot">&lt;-</span> distance[upper_tri_indices]</span>
<span id="cb86-756"><a href="#cb86-756" aria-hidden="true" tabindex="-1"></a>top_100_indices <span class="ot">&lt;-</span> <span class="fu">order</span>(upper_tri_values)[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">1000</span>, <span class="at">by=</span><span class="dv">10</span>)]</span>
<span id="cb86-757"><a href="#cb86-757" aria-hidden="true" tabindex="-1"></a>closest_pairs <span class="ot">&lt;-</span> upper_tri_indices[top_100_indices, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb86-758"><a href="#cb86-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-759"><a href="#cb86-759" aria-hidden="true" tabindex="-1"></a>closest_pairs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(closest_pairs)</span>
<span id="cb86-760"><a href="#cb86-760" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(closest_pairs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>)</span>
<span id="cb86-761"><a href="#cb86-761" aria-hidden="true" tabindex="-1"></a>closest_pairs<span class="sc">$</span>distance <span class="ot">=</span> upper_tri_values[top_100_indices]</span>
<span id="cb86-762"><a href="#cb86-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-763"><a href="#cb86-763" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(closest_pairs)</span>
<span id="cb86-764"><a href="#cb86-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-765"><a href="#cb86-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-766"><a href="#cb86-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r datastruct-cv}</span></span>
<span id="cb86-767"><a href="#cb86-767" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">=</span> <span class="fu">unique</span>(closest_pairs<span class="sc">$</span>col)</span>
<span id="cb86-768"><a href="#cb86-768" aria-hidden="true" tabindex="-1"></a>datastructcv <span class="ot">=</span> datastruct;</span>
<span id="cb86-769"><a href="#cb86-769" aria-hidden="true" tabindex="-1"></a>initcv<span class="ot">=</span>init;</span>
<span id="cb86-770"><a href="#cb86-770" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb86-771"><a href="#cb86-771" aria-hidden="true" tabindex="-1"></a>idx_analytes_out <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(closest_pairs<span class="sc">$</span>col))</span>
<span id="cb86-772"><a href="#cb86-772" aria-hidden="true" tabindex="-1"></a>idx_analytes_in <span class="ot">=</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(datastructcv<span class="sc">$</span>analyte),idx_analytes_out)</span>
<span id="cb86-773"><a href="#cb86-773" aria-hidden="true" tabindex="-1"></a>idxcv <span class="ot">=</span>  <span class="fu">which</span>(datastructcv<span class="sc">$</span>analyte <span class="sc">%in%</span> idx_analytes_in)</span>
<span id="cb86-774"><a href="#cb86-774" aria-hidden="true" tabindex="-1"></a>nObscv <span class="ot">=</span> <span class="fu">length</span>(idxcv);</span>
<span id="cb86-775"><a href="#cb86-775" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>idxcv <span class="ot">=</span> idxcv;</span>
<span id="cb86-776"><a href="#cb86-776" aria-hidden="true" tabindex="-1"></a>datastructcv<span class="sc">$</span>nObscv <span class="ot">=</span> nObscv;</span>
<span id="cb86-777"><a href="#cb86-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-778"><a href="#cb86-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-779"><a href="#cb86-779" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting the model</span></span>
<span id="cb86-780"><a href="#cb86-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-781"><a href="#cb86-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mod-settings-cv}</span></span>
<span id="cb86-782"><a href="#cb86-782" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod20cv"</span></span>
<span id="cb86-783"><a href="#cb86-783" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb86-784"><a href="#cb86-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-785"><a href="#cb86-785" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb86-786"><a href="#cb86-786" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb86-787"><a href="#cb86-787" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb86-788"><a href="#cb86-788" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb86-789"><a href="#cb86-789" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb86-790"><a href="#cb86-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-791"><a href="#cb86-791" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb86-792"><a href="#cb86-792" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb86-793"><a href="#cb86-793" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb86-794"><a href="#cb86-794" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb86-795"><a href="#cb86-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-796"><a href="#cb86-796" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb86-797"><a href="#cb86-797" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb86-798"><a href="#cb86-798" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb86-799"><a href="#cb86-799" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb86-800"><a href="#cb86-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-801"><a href="#cb86-801" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb86-802"><a href="#cb86-802" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span>
<span id="cb86-803"><a href="#cb86-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-804"><a href="#cb86-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-805"><a href="#cb86-805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-compile-cv, eval = FALSE}</span></span>
<span id="cb86-806"><a href="#cb86-806" aria-hidden="true" tabindex="-1"></a>mod20cv <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))                </span>
<span id="cb86-807"><a href="#cb86-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-808"><a href="#cb86-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-809"><a href="#cb86-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dump-files-cv, eval = FALSE}</span></span>
<span id="cb86-810"><a href="#cb86-810" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastructcv, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-811"><a href="#cb86-811" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-812"><a href="#cb86-812" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-813"><a href="#cb86-813" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-814"><a href="#cb86-814" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-815"><a href="#cb86-815" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-816"><a href="#cb86-816" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-817"><a href="#cb86-817" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-818"><a href="#cb86-818" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">initcv</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb86-819"><a href="#cb86-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-820"><a href="#cb86-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-821"><a href="#cb86-821" aria-hidden="true" tabindex="-1"></a>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb86-822"><a href="#cb86-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-823"><a href="#cb86-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-load-cv}</span></span>
<span id="cb86-824"><a href="#cb86-824" aria-hidden="true" tabindex="-1"></a>fitcv <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb86-825"><a href="#cb86-825" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb86-826"><a href="#cb86-826" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb86-827"><a href="#cb86-827" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb86-828"><a href="#cb86-828" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb86-829"><a href="#cb86-829" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb86-830"><a href="#cb86-830" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb86-831"><a href="#cb86-831" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb86-832"><a href="#cb86-832" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb86-833"><a href="#cb86-833" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb86-834"><a href="#cb86-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-835"><a href="#cb86-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-836"><a href="#cb86-836" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb86-837"><a href="#cb86-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-838"><a href="#cb86-838" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb86-839"><a href="#cb86-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-840"><a href="#cb86-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary-cv}</span></span>
<span id="cb86-841"><a href="#cb86-841" aria-hidden="true" tabindex="-1"></a>fitcv<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb86-842"><a href="#cb86-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-843"><a href="#cb86-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-844"><a href="#cb86-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-845"><a href="#cb86-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## Genereted quantitites</span></span>
<span id="cb86-846"><a href="#cb86-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-847"><a href="#cb86-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities-cv, eval=FALSE}</span></span>
<span id="cb86-848"><a href="#cb86-848" aria-hidden="true" tabindex="-1"></a>mod20cvgq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb86-849"><a href="#cb86-849" aria-hidden="true" tabindex="-1"></a>fitcvgq  <span class="ot">&lt;-</span> mod20cvgq<span class="sc">$</span><span class="fu">generate_quantities</span>(fitcv,</span>
<span id="cb86-850"><a href="#cb86-850" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastructcv,</span>
<span id="cb86-851"><a href="#cb86-851" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb86-852"><a href="#cb86-852" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb86-853"><a href="#cb86-853" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb86-854"><a href="#cb86-854" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span>
<span id="cb86-855"><a href="#cb86-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-856"><a href="#cb86-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-857"><a href="#cb86-857" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb86-858"><a href="#cb86-858" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load</span></span>
<span id="cb86-859"><a href="#cb86-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eta-load-cv}</span></span>
<span id="cb86-860"><a href="#cb86-860" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb86-861"><a href="#cb86-861" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb86-862"><a href="#cb86-862" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb86-863"><a href="#cb86-863" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb86-864"><a href="#cb86-864" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb86-865"><a href="#cb86-865" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb86-866"><a href="#cb86-866" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb86-867"><a href="#cb86-867" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb86-868"><a href="#cb86-868" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb86-869"><a href="#cb86-869" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb86-870"><a href="#cb86-870" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb86-871"><a href="#cb86-871" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-872"><a href="#cb86-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-873"><a href="#cb86-873" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fits</span></span>
<span id="cb86-874"><a href="#cb86-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-875"><a href="#cb86-875" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-predictions-cv}</span></span>
<span id="cb86-876"><a href="#cb86-876" aria-hidden="true" tabindex="-1"></a>fun_plot_ind_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">.analytes_idx=</span>analytes_idx){</span>
<span id="cb86-877"><a href="#cb86-877" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-878"><a href="#cb86-878" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb86-879"><a href="#cb86-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-880"><a href="#cb86-880" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb86-881"><a href="#cb86-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb86-882"><a href="#cb86-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb86-883"><a href="#cb86-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> .analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb86-884"><a href="#cb86-884" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-885"><a href="#cb86-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkind =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb86-886"><a href="#cb86-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logkpop =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb86-887"><a href="#cb86-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb86-888"><a href="#cb86-888" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkind), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb86-889"><a href="#cb86-889" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logkpop), <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb86-890"><a href="#cb86-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> .analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb86-891"><a href="#cb86-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb86-892"><a href="#cb86-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual and population)"</span>) <span class="sc">+</span></span>
<span id="cb86-893"><a href="#cb86-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb86-894"><a href="#cb86-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb86-895"><a href="#cb86-895" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-896"><a href="#cb86-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-897"><a href="#cb86-897" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">fun_plot_ind_pop</span>(idx_analytes_out[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb86-898"><a href="#cb86-898" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">fun_plot_ind_pop</span>(idx_analytes_in[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb86-899"><a href="#cb86-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-900"><a href="#cb86-900" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span>
<span id="cb86-901"><a href="#cb86-901" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span>
<span id="cb86-902"><a href="#cb86-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-903"><a href="#cb86-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb86-904"><a href="#cb86-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-905"><a href="#cb86-905" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session info</span></span>
<span id="cb86-906"><a href="#cb86-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-909"><a href="#cb86-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb86-910"><a href="#cb86-910" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb86-911"><a href="#cb86-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>