<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2024-02-12">

<title>Hierarchical models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hierarchical-models_files/libs/clipboard/clipboard.min.js"></script>
<script src="hierarchical-models_files/libs/quarto-html/quarto.js"></script>
<script src="hierarchical-models_files/libs/quarto-html/popper.min.js"></script>
<script src="hierarchical-models_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hierarchical-models_files/libs/quarto-html/anchor.min.js"></script>
<link href="hierarchical-models_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hierarchical-models_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hierarchical-models_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hierarchical-models_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hierarchical-models_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory data analysis</a></li>
  <li><a href="#prepare-data-for-calculations" id="toc-prepare-data-for-calculations" class="nav-link" data-scroll-target="#prepare-data-for-calculations">Prepare data for calculations</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#the-stan-model" id="toc-the-stan-model" class="nav-link" data-scroll-target="#the-stan-model">The Stan model:</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  </ul></li>
  <li><a href="#generete-quntitie" id="toc-generete-quntitie" class="nav-link" data-scroll-target="#generete-quntitie">Generete-Quntitie</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#load" id="toc-load" class="nav-link" data-scroll-target="#load">Load</a></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  <li><a href="#fits" id="toc-fits" class="nav-link" data-scroll-target="#fits">Fits</a></li>
  <li><a href="#individual-parameters-and-etaplots" id="toc-individual-parameters-and-etaplots" class="nav-link" data-scroll-target="#individual-parameters-and-etaplots">Individual Parameters and etaplots</a>
  <ul class="collapse">
  <li><a href="#individual-parameters" id="toc-individual-parameters" class="nav-link" data-scroll-target="#individual-parameters">Individual parameters</a></li>
  <li><a href="#etas" id="toc-etas" class="nav-link" data-scroll-target="#etas">Etas</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Hierarchical models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<p>The packages we will use are listed below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="do">## not required but assures repeatable results</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35^{}C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient.</p>
<div class="cell" data-hash="hierarchical-models_cache/html/rxnsim-similarity_e33daf237509570e4107ab2a8dd16ac8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/load-data_6ceff658f7394ece50fad1a1c3c49220">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory data analysis</h1>
<p>During the exploratory data analysis phase, we create a series of plots to better understand our data.</p>
<div class="cell" data-hash="hierarchical-models_cache/html/similarity-matrixplot_14b21c2360c41655b706b9813a354266">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>((simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>]<span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">*</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/similarity-matrixplot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[101:200,101:200]-0.5)*2)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[201:300,201:300]-0.5)*2)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[301:400,301:400]-0.5)*2)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[401:500,401:500]-0.5)*2)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[501:600,501:600]-0.5)*2)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[601:700,601:700]-0.5)*2)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[701:800,701:800]-0.5)*2)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[801:900,801:900]-0.5)*2)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[901:1026,901:1026]-0.5)*2)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.95</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>((simMat[selected_compounds,selected_compounds]<span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">*</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/similarity-matrixplot-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/raw-data_6661c85d9e72c0a421c5362e53236516">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/raw-data-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</p>
<div class="cell" data-hash="hierarchical-models_cache/html/pH-plot_2b5342ff43966bae484b7c0a1aab7eaf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/pH-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The values of molecular mass MM were added to the dataset. They were calculated using <a href="www.acdlabs.com">ACD/Labs program</a> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</p>
<div class="cell" data-hash="hierarchical-models_cache/html/hist-MW-logP_854289b01b121e58d82106c2254abaaf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/hist-MW-logP-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</p>
<div class="cell" data-hash="hierarchical-models_cache/html/functional-group-summary_14a35380fe8733629913bdbf09dafaf0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/functional-group-summary-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="prepare-data-for-calculations" class="level1">
<h1>Prepare data for calculations</h1>
<div class="cell" data-hash="hierarchical-models_cache/html/unnamed-chunk-1_94c9068e0ae8cabd6892f022bcd2212c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/initial-estimates_c05bb2a13664378d49b073f3669a032c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/initial-estimates-plot_1fff966bd0e9c0b77078ff9a78af30f5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/initial-estimates-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a …</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk  = \cdot
\end{aligned}
\]</span></p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell" data-hash="hierarchical-models_cache/html/stansetup_a0835fa8d191aee8ef267ff1571dbc4f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslit =</span> pKaslit,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">charges =</span> charges,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>          <span class="co">#param = cbind(matrix(2, 1, nrow=nSteps), matrix(5, 1, nrow=nSteps)),</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-stan-model" class="level3">
<h3 class="anchored" data-anchor-id="the-stan-model">The Stan model:</h3>
<div class="cell" data-hash="hierarchical-models_cache/html/stancode_c056845226cab3003a6445b5ba82c3e0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(<span class="st">"../model/stan/hplc-qsrr-izo-diss.stan"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>// Stan code to model the isocratic data
// Include logP and pKa as predictors. 
// Simplified version
 
functions {
// credit http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/
  real lkj_corr_point_lower_tri_lpdf(matrix rho, real point_mu_lower,
                                     real point_scale_lower) {
// works only for [2x2 matrix]
    real lpdf = lkj_corr_lpdf(rho | 1)
                + normal_lpdf(rho[2, 1] | point_mu_lower, point_scale_lower);
    return lpdf;
  }
  
 vector funlogki(real logkw, real S1, real S2, vector fi) {
// isocratic Neue model
    int d = num_elements(fi);
    vector[d] logki;
    logki = logkw-S1*(1+S2)*fi./(1+S2*fi);
    return logki;
  }
}

data {
  int nAnalytes;        
  int nObs;                 
  array[nObs] int analyte;
  vector[nObs] fi; 
  array[nAnalytes] int&lt;lower = 1&gt; start;
  array[nAnalytes] int&lt;lower = 1&gt; end;
  vector[nAnalytes] logPobs;
  array[nAnalytes] vector[3] pKaslit;
  array[nAnalytes] vector[4] charges;
  vector[nObs] logkobs;                 // observed retention factors 
  int&lt;lower=0, upper=1&gt; run_estimation; // 0 for prior predictive, 1 for estimation
}

transformed data{
  
    array[nAnalytes] real fr;
    vector[4] cpHmpKa;
    vector[4] lambda;
    vector[3] pHmpKa;
    
    for (i in 1 : nAnalytes) {
     pHmpKa = log(10) *(2.66-pKaslit[i]);
     cpHmpKa[1]=0;
     cpHmpKa[2:4]=cumulative_sum(pHmpKa);
     lambda = softmax(cpHmpKa);
     fr[i] = sum(lambda.*charges[i]);
    }
}

parameters {
  real logkwHat;            // typical logkw
  real S1Hat;               // effect of ACN on logkw
  real dlogkwHat;            // typical dlogkw
  real dS1Hat;               // effect of ACN on dlogkw
  real&lt;lower=0&gt; S2Hat;      // typical value of S2
  vector[2] beta;           // effect of logP on logkw and S1
  vector&lt;lower=0&gt;[2] omega; // sd of BAV [logkw,S1]
  corr_matrix[2] rho;       // correlation matrix [logkw vs. S1] 
  real&lt;lower=0&gt; sigma;      // typical sigma
  array[nAnalytes] vector[2] param;
}

transformed parameters {
  cov_matrix[2] Omega;
  array[nAnalytes] vector[2] miu;
  vector[nObs] logkx;
  
  Omega = quad_form_diag(rho, omega); // diag_matrix(omega) * rho * diag_matrix(omega)
  
  for (i in 1 : nAnalytes) {
    miu[i, 1] = logkwHat + fr[i]*dlogkwHat + beta[1] * logPobs[i];
    miu[i, 2] = S1Hat    + fr[i]*dS1Hat + beta[2] * logPobs[i];
  }
  
  for (i in 1 : nAnalytes) {
    logkx[start[i]:end[i]] = funlogki(param[i,1],param[i,2], S2Hat, fi[start[i]:end[i]]);
  }

}

model {
  logkwHat ~ normal(2, 4);
  S1Hat ~ normal(4, 2);
  dlogkwHat ~ normal(-1, 0.25);
  dS1Hat ~ normal(0, 0.5);
  S2Hat ~ lognormal(0.693, 0.125);
  beta[{1}] ~ normal(0.7, 0.125);
  beta[{2}] ~ normal(0.5, 0.5);
  omega ~ normal(0, 1);
  
  rho ~ lkj_corr_point_lower_tri(0.75, 0.125);
 
  for (i in 1 : nAnalytes) {
  param[i] ~ multi_normal(miu[i,1:2], Omega);
  }
  
  sigma ~ normal(0,0.05);
  
  if (run_estimation == 1) {
   logkobs ~ student_t(7,logkx, sigma);
  }
}

generated quantities {
}</code></pre>
</div>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<p>We compiled the model using cmdstanr:</p>
<div class="cell" data-hash="hierarchical-models_cache/html/stancompile_6d5973e7baff931d99813a0382a37b30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../model/stan/hplc-qsrr-izo-diss.stan"</span>, <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used optimization for initial testing:</p>
<div class="cell" data-hash="hierarchical-models_cache/html/stanoptimize_f7f143ad1ae1b80ec598bee509a2dd55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod1<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">'../stanfiles'</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">2000</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/optplots_021503f820a00711e3db291087c729b3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>datax<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datax, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/brms_e13892f53e1856cd009fef560da9c978">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to check if it can be dones</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>databrms <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> datastruct<span class="sc">$</span>analyte, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">logkobs =</span> datastruct<span class="sc">$</span>logk,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">logPobs=</span> datastruct<span class="sc">$</span>logPobs[datastruct<span class="sc">$</span>analyte],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fi=</span> datastruct<span class="sc">$</span>fi)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># make_stancode(bf(logkobs ~ logkw-S1*(1+S2)*fi/(1+S2*fi),</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#      logkw ~ logPobs + (1|xyz|id), </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#      S1 ~ logPobs + (1|xyz|id), </span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#      S2 ~ 1,</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#      nl = TRUE),</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = databrms, </span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   family = gaussian())</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>fit_hplc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(logkobs <span class="sc">~</span> logkw<span class="sc">-</span>S1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>S2)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>S2<span class="sc">*</span>fi),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>     logkw <span class="sc">~</span> logPobs <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>xyz<span class="sc">|</span>id), </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>     S1 <span class="sc">~</span> logPobs <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>xyz<span class="sc">|</span>id), </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>     S2 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> databrms, </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">nlpar =</span> <span class="st">"logkw"</span>),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">4</span>, <span class="dv">2</span>), <span class="at">nlpar =</span> <span class="st">"S1"</span>),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fl">0.69</span>, <span class="fl">0.125</span>), <span class="at">nlpar =</span> <span class="st">"S2"</span>, <span class="at">lb=</span><span class="dv">0</span>)),</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For local computations one can use cmdstanr:</p>
<div class="cell" data-hash="hierarchical-models_cache/html/stansample_8311dc0468d9b101651b33c2dd97d980">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod1<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> <span class="st">"../stanfiles"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../stanfiles/fit.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We performed out computations at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>. In this case:</p>
<ol type="1">
<li>we dumped the necessary data to .json format</li>
</ol>
<div class="cell" data-hash="hierarchical-models_cache/html/dumpfiles_bf30f2328d413e6df753f6a238543311">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="st">"../model/stan/standata.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-1.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-2.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-3.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-4.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-5.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-6.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-7.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-8.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>we run the model using the batch file:</li>
</ol>
<pre> 
</pre>
<ol start="3" type="1">
<li>After calculations, we loaded the output files using cmdstanr.</li>
</ol>
<div class="cell" data-hash="hierarchical-models_cache/html/stanload_c965c500accc5d7eca0781deb6ba9193">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_1.csv'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_2.csv'</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_3.csv'</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_4.csv'</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_5.csv'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_6.csv'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_7.csv'</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_8.csv'</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../stanfiles/hplc-qsrr-izo-diss.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell" data-hash="hierarchical-models_cache/html/standiagnose_54e8590bea470f27ccfe60f169832ccb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(<span class="st">'../stanfiles'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  output_*.csv'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The diagnostics are reasonable given model complexity. Output copied here to save time:</p>
<pre> [1] "Processing csv files: output_1.csv, output_2.csv, output_3.csv, output_4.csv, output_5.csv, output_6.csv, output_7.csv, output_8.csv"
 [3] "Checking sampler transitions treedepth."
 [4] "Treedepth satisfactory for all transitions."
 [6] "Checking sampler transitions for divergences."
 [7] "No divergent transitions found."
 [9] "Checking E-BFMI - sampler transitions HMC potential energy."                                                    
[10] "E-BFMI satisfactory."                                                                                           
[12] "Effective sample size satisfactory."                                                                            
[14] "Split R-hat values satisfactory all parameters."                                                                
[16] "Processing complete, no problems detected."  
</pre>
</section>
</section>
<section id="generete-quntitie" class="level1">
<h1>Generete-Quntitie</h1>
<div class="cell" data-hash="hierarchical-models_cache/html/generete-quntities_924e381053e7c5c51ffad6bd90b7ad35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../model/stan/hplc-qsrr-izo-diss-gq.stan"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fit_gq  <span class="ot">&lt;-</span> model_gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> <span class="st">"../stanfiles"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>fit_gq<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../stanfiles/hplc-qsrr-izo-dis_gq.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="load" class="level2">
<h2 class="anchored" data-anchor-id="load">Load</h2>
<div class="cell" data-hash="hierarchical-models_cache/html/load-saved-data_9da48520443e3bddc6c7290d9b1ad14a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#' fit is read back using readRDS - for speed</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../stanfiles/hplc-qsrr-izo-diss.RDS"</span>) </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit_gq &lt;- readRDS("../stanfiles/hplc-qsrr-izo-dis-gq.RDS") </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/etaload_76de0da581d88de2ad125a5aae637be1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-1-2a7e0a.csv'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-2-2a7e0a.csv'</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-3-2a7e0a.csv'</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-4-2a7e0a.csv'</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>draws_gq_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># draws_etas_df &lt;- fit_etas$draws(format = "df")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-model-parameters-table" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell" data-hash="hierarchical-models_cache/html/summary_9736b64b187cff07396fab500d70959e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     variable     mean   median    sd   mad       q5      q95 rhat ess_bulk
 lp__         10907.85 10908.20 42.85 43.14 10835.10 10976.30 1.01      956
 logkwHat         2.32     2.32  0.09  0.09     2.17     2.47 1.00     4856
 S1Hat            3.73     3.73  0.08  0.08     3.59     3.87 1.00     4947
 dlogkwHat       -0.90    -0.90  0.07  0.07    -1.03    -0.78 1.00     6395
 dS1Hat           0.07     0.07  0.07  0.07    -0.05     0.18 1.00     4207
 S2Hat            2.91     2.91  0.04  0.04     2.85     2.97 1.04      264
 beta[1]          0.90     0.90  0.03  0.03     0.85     0.94 1.00     2730
 beta[2]          0.69     0.69  0.02  0.02     0.64     0.73 1.00     2157
 omega[1]         1.54     1.54  0.04  0.04     1.48     1.60 1.00     2288
 omega[2]         1.40     1.40  0.04  0.04     1.34     1.46 1.00     2449
 rho[1,1]         1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 rho[2,1]         0.88     0.88  0.01  0.01     0.87     0.90 1.00     1408
 rho[1,2]         0.88     0.88  0.01  0.01     0.87     0.90 1.00     1408
 rho[2,2]         1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 sigma            0.05     0.05  0.00  0.00     0.05     0.05 1.00     2075
 param[1,1]       0.39     0.39  0.08  0.07     0.26     0.51 1.01     8725
 param[2,1]       1.64     1.63  0.06  0.06     1.54     1.74 1.00     6790
 param[3,1]       1.43     1.44  0.10  0.10     1.25     1.58 1.01     7855
 param[4,1]       2.57     2.56  0.14  0.13     2.36     2.80 1.00     8298
 param[5,1]       1.00     1.00  0.06  0.05     0.90     1.09 1.00     9445
 param[6,1]       5.80     5.80  0.15  0.15     5.56     6.05 1.00     3605
 param[7,1]       1.31     1.31  0.09  0.09     1.17     1.47 1.00     8357
 param[8,1]       3.90     3.90  0.11  0.11     3.72     4.10 1.00     5988
 param[9,1]       1.71     1.71  0.05  0.05     1.63     1.80 1.00     8266
 param[10,1]      0.23     0.23  0.08  0.08     0.09     0.35 1.01     8766
 param[11,1]      1.69     1.69  0.08  0.08     1.55     1.81 1.00     8207
 param[12,1]      2.63     2.63  0.06  0.06     2.54     2.73 1.00     7777
 param[13,1]      0.78     0.79  0.13  0.13     0.56     0.98 1.00     7195
 param[14,1]      1.78     1.78  0.05  0.04     1.71     1.86 1.00     7025
 param[15,1]      2.24     2.24  0.06  0.06     2.14     2.34 1.00     7188
 param[16,1]      2.84     2.84  0.06  0.06     2.74     2.95 1.00     6610
 param[17,1]      2.06     2.06  0.05  0.05     1.98     2.14 1.00     6435
 param[18,1]      2.63     2.62  0.12  0.12     2.45     2.85 1.00     6947
 param[19,1]      2.18     2.18  0.05  0.05     2.10     2.27 1.00     7598
 param[20,1]      2.94     2.95  0.07  0.07     2.83     3.05 1.00     6246
 param[21,1]     11.74    11.77  0.86  0.86    10.29    13.09 1.00     6617
 param[22,1]      5.62     5.62  0.15  0.15     5.37     5.85 1.00     3636
 param[23,1]      6.36     6.36  0.24  0.23     5.98     6.74 1.00     8363
 param[24,1]      4.38     4.38  0.10  0.09     4.22     4.53 1.01     3526
 param[25,1]      4.38     4.39  0.11  0.11     4.20     4.55 1.00     3737
 param[26,1]      5.25     5.25  0.15  0.14     5.00     5.49 1.00     3327
 param[27,1]      5.04     5.04  0.16  0.15     4.78     5.29 1.00     4112
 param[28,1]      5.74     5.75  0.17  0.16     5.46     6.00 1.00     4802
 param[29,1]      4.55     4.55  0.11  0.10     4.36     4.72 1.00     4198
 param[30,1]      4.49     4.49  0.12  0.12     4.28     4.67 1.00     4262
 param[31,1]      2.81     2.81  0.06  0.06     2.71     2.90 1.00     5030
 param[32,1]      1.81     1.81  0.05  0.04     1.73     1.88 1.00     6617
 param[33,1]      1.56     1.56  0.05  0.05     1.48     1.64 1.00     8061
 param[34,1]      2.89     2.89  0.09  0.09     2.75     3.06 1.00     6239
 param[35,1]      1.54     1.54  0.05  0.04     1.46     1.61 1.00     7762
 param[36,1]      1.85     1.85  0.05  0.05     1.77     1.93 1.00     7136
 param[37,1]      2.82     2.81  0.11  0.11     2.65     3.02 1.00     6934
 param[38,1]      0.37     0.36  0.10  0.09     0.22     0.54 1.01     7870
 param[39,1]      6.07     6.07  0.15  0.15     5.83     6.33 1.00     3890
 param[40,1]      2.82     2.81  0.11  0.11     2.65     3.03 1.00     7578
 param[41,1]      3.44     3.45  0.13  0.14     3.21     3.65 1.00     6711
 param[42,1]      2.11     2.11  0.06  0.05     2.01     2.20 1.00     6003
 param[43,1]      3.28     3.27  0.10  0.10     3.12     3.45 1.00     6547
 param[44,1]      2.93     2.93  0.10  0.10     2.79     3.11 1.01     7615
 param[45,1]      3.70     3.70  0.14  0.14     3.45     3.93 1.00     6215
 param[46,1]     -0.64    -0.65  0.15  0.15    -0.89    -0.40 1.00     9813
 param[47,1]     -0.59    -0.59  0.15  0.15    -0.84    -0.35 1.00     9335
 param[48,1]      3.07     3.07  0.08  0.08     2.94     3.21 1.00     7860
 param[49,1]      2.31     2.31  0.05  0.05     2.23     2.40 1.00     6737
 param[50,1]      2.19     2.19  0.05  0.05     2.11     2.27 1.00     5049
 param[51,1]      2.94     2.93  0.10  0.10     2.79     3.11 1.01     7476
 param[52,1]      2.32     2.32  0.05  0.05     2.24     2.41 1.00     4659
 param[53,1]      2.13     2.12  0.05  0.05     2.04     2.22 1.00     7565
 param[54,1]      2.70     2.71  0.05  0.05     2.62     2.79 1.00     7252
 param[55,1]      1.40     1.40  0.06  0.06     1.29     1.49 1.00     8467
 param[56,1]      2.94     2.94  0.07  0.07     2.81     3.05 1.00     6422
 param[57,1]      2.11     2.11  0.06  0.05     2.01     2.20 1.00     8224
 param[58,1]      3.25     3.24  0.10  0.09     3.10     3.41 1.01     7396
 param[59,1]      1.75     1.74  0.08  0.08     1.62     1.89 1.00     8404
 param[60,1]      2.56     2.55  0.07  0.06     2.45     2.67 1.00     8114
 param[61,1]      7.61     7.61  0.23  0.22     7.23     7.99 1.00     5665
 param[62,1]      2.00     2.00  0.06  0.06     1.91     2.09 1.00     6985
 param[63,1]      2.41     2.41  0.05  0.05     2.34     2.49 1.00     6522
 param[64,1]      4.54     4.54  0.11  0.11     4.35     4.71 1.00     3306
 param[65,1]      1.92     1.92  0.07  0.07     1.80     2.04 1.00     7490
 param[66,1]      3.47     3.48  0.06  0.06     3.36     3.58 1.00     3719
 param[67,1]      4.84     4.84  0.22  0.21     4.48     5.18 1.00     5165
 param[68,1]      6.46     6.46  0.21  0.21     6.11     6.81 1.00     4954
 param[69,1]      2.72     2.71  0.07  0.07     2.61     2.85 1.00     8790
 param[70,1]      3.23     3.23  0.07  0.07     3.12     3.35 1.00     5720
 param[71,1]      2.47     2.47  0.05  0.05     2.39     2.56 1.01     6006
 param[72,1]      2.87     2.86  0.11  0.10     2.71     3.05 1.00     7295
 param[73,1]      2.72     2.72  0.07  0.07     2.61     2.84 1.00     8395
 param[74,1]      2.72     2.71  0.07  0.07     2.61     2.84 1.00     7622
 param[75,1]      3.93     3.94  0.11  0.11     3.75     4.11 1.00     4357
 param[76,1]      2.72     2.71  0.07  0.07     2.61     2.84 1.00     9047
 param[77,1]      3.58     3.58  0.07  0.07     3.46     3.70 1.00     4799
 param[78,1]      3.58     3.58  0.07  0.07     3.46     3.70 1.00     5279
 param[79,1]      4.56     4.57  0.13  0.13     4.34     4.76 1.00     4885
 param[80,1]      4.43     4.43  0.19  0.17     4.10     4.74 1.00     6190
 param[81,1]      5.24     5.24  0.19  0.18     4.92     5.54 1.00     7353
 param[82,1]      3.35     3.36  0.10  0.10     3.17     3.50 1.00     6744
 param[83,1]      2.27     2.27  0.05  0.05     2.19     2.36 1.00     9006
 param[84,1]      0.91     0.91  0.05  0.05     0.82     0.99 1.00     7764
 param[85,1]      1.80     1.80  0.06  0.06     1.71     1.89 1.00     6848
 param[86,1]      0.37     0.37  0.07  0.06     0.26     0.47 1.00     8957
 param[87,1]      3.10     3.10  0.06  0.06     3.00     3.21 1.00     4433
 param[88,1]     -0.27    -0.27  0.08  0.07    -0.40    -0.14 1.01     7453
 param[89,1]      0.11     0.11  0.08  0.08    -0.03     0.23 1.00     8269
 param[90,1]      1.53     1.53  0.05  0.05     1.44     1.62 1.01     6501
 param[91,1]      0.00     0.00  0.09  0.08    -0.15     0.14 1.00     7817
 param[92,1]      0.97     0.97  0.06  0.06     0.86     1.07 1.00     9252
 param[93,1]      0.76     0.76  0.07  0.06     0.66     0.86 1.00     9359
 param[94,1]     -0.20    -0.20  0.09  0.08    -0.35    -0.07 1.00     8317
 param[95,1]     -0.68    -0.59  0.35  0.21    -1.46    -0.31 1.02      325
 param[96,1]     -0.34    -0.34  0.08  0.08    -0.47    -0.22 1.00     8939
 param[97,1]      0.22     0.22  0.08  0.07     0.09     0.34 1.00     8606
 param[98,1]      0.85     0.85  0.07  0.06     0.73     0.95 1.01     7821
 param[99,1]      1.25     1.25  0.05  0.05     1.17     1.34 1.00     8846
 param[100,1]     1.46     1.46  0.05  0.05     1.38     1.54 1.00     6067
 param[101,1]     1.87     1.87  0.04  0.04     1.80     1.95 1.01     7021
 param[102,1]     2.41     2.41  0.05  0.05     2.33     2.48 1.00     6231
 param[103,1]     3.16     3.16  0.08  0.07     3.04     3.29 1.00     5632
 param[104,1]     4.10     4.09  0.10  0.10     3.93     4.27 1.00     4076
 param[105,1]     4.98     4.98  0.14  0.14     4.77     5.22 1.00     3985
 param[106,1]     5.75     5.75  0.14  0.14     5.51     5.98 1.00     3294
 param[107,1]     6.54     6.54  0.22  0.21     6.19     6.90 1.01     5447
 param[108,1]     7.24     7.24  0.21  0.21     6.89     7.59 1.00     4716
 param[109,1]     7.93     7.93  0.22  0.21     7.58     8.30 1.00     3925
 param[110,1]     8.74     8.73  0.33  0.33     8.19     9.28 1.00     5267
 param[111,1]     9.53     9.53  0.50  0.49     8.70    10.33 1.00     5566
 param[112,1]    10.22    10.23  0.52  0.51     9.32    11.06 1.00     6263
 param[113,1]    10.90    10.91  0.54  0.53    10.01    11.76 1.00     7327
 param[114,1]    11.56    11.57  0.53  0.54    10.67    12.42 1.01     5766
 param[115,1]    12.28    12.31  0.88  0.84    10.80    13.67 1.00     6052
 param[116,1]     1.39     1.39  0.06  0.06     1.29     1.48 1.00     7914
 param[117,1]     1.31     1.31  0.05  0.05     1.23     1.39 1.00    10032
 param[118,1]     2.79     2.79  0.06  0.06     2.69     2.90 1.00     8104
 param[119,1]     2.24     2.24  0.05  0.05     2.16     2.32 1.00     6532
 param[120,1]     6.11     6.11  0.16  0.15     5.85     6.37 1.00     3477
 param[121,1]     3.79     3.78  0.16  0.16     3.54     4.06 1.00     8670
 param[122,1]     4.38     4.37  0.19  0.17     4.08     4.69 1.00     7321
 param[123,1]    12.05    12.09  0.74  0.70    10.79    13.22 1.00     5904
 param[124,1]     8.15     8.15  0.26  0.25     7.74     8.59 1.00     5166
 param[125,1]     9.49     9.49  0.51  0.50     8.63    10.31 1.00     7562
 param[126,1]     3.48     3.49  0.17  0.16     3.19     3.73 1.00     7289
 param[127,1]     6.44     6.45  0.17  0.16     6.17     6.71 1.00     3832
 param[128,1]     0.62     0.62  0.07  0.06     0.50     0.72 1.00     9596
 param[129,1]     4.21     4.22  0.10  0.10     4.05     4.37 1.01     3771
 param[130,1]     6.41     6.41  0.18  0.17     6.11     6.70 1.00     5073
 param[131,1]     5.28     5.28  0.18  0.18     4.98     5.58 1.00     6525
 param[132,1]     4.60     4.59  0.16  0.16     4.34     4.88 1.00     4595
 param[133,1]     6.26     6.26  0.22  0.21     5.91     6.62 1.00     5861
 param[134,1]     2.89     2.88  0.09  0.08     2.76     3.04 1.00     8666
 param[135,1]     5.19     5.19  0.17  0.16     4.91     5.46 1.00     6719
 param[136,1]     8.04     8.04  0.25  0.24     7.62     8.44 1.00     4135
 param[137,1]     4.35     4.35  0.10  0.10     4.19     4.53 1.00     4208
 param[138,1]     6.52     6.52  0.16  0.15     6.26     6.78 1.00     4389
 param[139,1]     7.52     7.50  0.26  0.25     7.11     7.95 1.00     5143
 param[140,1]     5.75     5.75  0.18  0.18     5.45     6.03 1.00     5451
 param[141,1]     6.42     6.41  0.16  0.15     6.16     6.68 1.00     3684
 param[142,1]     6.03     6.03  0.16  0.16     5.77     6.29 1.00     4320
 param[143,1]     4.00     4.00  0.10  0.10     3.83     4.17 1.00     5061
 param[144,1]     7.42     7.42  0.23  0.22     7.04     7.81 1.00     4320
 param[145,1]     5.80     5.79  0.16  0.16     5.54     6.06 1.00     4581
 param[146,1]     3.50     3.50  0.09  0.09     3.34     3.65 1.00     4751
 param[147,1]     0.30     0.30  0.06  0.05     0.20     0.38 1.00     8239
 param[148,1]     5.80     5.80  0.15  0.14     5.55     6.04 1.00     4314
 param[149,1]     5.07     5.08  0.18  0.17     4.77     5.36 1.00     5846
 param[150,1]     7.95     7.96  0.34  0.34     7.38     8.50 1.00     5223
 param[151,1]     9.97     9.98  0.36  0.35     9.38    10.55 1.00     4405
 param[152,1]     6.81     6.79  0.28  0.26     6.39     7.29 1.00     6654
 param[153,1]     5.96     5.96  0.15  0.14     5.72     6.20 1.00     3152
 param[154,1]     3.50     3.50  0.09  0.09     3.35     3.65 1.01     4283
 param[155,1]     6.38     6.37  0.17  0.16     6.11     6.66 1.00     4589
 param[156,1]    12.17    12.18  0.60  0.60    11.19    13.10 1.00     6915
 param[157,1]     5.21     5.21  0.17  0.16     4.92     5.48 1.00     4823
 param[158,1]     4.50     4.50  0.10  0.09     4.34     4.65 1.00     3589
 param[159,1]     6.47     6.47  0.26  0.25     6.04     6.89 1.00     5035
 param[160,1]     8.40     8.40  0.41  0.38     7.72     9.07 1.00     5441
 param[161,1]     7.59     7.58  0.31  0.30     7.10     8.10 1.00     6637
 param[162,1]     6.63     6.63  0.32  0.30     6.11     7.17 1.00     6252
 param[163,1]     3.09     3.09  0.07  0.07     2.98     3.22 1.00     5434
 param[164,1]     2.50     2.50  0.06  0.05     2.40     2.59 1.00     7967
 param[165,1]     5.98     5.98  0.14  0.14     5.74     6.21 1.00     3534
 ess_tail
     2185
     3176
     3299
     3085
     3381
      657
     3070
     2731
     2974
     2871
       NA
     2426
     2426
       NA
     2706
     2900
     2289
     2909
     2342
     2738
     2722
     2822
     2551
     2906
     2678
     2764
     2870
     2658
     2752
     2871
     2499
     2737
     2907
     2773
     2490
     2738
     2804
     2579
     2399
     2165
     2649
     2170
     2939
     2491
     2650
     3020
     3032
     2862
     2297
     2666
     2432
     2825
     2919
     2586
     2601
     2814
     2710
     2497
     2538
     2718
     2999
     2903
     2916
     2749
     2920
     2406
     2356
     3110
     2836
     3071
     2732
     2726
     2204
     2905
     2886
     2308
     2310
     2784
     2767
     2631
     2456
     2589
     2788
     2208
     2336
     2468
     2419
     2899
     2882
     2512
     2759
     2255
     2930
     2928
     2216
     2589
     2640
     2997
     2877
     3028
     2768
     2710
     2597
     2754
     2519
     2778
     2690
     2799
     2465
      697
     2546
     2968
     2280
     2882
     2311
     2670
     2736
     2530
     2482
     2702
     2422
     2744
     2855
     2560
     2881
     2596
     2530
     2673
     2530
     2384
     2806
     2732
     2885
     2963
     2345
     3102
     2420
     2592
     2455
     2850
     2939
     2812
     2629
     2380
     2589
     2654
     2688
     2476
     2767
     2195
     2835
     2294
     2812
     2768
     2722
     2382
     2657
     2825
     2251
     2548
     2543
     2483
     2626
     2977
     2634
     2513
     2522
     2489
     2556
     2930
     3017
     2713
     2731
     2539
     2193
     2598
     2876
     2683
     2707
     2598

 # showing 180 of 9220 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="trace-plots" class="level2">
<h2 class="anchored" data-anchor-id="trace-plots">Trace plots</h2>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell" data-hash="hierarchical-models_cache/html/trace-plots_7514bbe1c6b4a16b0f5076275e6f353a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"param[626,1]"</span>,<span class="st">"param[626,2]"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/trace-plots-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-figures">Summary of model parameters (figures)</h2>
<div class="cell" data-hash="hierarchical-models_cache/html/mcmc-intervals_dc37d35100a4e9e76419bc6a1842f30d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/mcmc-intervals-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="fits" class="level2">
<h2 class="anchored" data-anchor-id="fits">Fits</h2>
<div class="cell" data-hash="hierarchical-models_cache/html/ind-pop-gof-plots_475d341bafdeb5eb6ce42cfbb651583f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/ind-pop-gof-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/ind-predictions_027091ee44af8f33abfe39990e7eb6fe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/ind-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/pop-predictions_5024f25641fd698d2969ab572865002e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/pop-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-and-etaplots" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters-and-etaplots">Individual Parameters and etaplots</h2>
<p>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</p>
<section id="individual-parameters" class="level3">
<h3 class="anchored" data-anchor-id="individual-parameters">Individual parameters</h3>
<div class="cell" data-hash="hierarchical-models_cache/html/iparam-column-neutral_a192f64075275e72a936144afd8a1566">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gq_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gq_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^sparam_ind"</span>, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gq_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/iparam-column-neutral-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="etas" class="level3">
<h3 class="anchored" data-anchor-id="etas">Etas</h3>
<div class="cell" data-hash="hierarchical-models_cache/html/ieta_dd244d03798284b2cdc8622b4e356ee8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gq_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gq_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^seta_ind"</span>, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gq_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="hierarchical-models_files/figure-html/ieta-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="hierarchical-models_cache/html/info_da7a1e996af8a2017026536857b38afa">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.3 (2022-03-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22631)

Matrix products: default

locale:
[1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
[3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.1250    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggcorrplot_0.1.4.1 brms_2.20.4        Rcpp_1.0.12        pracma_2.4.4      
 [5] reshape2_1.4.4     GGally_2.2.0       bayesplot_1.10.0   posterior_1.5.0   
 [9] dplyr_1.1.3        tidyr_1.3.0        rstan_2.32.5       StanHeaders_2.32.5
[13] patchwork_1.2.0    gridExtra_2.3      ggplot2_3.4.4      cmdstanr_0.5.3    

loaded via a namespace (and not attached):
 [1] nlme_3.1-155         matrixStats_1.2.0    xts_0.13.1          
 [4] RColorBrewer_1.1-3   threejs_0.3.3        tensorA_0.36.2      
 [7] tools_4.1.3          backports_1.4.1      utf8_1.2.3          
[10] R6_2.5.1             DT_0.31              ggdist_3.3.1        
[13] colorspace_2.0-3     withr_3.0.0          tidyselect_1.2.0    
[16] Brobdingnag_1.2-9    compiler_4.1.3       cli_3.6.1           
[19] arrayhelpers_1.1-0   shinyjs_2.1.0        labeling_0.4.3      
[22] colourpicker_1.3.0   scales_1.3.0         dygraphs_1.1.1.6    
[25] checkmate_2.2.0      mvtnorm_1.2-4        QuickJSR_1.0.9      
[28] stringr_1.5.1        digest_0.6.34        rmarkdown_2.25      
[31] base64enc_0.1-3      pkgconfig_2.0.3      htmltools_0.5.7     
[34] fastmap_1.1.1        htmlwidgets_1.6.4    rlang_1.1.0         
[37] rstudioapi_0.15.0    shiny_1.8.0          svUnit_1.0.6        
[40] farver_2.1.1         generics_0.1.3       zoo_1.8-12          
[43] jsonlite_1.8.8       crosstalk_1.2.1      gtools_3.9.5        
[46] distributional_0.3.2 inline_0.3.19        magrittr_2.0.3      
[49] loo_2.6.0            Matrix_1.6-5         munsell_0.5.0       
[52] fansi_1.0.4          abind_1.4-5          lifecycle_1.0.4     
[55] stringi_1.8.3        yaml_2.3.8           pkgbuild_1.4.3      
[58] plyr_1.8.9           grid_4.1.3           ggstats_0.5.1       
[61] parallel_4.1.3       promises_1.2.1       miniUI_0.1.1.1      
[64] lattice_0.20-45      knitr_1.45           pillar_1.9.0        
[67] igraph_1.3.5         markdown_1.12        shinystan_2.6.0     
[70] codetools_0.2-18     stats4_4.1.3         rstantools_2.3.1.1  
[73] glue_1.6.2           evaluate_0.23        data.table_1.14.10  
[76] RcppParallel_5.1.7   vctrs_0.6.2          httpuv_1.6.13       
[79] gtable_0.3.4         purrr_1.0.1          xfun_0.41           
[82] mime_0.12            xtable_1.8-4         coda_0.19-4         
[85] later_1.3.2          viridisLite_0.4.2    tibble_3.2.1        
[88] shinythemes_1.2.0    tidybayes_3.0.6      ellipsis_0.3.2      
[91] bridgesampling_1.1-2</code></pre>
</div>
</div>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Hierarchical models"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>The packages we will use are listed below.</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="do">## not required but assures repeatable results</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35\^{\circ}C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient.</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rxnsim-similarity, eval=FALSE}</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory data analysis</span></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>During the exploratory data analysis phase, we create a series of plots to better understand our data.</span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r similarity-matrixplot}</span></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>((simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>]<span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[101:200,101:200]-0.5)*2)</span></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[201:300,201:300]-0.5)*2)</span></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[301:400,301:400]-0.5)*2)</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[401:500,401:500]-0.5)*2)</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[501:600,501:600]-0.5)*2)</span></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[601:700,601:700]-0.5)*2)</span></span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[701:800,701:800]-0.5)*2)</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[801:900,801:900]-0.5)*2)</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot((simMat[901:1026,901:1026]-0.5)*2)</span></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.95</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>((simMat[selected_compounds,selected_compounds]<span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pH-plot, message=FALSE, warning=FALSE}</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a>The values of molecular mass MM were added to the dataset. They were calculated using <span class="co">[</span><span class="ot">ACD/Labs program</span><span class="co">](www.acdlabs.com)</span> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hist-MW-logP,message=FALSE, warning=FALSE}</span></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functional-group-summary, message=FALSE, warning=FALSE}</span></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prepare data for calculations</span></span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates-plot}</span></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a ...</span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a>&amp; logk  = \cdot</span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansetup}</span></span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslit =</span> pKaslit,</span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a>                       <span class="at">charges =</span> charges,</span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a>          <span class="co">#param = cbind(matrix(2, 1, nrow=nSteps), matrix(5, 1, nrow=nSteps)),</span></span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Stan model:</span></span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stancode}</span></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(<span class="st">"../model/stan/hplc-qsrr-izo-diss.stan"</span>))</span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a>We compiled the model using cmdstanr:</span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stancompile, eval = FALSE}</span></span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../model/stan/hplc-qsrr-izo-diss.stan"</span>, <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-341"><a href="#cb41-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a>We used optimization for initial testing:</span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanoptimize, eval = FALSE}</span></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod1<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">'../stanfiles'</span>,</span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">2000</span></span>
<span id="cb41-350"><a href="#cb41-350" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-351"><a href="#cb41-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r optplots, eval=FALSE}</span></span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a>datax<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>))</span>
<span id="cb41-360"><a href="#cb41-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-361"><a href="#cb41-361" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datax, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-368"><a href="#cb41-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-369"><a href="#cb41-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brms, eval=FALSE}</span></span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a><span class="co"># to check if it can be dones</span></span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a>databrms <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> datastruct<span class="sc">$</span>analyte, </span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a>                      <span class="at">logkobs =</span> datastruct<span class="sc">$</span>logk,</span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a>                      <span class="at">logPobs=</span> datastruct<span class="sc">$</span>logPobs[datastruct<span class="sc">$</span>analyte],</span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fi=</span> datastruct<span class="sc">$</span>fi)</span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-377"><a href="#cb41-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-378"><a href="#cb41-378" aria-hidden="true" tabindex="-1"></a><span class="co"># make_stancode(bf(logkobs ~ logkw-S1*(1+S2)*fi/(1+S2*fi),</span></span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="co">#      logkw ~ logPobs + (1|xyz|id), </span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a><span class="co">#      S1 ~ logPobs + (1|xyz|id), </span></span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a><span class="co">#      S2 ~ 1,</span></span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a><span class="co">#      nl = TRUE),</span></span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = databrms, </span></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a><span class="co">#   family = gaussian())</span></span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-386"><a href="#cb41-386" aria-hidden="true" tabindex="-1"></a>fit_hplc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(logkobs <span class="sc">~</span> logkw<span class="sc">-</span>S1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>S2)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>S2<span class="sc">*</span>fi),</span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a>     logkw <span class="sc">~</span> logPobs <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>xyz<span class="sc">|</span>id), </span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a>     S1 <span class="sc">~</span> logPobs <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>xyz<span class="sc">|</span>id), </span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a>     S2 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> databrms, </span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb41-394"><a href="#cb41-394" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb41-395"><a href="#cb41-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">nlpar =</span> <span class="st">"logkw"</span>),</span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">4</span>, <span class="dv">2</span>), <span class="at">nlpar =</span> <span class="st">"S1"</span>),</span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fl">0.69</span>, <span class="fl">0.125</span>), <span class="at">nlpar =</span> <span class="st">"S2"</span>, <span class="at">lb=</span><span class="dv">0</span>)),</span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>))</span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a>For local computations one can use cmdstanr:</span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansample, eval = FALSE}</span></span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod1<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> <span class="st">"../stanfiles"</span>,</span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb41-416"><a href="#cb41-416" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb41-417"><a href="#cb41-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../stanfiles/fit.RDS"</span>)</span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a>We performed out computations at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>. In this case:</span>
<span id="cb41-423"><a href="#cb41-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-424"><a href="#cb41-424" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we dumped the necessary data to .json format</span>
<span id="cb41-425"><a href="#cb41-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-426"><a href="#cb41-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dumpfiles, eval = FALSE}</span></span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="st">"../model/stan/standata.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-1.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-2.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-3.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-4.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-5.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-6.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-7.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="st">"../model/stan/init-8.json"</span>, <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we run the model using the batch file:</span>
<span id="cb41-439"><a href="#cb41-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-440"><a href="#cb41-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb41-441"><a href="#cb41-441" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb41-442"><a href="#cb41-442" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb41-443"><a href="#cb41-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-444"><a href="#cb41-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-445"><a href="#cb41-445" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb41-446"><a href="#cb41-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-447"><a href="#cb41-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanload}</span></span>
<span id="cb41-448"><a href="#cb41-448" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb41-449"><a href="#cb41-449" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_1.csv'</span>,</span>
<span id="cb41-450"><a href="#cb41-450" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_2.csv'</span>,</span>
<span id="cb41-451"><a href="#cb41-451" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_3.csv'</span>,</span>
<span id="cb41-452"><a href="#cb41-452" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_4.csv'</span>,</span>
<span id="cb41-453"><a href="#cb41-453" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_5.csv'</span>,</span>
<span id="cb41-454"><a href="#cb41-454" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_6.csv'</span>,</span>
<span id="cb41-455"><a href="#cb41-455" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_7.csv'</span>,</span>
<span id="cb41-456"><a href="#cb41-456" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/output_8.csv'</span></span>
<span id="cb41-457"><a href="#cb41-457" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb41-458"><a href="#cb41-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-459"><a href="#cb41-459" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../stanfiles/hplc-qsrr-izo-diss.RDS"</span>)</span>
<span id="cb41-460"><a href="#cb41-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-461"><a href="#cb41-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-462"><a href="#cb41-462" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb41-463"><a href="#cb41-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-464"><a href="#cb41-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r standiagnose, eval = FALSE}</span></span>
<span id="cb41-465"><a href="#cb41-465" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb41-466"><a href="#cb41-466" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(<span class="st">'../stanfiles'</span>)</span>
<span id="cb41-467"><a href="#cb41-467" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  output_*.csv'</span>)</span>
<span id="cb41-468"><a href="#cb41-468" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-469"><a href="#cb41-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-470"><a href="#cb41-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-471"><a href="#cb41-471" aria-hidden="true" tabindex="-1"></a>The diagnostics are reasonable given model complexity. Output copied here to save time:</span>
<span id="cb41-472"><a href="#cb41-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-473"><a href="#cb41-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb41-474"><a href="#cb41-474" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb41-475"><a href="#cb41-475" aria-hidden="true" tabindex="-1"></a><span class="in"> [1] "Processing csv files: output_1.csv, output_2.csv, output_3.csv, output_4.csv, output_5.csv, output_6.csv, output_7.csv, output_8.csv"</span></span>
<span id="cb41-476"><a href="#cb41-476" aria-hidden="true" tabindex="-1"></a><span class="in"> [3] "Checking sampler transitions treedepth."</span></span>
<span id="cb41-477"><a href="#cb41-477" aria-hidden="true" tabindex="-1"></a><span class="in"> [4] "Treedepth satisfactory for all transitions."</span></span>
<span id="cb41-478"><a href="#cb41-478" aria-hidden="true" tabindex="-1"></a><span class="in"> [6] "Checking sampler transitions for divergences."</span></span>
<span id="cb41-479"><a href="#cb41-479" aria-hidden="true" tabindex="-1"></a><span class="in"> [7] "No divergent transitions found."</span></span>
<span id="cb41-480"><a href="#cb41-480" aria-hidden="true" tabindex="-1"></a><span class="in"> [9] "Checking E-BFMI - sampler transitions HMC potential energy."                                                    </span></span>
<span id="cb41-481"><a href="#cb41-481" aria-hidden="true" tabindex="-1"></a><span class="in">[10] "E-BFMI satisfactory."                                                                                           </span></span>
<span id="cb41-482"><a href="#cb41-482" aria-hidden="true" tabindex="-1"></a><span class="in">[12] "Effective sample size satisfactory."                                                                            </span></span>
<span id="cb41-483"><a href="#cb41-483" aria-hidden="true" tabindex="-1"></a><span class="in">[14] "Split R-hat values satisfactory all parameters."                                                                </span></span>
<span id="cb41-484"><a href="#cb41-484" aria-hidden="true" tabindex="-1"></a><span class="in">[16] "Processing complete, no problems detected."  </span></span>
<span id="cb41-485"><a href="#cb41-485" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb41-486"><a href="#cb41-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-487"><a href="#cb41-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-488"><a href="#cb41-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-489"><a href="#cb41-489" aria-hidden="true" tabindex="-1"></a><span class="fu"># Generete-Quntitie</span></span>
<span id="cb41-490"><a href="#cb41-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities, eval=FALSE}</span></span>
<span id="cb41-491"><a href="#cb41-491" aria-hidden="true" tabindex="-1"></a>model_gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"../model/stan/hplc-qsrr-izo-diss-gq.stan"</span>)</span>
<span id="cb41-492"><a href="#cb41-492" aria-hidden="true" tabindex="-1"></a>fit_gq  <span class="ot">&lt;-</span> model_gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb41-493"><a href="#cb41-493" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb41-494"><a href="#cb41-494" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb41-495"><a href="#cb41-495" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb41-496"><a href="#cb41-496" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> <span class="st">"../stanfiles"</span>)</span>
<span id="cb41-497"><a href="#cb41-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-498"><a href="#cb41-498" aria-hidden="true" tabindex="-1"></a>fit_gq<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="st">"../stanfiles/hplc-qsrr-izo-dis_gq.RDS"</span>)</span>
<span id="cb41-499"><a href="#cb41-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-500"><a href="#cb41-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-501"><a href="#cb41-501" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb41-502"><a href="#cb41-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-503"><a href="#cb41-503" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load</span></span>
<span id="cb41-504"><a href="#cb41-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-505"><a href="#cb41-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-saved-data}</span></span>
<span id="cb41-506"><a href="#cb41-506" aria-hidden="true" tabindex="-1"></a> <span class="co">#' fit is read back using readRDS - for speed</span></span>
<span id="cb41-507"><a href="#cb41-507" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../stanfiles/hplc-qsrr-izo-diss.RDS"</span>) </span>
<span id="cb41-508"><a href="#cb41-508" aria-hidden="true" tabindex="-1"></a><span class="co"># fit_gq &lt;- readRDS("../stanfiles/hplc-qsrr-izo-dis-gq.RDS") </span></span>
<span id="cb41-509"><a href="#cb41-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-510"><a href="#cb41-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-511"><a href="#cb41-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r etaload}</span></span>
<span id="cb41-512"><a href="#cb41-512" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb41-513"><a href="#cb41-513" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-1-2a7e0a.csv'</span>,</span>
<span id="cb41-514"><a href="#cb41-514" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-2-2a7e0a.csv'</span>,</span>
<span id="cb41-515"><a href="#cb41-515" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-3-2a7e0a.csv'</span>,</span>
<span id="cb41-516"><a href="#cb41-516" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'../stanfiles/hplc-qsrr-izo-diss-gq-202402121544-4-2a7e0a.csv'</span></span>
<span id="cb41-517"><a href="#cb41-517" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb41-518"><a href="#cb41-518" aria-hidden="true" tabindex="-1"></a>draws_gq_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb41-519"><a href="#cb41-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-520"><a href="#cb41-520" aria-hidden="true" tabindex="-1"></a><span class="co"># draws_etas_df &lt;- fit_etas$draws(format = "df")</span></span>
<span id="cb41-521"><a href="#cb41-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-522"><a href="#cb41-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-523"><a href="#cb41-523" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb41-524"><a href="#cb41-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-525"><a href="#cb41-525" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb41-526"><a href="#cb41-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-527"><a href="#cb41-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-528"><a href="#cb41-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb41-529"><a href="#cb41-529" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb41-530"><a href="#cb41-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-531"><a href="#cb41-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-532"><a href="#cb41-532" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trace plots</span></span>
<span id="cb41-533"><a href="#cb41-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-534"><a href="#cb41-534" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb41-535"><a href="#cb41-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-536"><a href="#cb41-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb41-537"><a href="#cb41-537" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb41-538"><a href="#cb41-538" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span>
<span id="cb41-539"><a href="#cb41-539" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"param[626,1]"</span>,<span class="st">"param[626,2]"</span>))) </span>
<span id="cb41-540"><a href="#cb41-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-541"><a href="#cb41-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-542"><a href="#cb41-542" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (figures)</span></span>
<span id="cb41-543"><a href="#cb41-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-544"><a href="#cb41-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb41-545"><a href="#cb41-545" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb41-546"><a href="#cb41-546" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span>
<span id="cb41-547"><a href="#cb41-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-548"><a href="#cb41-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-549"><a href="#cb41-549" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fits</span></span>
<span id="cb41-550"><a href="#cb41-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-551"><a href="#cb41-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-gof-plots}</span></span>
<span id="cb41-552"><a href="#cb41-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-553"><a href="#cb41-553" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb41-554"><a href="#cb41-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-555"><a href="#cb41-555" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb41-556"><a href="#cb41-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb41-557"><a href="#cb41-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb41-558"><a href="#cb41-558" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb41-559"><a href="#cb41-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb41-560"><a href="#cb41-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-561"><a href="#cb41-561" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb41-562"><a href="#cb41-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-563"><a href="#cb41-563" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb41-564"><a href="#cb41-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb41-565"><a href="#cb41-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb41-566"><a href="#cb41-566" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb41-567"><a href="#cb41-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb41-568"><a href="#cb41-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-569"><a href="#cb41-569" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb41-570"><a href="#cb41-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb41-571"><a href="#cb41-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb41-572"><a href="#cb41-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb41-573"><a href="#cb41-573" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb41-574"><a href="#cb41-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-575"><a href="#cb41-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb41-576"><a href="#cb41-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb41-577"><a href="#cb41-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb41-578"><a href="#cb41-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-579"><a href="#cb41-579" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb41-580"><a href="#cb41-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb41-581"><a href="#cb41-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb41-582"><a href="#cb41-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb41-583"><a href="#cb41-583" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb41-584"><a href="#cb41-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-585"><a href="#cb41-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb41-586"><a href="#cb41-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb41-587"><a href="#cb41-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb41-588"><a href="#cb41-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-589"><a href="#cb41-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-590"><a href="#cb41-590" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb41-591"><a href="#cb41-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-592"><a href="#cb41-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-593"><a href="#cb41-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-594"><a href="#cb41-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-595"><a href="#cb41-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-predictions}</span></span>
<span id="cb41-596"><a href="#cb41-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-597"><a href="#cb41-597" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb41-598"><a href="#cb41-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-599"><a href="#cb41-599" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb41-600"><a href="#cb41-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-601"><a href="#cb41-601" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb41-602"><a href="#cb41-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb41-603"><a href="#cb41-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb41-604"><a href="#cb41-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb41-605"><a href="#cb41-605" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-606"><a href="#cb41-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb41-607"><a href="#cb41-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb41-608"><a href="#cb41-608" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-609"><a href="#cb41-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb41-610"><a href="#cb41-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb41-611"><a href="#cb41-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb41-612"><a href="#cb41-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb41-613"><a href="#cb41-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb41-614"><a href="#cb41-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-615"><a href="#cb41-615" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb41-616"><a href="#cb41-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-617"><a href="#cb41-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-618"><a href="#cb41-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions}</span></span>
<span id="cb41-619"><a href="#cb41-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-620"><a href="#cb41-620" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb41-621"><a href="#cb41-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-622"><a href="#cb41-622" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gq_df <span class="sc">%&gt;%</span></span>
<span id="cb41-623"><a href="#cb41-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-624"><a href="#cb41-624" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb41-625"><a href="#cb41-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb41-626"><a href="#cb41-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb41-627"><a href="#cb41-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb41-628"><a href="#cb41-628" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-629"><a href="#cb41-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb41-630"><a href="#cb41-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb41-631"><a href="#cb41-631" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-632"><a href="#cb41-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb41-633"><a href="#cb41-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb41-634"><a href="#cb41-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb41-635"><a href="#cb41-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb41-636"><a href="#cb41-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb41-637"><a href="#cb41-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-638"><a href="#cb41-638" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb41-639"><a href="#cb41-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-640"><a href="#cb41-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-641"><a href="#cb41-641" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual Parameters and etaplots</span></span>
<span id="cb41-642"><a href="#cb41-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-643"><a href="#cb41-643" aria-hidden="true" tabindex="-1"></a>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</span>
<span id="cb41-644"><a href="#cb41-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-645"><a href="#cb41-645" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual parameters</span></span>
<span id="cb41-646"><a href="#cb41-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-647"><a href="#cb41-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iparam-column-neutral}</span></span>
<span id="cb41-648"><a href="#cb41-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-649"><a href="#cb41-649" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gq_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gq_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^sparam_ind"</span>, </span>
<span id="cb41-650"><a href="#cb41-650" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gq_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb41-652"><a href="#cb41-652" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb41-653"><a href="#cb41-653" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb41-654"><a href="#cb41-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-655"><a href="#cb41-655" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb41-656"><a href="#cb41-656" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb41-657"><a href="#cb41-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-658"><a href="#cb41-658" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb41-659"><a href="#cb41-659" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb41-660"><a href="#cb41-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-661"><a href="#cb41-661" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb41-662"><a href="#cb41-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-663"><a href="#cb41-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-664"><a href="#cb41-664" aria-hidden="true" tabindex="-1"></a><span class="fu">### Etas</span></span>
<span id="cb41-665"><a href="#cb41-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-666"><a href="#cb41-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ieta}</span></span>
<span id="cb41-667"><a href="#cb41-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-668"><a href="#cb41-668" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gq_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gq_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^seta_ind"</span>, </span>
<span id="cb41-669"><a href="#cb41-669" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gq_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb41-670"><a href="#cb41-670" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb41-671"><a href="#cb41-671" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nAnalytes,]</span>
<span id="cb41-672"><a href="#cb41-672" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes),]</span>
<span id="cb41-673"><a href="#cb41-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-674"><a href="#cb41-674" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs)</span>
<span id="cb41-675"><a href="#cb41-675" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb41-676"><a href="#cb41-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-677"><a href="#cb41-677" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb41-678"><a href="#cb41-678" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb41-679"><a href="#cb41-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-680"><a href="#cb41-680" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb41-681"><a href="#cb41-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-682"><a href="#cb41-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-683"><a href="#cb41-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-684"><a href="#cb41-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r info}</span></span>
<span id="cb41-685"><a href="#cb41-685" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb41-686"><a href="#cb41-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>