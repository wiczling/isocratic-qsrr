<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2025-05-08">

<title>QSRR revisited. Model 002</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="model-development-002_files/libs/clipboard/clipboard.min.js"></script>
<script src="model-development-002_files/libs/quarto-html/quarto.js"></script>
<script src="model-development-002_files/libs/quarto-html/popper.min.js"></script>
<script src="model-development-002_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="model-development-002_files/libs/quarto-html/anchor.min.js"></script>
<link href="model-development-002_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="model-development-002_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model-development-002_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model-development-002_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model-development-002_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introductions" id="toc-introductions" class="nav-link active" data-scroll-target="#introductions">Introductions</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#prepare-data" id="toc-prepare-data" class="nav-link" data-scroll-target="#prepare-data">Prepare data</a></li>
  <li><a href="#initial-estimates" id="toc-initial-estimates" class="nav-link" data-scroll-target="#initial-estimates">Initial estimates</a></li>
  </ul></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data analysis</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#priors" id="toc-priors" class="nav-link" data-scroll-target="#priors">Priors</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  </ul></li>
  <li><a href="#genereted-quantitites" id="toc-genereted-quantitites" class="nav-link" data-scroll-target="#genereted-quantitites">Genereted quantitites</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#load" id="toc-load" class="nav-link" data-scroll-target="#load">Load</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  <li><a href="#fits" id="toc-fits" class="nav-link" data-scroll-target="#fits">Fits</a></li>
  <li><a href="#individual-parameters-and-etaplots" id="toc-individual-parameters-and-etaplots" class="nav-link" data-scroll-target="#individual-parameters-and-etaplots">Individual Parameters and etaplots</a>
  <ul class="collapse">
  <li><a href="#individual-parameters" id="toc-individual-parameters" class="nav-link" data-scroll-target="#individual-parameters">Individual parameters</a></li>
  <li><a href="#etas" id="toc-etas" class="nav-link" data-scroll-target="#etas">Etas</a></li>
  <li><a href="#effect-of-functional-groups" id="toc-effect-of-functional-groups" class="nav-link" data-scroll-target="#effect-of-functional-groups">Effect of functional groups</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">QSRR revisited. Model 002</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 8, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introductions" class="level1">
<h1>Introductions</h1>
<p>…</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr.bayes)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'dplyr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'ggplot2' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'patchwork' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'gridExtra' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'naniar' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'knitr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tidyverse' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tibble' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tidyr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'readr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'purrr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'stringr' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'forcats' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'lubridate' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'glue' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(whisker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'whisker' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'here' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'posterior' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'bayesplot' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'tidybayes' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'reshape2' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'pracma' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mrgmisc)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakiet 'GGally' został zbudowany w wersji R 4.3.3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("metrumresearchgroup/mrgmisc")</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/GUMed/.cmdstan/cmdstan-2.36.0"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10271998</span>) <span class="do">## not required but assures repeatable results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>model_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>,<span class="st">"stan"</span>)  </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>tables_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_dir)) <span class="fu">dir.create</span>(tables_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>data_deliv_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"deliv"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>data_derived_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"derived"</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_deliv_dir)) <span class="fu">dir.create</span>(data_deliv_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_derived_dir)) <span class="fu">dir.create</span>(data_derived_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>figures_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>tables_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_eda_dir)) <span class="fu">dir.create</span>(figures_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_eda_dir)) <span class="fu">dir.create</span>(tables_eda_dir, <span class="at">recursive =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35^{}C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient.</p>
<p>The values of molecular mass MM were added to the dataset. They were calculated using <a href="www.acdlabs.com">ACD/Labs program</a> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8. The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</p>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir, <span class="st">"database_logk_1026.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"database_logk_1026_analyte_names.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"smiles1026.smi"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># functional_groups = read.csv(here(data_deliv_dir, 'checkmol_functional_groups.csv'))</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># functional_groups_names = read.csv(here(data_deliv_dir,'checkmol_functional_group_names.csv'))</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">'ACD_pKas.csv'</span>))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"pH.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(logP_ACD)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>MW <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(MW_ACD)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(data_ACD<span class="sc">$</span>logP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># results = read.csv(file = here(data_deliv_dir,"results_table_max_frag_size.csv"), header = TRUE)</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_table = read.csv(file = here(data_deliv_dir,"comparison_table.csv"), header = TRUE)</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_table_add = read.csv(file = here(data_deliv_dir,"comparison_table_add.csv"), header = TRUE)</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_table_remove = read.csv(file = here(data_deliv_dir,"comparison_table_remove.csv"), header = TRUE)</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>fg_df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>fg_df_common1 <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups_common1.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>fg_df_common2 <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups_common2.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>descriptor_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"descriptor_df.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>smiles<span class="ot">&lt;-</span>smiles <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ID=</span>V2,<span class="at">smiles=</span>V1) <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID,smiles)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">905</span>] <span class="ot">=</span> <span class="st">"CN(C1CCCCC1N1CCCC1)C(=O)Cc1ccc(c(c1)Cl)Cl"</span> <span class="co"># remove tartrate moiety </span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">425</span>] <span class="ot">=</span> <span class="st">"CC(Cc1ccc(cc1)OCC(=O)O)NCC(c1cccc(c1)Cl)O"</span> <span class="co"># remove Na+ and dissociation</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">501</span>] <span class="ot">=</span> <span class="st">"c1ccc(cc1)C1(c2ccccc2)C(=O)NC(=N1)O"</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">401</span>]<span class="ot">=</span> <span class="st">"CC(C)(C)c1c(CC(C(=O)[OH])[NH2])c(=O)[nH]o1"</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">686</span>] <span class="ot">=</span> <span class="st">"CCCCCCCCCCCCCCCC(=O)OC(CC(=O)[OH])C[N+](C)(C)C"</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">901</span>] <span class="ot">=</span> <span class="st">"CCOC(=Nc1c[n+](no1)N1CCOCC1)[OH]"</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>analytes_names<span class="sc">$</span>Analyte <span class="ot">&lt;-</span> <span class="fu">iconv</span>(analytes_names<span class="sc">$</span>Analyte, <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">"byte"</span>)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="co"># functional_groups_lf = functional_groups %&gt;%</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(ID = 1:n(), .before = "cation")%&gt;%</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cation:last_col(), values_to = "Ngroups", names_to = c("fgrp")) %&gt;%</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Ngroups&gt;0)</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>dissociated_groups <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Anions</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sulfonic_acid"</span>, <span class="st">"Sulfinic_acid"</span>, <span class="st">"Sulfenic_acid"</span>, <span class="st">"Sulfuric_acid"</span>, <span class="st">"Sulfuric_monoester"</span>,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonic_acid"</span>, <span class="st">"Phosphoric_acid"</span>, <span class="st">"Phosphoric_monoester"</span>, <span class="st">"Phosphinic_acid"</span>,</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonous_acid"</span>, <span class="st">"Phosphinous_acid"</span>, <span class="st">"Carbothioic_acid"</span>, <span class="st">"Carbodithioic_acid"</span>,</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cations</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Primary_aliph_amine"</span>, <span class="st">"Secondary_aliph_amine"</span>, <span class="st">"Tertiary_aliph_amine"</span>, </span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Quaternary_aliph_ammonium"</span>, <span class="st">"Primary_arom_amine"</span>, <span class="st">"Secondary_arom_amine"</span>, </span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_arom_amine"</span>, <span class="st">"Quaternary_arom_ammonium"</span>, <span class="st">"Secondary_mixed_amine"</span>, </span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_mixed_amine"</span>, <span class="st">"Quaternary_mixed_ammonium"</span>, <span class="st">"Oxonium"</span>, </span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Immonium"</span>, <span class="st">"Sulfonium"</span>, <span class="st">"Phosphonium"</span>, <span class="st">"Hetero_N_basic_H"</span>, <span class="st">"Hetero_N_basic_no_H"</span>, <span class="st">"Guanidine"</span>, <span class="st">"Hydrazine"</span>, <span class="st">"Hydroxylamine"</span>, </span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diazonium"</span>, <span class="st">"N-Oxide"</span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data">Prepare data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> fg_df<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.) <span class="sc">||</span> <span class="sc">!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id1,<span class="sc">-</span>id2,<span class="sc">-</span>SMILES, <span class="sc">-</span>Anion, <span class="sc">-</span>Kation,<span class="sc">-</span>Ammonium )</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> <span class="fu">colnames</span>(functional_groups)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>dissociation <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="at">pKaslit =</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>],           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="at">pKasliterror =</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>],    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="at">chargesA =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>]),    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="at">chargesB =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]))   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>charges <span class="ot">=</span> dissociation<span class="sc">$</span>chargesA<span class="sc">+</span>dissociation<span class="sc">$</span>chargesB                  <span class="co"># absolute charge</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsA <span class="ot">=</span> (dissociation<span class="sc">$</span>chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsB <span class="ot">=</span> <span class="sc">-</span>(dissociation<span class="sc">$</span>chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># number of dissociation steps</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groups <span class="ot">=</span> dissociation<span class="sc">$</span>groupsB<span class="sc">-</span>dissociation<span class="sc">$</span>groupsA</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>logPobs <span class="ot">=</span>data_ACD<span class="sc">$</span>logP</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>MW <span class="ot">=</span>data_ACD<span class="sc">$</span>MW</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsA)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitA<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsA]</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsB)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitB<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsB]</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span>]</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesB[,<span class="fu">max</span>(dissociation<span class="sc">$</span>R)]</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxA0)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxB0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="initial-estimates" class="level2">
<h2 class="anchored" data-anchor-id="initial-estimates">Initial estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-analysis" class="level1">
<h1>Data analysis</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a …</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk_{i,j}  = logkw_{i} - S_{1,i} \cdot (1 + S_{2}) \cdot \varphi_{i,j} / (1 + S_{2} \cdot \varphi_{i,j})
\end{aligned}
\]</span> The statistical model has the following structure (hierarchical model):</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \log k_{obs_{i,j}} \sim student_t(\nu,logk_{i,j},\sigma) \\
&amp; R_{i} \sim \text{MVN}(\theta_R  + \beta \cdot log P_i , \Omega) \\
\end{aligned}
\]</span> Needs improvements!! where <span class="math inline">\(R_i=(logkw_{i}, S_{1,i})\)</span> is a vector of subject-specific parameters, <span class="math inline">\(logk_{i,j}\)</span> corresponds to the above Neue equation, <span class="math inline">\(MVN\)</span> is a multivariate normal distribution, <span class="math inline">\(\theta_P\)</span> is a vector of typical values of <span class="math inline">\(R_i\)</span>, <span class="math inline">\(beta_R\)</span> is a vector of slopes between <span class="math inline">\(R_i\)</span> and <span class="math inline">\(logP_i\)</span>. In turn, <span class="math inline">\(\sigma\)</span> is the scale and <span class="math inline">\(\Omega\)</span> is the scale matrix for the random effects related to the residual and unexplained between-analyte variability. <span class="math inline">\(\Omega\)</span> was decomposed to:</p>
<p><span class="math display">\[
\Omega = diag(\omega) \cdot \rho \cdot diag(\omega)
\]</span></p>
<p>where <span class="math inline">\(\rho\)</span> denotes correlation a correlation matrix and <span class="math inline">\(\omega\)</span> denotes standard deviation for between analyte variability.</p>
</section>
<section id="priors" class="level2">
<h2 class="anchored" data-anchor-id="priors">Priors</h2>
<p>The priors were specified as follows:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \theta_{logkw} \sim normal(2, 4), \\
&amp; \theta_{S1} \sim normal(4, 2), \\
&amp; \theta_{S2} \sim lognormal(0.693, 0.125), \\
&amp; \nu = 7,\\
&amp; \omega_{logkw},\omega_{S1} \sim normal_+(0, 1), \\
&amp; \beta_{logkw} \sim  normal(0.7, 0.125), \\
&amp; \beta_{S1} \sim  normal(0.5, 0.125), \\
&amp; \sigma \sim normal_+(0,0.05), \\
&amp; p(\rho) \propto LKJ(2) \cdot \Pi_u N(c_u, 0.125), \\
&amp; c_u = [0.75]
\end{aligned}
\]</span></p>
<p>LKJ(2) ensure that the density is uniform over correlation matrices of order 2 and u denotes the unique lower triangular elements of correlation matrix (<a href="http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/" class="uri">http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/</a>)</p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">=</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>data_ACD<span class="sc">$</span>logP,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups[,],</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>          <span class="co">#param = cbind(matrix(2, 1, nrow=nSteps), matrix(5, 1, nrow=nSteps)),</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<p>We compiled the model using cmdstanr:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod2"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used optimization for initial testing:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="st">"mod2-opt"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">1000</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-opt-1.csv"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID),<span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/plots-optimize-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>For local computations one can use cmdstanr:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="st">"mod2-loc"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a> fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="fu">here</span>(mod_output_dir,<span class="st">"mod2-loc.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We performed out computations at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>. In this case:</p>
<ol type="1">
<li>we dumped the necessary data to .json format</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>we run the model using the batch file:</li>
</ol>
<pre> 
</pre>
<ol start="3" type="1">
<li>After calculations, we loaded the output files using cmdstanr.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(mod_output_dir)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod2-*.csv'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The diagnostics are reasonable given model complexity. Output copied here to save time:</p>
<pre></pre>
</section>
<section id="summary-of-model-parameters-table" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     variable     mean   median    sd   mad       q5      q95 rhat ess_bulk
 lp__         11508.84 11510.20 46.47 45.52 11430.80 11583.50 1.01      944
 logkwHat         2.37     2.36  0.16  0.16     2.10     2.63 1.00     4157
 S1Hat            3.02     3.02  0.14  0.14     2.79     3.25 1.00     3805
 S2Hat            2.90     2.90  0.03  0.03     2.85     2.96 1.01      571
 beta[1]          0.62     0.62  0.04  0.04     0.56     0.68 1.00     3551
 beta[2]          0.38     0.38  0.03  0.03     0.33     0.43 1.00     3213
 omega[1]         1.31     1.31  0.03  0.03     1.26     1.37 1.00     3091
 omega[2]         1.08     1.08  0.03  0.03     1.04     1.13 1.00     2698
 rho[1,1]         1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 rho[2,1]         0.88     0.88  0.01  0.01     0.86     0.90 1.00     2381
 rho[1,2]         0.88     0.88  0.01  0.01     0.86     0.90 1.00     2381
 rho[2,2]         1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 sigma            0.05     0.05  0.00  0.00     0.05     0.05 1.00     1952
 pilogkw[1]       0.32     0.32  0.04  0.04     0.26     0.39 1.00     3900
 pilogkw[2]       0.25     0.25  0.02  0.02     0.21     0.29 1.00     4060
 pilogkw[3]      -0.14    -0.14  0.07  0.07    -0.25    -0.02 1.00     7230
 pilogkw[4]      -0.05    -0.05  0.09  0.09    -0.20     0.11 1.00     7605
 pilogkw[5]       0.10     0.10  0.07  0.07    -0.02     0.22 1.00     8971
 pilogkw[6]      -0.03    -0.03  0.17  0.17    -0.32     0.26 1.00     9367
 pilogkw[7]       0.08     0.08  0.16  0.16    -0.19     0.35 1.00     7339
 pilogkw[8]       0.29     0.29  0.10  0.09     0.13     0.45 1.00     8671
 pilogkw[9]       0.03     0.03  0.26  0.26    -0.40     0.44 1.00     7210
 pilogkw[10]      0.01     0.01  0.14  0.14    -0.22     0.23 1.00     9223
 pilogkw[11]      0.10     0.10  0.11  0.11    -0.08     0.28 1.00     6400
 pilogkw[12]      0.01     0.01  0.15  0.15    -0.24     0.25 1.00     7141
 pilogkw[13]      0.18     0.18  0.14  0.14    -0.06     0.41 1.00     8236
 pilogkw[14]      0.21     0.21  0.20  0.20    -0.11     0.54 1.00     5785
 pilogkw[15]      0.16     0.16  0.05  0.05     0.07     0.25 1.00     7753
 pilogkw[16]      0.22     0.21  0.16  0.17    -0.05     0.49 1.00     8079
 pilogkw[17]      0.17     0.17  0.18  0.19    -0.13     0.48 1.00     8069
 pilogkw[18]      0.13     0.12  0.20  0.20    -0.21     0.46 1.00     8152
 pilogkw[19]     -0.55    -0.55  0.16  0.16    -0.82    -0.29 1.00     5978
 pilogkw[20]     -0.75    -0.75  0.16  0.16    -1.01    -0.47 1.00     5588
 pilogkw[21]     -0.88    -0.88  0.12  0.11    -1.07    -0.69 1.00     5358
 pilogkw[22]      0.08     0.08  0.21  0.21    -0.26     0.41 1.00     5562
 pilogkw[23]     -0.13    -0.13  0.13  0.13    -0.35     0.09 1.00     8430
 pilogkw[24]      0.00     0.00  0.23  0.23    -0.37     0.38 1.00     8044
 pilogkw[25]      0.00     0.00  0.20  0.19    -0.33     0.32 1.00     7422
 pilogkw[26]     -0.06    -0.06  0.17  0.17    -0.34     0.22 1.00     7605
 pilogkw[27]     -0.25    -0.24  0.28  0.27    -0.71     0.21 1.00     5746
 pilogkw[28]      0.02     0.01  0.24  0.24    -0.39     0.43 1.00     7782
 pilogkw[29]     -0.07    -0.07  0.17  0.17    -0.34     0.20 1.00     9053
 pilogkw[30]      0.46     0.46  0.15  0.15     0.21     0.70 1.00     7319
 pilogkw[31]      0.23     0.23  0.25  0.25    -0.17     0.64 1.00     6980
 pilogkw[32]      0.08     0.07  0.25  0.25    -0.33     0.49 1.00     7147
 pilogkw[33]      0.19     0.19  0.11  0.11     0.01     0.38 1.00     6932
 pilogkw[34]     -0.12    -0.12  0.23  0.24    -0.50     0.27 1.00     6760
 pilogkw[35]      0.04     0.04  0.26  0.26    -0.40     0.46 1.00     8471
 pilogkw[36]      0.02     0.01  0.20  0.20    -0.30     0.34 1.00     8933
 pilogkw[37]      0.16     0.16  0.19  0.19    -0.16     0.47 1.00     7947
 pilogkw[38]      0.17     0.17  0.27  0.26    -0.27     0.61 1.00     7126
 pilogkw[39]     -0.15    -0.15  0.18  0.18    -0.46     0.14 1.00     8341
 pilogkw[40]      0.13     0.13  0.18  0.18    -0.16     0.43 1.00     8125
 pilogkw[41]      0.03     0.03  0.17  0.17    -0.24     0.29 1.00     7786
 pilogkw[42]      0.05     0.05  0.23  0.23    -0.33     0.42 1.00     9638
 pilogkw[43]      0.05     0.05  0.23  0.23    -0.32     0.43 1.00     8248
 pilogkw[44]     -0.16    -0.16  0.26  0.26    -0.60     0.27 1.00     6584
 pilogkw[45]      0.06     0.05  0.20  0.20    -0.27     0.38 1.00     8563
 pilogkw[46]      0.00     0.00  0.26  0.26    -0.43     0.44 1.00     7609
 pilogkw[47]      0.09     0.09  0.19  0.19    -0.22     0.41 1.00     6998
 pilogkw[48]      0.02     0.02  0.19  0.18    -0.30     0.32 1.00     8647
 pilogkw[49]     -0.03    -0.02  0.23  0.22    -0.40     0.34 1.00     7564
 pilogkw[50]      0.17     0.18  0.19  0.19    -0.14     0.47 1.00     8792
 pilogkw[51]      0.04     0.04  0.26  0.26    -0.38     0.46 1.00     7937
 pilogkw[52]     -0.05    -0.05  0.10  0.10    -0.21     0.12 1.00     7087
 pilogkw[53]      0.27     0.27  0.11  0.11     0.08     0.45 1.00     7933
 pilogkw[54]      0.01     0.01  0.17  0.16    -0.26     0.28 1.00     8551
 pilogkw[55]     -0.06    -0.06  0.25  0.26    -0.48     0.35 1.00     7896
 pilogkw[56]     -0.07    -0.07  0.20  0.20    -0.41     0.25 1.00     7549
 pilogkw[57]      0.13     0.13  0.11  0.11    -0.05     0.31 1.00    10161
 pilogkw[58]     -0.01    -0.01  0.15  0.15    -0.25     0.24 1.00     9430
 pilogkw[59]     -0.09    -0.09  0.15  0.15    -0.33     0.16 1.00     9359
 pilogkw[60]      0.06     0.06  0.20  0.20    -0.27     0.38 1.00     8025
 pilogkw[61]     -0.05    -0.04  0.22  0.21    -0.40     0.31 1.00     7729
 pilogkw[62]     -0.05    -0.05  0.25  0.25    -0.48     0.35 1.00     8702
 pilogkw[63]     -0.58    -0.58  0.19  0.19    -0.90    -0.27 1.00     6641
 pilogkw[64]     -0.09    -0.09  0.25  0.25    -0.51     0.34 1.00     7775
 pilogkw[65]      0.03     0.03  0.25  0.25    -0.36     0.44 1.00     6903
 pilogkw[66]      0.01     0.01  0.25  0.26    -0.40     0.42 1.00     7133
 pilogkw[67]     -0.12    -0.12  0.25  0.24    -0.53     0.29 1.00     7401
 pilogkw[68]      0.31     0.30  0.15  0.14     0.07     0.53 1.00     8400
 pilogkw[69]      0.29     0.28  0.24  0.25    -0.10     0.68 1.00     5988
 pilogkw[70]     -0.30    -0.30  0.14  0.14    -0.52    -0.07 1.00     8021
 pilogkw[71]      0.14     0.14  0.19  0.19    -0.17     0.44 1.00     6667
 pilogkw[72]     -0.03    -0.03  0.20  0.19    -0.36     0.29 1.00     8308
 pilogkw[73]      0.38     0.38  0.22  0.21     0.04     0.74 1.00     6194
 pilogkw[74]     -0.04    -0.04  0.25  0.25    -0.46     0.37 1.00     8454
 pilogkw[75]      0.22     0.22  0.23  0.24    -0.15     0.62 1.00     7665
 pilogkw[76]     -0.05    -0.05  0.26  0.25    -0.48     0.37 1.00     8563
 pilogkw[77]     -0.02    -0.02  0.26  0.26    -0.43     0.41 1.00     6939
 pilogkw[78]      0.13     0.13  0.18  0.19    -0.17     0.44 1.00     7466
 pilogkw[79]     -0.03    -0.03  0.26  0.26    -0.46     0.39 1.00     6844
 pilogkw[80]     -0.01     0.00  0.15  0.15    -0.26     0.24 1.00     7812
 pilogkw[81]     -0.05    -0.04  0.24  0.24    -0.46     0.35 1.00     7102
 pilogkw[82]      0.03     0.03  0.24  0.25    -0.37     0.43 1.00     6704
 pilogkw[83]     -0.40    -0.40  0.19  0.19    -0.72    -0.08 1.00     6065
 pilogkw[84]     -0.51    -0.51  0.17  0.17    -0.80    -0.23 1.00     5989
 pilogkw[85]      0.00     0.00  0.14  0.14    -0.24     0.24 1.00     8815
 pilogkw[86]      0.06     0.06  0.24  0.24    -0.35     0.45 1.00     8379
 pilogkw[87]      0.00    -0.01  0.25  0.25    -0.41     0.40 1.00     8105
 pilogkw[88]      0.14     0.13  0.26  0.25    -0.28     0.57 1.01     7203
 pilogkw[89]     -0.21    -0.21  0.07  0.07    -0.33    -0.09 1.00     7661
 pilogkw[90]     -0.11    -0.11  0.16  0.16    -0.39     0.15 1.00     7790
 pilogkw[91]      0.27     0.27  0.07  0.07     0.15     0.39 1.00     7093
 pilogkw[92]      0.20     0.20  0.13  0.12    -0.01     0.41 1.00     8887
 pilogkw[93]      0.00     0.00  0.19  0.19    -0.31     0.31 1.00     8461
 pilogkw[94]     -0.05    -0.05  0.19  0.19    -0.37     0.28 1.00     8206
 pilogkw[95]      0.10     0.10  0.26  0.26    -0.33     0.53 1.00     7018
 pilogkw[96]     -0.37    -0.37  0.24  0.23    -0.77     0.01 1.00     6492
 pilogkw[97]     -0.05    -0.04  0.13  0.13    -0.27     0.17 1.00     6973
 pilogkw[98]     -0.43    -0.43  0.15  0.15    -0.67    -0.18 1.00     6098
 pilogkw[99]      0.13     0.13  0.15  0.15    -0.12     0.36 1.00     6462
 pilogkw[100]    -0.19    -0.19  0.14  0.14    -0.42     0.03 1.00     6621
 pilogkw[101]     0.23     0.23  0.17  0.17    -0.05     0.50 1.00     7314
 pilogkw[102]     0.09     0.08  0.19  0.18    -0.22     0.39 1.00     8477
 pilogkw[103]    -0.19    -0.19  0.13  0.13    -0.40     0.03 1.00     6426
 pilogkw[104]     0.01     0.01  0.26  0.25    -0.41     0.44 1.01     7212
 pilogkw[105]     0.27     0.26  0.16  0.16     0.01     0.53 1.00     8718
 pilogkw[106]     0.02     0.02  0.26  0.25    -0.41     0.45 1.00     7676
 pilogkw[107]     0.07     0.08  0.25  0.25    -0.33     0.48 1.01     7526
 pilogkw[108]     0.03     0.02  0.26  0.25    -0.39     0.46 1.01     8268
 pilogkw[109]    -0.06    -0.06  0.24  0.23    -0.46     0.34 1.00     7297
 pilogkw[110]    -0.20    -0.20  0.25  0.24    -0.61     0.21 1.00     6496
 pilogkw[111]     0.04     0.05  0.25  0.26    -0.37     0.46 1.00     7816
 pilogkw[112]     0.00     0.00  0.23  0.23    -0.38     0.37 1.00     7633
 pilogkw[113]    -0.20    -0.20  0.23  0.24    -0.60     0.18 1.00     5953
 pilogkw[114]    -0.07    -0.07  0.24  0.24    -0.48     0.33 1.00     7062
 pilogkw[115]     0.07     0.07  0.23  0.23    -0.30     0.44 1.00     7691
 pilogkw[116]     0.08     0.07  0.23  0.23    -0.29     0.45 1.00     5709
 pilogkw[117]     0.02     0.02  0.17  0.17    -0.26     0.31 1.00     7917
 pilogkw[118]    -0.02    -0.02  0.26  0.25    -0.45     0.40 1.00     8117
 pilogkw[119]     0.44     0.43  0.27  0.27     0.01     0.89 1.00     5220
 pilogkw[120]     0.04     0.04  0.26  0.26    -0.37     0.47 1.00     6634
 pilogkw[121]     0.02     0.02  0.25  0.25    -0.39     0.43 1.00     6726
 pilogkw[122]     0.04     0.05  0.22  0.23    -0.33     0.41 1.00     7190
 pilogkw[123]    -0.02    -0.02  0.26  0.26    -0.44     0.41 1.00     8034
 pilogkw[124]     0.01     0.01  0.26  0.26    -0.41     0.44 1.00     6937
 pilogkw[125]     0.04     0.03  0.24  0.24    -0.35     0.43 1.00     7408
 pilogkw[126]    -0.06    -0.07  0.26  0.26    -0.50     0.37 1.00     7661
 pilogkw[127]     0.11     0.11  0.01  0.01     0.09     0.14 1.00     4288
 pilogkw[128]     0.13     0.13  0.06  0.06     0.04     0.23 1.00     6483
 pilogkw[129]    -0.11    -0.11  0.19  0.19    -0.43     0.20 1.00     8126
 pilogkw[130]     0.33     0.33  0.16  0.16     0.08     0.59 1.00     8095
 pilogkw[131]    -0.08    -0.08  0.04  0.04    -0.14    -0.01 1.00     7158
 pilogkw[132]     0.16     0.16  0.12  0.12    -0.03     0.36 1.00    10053
 pilogkw[133]     0.01     0.01  0.19  0.18    -0.29     0.31 1.00     7382
 pilogkw[134]     0.17     0.17  0.22  0.22    -0.19     0.52 1.00     6966
 pilogkw[135]     0.17     0.16  0.27  0.27    -0.27     0.62 1.00     6599
 pilogkw[136]     0.07     0.07  0.03  0.03     0.03     0.12 1.00     6855
 pilogkw[137]     0.07     0.07  0.15  0.15    -0.18     0.32 1.00     9609
 pilogkw[138]    -0.07    -0.07  0.26  0.26    -0.50     0.35 1.00     7568
 pilogkw[139]     0.21     0.21  0.23  0.23    -0.16     0.61 1.00     7282
 pilogkw[140]    -0.20    -0.20  0.27  0.26    -0.65     0.23 1.00     7599
 pilogkw[141]     0.22     0.23  0.22  0.22    -0.14     0.59 1.00     8368
 pilogkw[142]     0.03     0.03  0.09  0.09    -0.12     0.19 1.00     7839
 pilogkw[143]     0.14     0.14  0.21  0.21    -0.21     0.49 1.01     7896
 piS1[1]          0.29     0.29  0.03  0.03     0.24     0.35 1.00     4312
 piS1[2]          0.27     0.27  0.02  0.02     0.23     0.30 1.00     4650
 piS1[3]         -0.06    -0.06  0.06  0.06    -0.16     0.03 1.00     7103
 piS1[4]          0.00     0.00  0.08  0.08    -0.13     0.13 1.00     6904
 piS1[5]          0.20     0.20  0.06  0.06     0.10     0.30 1.00     7070
 piS1[6]          0.10     0.10  0.14  0.14    -0.13     0.33 1.00    10008
 piS1[7]          0.17     0.16  0.14  0.14    -0.05     0.40 1.00     7364
 piS1[8]          0.32     0.32  0.08  0.08     0.19     0.45 1.00     7742
 piS1[9]         -0.02    -0.02  0.20  0.20    -0.36     0.31 1.00     8249
 piS1[10]        -0.01    -0.01  0.12  0.12    -0.21     0.17 1.00     9523
 piS1[11]         0.28     0.28  0.09  0.09     0.13     0.43 1.00     6026
 piS1[12]         0.01     0.01  0.12  0.12    -0.20     0.21 1.00     8046
 piS1[13]         0.20     0.20  0.12  0.12     0.01     0.40 1.00     7771
 piS1[14]         0.50     0.49  0.17  0.16     0.23     0.78 1.00     4733
 piS1[15]         0.16     0.16  0.05  0.05     0.08     0.23 1.00     7515
 piS1[16]         0.15     0.15  0.14  0.14    -0.08     0.38 1.00     7542
 piS1[17]         0.15     0.15  0.15  0.15    -0.11     0.40 1.00     7109
 piS1[18]         0.05     0.05  0.16  0.16    -0.22     0.32 1.00     7981
 piS1[19]         0.40     0.40  0.14  0.14     0.17     0.63 1.01     5103
 piS1[20]         0.47     0.47  0.14  0.14     0.25     0.70 1.00     4877
 piS1[21]         0.30     0.30  0.09  0.09     0.14     0.45 1.00     5212
 piS1[22]         0.54     0.54  0.18  0.19     0.25     0.85 1.00     4036
 piS1[23]         0.18     0.17  0.11  0.11    -0.01     0.37 1.00     7354
 piS1[24]         0.01     0.00  0.18  0.18    -0.30     0.30 1.00     6987
 ess_tail
     1406
     3516
     3520
     1076
     3721
     3646
     3009
     2856
       NA
     3045
     3045
       NA
     2559
     3407
     3687
     3191
     3287
     3247
     3267
     3475
     3061
     2996
     3393
     3295
     3378
     3507
     3185
     3069
     3434
     3427
     3100
     3329
     3336
     3461
     3550
     3548
     3387
     3298
     3441
     2863
     3216
     3392
     3725
     2985
     3306
     3072
     3216
     2718
     3254
     2724
     2673
     3325
     3330
     3657
     3392
     2791
     2709
     2792
     3248
     3401
     2836
     3115
     3108
     2956
     3065
     3248
     3265
     3191
     3276
     3422
     3152
     3108
     3253
     3071
     2847
     3245
     2673
     2826
     3063
     3027
     3290
     2998
     3267
     3026
     2975
     3372
     3086
     3438
     3034
     2661
     3477
     2905
     2926
     2727
     3026
     3150
     3418
     3378
     2950
     2848
     2780
     3629
     3636
     3557
     3580
     3319
     3139
     2726
     3429
     3259
     3563
     3536
     3440
     3453
     3279
     3278
     2900
     3076
     2949
     2894
     2711
     2952
     2902
     3092
     3289
     3303
     2855
     3332
     3465
     3375
     2560
     3329
     2546
     2798
     3332
     2712
     2743
     3111
     2651
     3659
     3232
     3648
     3415
     3804
     3395
     3262
     3382
     3187
     3547
     3227
     3025
     2980
     2893
     3352
     3375
     2907
     3289
     3800
     3473
     3550
     3163
     3527
     2929
     3559
     2638
     3555
     3488
     3182
     3006
     3476
     3229
     3427
     3394
     3127
     3090
     3447
     3317
     3384
     3457
     3059

 # showing 180 of 9506 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
</section>
<section id="genereted-quantitites" class="level1">
<h1>Genereted quantitites</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mod2gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fitgq  <span class="ot">&lt;-</span> mod2gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="load" class="level2">
<h2 class="anchored" data-anchor-id="load">Load</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="trace-plots" class="level2">
<h2 class="anchored" data-anchor-id="trace-plots">Trace plots</h2>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"param[626,1]"</span>,<span class="st">"param[626,2]"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/trace-plots-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-figures">Summary of model parameters (figures)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/mcmc-intervals-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="fits" class="level2">
<h2 class="anchored" data-anchor-id="fits">Fits</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/ind-pop-gof-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/ind-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/pop-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-and-etaplots" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters-and-etaplots">Individual Parameters and etaplots</h2>
<p>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</p>
<section id="individual-parameters" class="level3">
<h3 class="anchored" data-anchor-id="individual-parameters">Individual parameters</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sparam_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2, param1<span class="sc">-</span>param2, datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logka'</span>[i]), <span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/iparam-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="etas" class="level3">
<h3 class="anchored" data-anchor-id="etas">Etas</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,param1<span class="sc">-</span>param2,datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etalogka'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/ieta-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="effect-of-functional-groups" class="level3">
<h3 class="anchored" data-anchor-id="effect-of-functional-groups">Effect of functional groups</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>valid_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">map</span>(valid_indices, <span class="cf">function</span>(i) {</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract functional group as a factor</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  nrgroups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(functional_groups[, i])</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for plotting</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">param1 =</span> param1,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">param2 =</span> param2,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">param3=</span> param1<span class="sc">-</span>param2,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrgroups =</span> nrgroups</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape and create plot in one pipeline</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="sc">%&gt;%</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(param1, param2, param3), </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"name"</span>, </span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">etaname =</span> <span class="fu">recode</span>(name, </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param1 =</span> <span class="st">"etalogkw"</span>, </span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param2 =</span> <span class="st">"etaS"</span>,</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param3 =</span> <span class="st">"etalogka"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> nrgroups)) <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>etaname) <span class="sc">+</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> functional_groups_names[i], </span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Nr of functional groups"</span>, </span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"eta"</span>)<span class="sc">+</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>plot_groups <span class="ot">&lt;-</span> <span class="fu">split</span>(plots, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(plots) <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each group of up to four plots</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(plot_groups, <span class="cf">function</span>(group) {</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(group, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-3.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-4.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-5.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-6.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-7.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-8.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-9.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-10.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-11.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-12.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-13.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-14.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-15.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-16.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-17.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-18.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/effect-fg-screening-19.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>param <span class="sc">%&gt;%</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="model-development-002_files/figure-html/functinoal-group-effects-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
</section>
<section id="session-info" class="level1">
<h1>Session info</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19045)

Matrix products: default


locale:
[1] LC_COLLATE=Polish_Poland.utf8  LC_CTYPE=Polish_Poland.utf8   
[3] LC_MONETARY=Polish_Poland.utf8 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.utf8    

time zone: Europe/Warsaw
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] GGally_2.2.1        mrgmisc_0.2.2       pracma_2.4.4       
 [4] reshape2_1.4.4      tidybayes_3.0.7     bayesplot_1.11.1   
 [7] posterior_1.6.0     cmdstanr_0.8.0.9000 here_1.0.1         
[10] whisker_0.4.1       glue_1.7.0          lubridate_1.9.3    
[13] forcats_1.0.0       stringr_1.5.1       purrr_1.0.2        
[16] readr_2.1.5         tidyr_1.3.1         tibble_3.2.1       
[19] tidyverse_2.0.0     data.table_1.15.4   knitr_1.46         
[22] naniar_1.1.0        gridExtra_2.3       patchwork_1.2.0    
[25] ggplot2_3.5.1       dplyr_1.1.4         bbr.bayes_0.2.0    
[28] bbr_1.10.0         

loaded via a namespace (and not attached):
 [1] gtable_0.3.5         tensorA_0.36.2.1     xfun_0.44           
 [4] htmlwidgets_1.6.4    visdat_0.6.0         processx_3.8.4      
 [7] lattice_0.21-8       tzdb_0.4.0           vctrs_0.6.5         
[10] tools_4.3.1          ps_1.7.6             generics_0.1.3      
[13] fansi_1.0.6          pkgconfig_2.0.3      checkmate_2.3.1     
[16] RColorBrewer_1.1-3   distributional_0.4.0 lifecycle_1.0.4     
[19] farver_2.1.2         compiler_4.3.1       textshaping_0.4.0   
[22] munsell_0.5.1        htmltools_0.5.8.1    yaml_2.3.8          
[25] pillar_1.9.0         crayon_1.5.2         arrayhelpers_1.1-0  
[28] abind_1.4-8          ggstats_0.8.0        svUnit_1.0.6        
[31] tidyselect_1.2.1     digest_0.6.35        stringi_1.8.4       
[34] diffobj_0.3.5        labeling_0.4.3       rprojroot_2.0.4     
[37] fastmap_1.2.0        grid_4.3.1           colorspace_2.1-0    
[40] cli_3.6.2            magrittr_2.0.3       utf8_1.2.4          
[43] withr_3.0.2          scales_1.3.0         backports_1.5.0     
[46] timechange_0.3.0     rmarkdown_2.27       matrixStats_1.3.0   
[49] ragg_1.3.2           hms_1.1.3            coda_0.19-4.1       
[52] evaluate_1.0.3       ggdist_3.3.2         viridisLite_0.4.2   
[55] rlang_1.1.3          Rcpp_1.0.12          rstudioapi_0.16.0   
[58] jsonlite_1.8.8       plyr_1.8.9           R6_2.5.1            
[61] systemfonts_1.1.0    fs_1.6.4            </code></pre>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb72" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "QSRR revisited. Model 002"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introductions</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr.bayes)</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(whisker)</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mrgmisc)</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("metrumresearchgroup/mrgmisc")</span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"C:/Users/GUMed/.cmdstan/cmdstan-2.36.0"</span>)</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10271998</span>) <span class="do">## not required but assures repeatable results</span></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r settings}</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>model_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>,<span class="st">"stan"</span>)  </span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>tables_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_dir)) <span class="fu">dir.create</span>(tables_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>data_deliv_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"deliv"</span>)</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>data_derived_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"derived"</span>)</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_deliv_dir)) <span class="fu">dir.create</span>(data_deliv_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(data_derived_dir)) <span class="fu">dir.create</span>(data_derived_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a>figures_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"figures"</span>, <span class="st">"stan"</span>)</span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>tables_eda_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>,<span class="st">"tables"</span>, <span class="st">"stan"</span>)</span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(figures_eda_dir)) <span class="fu">dir.create</span>(figures_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(tables_eda_dir)) <span class="fu">dir.create</span>(tables_eda_dir, <span class="at">recursive =</span> T)</span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35\^{\circ}C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient.</span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>The values of molecular mass MM were added to the dataset. They were calculated using <span class="co">[</span><span class="ot">ACD/Labs program</span><span class="co">](www.acdlabs.com)</span> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8. The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load data</span></span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir, <span class="st">"database_logk_1026.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"database_logk_1026_analyte_names.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"smiles1026.smi"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a><span class="co"># functional_groups = read.csv(here(data_deliv_dir, 'checkmol_functional_groups.csv'))</span></span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a><span class="co"># functional_groups_names = read.csv(here(data_deliv_dir,'checkmol_functional_group_names.csv'))</span></span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">'ACD_pKas.csv'</span>))</span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(data_deliv_dir,<span class="st">"pH.csv"</span>),<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(logP_ACD)</span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>MW <span class="ot">=</span>data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(MW_ACD)</span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>logP[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(data_ACD<span class="sc">$</span>logP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a><span class="co"># results = read.csv(file = here(data_deliv_dir,"results_table_max_frag_size.csv"), header = TRUE)</span></span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_table = read.csv(file = here(data_deliv_dir,"comparison_table.csv"), header = TRUE)</span></span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_table_add = read.csv(file = here(data_deliv_dir,"comparison_table_add.csv"), header = TRUE)</span></span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison_table_remove = read.csv(file = here(data_deliv_dir,"comparison_table_remove.csv"), header = TRUE)</span></span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a>fg_df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a>fg_df_common1 <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups_common1.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a>fg_df_common2 <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"smarts_functional_groups_common2.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a>descriptor_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">here</span>(data_deliv_dir,<span class="st">"descriptor_df.csv"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a>smiles<span class="ot">&lt;-</span>smiles <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ID=</span>V2,<span class="at">smiles=</span>V1) <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID,smiles)</span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">905</span>] <span class="ot">=</span> <span class="st">"CN(C1CCCCC1N1CCCC1)C(=O)Cc1ccc(c(c1)Cl)Cl"</span> <span class="co"># remove tartrate moiety </span></span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">425</span>] <span class="ot">=</span> <span class="st">"CC(Cc1ccc(cc1)OCC(=O)O)NCC(c1cccc(c1)Cl)O"</span> <span class="co"># remove Na+ and dissociation</span></span>
<span id="cb72-111"><a href="#cb72-111" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">501</span>] <span class="ot">=</span> <span class="st">"c1ccc(cc1)C1(c2ccccc2)C(=O)NC(=N1)O"</span></span>
<span id="cb72-112"><a href="#cb72-112" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">401</span>]<span class="ot">=</span> <span class="st">"CC(C)(C)c1c(CC(C(=O)[OH])[NH2])c(=O)[nH]o1"</span></span>
<span id="cb72-113"><a href="#cb72-113" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">686</span>] <span class="ot">=</span> <span class="st">"CCCCCCCCCCCCCCCC(=O)OC(CC(=O)[OH])C[N+](C)(C)C"</span></span>
<span id="cb72-114"><a href="#cb72-114" aria-hidden="true" tabindex="-1"></a>smiles<span class="sc">$</span>smiles[<span class="dv">901</span>] <span class="ot">=</span> <span class="st">"CCOC(=Nc1c[n+](no1)N1CCOCC1)[OH]"</span></span>
<span id="cb72-115"><a href="#cb72-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-116"><a href="#cb72-116" aria-hidden="true" tabindex="-1"></a>analytes_names<span class="sc">$</span>Analyte <span class="ot">&lt;-</span> <span class="fu">iconv</span>(analytes_names<span class="sc">$</span>Analyte, <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">"byte"</span>)</span>
<span id="cb72-117"><a href="#cb72-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-118"><a href="#cb72-118" aria-hidden="true" tabindex="-1"></a><span class="co"># functional_groups_lf = functional_groups %&gt;%</span></span>
<span id="cb72-119"><a href="#cb72-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(ID = 1:n(), .before = "cation")%&gt;%</span></span>
<span id="cb72-120"><a href="#cb72-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cation:last_col(), values_to = "Ngroups", names_to = c("fgrp")) %&gt;%</span></span>
<span id="cb72-121"><a href="#cb72-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Ngroups&gt;0)</span></span>
<span id="cb72-122"><a href="#cb72-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-123"><a href="#cb72-123" aria-hidden="true" tabindex="-1"></a>dissociated_groups <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb72-124"><a href="#cb72-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Anions</span></span>
<span id="cb72-125"><a href="#cb72-125" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sulfonic_acid"</span>, <span class="st">"Sulfinic_acid"</span>, <span class="st">"Sulfenic_acid"</span>, <span class="st">"Sulfuric_acid"</span>, <span class="st">"Sulfuric_monoester"</span>,</span>
<span id="cb72-126"><a href="#cb72-126" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonic_acid"</span>, <span class="st">"Phosphoric_acid"</span>, <span class="st">"Phosphoric_monoester"</span>, <span class="st">"Phosphinic_acid"</span>,</span>
<span id="cb72-127"><a href="#cb72-127" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Phosphonous_acid"</span>, <span class="st">"Phosphinous_acid"</span>, <span class="st">"Carbothioic_acid"</span>, <span class="st">"Carbodithioic_acid"</span>,</span>
<span id="cb72-128"><a href="#cb72-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cations</span></span>
<span id="cb72-129"><a href="#cb72-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Primary_aliph_amine"</span>, <span class="st">"Secondary_aliph_amine"</span>, <span class="st">"Tertiary_aliph_amine"</span>, </span>
<span id="cb72-130"><a href="#cb72-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Quaternary_aliph_ammonium"</span>, <span class="st">"Primary_arom_amine"</span>, <span class="st">"Secondary_arom_amine"</span>, </span>
<span id="cb72-131"><a href="#cb72-131" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_arom_amine"</span>, <span class="st">"Quaternary_arom_ammonium"</span>, <span class="st">"Secondary_mixed_amine"</span>, </span>
<span id="cb72-132"><a href="#cb72-132" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tertiary_mixed_amine"</span>, <span class="st">"Quaternary_mixed_ammonium"</span>, <span class="st">"Oxonium"</span>, </span>
<span id="cb72-133"><a href="#cb72-133" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Immonium"</span>, <span class="st">"Sulfonium"</span>, <span class="st">"Phosphonium"</span>, <span class="st">"Hetero_N_basic_H"</span>, <span class="st">"Hetero_N_basic_no_H"</span>, <span class="st">"Guanidine"</span>, <span class="st">"Hydrazine"</span>, <span class="st">"Hydroxylamine"</span>, </span>
<span id="cb72-134"><a href="#cb72-134" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diazonium"</span>, <span class="st">"N-Oxide"</span></span>
<span id="cb72-135"><a href="#cb72-135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-136"><a href="#cb72-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-137"><a href="#cb72-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-138"><a href="#cb72-138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prepare data</span></span>
<span id="cb72-139"><a href="#cb72-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prepare-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb72-140"><a href="#cb72-140" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb72-141"><a href="#cb72-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb72-142"><a href="#cb72-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb72-143"><a href="#cb72-143" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb72-144"><a href="#cb72-144" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb72-145"><a href="#cb72-145" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb72-146"><a href="#cb72-146" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb72-147"><a href="#cb72-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-148"><a href="#cb72-148" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> fg_df<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.) <span class="sc">||</span> <span class="sc">!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-149"><a href="#cb72-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id1,<span class="sc">-</span>id2,<span class="sc">-</span>SMILES, <span class="sc">-</span>Anion, <span class="sc">-</span>Kation,<span class="sc">-</span>Ammonium )</span>
<span id="cb72-150"><a href="#cb72-150" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> <span class="fu">colnames</span>(functional_groups)</span>
<span id="cb72-151"><a href="#cb72-151" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb72-152"><a href="#cb72-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-153"><a href="#cb72-153" aria-hidden="true" tabindex="-1"></a>dissociation <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb72-154"><a href="#cb72-154" aria-hidden="true" tabindex="-1"></a><span class="at">pKaslit =</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>],           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb72-155"><a href="#cb72-155" aria-hidden="true" tabindex="-1"></a><span class="at">pKasliterror =</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>],    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb72-156"><a href="#cb72-156" aria-hidden="true" tabindex="-1"></a><span class="at">chargesA =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>]),    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb72-157"><a href="#cb72-157" aria-hidden="true" tabindex="-1"></a><span class="at">chargesB =</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>]))   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb72-158"><a href="#cb72-158" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>charges <span class="ot">=</span> dissociation<span class="sc">$</span>chargesA<span class="sc">+</span>dissociation<span class="sc">$</span>chargesB                  <span class="co"># absolute charge</span></span>
<span id="cb72-159"><a href="#cb72-159" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsA <span class="ot">=</span> (dissociation<span class="sc">$</span>chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb72-160"><a href="#cb72-160" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groupsB <span class="ot">=</span> <span class="sc">-</span>(dissociation<span class="sc">$</span>chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>dissociation<span class="sc">$</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb72-161"><a href="#cb72-161" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># number of dissociation steps</span></span>
<span id="cb72-162"><a href="#cb72-162" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>groups <span class="ot">=</span> dissociation<span class="sc">$</span>groupsB<span class="sc">-</span>dissociation<span class="sc">$</span>groupsA</span>
<span id="cb72-163"><a href="#cb72-163" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>logPobs <span class="ot">=</span>data_ACD<span class="sc">$</span>logP</span>
<span id="cb72-164"><a href="#cb72-164" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>MW <span class="ot">=</span>data_ACD<span class="sc">$</span>MW</span>
<span id="cb72-165"><a href="#cb72-165" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb72-166"><a href="#cb72-166" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb72-167"><a href="#cb72-167" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsA)</span>
<span id="cb72-168"><a href="#cb72-168" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitA<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsA]</span>
<span id="cb72-169"><a href="#cb72-169" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb72-170"><a href="#cb72-170" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(dissociation<span class="sc">$</span>groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb72-171"><a href="#cb72-171" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dissociation<span class="sc">$</span>idxGroupsB)</span>
<span id="cb72-172"><a href="#cb72-172" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>pKaslitB<span class="ot">&lt;-</span>dissociation<span class="sc">$</span>pKaslit[dissociation<span class="sc">$</span>idxGroupsB]</span>
<span id="cb72-173"><a href="#cb72-173" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb72-174"><a href="#cb72-174" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesA[,<span class="dv">1</span>]</span>
<span id="cb72-175"><a href="#cb72-175" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span> dissociation<span class="sc">$</span>chargesB[,<span class="fu">max</span>(dissociation<span class="sc">$</span>R)]</span>
<span id="cb72-176"><a href="#cb72-176" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb72-177"><a href="#cb72-177" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(dissociation<span class="sc">$</span>chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb72-178"><a href="#cb72-178" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxA0)</span>
<span id="cb72-179"><a href="#cb72-179" aria-hidden="true" tabindex="-1"></a>dissociation<span class="sc">$</span>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(dissociation<span class="sc">$</span>idxB0)</span>
<span id="cb72-180"><a href="#cb72-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-181"><a href="#cb72-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-182"><a href="#cb72-182" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial estimates</span></span>
<span id="cb72-183"><a href="#cb72-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb72-184"><a href="#cb72-184" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb72-185"><a href="#cb72-185" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb72-186"><a href="#cb72-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-187"><a href="#cb72-187" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb72-188"><a href="#cb72-188" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb72-189"><a href="#cb72-189" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb72-190"><a href="#cb72-190" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb72-191"><a href="#cb72-191" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb72-192"><a href="#cb72-192" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb72-193"><a href="#cb72-193" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-194"><a href="#cb72-194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-195"><a href="#cb72-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-196"><a href="#cb72-196" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb72-197"><a href="#cb72-197" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb72-198"><a href="#cb72-198" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb72-199"><a href="#cb72-199" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb72-200"><a href="#cb72-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-201"><a href="#cb72-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-202"><a href="#cb72-202" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data analysis</span></span>
<span id="cb72-203"><a href="#cb72-203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb72-204"><a href="#cb72-204" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a ...</span>
<span id="cb72-205"><a href="#cb72-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-206"><a href="#cb72-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-207"><a href="#cb72-207" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb72-208"><a href="#cb72-208" aria-hidden="true" tabindex="-1"></a>&amp; logk_{i,j}  = logkw_{i} - S_{1,i} \cdot (1 + S_{2}) \cdot \varphi_{i,j} / (1 + S_{2} \cdot \varphi_{i,j})</span>
<span id="cb72-209"><a href="#cb72-209" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-210"><a href="#cb72-210" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-211"><a href="#cb72-211" aria-hidden="true" tabindex="-1"></a>The statistical model has the following structure (hierarchical model):</span>
<span id="cb72-212"><a href="#cb72-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-213"><a href="#cb72-213" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb72-214"><a href="#cb72-214" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb72-215"><a href="#cb72-215" aria-hidden="true" tabindex="-1"></a>&amp; \log k_{obs_{i,j}} \sim student_t(\nu,logk_{i,j},\sigma) <span class="sc">\\</span></span>
<span id="cb72-216"><a href="#cb72-216" aria-hidden="true" tabindex="-1"></a>&amp; R_{i} \sim \text{MVN}(\theta_R  + \beta \cdot log P_i , \Omega) <span class="sc">\\</span></span>
<span id="cb72-217"><a href="#cb72-217" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-218"><a href="#cb72-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-219"><a href="#cb72-219" aria-hidden="true" tabindex="-1"></a>Needs improvements!! where $R_i=(logkw_{i}, S_{1,i})$ is a vector of subject-specific parameters, $logk_{i,j}$ corresponds to the above Neue equation, $MVN$ is a multivariate normal distribution, $\theta_P$ is a vector of typical values of $R_i$, $beta_R$ is a vector of slopes between $R_i$ and $logP_i$. In turn, $\sigma$ is the scale and $\Omega$ is the scale matrix for the random effects related to the residual and unexplained between-analyte variability. $\Omega$ was decomposed to:</span>
<span id="cb72-220"><a href="#cb72-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-221"><a href="#cb72-221" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-222"><a href="#cb72-222" aria-hidden="true" tabindex="-1"></a>\Omega = diag(\omega) \cdot \rho \cdot diag(\omega) </span>
<span id="cb72-223"><a href="#cb72-223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-224"><a href="#cb72-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-225"><a href="#cb72-225" aria-hidden="true" tabindex="-1"></a>where $\rho$ denotes correlation a correlation matrix and $\omega$ denotes standard deviation for between analyte variability.</span>
<span id="cb72-226"><a href="#cb72-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-227"><a href="#cb72-227" aria-hidden="true" tabindex="-1"></a><span class="fu">## Priors</span></span>
<span id="cb72-228"><a href="#cb72-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-229"><a href="#cb72-229" aria-hidden="true" tabindex="-1"></a>The priors were specified as follows:</span>
<span id="cb72-230"><a href="#cb72-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-231"><a href="#cb72-231" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb72-232"><a href="#cb72-232" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb72-233"><a href="#cb72-233" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{logkw} \sim normal(2, 4), <span class="sc">\\</span></span>
<span id="cb72-234"><a href="#cb72-234" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{S1} \sim normal(4, 2), <span class="sc">\\</span></span>
<span id="cb72-235"><a href="#cb72-235" aria-hidden="true" tabindex="-1"></a>&amp; \theta_{S2} \sim lognormal(0.693, 0.125), <span class="sc">\\</span></span>
<span id="cb72-236"><a href="#cb72-236" aria-hidden="true" tabindex="-1"></a>&amp; \nu = 7,<span class="sc">\\</span></span>
<span id="cb72-237"><a href="#cb72-237" aria-hidden="true" tabindex="-1"></a>&amp; \omega_{logkw},\omega_{S1} \sim normal_+(0, 1), <span class="sc">\\</span></span>
<span id="cb72-238"><a href="#cb72-238" aria-hidden="true" tabindex="-1"></a>&amp; \beta_{logkw} \sim  normal(0.7, 0.125), <span class="sc">\\</span></span>
<span id="cb72-239"><a href="#cb72-239" aria-hidden="true" tabindex="-1"></a>&amp; \beta_{S1} \sim  normal(0.5, 0.125), <span class="sc">\\</span></span>
<span id="cb72-240"><a href="#cb72-240" aria-hidden="true" tabindex="-1"></a>&amp; \sigma \sim normal_+(0,0.05), <span class="sc">\\</span></span>
<span id="cb72-241"><a href="#cb72-241" aria-hidden="true" tabindex="-1"></a>&amp; p(\rho) \propto LKJ(2) \cdot \Pi_u N(c_u, 0.125), <span class="sc">\\</span></span>
<span id="cb72-242"><a href="#cb72-242" aria-hidden="true" tabindex="-1"></a>&amp; c_u = <span class="co">[</span><span class="ot">0.75</span><span class="co">]</span></span>
<span id="cb72-243"><a href="#cb72-243" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-244"><a href="#cb72-244" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-245"><a href="#cb72-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-246"><a href="#cb72-246" aria-hidden="true" tabindex="-1"></a>LKJ(2) ensure that the density is uniform over correlation matrices of order 2 and u denotes the unique lower triangular elements of correlation matrix (<span class="ot">&lt;http://srmart.in/informative-priors-for-correlation-matrices-an-easy-approach/&gt;</span>)</span>
<span id="cb72-247"><a href="#cb72-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-248"><a href="#cb72-248" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb72-249"><a href="#cb72-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-250"><a href="#cb72-250" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb72-251"><a href="#cb72-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-252"><a href="#cb72-252" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb72-253"><a href="#cb72-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-254"><a href="#cb72-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-setup}</span></span>
<span id="cb72-255"><a href="#cb72-255" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb72-256"><a href="#cb72-256" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb72-257"><a href="#cb72-257" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb72-258"><a href="#cb72-258" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb72-259"><a href="#cb72-259" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb72-260"><a href="#cb72-260" aria-hidden="true" tabindex="-1"></a>nK <span class="ot">=</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb72-261"><a href="#cb72-261" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb72-262"><a href="#cb72-262" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb72-263"><a href="#cb72-263" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb72-264"><a href="#cb72-264" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb72-265"><a href="#cb72-265" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb72-266"><a href="#cb72-266" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>data_ACD<span class="sc">$</span>logP,</span>
<span id="cb72-267"><a href="#cb72-267" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nK =</span> nK,</span>
<span id="cb72-268"><a href="#cb72-268" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fgrp =</span> functional_groups[,],</span>
<span id="cb72-269"><a href="#cb72-269" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> start,</span>
<span id="cb72-270"><a href="#cb72-270" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end=</span> end,</span>
<span id="cb72-271"><a href="#cb72-271" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>logk,</span>
<span id="cb72-272"><a href="#cb72-272" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb72-273"><a href="#cb72-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-274"><a href="#cb72-274" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb72-275"><a href="#cb72-275" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb72-276"><a href="#cb72-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb72-277"><a href="#cb72-277" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb72-278"><a href="#cb72-278" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.125</span>)),</span>
<span id="cb72-279"><a href="#cb72-279" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb72-280"><a href="#cb72-280" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb72-281"><a href="#cb72-281" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb72-282"><a href="#cb72-282" aria-hidden="true" tabindex="-1"></a>          <span class="co">#param = cbind(matrix(2, 1, nrow=nSteps), matrix(5, 1, nrow=nSteps)),</span></span>
<span id="cb72-283"><a href="#cb72-283" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw,init_aprox<span class="sc">$</span>S1),</span>
<span id="cb72-284"><a href="#cb72-284" aria-hidden="true" tabindex="-1"></a>          <span class="at">pilogkw =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb72-285"><a href="#cb72-285" aria-hidden="true" tabindex="-1"></a>          <span class="at">piS1 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,nK),</span>
<span id="cb72-286"><a href="#cb72-286" aria-hidden="true" tabindex="-1"></a>          <span class="at">sdpi =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>)<span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)),</span>
<span id="cb72-287"><a href="#cb72-287" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb72-288"><a href="#cb72-288" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-289"><a href="#cb72-289" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-290"><a href="#cb72-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-291"><a href="#cb72-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-292"><a href="#cb72-292" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb72-293"><a href="#cb72-293" aria-hidden="true" tabindex="-1"></a>We compiled the model using cmdstanr:</span>
<span id="cb72-294"><a href="#cb72-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mod-settings}</span></span>
<span id="cb72-295"><a href="#cb72-295" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod2"</span></span>
<span id="cb72-296"><a href="#cb72-296" aria-hidden="true" tabindex="-1"></a>model_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">".stan"</span>)</span>
<span id="cb72-297"><a href="#cb72-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-298"><a href="#cb72-298" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb72-299"><a href="#cb72-299" aria-hidden="true" tabindex="-1"></a>mod_figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb72-300"><a href="#cb72-300" aria-hidden="true" tabindex="-1"></a>mod_tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb72-301"><a href="#cb72-301" aria-hidden="true" tabindex="-1"></a>mod_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb72-302"><a href="#cb72-302" aria-hidden="true" tabindex="-1"></a>mod_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"output"</span>)</span>
<span id="cb72-303"><a href="#cb72-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-304"><a href="#cb72-304" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_figures_dir)) <span class="fu">dir.create</span>(mod_figures_dir)</span>
<span id="cb72-305"><a href="#cb72-305" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_tabels_dir)) <span class="fu">dir.create</span>(mod_tabels_dir)</span>
<span id="cb72-306"><a href="#cb72-306" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_model_dir)) <span class="fu">dir.create</span>(mod_model_dir)</span>
<span id="cb72-307"><a href="#cb72-307" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mod_output_dir)) <span class="fu">dir.create</span>(mod_output_dir)</span>
<span id="cb72-308"><a href="#cb72-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-309"><a href="#cb72-309" aria-hidden="true" tabindex="-1"></a>modelqg_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(model_name,<span class="st">"gq"</span>)</span>
<span id="cb72-310"><a href="#cb72-310" aria-hidden="true" tabindex="-1"></a>modelqg_name_ext <span class="ot">&lt;-</span> <span class="fu">paste0</span>(modelqg_name,<span class="st">".stan"</span>)</span>
<span id="cb72-311"><a href="#cb72-311" aria-hidden="true" tabindex="-1"></a>modgq_model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name)</span>
<span id="cb72-312"><a href="#cb72-312" aria-hidden="true" tabindex="-1"></a>modgq_output_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, modelqg_name, <span class="st">"output"</span>)</span>
<span id="cb72-313"><a href="#cb72-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-314"><a href="#cb72-314" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_model_dir)) <span class="fu">dir.create</span>(modgq_model_dir)</span>
<span id="cb72-315"><a href="#cb72-315" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(modgq_output_dir)) <span class="fu">dir.create</span>(modgq_output_dir)</span>
<span id="cb72-316"><a href="#cb72-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-317"><a href="#cb72-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-318"><a href="#cb72-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-compile, eval = FALSE}</span></span>
<span id="cb72-319"><a href="#cb72-319" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(mod_model_dir, model_name_ext), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb72-320"><a href="#cb72-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-321"><a href="#cb72-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-322"><a href="#cb72-322" aria-hidden="true" tabindex="-1"></a>We used optimization for initial testing:</span>
<span id="cb72-323"><a href="#cb72-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-324"><a href="#cb72-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-optimize, eval = FALSE}</span></span>
<span id="cb72-325"><a href="#cb72-325" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb72-326"><a href="#cb72-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb72-327"><a href="#cb72-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb72-328"><a href="#cb72-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="st">"mod2-opt"</span>,</span>
<span id="cb72-329"><a href="#cb72-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb72-330"><a href="#cb72-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">1000</span></span>
<span id="cb72-331"><a href="#cb72-331" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-332"><a href="#cb72-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-333"><a href="#cb72-333" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span>
<span id="cb72-334"><a href="#cb72-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-335"><a href="#cb72-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-336"><a href="#cb72-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plots-optimize}</span></span>
<span id="cb72-337"><a href="#cb72-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-338"><a href="#cb72-338" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb72-339"><a href="#cb72-339" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-opt-1.csv"</span>)</span>
<span id="cb72-340"><a href="#cb72-340" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb72-341"><a href="#cb72-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-342"><a href="#cb72-342" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb72-343"><a href="#cb72-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-344"><a href="#cb72-344" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb72-345"><a href="#cb72-345" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb72-346"><a href="#cb72-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID),<span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-347"><a href="#cb72-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb72-348"><a href="#cb72-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb72-349"><a href="#cb72-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb72-350"><a href="#cb72-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb72-351"><a href="#cb72-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb72-352"><a href="#cb72-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte) <span class="sc">+</span></span>
<span id="cb72-353"><a href="#cb72-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb72-354"><a href="#cb72-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb72-355"><a href="#cb72-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>, </span>
<span id="cb72-356"><a href="#cb72-356" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb72-357"><a href="#cb72-357" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb72-358"><a href="#cb72-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-359"><a href="#cb72-359" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb72-360"><a href="#cb72-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-361"><a href="#cb72-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-362"><a href="#cb72-362" aria-hidden="true" tabindex="-1"></a>For local computations one can use cmdstanr:</span>
<span id="cb72-363"><a href="#cb72-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-364"><a href="#cb72-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-sample, eval = FALSE}</span></span>
<span id="cb72-365"><a href="#cb72-365" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb72-366"><a href="#cb72-366" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb72-367"><a href="#cb72-367" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> mod_output_dir,</span>
<span id="cb72-368"><a href="#cb72-368" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="st">"mod2-loc"</span>,</span>
<span id="cb72-369"><a href="#cb72-369" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb72-370"><a href="#cb72-370" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb72-371"><a href="#cb72-371" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb72-372"><a href="#cb72-372" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb72-373"><a href="#cb72-373" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb72-374"><a href="#cb72-374" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb72-375"><a href="#cb72-375" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb72-376"><a href="#cb72-376" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb72-377"><a href="#cb72-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-378"><a href="#cb72-378" aria-hidden="true" tabindex="-1"></a> fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> <span class="fu">here</span>(mod_output_dir,<span class="st">"mod2-loc.RDS"</span>))</span>
<span id="cb72-379"><a href="#cb72-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-380"><a href="#cb72-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-381"><a href="#cb72-381" aria-hidden="true" tabindex="-1"></a>We performed out computations at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>. In this case:</span>
<span id="cb72-382"><a href="#cb72-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-383"><a href="#cb72-383" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we dumped the necessary data to .json format</span>
<span id="cb72-384"><a href="#cb72-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-385"><a href="#cb72-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dump-files, eval = FALSE}</span></span>
<span id="cb72-386"><a href="#cb72-386" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-387"><a href="#cb72-387" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-388"><a href="#cb72-388" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-389"><a href="#cb72-389" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-390"><a href="#cb72-390" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-391"><a href="#cb72-391" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-392"><a href="#cb72-392" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-393"><a href="#cb72-393" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-394"><a href="#cb72-394" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(mod_model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-395"><a href="#cb72-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-396"><a href="#cb72-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-397"><a href="#cb72-397" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we run the model using the batch file:</span>
<span id="cb72-398"><a href="#cb72-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-399"><a href="#cb72-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb72-400"><a href="#cb72-400" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb72-401"><a href="#cb72-401" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb72-402"><a href="#cb72-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-403"><a href="#cb72-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-404"><a href="#cb72-404" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb72-405"><a href="#cb72-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-406"><a href="#cb72-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-load}</span></span>
<span id="cb72-407"><a href="#cb72-407" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb72-408"><a href="#cb72-408" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb72-409"><a href="#cb72-409" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb72-410"><a href="#cb72-410" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb72-411"><a href="#cb72-411" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb72-412"><a href="#cb72-412" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb72-413"><a href="#cb72-413" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb72-414"><a href="#cb72-414" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb72-415"><a href="#cb72-415" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(mod_output_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb72-416"><a href="#cb72-416" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb72-417"><a href="#cb72-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-418"><a href="#cb72-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-419"><a href="#cb72-419" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb72-420"><a href="#cb72-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-421"><a href="#cb72-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-diagnose, eval = FALSE}</span></span>
<span id="cb72-422"><a href="#cb72-422" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb72-423"><a href="#cb72-423" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(mod_output_dir)</span>
<span id="cb72-424"><a href="#cb72-424" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod2-*.csv'</span>)</span>
<span id="cb72-425"><a href="#cb72-425" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb72-426"><a href="#cb72-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-427"><a href="#cb72-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-428"><a href="#cb72-428" aria-hidden="true" tabindex="-1"></a>The diagnostics are reasonable given model complexity. Output copied here to save time:</span>
<span id="cb72-429"><a href="#cb72-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-430"><a href="#cb72-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb72-431"><a href="#cb72-431" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb72-432"><a href="#cb72-432" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb72-433"><a href="#cb72-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-434"><a href="#cb72-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-435"><a href="#cb72-435" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb72-436"><a href="#cb72-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-437"><a href="#cb72-437" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb72-438"><a href="#cb72-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-439"><a href="#cb72-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb72-440"><a href="#cb72-440" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb72-441"><a href="#cb72-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-442"><a href="#cb72-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-443"><a href="#cb72-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-444"><a href="#cb72-444" aria-hidden="true" tabindex="-1"></a><span class="fu"># Genereted quantitites</span></span>
<span id="cb72-445"><a href="#cb72-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-446"><a href="#cb72-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities, eval=FALSE}</span></span>
<span id="cb72-447"><a href="#cb72-447" aria-hidden="true" tabindex="-1"></a>mod2gq <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">here</span>(modgq_model_dir,modelqg_name_ext))</span>
<span id="cb72-448"><a href="#cb72-448" aria-hidden="true" tabindex="-1"></a>fitgq  <span class="ot">&lt;-</span> mod2gq<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb72-449"><a href="#cb72-449" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb72-450"><a href="#cb72-450" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb72-451"><a href="#cb72-451" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">8</span>,</span>
<span id="cb72-452"><a href="#cb72-452" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> modgq_output_dir,</span>
<span id="cb72-453"><a href="#cb72-453" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> modelqg_name)</span>
<span id="cb72-454"><a href="#cb72-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-455"><a href="#cb72-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-456"><a href="#cb72-456" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb72-457"><a href="#cb72-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load</span></span>
<span id="cb72-458"><a href="#cb72-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eta-load}</span></span>
<span id="cb72-459"><a href="#cb72-459" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb72-460"><a href="#cb72-460" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb72-461"><a href="#cb72-461" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb72-462"><a href="#cb72-462" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb72-463"><a href="#cb72-463" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(modgq_output_dir, <span class="st">"/"</span>,  modelqg_name, <span class="st">"-4.csv"</span>)</span>
<span id="cb72-464"><a href="#cb72-464" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb72-465"><a href="#cb72-465" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb72-466"><a href="#cb72-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-467"><a href="#cb72-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-468"><a href="#cb72-468" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trace plots</span></span>
<span id="cb72-469"><a href="#cb72-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-470"><a href="#cb72-470" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb72-471"><a href="#cb72-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-472"><a href="#cb72-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb72-473"><a href="#cb72-473" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb72-474"><a href="#cb72-474" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span>
<span id="cb72-475"><a href="#cb72-475" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"param[626,1]"</span>,<span class="st">"param[626,2]"</span>))) </span>
<span id="cb72-476"><a href="#cb72-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-477"><a href="#cb72-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-478"><a href="#cb72-478" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (figures)</span></span>
<span id="cb72-479"><a href="#cb72-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-480"><a href="#cb72-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb72-481"><a href="#cb72-481" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb72-482"><a href="#cb72-482" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span>
<span id="cb72-483"><a href="#cb72-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-484"><a href="#cb72-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-485"><a href="#cb72-485" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fits</span></span>
<span id="cb72-486"><a href="#cb72-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-487"><a href="#cb72-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-gof-plots}</span></span>
<span id="cb72-488"><a href="#cb72-488" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb72-489"><a href="#cb72-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-490"><a href="#cb72-490" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb72-491"><a href="#cb72-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb72-492"><a href="#cb72-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb72-493"><a href="#cb72-493" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb72-494"><a href="#cb72-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb72-495"><a href="#cb72-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-496"><a href="#cb72-496" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb72-497"><a href="#cb72-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-498"><a href="#cb72-498" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb72-499"><a href="#cb72-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb72-500"><a href="#cb72-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb72-501"><a href="#cb72-501" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb72-502"><a href="#cb72-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb72-503"><a href="#cb72-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-504"><a href="#cb72-504" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb72-505"><a href="#cb72-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb72-506"><a href="#cb72-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb72-507"><a href="#cb72-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb72-508"><a href="#cb72-508" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb72-509"><a href="#cb72-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb72-510"><a href="#cb72-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb72-511"><a href="#cb72-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb72-512"><a href="#cb72-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb72-513"><a href="#cb72-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-514"><a href="#cb72-514" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb72-515"><a href="#cb72-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb72-516"><a href="#cb72-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb72-517"><a href="#cb72-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb72-518"><a href="#cb72-518" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb72-519"><a href="#cb72-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb72-520"><a href="#cb72-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb72-521"><a href="#cb72-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb72-522"><a href="#cb72-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb72-523"><a href="#cb72-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-524"><a href="#cb72-524" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb72-525"><a href="#cb72-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-526"><a href="#cb72-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-527"><a href="#cb72-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-528"><a href="#cb72-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-predictions}</span></span>
<span id="cb72-529"><a href="#cb72-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-530"><a href="#cb72-530" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb72-531"><a href="#cb72-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-532"><a href="#cb72-532" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb72-533"><a href="#cb72-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-534"><a href="#cb72-534" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_ind[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb72-535"><a href="#cb72-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb72-536"><a href="#cb72-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb72-537"><a href="#cb72-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb72-538"><a href="#cb72-538" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-539"><a href="#cb72-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_ind<span class="fl">.1</span><span class="sc">-</span>sparam_ind<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb72-540"><a href="#cb72-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb72-541"><a href="#cb72-541" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb72-542"><a href="#cb72-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb72-543"><a href="#cb72-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb72-544"><a href="#cb72-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb72-545"><a href="#cb72-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb72-546"><a href="#cb72-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb72-547"><a href="#cb72-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-548"><a href="#cb72-548" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb72-549"><a href="#cb72-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-550"><a href="#cb72-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-551"><a href="#cb72-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions}</span></span>
<span id="cb72-552"><a href="#cb72-552" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb72-553"><a href="#cb72-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-554"><a href="#cb72-554" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb72-555"><a href="#cb72-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-556"><a href="#cb72-556" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(sparam_pop[i,..], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb72-557"><a href="#cb72-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb72-558"><a href="#cb72-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb72-559"><a href="#cb72-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb72-560"><a href="#cb72-560" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-561"><a href="#cb72-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logk =</span> sparam_pop<span class="fl">.1</span><span class="sc">-</span>sparam_pop<span class="fl">.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat)<span class="sc">*</span>fi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>sS2Hat<span class="sc">*</span>fi)) <span class="sc">%&gt;%</span></span>
<span id="cb72-562"><a href="#cb72-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb72-563"><a href="#cb72-563" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb72-564"><a href="#cb72-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb72-565"><a href="#cb72-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb72-566"><a href="#cb72-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb72-567"><a href="#cb72-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb72-568"><a href="#cb72-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb72-569"><a href="#cb72-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-570"><a href="#cb72-570" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb72-571"><a href="#cb72-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-572"><a href="#cb72-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-573"><a href="#cb72-573" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual Parameters and etaplots</span></span>
<span id="cb72-574"><a href="#cb72-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-575"><a href="#cb72-575" aria-hidden="true" tabindex="-1"></a>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</span>
<span id="cb72-576"><a href="#cb72-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-577"><a href="#cb72-577" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual parameters</span></span>
<span id="cb72-578"><a href="#cb72-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-579"><a href="#cb72-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iparam}</span></span>
<span id="cb72-580"><a href="#cb72-580" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb72-581"><a href="#cb72-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sparam_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-582"><a href="#cb72-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb72-583"><a href="#cb72-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb72-584"><a href="#cb72-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-585"><a href="#cb72-585" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb72-586"><a href="#cb72-586" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb72-587"><a href="#cb72-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-588"><a href="#cb72-588" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2, param1<span class="sc">-</span>param2, datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb72-589"><a href="#cb72-589" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'logka'</span>[i]), <span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb72-590"><a href="#cb72-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-591"><a href="#cb72-591" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb72-592"><a href="#cb72-592" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb72-593"><a href="#cb72-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-594"><a href="#cb72-594" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb72-595"><a href="#cb72-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-596"><a href="#cb72-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-597"><a href="#cb72-597" aria-hidden="true" tabindex="-1"></a><span class="fu">### Etas</span></span>
<span id="cb72-598"><a href="#cb72-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ieta}</span></span>
<span id="cb72-599"><a href="#cb72-599" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb72-600"><a href="#cb72-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"seta_ind"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-601"><a href="#cb72-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb72-602"><a href="#cb72-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb72-603"><a href="#cb72-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-604"><a href="#cb72-604" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[<span class="dv">1</span><span class="sc">:</span>nAnalytes]</span>
<span id="cb72-605"><a href="#cb72-605" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param<span class="sc">$</span>value[(nAnalytes<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nAnalytes)]</span>
<span id="cb72-606"><a href="#cb72-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-607"><a href="#cb72-607" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,param1<span class="sc">-</span>param2,datastruct<span class="sc">$</span>logPobs)</span>
<span id="cb72-608"><a href="#cb72-608" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkwN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1mN'</span>[i]),<span class="fu">expression</span>(<span class="st">'etalogka'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb72-609"><a href="#cb72-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-610"><a href="#cb72-610" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb72-611"><a href="#cb72-611" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))</span>
<span id="cb72-612"><a href="#cb72-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-613"><a href="#cb72-613" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb72-614"><a href="#cb72-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-615"><a href="#cb72-615" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect of functional groups</span></span>
<span id="cb72-616"><a href="#cb72-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r effect-fg-screening}</span></span>
<span id="cb72-617"><a href="#cb72-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-618"><a href="#cb72-618" aria-hidden="true" tabindex="-1"></a>valid_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(totalnrgroups <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb72-619"><a href="#cb72-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-620"><a href="#cb72-620" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">map</span>(valid_indices, <span class="cf">function</span>(i) {</span>
<span id="cb72-621"><a href="#cb72-621" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract functional group as a factor</span></span>
<span id="cb72-622"><a href="#cb72-622" aria-hidden="true" tabindex="-1"></a>  nrgroups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(functional_groups[, i])</span>
<span id="cb72-623"><a href="#cb72-623" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-624"><a href="#cb72-624" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for plotting</span></span>
<span id="cb72-625"><a href="#cb72-625" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb72-626"><a href="#cb72-626" aria-hidden="true" tabindex="-1"></a>    <span class="at">param1 =</span> param1,</span>
<span id="cb72-627"><a href="#cb72-627" aria-hidden="true" tabindex="-1"></a>    <span class="at">param2 =</span> param2,</span>
<span id="cb72-628"><a href="#cb72-628" aria-hidden="true" tabindex="-1"></a>    <span class="at">param3=</span> param1<span class="sc">-</span>param2,</span>
<span id="cb72-629"><a href="#cb72-629" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrgroups =</span> nrgroups</span>
<span id="cb72-630"><a href="#cb72-630" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-631"><a href="#cb72-631" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-632"><a href="#cb72-632" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape and create plot in one pipeline</span></span>
<span id="cb72-633"><a href="#cb72-633" aria-hidden="true" tabindex="-1"></a>  data_to_plot_fungr <span class="sc">%&gt;%</span></span>
<span id="cb72-634"><a href="#cb72-634" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(param1, param2, param3), </span>
<span id="cb72-635"><a href="#cb72-635" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"name"</span>, </span>
<span id="cb72-636"><a href="#cb72-636" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-637"><a href="#cb72-637" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">etaname =</span> <span class="fu">recode</span>(name, </span>
<span id="cb72-638"><a href="#cb72-638" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param1 =</span> <span class="st">"etalogkw"</span>, </span>
<span id="cb72-639"><a href="#cb72-639" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param2 =</span> <span class="st">"etaS"</span>,</span>
<span id="cb72-640"><a href="#cb72-640" aria-hidden="true" tabindex="-1"></a>                           <span class="at">param3 =</span> <span class="st">"etalogka"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-641"><a href="#cb72-641" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> nrgroups)) <span class="sc">+</span></span>
<span id="cb72-642"><a href="#cb72-642" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb72-643"><a href="#cb72-643" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>etaname) <span class="sc">+</span></span>
<span id="cb72-644"><a href="#cb72-644" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> functional_groups_names[i], </span>
<span id="cb72-645"><a href="#cb72-645" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Nr of functional groups"</span>, </span>
<span id="cb72-646"><a href="#cb72-646" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"eta"</span>)<span class="sc">+</span></span>
<span id="cb72-647"><a href="#cb72-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb72-648"><a href="#cb72-648" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb72-649"><a href="#cb72-649" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb72-650"><a href="#cb72-650" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb72-651"><a href="#cb72-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-652"><a href="#cb72-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-653"><a href="#cb72-653" aria-hidden="true" tabindex="-1"></a>plot_groups <span class="ot">&lt;-</span> <span class="fu">split</span>(plots, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(plots) <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb72-654"><a href="#cb72-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-655"><a href="#cb72-655" aria-hidden="true" tabindex="-1"></a><span class="co"># Print each group of up to four plots</span></span>
<span id="cb72-656"><a href="#cb72-656" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(plot_groups, <span class="cf">function</span>(group) {</span>
<span id="cb72-657"><a href="#cb72-657" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(group, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb72-658"><a href="#cb72-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb72-659"><a href="#cb72-659" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb72-660"><a href="#cb72-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-661"><a href="#cb72-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-662"><a href="#cb72-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functinoal-group-effects}</span></span>
<span id="cb72-663"><a href="#cb72-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb72-664"><a href="#cb72-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb72-665"><a href="#cb72-665" aria-hidden="true" tabindex="-1"></a>draws_df_subset <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>, <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"pilogkw"</span>,<span class="st">"piS1"</span>))</span>
<span id="cb72-666"><a href="#cb72-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-667"><a href="#cb72-667" aria-hidden="true" tabindex="-1"></a>param1<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb72-668"><a href="#cb72-668" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(pilogkw[No])<span class="sc">%&gt;%</span></span>
<span id="cb72-669"><a href="#cb72-669" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(pilogkw) <span class="sc">%&gt;%</span></span>
<span id="cb72-670"><a href="#cb72-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"pilogkw"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-671"><a href="#cb72-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>pilogkw)<span class="sc">%&gt;%</span></span>
<span id="cb72-672"><a href="#cb72-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)</span>
<span id="cb72-673"><a href="#cb72-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-674"><a href="#cb72-674" aria-hidden="true" tabindex="-1"></a>param2<span class="ot">&lt;-</span>draws_df_subset <span class="sc">%&gt;%</span></span>
<span id="cb72-675"><a href="#cb72-675" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(piS1[No])<span class="sc">%&gt;%</span></span>
<span id="cb72-676"><a href="#cb72-676" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">median_qi</span>(piS1) <span class="sc">%&gt;%</span></span>
<span id="cb72-677"><a href="#cb72-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="st">"piS1"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb72-678"><a href="#cb72-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dv=</span>piS1)<span class="sc">%&gt;%</span></span>
<span id="cb72-679"><a href="#cb72-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">functional_groups_name =</span> functional_groups_names)</span>
<span id="cb72-680"><a href="#cb72-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-681"><a href="#cb72-681" aria-hidden="true" tabindex="-1"></a>param<span class="ot">&lt;-</span><span class="fu">rbind</span>(param1,param2) </span>
<span id="cb72-682"><a href="#cb72-682" aria-hidden="true" tabindex="-1"></a>param <span class="sc">%&gt;%</span></span>
<span id="cb72-683"><a href="#cb72-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> functional_groups_name, <span class="at">x =</span> dv, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb72-684"><a href="#cb72-684" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">geom_pointinterval</span>() <span class="sc">+</span></span>
<span id="cb72-685"><a href="#cb72-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Effect"</span>, <span class="at">y=</span><span class="st">"Functional group id"</span>)<span class="sc">+</span></span>
<span id="cb72-686"><a href="#cb72-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>param)</span>
<span id="cb72-687"><a href="#cb72-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-688"><a href="#cb72-688" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session info</span></span>
<span id="cb72-689"><a href="#cb72-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-692"><a href="#cb72-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb72-693"><a href="#cb72-693" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb72-694"><a href="#cb72-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>