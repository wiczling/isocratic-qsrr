<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Wiczling*">
<meta name="dcterms.date" content="2024-02-21">

<title>QSRR revisited. Hierarchical models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mod5_files/libs/clipboard/clipboard.min.js"></script>
<script src="mod5_files/libs/quarto-html/quarto.js"></script>
<script src="mod5_files/libs/quarto-html/popper.min.js"></script>
<script src="mod5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mod5_files/libs/quarto-html/anchor.min.js"></script>
<link href="mod5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mod5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mod5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mod5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mod5_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory data analysis</a></li>
  <li><a href="#prepare-data-for-calculations" id="toc-prepare-data-for-calculations" class="nav-link" data-scroll-target="#prepare-data-for-calculations">Prepare data for calculations</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  </ul></li>
  <li><a href="#stan" id="toc-stan" class="nav-link" data-scroll-target="#stan">Stan</a>
  <ul class="collapse">
  <li><a href="#initialize-variables-and-parameters" id="toc-initialize-variables-and-parameters" class="nav-link" data-scroll-target="#initialize-variables-and-parameters">Initialize variables and parameters</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li><a href="#summary-of-model-parameters-table" id="toc-summary-of-model-parameters-table" class="nav-link" data-scroll-target="#summary-of-model-parameters-table">Summary of model parameters (table):</a></li>
  <li><a href="#trace-plots" id="toc-trace-plots" class="nav-link" data-scroll-target="#trace-plots">Trace plots</a></li>
  <li><a href="#summary-of-model-parameters-figures" id="toc-summary-of-model-parameters-figures" class="nav-link" data-scroll-target="#summary-of-model-parameters-figures">Summary of model parameters (figures)</a></li>
  </ul></li>
  <li><a href="#genereted-quantitites" id="toc-genereted-quantitites" class="nav-link" data-scroll-target="#genereted-quantitites">Genereted quantitites</a>
  <ul class="collapse">
  <li><a href="#load" id="toc-load" class="nav-link" data-scroll-target="#load">Load</a></li>
  <li><a href="#fits" id="toc-fits" class="nav-link" data-scroll-target="#fits">Fits</a></li>
  <li><a href="#individual-parameters-and-etaplots" id="toc-individual-parameters-and-etaplots" class="nav-link" data-scroll-target="#individual-parameters-and-etaplots">Individual Parameters and etaplots</a>
  <ul class="collapse">
  <li><a href="#individual-parameters" id="toc-individual-parameters" class="nav-link" data-scroll-target="#individual-parameters">Individual parameters</a></li>
  <li><a href="#etas" id="toc-etas" class="nav-link" data-scroll-target="#etas">Etas</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">QSRR revisited. Hierarchical models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paweł Wiczling* </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen.&nbsp;J. Hallera 107, 80-416 Gdańsk, Poland
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 21, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<p>The packages we will use are listed below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod5_cache/html/paths_0fd43e3ade9847512f5fd87b69fdb012">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod5"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>stanfiles_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"stanfiles"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>stan_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tabels_dir)) <span class="fu">dir.create</span>(tabels_dir)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(stanfiles_dir)) <span class="fu">dir.create</span>(stanfiles_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>We used a publicly available <a href="www.retentionprediction.org/hplc/database/">dataset</a> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35^{}C. The data were collected by Boswell et al.&nbsp;and were used to create a method to predict retention time by Back-Calculating the Gradient.</p>
<div class="cell" data-hash="mod5_cache/html/rxnsim-similarity_c02b234f47abc84e070b24aa1bc79cdd">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher to run Rxnsim (will fix later)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod5_cache/html/load-data_f7c3d78f79b1c490c559c5e1609736d1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>makeSymm <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    m[<span class="fu">upper.tri</span>(m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(m)[<span class="fu">upper.tri</span>(m)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(m)}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">makeSymm</span>(simMat)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory data analysis</h1>
<p>During the exploratory data analysis phase, we create a series of plots to better understand our data.</p>
<div class="cell" data-hash="mod5_cache/html/similarity-matrixplot_cbc7cd0595c5bcd34a1738183e9b3e97">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/similarity-matrixplot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[101:200,101:200])</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[201:300,201:300])</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[301:400,301:400])</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[401:500,401:500])</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[501:600,501:600])</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[601:700,601:700])</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[701:800,701:800])</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[801:900,801:900])</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[901:1026,901:1026])</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.95</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[selected_compounds,selected_compounds])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/similarity-matrixplot-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod5_cache/html/clusterring_07a84062672947934d41a9db7e396df0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">hclust</span>(<span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span>simMat), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/clusterring-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cut_avg <span class="ot">&lt;-</span> <span class="fu">cutree</span>(x, <span class="at">k =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod5_cache/html/raw-data_be41ea6fdc85998d9671e4e063bee7d6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/raw-data-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</p>
<div class="cell" data-hash="mod5_cache/html/pH-plot_fb20ab69da3b6fcc05019edcf8b0820f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/pH-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The values of molecular mass MM were added to the dataset. They were calculated using <a href="www.acdlabs.com">ACD/Labs program</a> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</p>
<div class="cell" data-hash="mod5_cache/html/hist-MW-logP_0b52285b6d7234c373809d611c864669">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/hist-MW-logP-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</p>
<div class="cell" data-hash="mod5_cache/html/functional-group-summary_0475c581de6bb9ed3b7c6969ef5bdc42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/functional-group-summary-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="prepare-data-for-calculations" class="level1">
<h1>Prepare data for calculations</h1>
<div class="cell" data-hash="mod5_cache/html/unnamed-chunk-1_091bd43f1dbebeb3a9189ac3e48d899c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>nSteps <span class="ot">&lt;-</span> <span class="fu">sum</span>(R<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co"># indices</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>idxch <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> nSteps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>inch <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> nAnalytes) { </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> (R[i]<span class="sc">+</span><span class="dv">1</span>)) { </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>idxch[inch,<span class="dv">1</span>] <span class="ot">=</span> i </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>idxch[inch,<span class="dv">2</span>] <span class="ot">=</span> r</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>   inch<span class="ot">=</span>inch<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>     }}</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>charges_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,nSteps)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (nc <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> nSteps) { </span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>   charges_long[nc]  <span class="ot">=</span>  charges[idxch[nc,<span class="dv">1</span>],idxch[nc,<span class="dv">2</span>]];</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod5_cache/html/initial-estimates_def7b415749c1e716ca9c140d68de1bb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod5_cache/html/initial-estimates-plot_eb0bc5e62abe4f349c74043085874fef">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/initial-estimates-plot-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>The data was analyzed using a …</p>
<p><span class="math display">\[
\begin{aligned}
&amp; logk  = logk_w - S_1 \cdot (1 + S_2) \cdot \varphi / (1 + S_2 \cdot \varphi)
\end{aligned}
\]</span></p>
</section>
</section>
<section id="stan" class="level1">
<h1>Stan</h1>
<p>Multilevel modeling was performed in <a href="https://mc-stan.org/">Stan software</a> linked with R/ <a href="https://mc-stan.org/cmdstanr/">cmdstanr</a>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</p>
<section id="initialize-variables-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-variables-and-parameters">Initialize variables and parameters</h3>
<div class="cell" data-hash="mod5_cache/html/stansetup_1309194813abc6a82e66f4d7b1d8c005">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">maxR=</span><span class="fu">max</span>(R),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">R=</span>R,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nSteps =</span> nSteps,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxch =</span> idxch,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsA=</span>nGroupsA,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsB=</span>nGroupsB,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitA=</span>pKaslitA,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitB=</span>pKaslitB,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsA=</span>idxGroupsA,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsB=</span>idxGroupsB,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>data<span class="sc">$</span>logk,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nA0 =</span> nA0,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nB0 =</span> nB0,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxA0 =</span> idxA0,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxB0 =</span> idxB0,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>),</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat   =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">0.693</span>,<span class="fl">0.125</span>),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>          <span class="co">#param = cbind(matrix(2, 1, nrow=nSteps), matrix(5, 1, nrow=nSteps)),</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw[idxch[,<span class="dv">1</span>]],init_aprox<span class="sc">$</span>S1[idxch[,<span class="dv">1</span>]]),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<p>We compiled the model using cmdstanr:</p>
<div class="cell" data-hash="mod5_cache/html/stancompile_36425f362402fe9b00590132cd56e139">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(model_dir,<span class="st">".stan"</span>), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used optimization for initial testing:</p>
<div class="cell" data-hash="mod5_cache/html/stanoptimize_06fffc3d6398d30f92d4c279d4074eaf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-opt"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">5000</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="mod5_cache/html/optplots_ce9a8742d2eb5583e3bd6aa7d05b6c64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For local computations one can use cmdstanr:</p>
<div class="cell" data-hash="mod5_cache/html/stansample_9439e9cc0f38da5ec35da7af6859b011">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-loc"</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We performed out computations at the Academic Computer Center in Gdańsk, <a href="https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/">Tryton Cluster</a>. In this case:</p>
<ol type="1">
<li>we dumped the necessary data to .json format</li>
</ol>
<div class="cell" data-hash="mod5_cache/html/dumpfiles_8d6c3e1efb563c81409c82f430735ef2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>we run the model using the batch file:</li>
</ol>
<pre> 
</pre>
<ol start="3" type="1">
<li>After calculations, we loaded the output files using cmdstanr.</li>
</ol>
<div class="cell" data-hash="mod5_cache/html/stanload_4ce386dc836859788abac2cfa60be82d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <a href="https://mc-stan.org/docs/cmdstan-guide/diagnose.html">diagnose</a></li>
</ol>
<div class="cell" data-hash="mod5_cache/html/standiagnose_95c4eaba15c349f137fde87e7c1b4f09">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(stanfiles_dir)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod1_*.csv'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The diagnostics are reasonable given model complexity. Output copied here to save time:</p>
<pre></pre>
</section>
<section id="summary-of-model-parameters-table" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-table">Summary of model parameters (table):</h2>
<p>The <a href="https://mc-stan.org/docs/cmdstan-guide/stansummary.html">stansummary</a> function was used to report summary and diagnostic statistics over model parameters.</p>
<div class="cell" data-hash="mod5_cache/html/summary_588ab429150036429861fdb21ac69818">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     variable     mean   median    sd   mad       q5      q95 rhat ess_bulk
 lp__         10902.99 10901.75 58.72 59.97 10807.60 10998.33 1.04      253
 logkwHat         2.09     2.09  0.09  0.09     1.94     2.24 1.01     2184
 S1Hat            3.52     3.52  0.08  0.08     3.39     3.66 1.01     2544
 dlogkwHat       -0.89    -0.89  0.07  0.07    -1.01    -0.76 1.02      610
 dS1Hat           0.27     0.27  0.07  0.07     0.15     0.39 1.03      207
 S2Hat            2.66     2.66  0.03  0.03     2.61     2.71 1.02      416
 beta[1]          0.87     0.87  0.03  0.03     0.83     0.91 1.00     2445
 beta[2]          0.66     0.66  0.02  0.02     0.62     0.70 1.00     1911
 omega[1]         1.65     1.65  0.04  0.04     1.58     1.71 1.01     1262
 omega[2]         1.45     1.45  0.04  0.04     1.39     1.51 1.01     1471
 rho[1,1]         1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 rho[2,1]         0.90     0.90  0.01  0.01     0.88     0.91 1.09       59
 rho[1,2]         0.90     0.90  0.01  0.01     0.88     0.91 1.09       59
 rho[2,2]         1.00     1.00  0.00  0.00     1.00     1.00   NA       NA
 sigma            0.04     0.04  0.00  0.00     0.04     0.04 1.01     1438
 param[1,1]       0.16     0.52  0.90  0.57    -1.76     1.01 1.00     3462
 param[2,1]      -0.02     0.03  0.46  0.46    -0.82     0.62 1.00     3202
 param[3,1]       0.77     1.10  1.15  1.03    -1.41     2.00 1.00     3946
 param[4,1]       0.52     0.66  0.92  0.87    -1.25     1.84 1.01      793
 param[5,1]       1.69     1.71  0.15  0.06     1.54     1.81 1.01      682
 param[6,1]       1.57     1.70  1.23  1.24    -0.64     3.35 1.00     6135
 param[7,1]       4.17     4.16  0.12  0.11     3.98     4.37 1.00     6692
 param[8,1]       0.82     0.83  0.14  0.14     0.58     1.03 1.00     4885
 param[9,1]       2.47     2.46  0.11  0.11     2.28     2.66 1.00     6386
 param[10,1]      0.98     0.98  0.05  0.05     0.90     1.06 1.00     6413
 param[11,1]      4.12     4.15  1.61  1.66     1.45     6.75 1.00     7763
 param[12,1]      5.55     5.55  0.12  0.12     5.35     5.76 1.00     3878
 param[13,1]      1.28     1.28  0.08  0.08     1.15     1.42 1.01     7256
 param[14,1]      3.76     3.75  0.10  0.09     3.61     3.92 1.00     5416
 param[15,1]      1.68     1.68  0.05  0.04     1.60     1.75 1.00     8486
 param[16,1]      0.21     0.21  0.07  0.07     0.10     0.33 1.00     8837
 param[17,1]      1.62     1.62  0.08  0.08     1.50     1.76 1.00     6081
 param[18,1]      2.59     2.59  0.05  0.05     2.51     2.68 1.00     7033
 param[19,1]      0.77     0.77  0.12  0.11     0.55     0.95 1.00     6138
 param[20,1]      1.74     1.74  0.04  0.04     1.67     1.80 1.00     6329
 param[21,1]      1.74     1.74  1.58  1.66    -0.89     4.29 1.00     3142
 param[22,1]      2.19     2.20  0.08  0.06     2.06     2.30 1.00     3531
 param[23,1]      2.76     2.76  0.05  0.05     2.67     2.85 1.00     6301
 param[24,1]      2.01     2.01  0.05  0.04     1.93     2.08 1.00     5039
 param[25,1]      1.61     1.72  1.31  1.41    -0.70     3.54 1.00     5621
 param[26,1]      2.58     2.57  0.12  0.11     2.42     2.80 1.01     5789
 param[27,1]      2.14     2.14  0.05  0.05     2.06     2.22 1.00     8247
 param[28,1]      1.64     1.80  1.23  1.26    -0.60     3.36 1.00     5977
 param[29,1]      2.85     2.86  0.06  0.06     2.75     2.95 1.00     6120
 param[30,1]     11.43    11.45  0.73  0.72    10.16    12.57 1.00     6832
 param[31,1]      8.03     7.99  1.64  1.67     5.37    10.72 1.00     8703
 param[32,1]      5.38     5.40  0.17  0.15     5.11     5.62 1.00     2905
 param[33,1]      3.75     3.68  1.80  1.80     0.91     6.93 1.00     3757
 param[34,1]      6.15     6.16  0.23  0.20     5.77     6.49 1.00     4435
 param[35,1]      4.05     4.01  1.74  1.70     1.23     7.02 1.00     4953
 param[36,1]      4.23     4.24  0.11  0.09     4.04     4.39 1.00     3820
 param[37,1]      2.89     2.91  1.64  1.71     0.16     5.56 1.00     4883
 param[38,1]      4.50     4.56  0.57  0.50     3.46     5.35 1.01     1040
 param[39,1]      4.71     4.82  0.70  0.33     3.41     5.41 1.00     1526
 param[40,1]      5.74     5.83  0.36  0.20     5.07     6.09 1.00     2156
 param[41,1]      3.76     3.90  1.58  1.74     1.00     6.00 1.00     2694
 param[42,1]      5.10     5.25  0.66  0.62     3.84     5.86 1.00     1336
 param[43,1]      4.81     5.28  1.53  1.06     1.57     6.57 1.01     1529
 param[44,1]      5.45     5.51  0.30  0.19     4.87     5.78 1.00     1910
 param[45,1]      4.61     4.54  1.94  2.09     1.47     7.78 1.00     1811
 param[46,1]      4.29     4.42  0.38  0.26     3.56     4.67 1.00     1442
 param[47,1]      3.79     4.36  1.69  1.56     0.61     5.75 1.00     1688
 param[48,1]      1.97     1.94  1.68  1.63    -0.83     4.71 1.00     8158
 param[49,1]      4.01     4.02  0.30  0.31     3.50     4.46 1.01     1048
 param[50,1]      5.30     5.82  1.48  0.65     1.89     6.65 1.01     1199
 param[51,1]      2.09     2.08  1.77  1.87    -0.78     5.03 1.00     5696
 param[52,1]      2.71     2.72  0.06  0.06     2.61     2.81 1.00     5871
 param[53,1]      2.29     2.71  1.33  1.17    -0.35     3.72 1.00     2216
 param[54,1]      1.71     1.73  0.08  0.07     1.55     1.82 1.00     2740
 param[55,1]      1.90     1.92  0.08  0.07     1.77     2.00 1.00     3336
 param[56,1]      0.78     1.01  0.92  0.80    -1.04     1.81 1.00     3144
 param[57,1]      2.83     2.83  0.08  0.07     2.72     2.97 1.00     6609
 param[58,1]      1.49     1.49  0.04  0.04     1.42     1.56 1.00     7447
 param[59,1]      1.80     1.80  0.04  0.04     1.73     1.87 1.00     6590
 param[60,1]      2.76     2.75  0.10  0.10     2.61     2.93 1.00     6172
 param[61,1]     -0.09     0.23  0.73  0.25    -1.66     0.47 1.00     2230
 param[62,1]      1.62     1.87  1.09  1.11    -0.41     2.79 1.00     2415
 param[63,1]      5.80     5.80  0.12  0.12     5.60     6.01 1.00     3664
 param[64,1]      2.75     2.75  0.10  0.10     2.61     2.92 1.00     6961
 param[65,1]      3.33     3.34  0.11  0.11     3.14     3.51 1.00     6004
 param[66,1]      2.14     2.26  0.48  0.10     1.40     2.40 1.01      633
 param[67,1]      2.21     2.31  0.60  0.56     1.05     3.03 1.01      575
 param[68,1]      3.18     3.18  0.08  0.08     3.05     3.32 1.00     5810
 param[69,1]      2.87     2.87  0.08  0.08     2.75     3.02 1.00     6194
 param[70,1]      3.59     3.59  0.12  0.12     3.38     3.78 1.00     6418
 param[71,1]      0.34     0.53  0.77  0.67    -1.21     1.21 1.00     3933
 param[72,1]     -0.95    -0.84  0.42  0.28    -1.79    -0.51 1.00     3997
 param[73,1]      0.36     0.54  0.71  0.61    -1.04     1.17 1.00     4169
 param[74,1]     -0.91    -0.79  0.44  0.28    -1.79    -0.47 1.00     4263
 param[75,1]      3.27     3.28  0.09  0.07     3.12     3.40 1.00     4364
 param[76,1]      1.18     1.35  1.41  1.48    -1.46     3.20 1.00     3929
 param[77,1]      2.26     2.26  0.05  0.05     2.18     2.34 1.00     5014
 param[78,1]      1.73     1.90  1.06  1.05    -0.23     3.15 1.00     4992
 param[79,1]      2.14     2.14  0.04  0.04     2.07     2.20 1.00     6425
 param[80,1]      2.88     2.87  0.08  0.08     2.75     3.03 1.00     6599
 param[81,1]      2.26     2.26  0.05  0.05     2.18     2.34 1.00     5064
 param[82,1]      1.93     2.10  0.97  0.95     0.13     3.22 1.00     4700
 param[83,1]      2.08     2.08  0.05  0.04     2.00     2.15 1.00     5591
 param[84,1]      1.93     2.06  1.14  1.13    -0.12     3.50 1.00     5148
 param[85,1]      2.65     2.65  0.05  0.05     2.57     2.73 1.00     7126
 param[86,1]      1.17     1.17  0.16  0.18     0.90     1.41 1.00     1347
 param[87,1]      2.98     3.49  1.18  0.36     0.17     3.85 1.00     1169
 param[88,1]      2.75     2.78  0.13  0.12     2.52     2.93 1.00     2194
 param[89,1]      3.44     3.99  1.77  1.69     0.07     5.36 1.00     1814
 param[90,1]      1.62     1.98  0.79  0.37    -0.08     2.28 1.00     2391
 param[91,1]      2.35     2.55  0.65  0.53     1.03     2.98 1.00     2304
 param[92,1]      3.17     3.16  0.08  0.08     3.05     3.30 1.00     5950
 param[93,1]      2.29     2.37  1.44  1.52    -0.21     4.54 1.00     6880
 param[94,1]      1.66     1.79  0.51  0.10     0.83     1.93 1.01      983
 param[95,1]      0.32     0.47  1.41  1.51    -2.30     2.29 1.01     1047
 param[96,1]      2.53     2.53  0.08  0.06     2.41     2.64 1.00     4470
 param[97,1]      1.51     1.67  1.24  1.29    -0.72     3.27 1.00     3481
 param[98,1]      7.07     7.33  1.27  0.20     5.16     7.66 1.11       46
 param[99,1]      3.01     2.87  1.96  1.82     0.06     7.21 1.10       50
 param[100,1]     2.00     2.02  0.08  0.06     1.85     2.11 1.00     3802
 param[101,1]     0.85     1.04  1.20  1.24    -1.42     2.44 1.00     3240
 param[102,1]     2.37     2.37  0.06  0.05     2.25     2.45 1.00     2756
 param[103,1]     1.40     1.56  1.24  1.29    -0.86     3.07 1.00     2456
 param[104,1]     4.14     4.19  0.27  0.26     3.67     4.48 1.01     1195
 param[105,1]     4.81     5.66  1.98  1.61     1.14     6.97 1.01     1363
 param[106,1]     1.70     1.91  0.58  0.14     0.43     2.06 1.00     1618
 param[107,1]     1.28     1.57  1.03  0.94    -0.76     2.40 1.00     1815
 param[108,1]     3.33     3.35  0.12  0.09     3.09     3.47 1.01     1645
 param[109,1]     2.58     2.64  1.81  2.32    -0.52     4.96 1.00     1753
 param[110,1]     4.59     4.60  0.18  0.18     4.28     4.89 1.00     5133
 param[111,1]     2.43     2.44  1.67  1.60    -0.37     5.21 1.00     7499
 param[112,1]     6.16     6.16  0.18  0.17     5.87     6.45 1.00     5223
 param[113,1]     2.60     2.65  0.32  0.07     2.45     2.77 1.02      465
 param[114,1]     2.37     2.51  1.11  1.14     0.33     3.96 1.01      593
 param[115,1]     3.13     3.12  0.06  0.06     3.03     3.23 1.00     5568
 param[116,1]     2.25     2.29  1.54  1.59    -0.38     4.71 1.00     6718
 param[117,1]     2.41     2.41  0.04  0.04     2.34     2.48 1.00     6217
 param[118,1]     2.74     2.75  0.14  0.10     2.54     2.93 1.00     4609
 param[119,1]     2.78     2.95  1.14  1.14     0.65     4.34 1.00     3726
 param[120,1]     2.64     2.65  0.12  0.07     2.50     2.76 1.00     4638
 param[121,1]     2.52     2.68  1.02  0.98     0.57     3.87 1.00     3823
 param[122,1]     2.65     2.65  0.09  0.06     2.53     2.77 1.00     4858
 param[123,1]     2.32     2.49  1.12  1.13     0.21     3.85 1.00     3598
 param[124,1]     3.70     3.73  0.16  0.13     3.38     3.91 1.00     2246
 param[125,1]     4.01     4.00  2.03  2.50     0.65     6.94 1.00     2088
 param[126,1]     2.64     2.65  0.16  0.06     2.51     2.77 1.01     1232
 param[127,1]     2.36     2.52  1.15  1.14     0.16     3.92 1.01     1689
 param[128,1]     3.48     3.48  0.06  0.06     3.37     3.58 1.00     4502
 param[129,1]     2.94     3.06  1.41  1.45     0.45     5.06 1.00     6398
 param[130,1]     3.48     3.48  0.06  0.06     3.38     3.59 1.00     5159
 param[131,1]     2.49     2.57  1.51  1.56    -0.11     4.80 1.00     7979
 param[132,1]     4.38     4.39  0.14  0.13     4.14     4.59 1.00     4209
 param[133,1]     1.96     1.89  1.71  1.67    -0.75     4.82 1.00     5037
 param[134,1]     4.24     4.24  0.16  0.15     3.96     4.49 1.00     5743
 param[135,1]     2.33     2.31  1.66  1.67    -0.38     5.06 1.00     7764
 param[136,1]     5.02     5.03  0.16  0.16     4.75     5.28 1.00     5120
 param[137,1]     3.74     3.73  1.68  1.67     1.03     6.51 1.00     9536
 param[138,1]     2.96     2.95  0.19  0.18     2.66     3.28 1.01      927
 param[139,1]     5.85     6.37  1.47  0.36     2.03     6.85 1.01      783
 param[140,1]     2.23     2.23  0.04  0.04     2.16     2.31 1.01     6559
 param[141,1]     0.82     0.84  0.09  0.08     0.64     0.94 1.00     2866
 param[142,1]     1.73     2.05  1.14  1.02    -0.56     3.00 1.00     2076
 param[143,1]     1.62     1.70  0.21  0.14     1.21     1.84 1.00     1847
 param[144,1]     1.81     2.28  1.39  1.25    -0.90     3.27 1.00     1748
 param[145,1]     0.22     0.26  0.16  0.14    -0.09     0.42 1.00     2779
 param[146,1]     1.31     1.68  1.11  0.88    -0.97     2.47 1.00     2270
 param[147,1]     3.01     3.01  0.06  0.06     2.91     3.10 1.00     4176
 param[148,1]     2.12     2.19  1.50  1.56    -0.44     4.45 1.00     5468
 param[149,1]    -0.39    -0.23  0.63  0.55    -1.59     0.28 1.00     3444
 param[150,1]    -0.84    -0.56  0.81  0.57    -2.52    -0.06 1.00     3846
 param[151,1]     0.70     0.94  1.15  1.17    -1.50     2.08 1.00     4441
 param[152,1]     0.08     0.08  0.08  0.08    -0.06     0.20 1.00     7243
 param[153,1]     1.42     1.43  0.09  0.09     1.25     1.54 1.00     2547
 param[154,1]     2.53     3.01  1.21  0.77    -0.07     3.69 1.00     1990
 param[155,1]    -0.13    -0.06  0.24  0.21    -0.59     0.16 1.00     2893
 param[156,1]    -0.06     0.26  0.97  0.76    -2.07     0.96 1.00     2378
 param[157,1]    -0.02    -0.05  1.70  1.74    -2.76     2.82 1.00     8278
 param[158,1]     0.94     0.94  0.06  0.05     0.85     1.03 1.00     6596
 param[159,1]     0.74     0.74  0.06  0.06     0.64     0.83 1.00     8144
 param[160,1]    -0.65    -0.59  0.51  0.54    -1.57    -0.03 1.00     2595
 param[161,1]    -0.20     0.19  0.92  0.39    -2.25     0.55 1.00     2455
 param[162,1]    -0.62    -0.61  1.69  1.81    -3.37     2.13 1.00     5435
 param[163,1]    -1.61    -1.61  1.69  1.67    -4.38     1.13 1.01     6970
 param[164,1]    -1.59    -1.54  0.97  1.08    -3.29    -0.23 1.00     2177
 param[165,1]    -0.62    -0.37  0.67  0.32    -2.08    -0.03 1.00     1825
 ess_tail
     1358
     3136
     2505
     2237
     1436
      929
     3274
     3133
     2653
     2353
       NA
      438
      438
       NA
     2652
     2929
     2733
     3316
      277
      215
     2723
     3083
     2468
     2723
     2802
     2873
     2402
     2863
     2578
     3139
     2910
     3147
     3253
     2796
     2846
     1636
     1354
     2093
     3042
     3056
     1962
     2815
     3212
     2829
     2585
     2980
     1270
     1708
     1881
     2139
     1989
     2466
      820
      543
     1677
     3460
     2212
     2828
     1752
     3294
     1937
     2833
     2775
     2518
     2240
     2713
     2743
     2883
     2091
     2512
     2787
     2835
     3111
     2638
     2751
     2230
     2937
     2429
     3188
     2986
      171
      191
     2657
     2934
     2423
     2748
     2345
     2952
     2163
     2003
     2585
     2566
     2614
     2770
     2540
     2787
     3445
     2777
     3217
     2995
     2387
     1874
     3042
     3156
     2311
     2965
     2779
     3168
      357
      657
     1703
     2362
       10
       12
     1955
     2823
     1955
     2701
     2369
     3135
      899
     1809
     1752
     3415
     2144
     2954
     2645
      113
      124
     2692
     2997
     2722
     1877
     3068
     2144
     2592
     1958
     2645
     2407
     2754
      453
      435
     2377
     3183
     2725
     3119
     1759
     1478
     2705
     2888
     2735
     2696
     1537
     1352
     2582
     2636
     2622
     2424
     3358
     2730
     2670
     2366
     2800
     2691
     3215
     3033
     2667
     3087
     2723
     2603
     2636
     2644
     2641
     2949
     3235
     2776
     3439
     2849
     2371
     1829

 # showing 180 of 27808 rows (change via 'max_rows' argument or 'cmdstanr_max_rows' option)</code></pre>
</div>
</div>
</section>
<section id="trace-plots" class="level2">
<h2 class="anchored" data-anchor-id="trace-plots">Trace plots</h2>
<p>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</p>
<div class="cell" data-hash="mod5_cache/html/trace-plots_e18a5bd125b2b33fd4fd38af324d2a26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/trace-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/trace-plots-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="summary-of-model-parameters-figures" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-model-parameters-figures">Summary of model parameters (figures)</h2>
<div class="cell" data-hash="mod5_cache/html/mcmc-intervals_be92703c51e73c1432c2af728f5c3347">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/mcmc-intervals-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/mcmc-intervals-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
</section>
<section id="genereted-quantitites" class="level1">
<h1>Genereted quantitites</h1>
<div class="cell" data-hash="mod5_cache/html/generete-quntities_df98669d97ecd6c5bc08bfe7a960365a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model_gen <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(stan_dir, <span class="st">"/"</span>, model_name, <span class="st">"-gen.stan"</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fit_gen  <span class="ot">&lt;-</span> model_gen<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-gen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="load" class="level2">
<h2 class="anchored" data-anchor-id="load">Load</h2>
<div class="cell" data-hash="mod5_cache/html/etaload_72e3d44e87d997193628e09f0cd763c1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-1.csv"</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-2.csv"</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-3.csv"</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-4.csv"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fits" class="level2">
<h2 class="anchored" data-anchor-id="fits">Fits</h2>
<div class="cell" data-hash="mod5_cache/html/ind-pop-gof-plots_a78a540fffeee56de4c6c771c8161781">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/ind-pop-gof-plots-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod5_cache/html/ind-predictions_d0fd64f7f945048b76a3a681fb16cb1b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_ind[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_ind) <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/ind-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod5_cache/html/pop-predictions_709e1237c464dfc49948880586721a42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_pop[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_pop) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/pop-predictions-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="individual-parameters-and-etaplots" class="level2">
<h2 class="anchored" data-anchor-id="individual-parameters-and-etaplots">Individual Parameters and etaplots</h2>
<p>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</p>
<section id="individual-parameters" class="level3">
<h3 class="anchored" data-anchor-id="individual-parameters">Individual parameters</h3>
<div class="cell" data-hash="mod5_cache/html/iparam-column-neutral_fe5acf539f01e3d9f22d7c4bba4e9a89">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^sparam_ind"</span>, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nSteps,]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nSteps<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nSteps),]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>charges_long</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs[idxch[,<span class="dv">1</span>]])</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/iparam-column-neutral-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section>
<section id="etas" class="level3">
<h3 class="anchored" data-anchor-id="etas">Etas</h3>
<div class="cell" data-hash="mod5_cache/html/ieta_d463aac05352b39615390d001371f90c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^seta_ind"</span>, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nSteps,]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nSteps<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nSteps),]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>charges_long</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs[idxch[,<span class="dv">1</span>]])</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mod5_files/figure-html/ieta-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell" data-hash="mod5_cache/html/info_94a5a99de0b0cee795b39d05689284f2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.3 (2022-03-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22631)

Matrix products: default

locale:
[1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
[3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
[5] LC_TIME=Polish_Poland.1250    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggcorrplot_0.1.4.1 here_1.0.1         pracma_2.4.4       reshape2_1.4.4    
 [5] GGally_2.2.0       bayesplot_1.10.0   posterior_1.5.0    dplyr_1.1.3       
 [9] tidyr_1.3.0        rstan_2.32.5       StanHeaders_2.32.5 patchwork_1.2.0   
[13] gridExtra_2.3      ggplot2_3.4.4      cmdstanr_0.5.3    

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.12          lattice_0.20-45      QuickJSR_1.0.9      
 [4] rprojroot_2.0.4      digest_0.6.34        utf8_1.2.3          
 [7] R6_2.5.1             plyr_1.8.9           backports_1.4.1     
[10] stats4_4.1.3         coda_0.19-4          evaluate_0.23       
[13] pillar_1.9.0         tidybayes_3.0.6      rlang_1.1.0         
[16] data.table_1.14.10   rstudioapi_0.15.0    checkmate_2.2.0     
[19] rmarkdown_2.25       labeling_0.4.3       textshaping_0.3.7   
[22] stringr_1.5.1        htmlwidgets_1.6.4    loo_2.6.0           
[25] munsell_0.5.0        compiler_4.1.3       xfun_0.41           
[28] pkgconfig_2.0.3      systemfonts_1.0.5    pkgbuild_1.4.3      
[31] ggstats_0.5.1        htmltools_0.5.7      tidyselect_1.2.0    
[34] tibble_3.2.1         tensorA_0.36.2       arrayhelpers_1.1-0  
[37] codetools_0.2-18     matrixStats_1.2.0    viridisLite_0.4.2   
[40] fansi_1.0.4          withr_3.0.0          ggdist_3.3.1        
[43] grid_4.1.3           distributional_0.3.2 jsonlite_1.8.8      
[46] gtable_0.3.4         lifecycle_1.0.4      magrittr_2.0.3      
[49] scales_1.3.0         RcppParallel_5.1.7   cli_3.6.1           
[52] stringi_1.8.3        farver_2.1.1         ragg_1.2.7          
[55] generics_0.1.3       vctrs_0.6.2          RColorBrewer_1.1-3  
[58] tools_4.1.3          svUnit_1.0.6         glue_1.6.2          
[61] purrr_1.0.1          abind_1.4-5          parallel_4.1.3      
[64] fastmap_1.1.1        yaml_2.3.8           inline_0.3.19       
[67] colorspace_2.0-3     knitr_1.45          </code></pre>
</div>
</div>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "QSRR revisited. Hierarchical models"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Paweł Wiczling*"</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "Department of Biopharmaceutics and Pharmacodynamics, Medical University of Gdańsk, Gen. J. Hallera 107, 80-416 Gdańsk, Poland"</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 7</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>The packages we will use are listed below.</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, message=FALSE}</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">cache=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">error=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>, <span class="at">out.width=</span><span class="st">'95%'</span>)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r paths}</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"mod5"</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="co">#' folder shortcuts:</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>figures_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"figures"</span>, model_name)</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>tabels_dir  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"deliv"</span>, <span class="st">"tables"</span>, model_name)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>model_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>stanfiles_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>, model_name, <span class="st">"stanfiles"</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>stan_dir   <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"model"</span>, <span class="st">"stan"</span>)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(figures_dir)) <span class="fu">dir.create</span>(figures_dir)</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tabels_dir)) <span class="fu">dir.create</span>(tabels_dir)</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(model_dir)) <span class="fu">dir.create</span>(model_dir)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(stanfiles_dir)) <span class="fu">dir.create</span>(stanfiles_dir)</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>We used a publicly available <span class="co">[</span><span class="ot">dataset</span><span class="co">](www.retentionprediction.org/hplc/database/)</span> that comprises the measurements of RP-HPLC retention times collected for 1026 analytes. The retention times were measured under isocratic conditions on Eclipse Plus C18 (Agilent) stationary phase with 3.5 μm particles. The experiments were conducted using a mixture of two solvents: solvent A, which was made of 0.1% formic acid in water, and solvent B, which was made of 0.1% formic acid in acetonitrile. The column temperature was set at 35\^{\circ}C. The data were collected by Boswell et al. and were used to create a method to predict retention time by Back-Calculating the Gradient.</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rxnsim-similarity, eval=FALSE}</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a><span class="co">#' R version needs to be higher to run Rxnsim (will fix later)</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a><span class="co">#' Rxnsim package</span></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">ms.compute.sim.matrix</span>(smiles<span class="sc">$</span>V1)</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(simMat,<span class="st">'../data/similarity-matrix.csv'</span>) </span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>data       <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>analytes_names  <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/database_logk_1026_analyte_names.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>smiles <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/smiles1026_kekulized.smi"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a><span class="co">#' obtained using Rxnsim package</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../data/similarity-matrix-ltri.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X)</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(simMat)<span class="ot">&lt;-</span><span class="fu">colnames</span>(simMat)</span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>makeSymm <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>    m[<span class="fu">upper.tri</span>(m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(m)[<span class="fu">upper.tri</span>(m)]</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(m)}</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>simMat <span class="ot">&lt;-</span> <span class="fu">makeSymm</span>(simMat)</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mm_group =</span><span class="fu">case_when</span>(</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"MM &lt; 200"</span>,</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"200 \u2264 MM &lt; 300"</span>,</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>             MW_ACD <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">&amp;</span> MW_ACD <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"300 \u2264 MM &lt; 400"</span>,</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>             <span class="at">.default =</span> <span class="st">"400 \u2264 MM"</span>))</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_groups.csv'</span>)</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/checkmol_functional_group_names.csv'</span>)</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="co"># combine nr of caroboxylic acid and carboxyalic acid salt functional groups</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a><span class="co"># heterocyclic compounds with more than 6 heterocycles are treated as if they have six</span></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>functional_groups[,<span class="dv">76</span>]<span class="ot">=</span>functional_groups[,<span class="dv">76</span>]<span class="sc">+</span>functional_groups[,<span class="dv">77</span>]       </span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>functional_groups[<span class="fu">which</span>(functional_groups[,<span class="dv">202</span>]<span class="sc">&gt;</span><span class="fl">5.5</span>),<span class="dv">202</span>] <span class="ot">=</span> <span class="dv">6</span>; </span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude some functional groups</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>idx_excluded <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">37</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">51</span>, <span class="dv">55</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">67</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">91</span>, <span class="dv">99</span>, <span class="dv">109</span>, <span class="dv">116</span>, <span class="dv">117</span>, <span class="dv">121</span>, <span class="dv">125</span>, <span class="dv">129</span>, <span class="dv">142</span>, <span class="dv">153</span>, <span class="dv">154</span>, <span class="dv">160</span>, <span class="dv">161</span>, <span class="dv">168</span>, <span class="dv">173</span>, <span class="dv">178</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">186</span>, <span class="dv">187</span>, <span class="dv">191</span>, <span class="dv">196</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>functional_groups_names <span class="ot">&lt;-</span> functional_groups_names[<span class="sc">-</span>idx_excluded,]</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="sc">-</span>idx_excluded]</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(idx_included)</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a><span class="co"># remove functional groups not present in the dataset:</span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>functional_groups <span class="ot">&lt;-</span> functional_groups[,<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>)]</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>functional_groups_names<span class="ot">&lt;-</span> functional_groups_names[<span class="fu">which</span>(totalnrgroups<span class="sc">!=</span><span class="dv">0</span>),]</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>totalnrgroups <span class="ot">&lt;-</span> <span class="fu">summarise_each</span>(functional_groups, <span class="fu">funs</span>(sum))</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(functional_groups)</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>data_ACD <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'../data/ACD_pKas.csv'</span>)</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>data_ACD<span class="sc">$</span>R <span class="ot">=</span> <span class="fu">rowSums</span>(data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">&lt;</span><span class="dv">14</span>) <span class="co"># No of dissociation steps</span></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory data analysis</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>During the exploratory data analysis phase, we create a series of plots to better understand our data.</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r similarity-matrixplot}</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">001</span><span class="sc">:</span><span class="dv">100</span>])</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[101:200,101:200])</span></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[201:300,201:300])</span></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[301:400,301:400])</span></span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[401:500,401:500])</span></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[501:600,501:600])</span></span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[601:700,601:700])</span></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[701:800,701:800])</span></span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[801:900,801:900])</span></span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a><span class="co"># ggcorrplot(simMat[901:1026,901:1026])</span></span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">which</span>(simMat<span class="sc">&gt;</span><span class="fl">0.95</span> <span class="sc">&amp;</span> simMat<span class="sc">!=</span><span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>pair_names <span class="ot">=</span> <span class="fu">cbind</span>(analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">1</span>])],analytes_names<span class="sc">$</span>Analyte[<span class="fu">unname</span>(x[,<span class="dv">2</span>])])</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>selected_compounds <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(x))</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(simMat[selected_compounds,selected_compounds])</span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clusterring}</span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">hclust</span>(<span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span>simMat), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a>cut_avg <span class="ot">&lt;-</span> <span class="fu">cutree</span>(x, <span class="at">k =</span> <span class="dv">15</span>)</span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw-data, message=FALSE, warning=FALSE}</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk, <span class="at">group=</span>ID)) <span class="sc">+</span> </span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span>logP_ACD)) <span class="sc">+</span> </span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mm_group, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(log<span class="sc">~</span>k[obs])) <span class="sc">+</span> </span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) </span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>The pH value of the mobile phase was verified experimentally for the purpose of this work. It equaled 2.66 with a standard deviation of 0.19 for the range of acetonitrile contents from 5 to 95%.</span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pH-plot, message=FALSE, warning=FALSE}</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a>data_pH <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/pH.csv"</span>,<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>data_pH, <span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>pH)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="st">"pH"</span>) <span class="sc">+</span> </span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">-</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(data_pH<span class="sc">$</span>pH)<span class="sc">+</span><span class="fu">sd</span>(data_pH<span class="sc">$</span>pH), <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">2.0</span>,<span class="fl">3.5</span>))</span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>The values of molecular mass MM were added to the dataset. They were calculated using <span class="co">[</span><span class="ot">ACD/Labs program</span><span class="co">](www.acdlabs.com)</span> based on the provided structures of analytes. The MM ranged from 73.09 to 656.8.</span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hist-MW-logP,message=FALSE, warning=FALSE}</span></span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>MW_ACD))<span class="sc">+</span></span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"molecular mass"</span>)<span class="sc">+</span></span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>df)<span class="sc">+</span></span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>logP_ACD))<span class="sc">+</span></span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"logP"</span>)<span class="sc">+</span></span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"count"</span>)</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a>The functional groups present in the analyzed chemical compounds are presented below, along with their frequencies</span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functional-group-summary, message=FALSE, warning=FALSE}</span></span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a>sumdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">value=</span><span class="fu">apply</span>(functional_groups,<span class="dv">2</span>,sum))</span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>key<span class="ot">=</span>functional_groups_names[,<span class="dv">2</span>]</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a>sumdata <span class="ot">&lt;-</span> sumdata[<span class="fu">order</span>(sumdata<span class="sc">$</span>value),]</span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>sumdata<span class="sc">$</span>split <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">49</span>)</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">1</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>sumdata[<span class="fu">which</span>(sumdata<span class="sc">$</span>split<span class="sc">==</span><span class="dv">2</span>),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(key, <span class="sc">+</span>value), <span class="at">y=</span>value, <span class="at">fill=</span>key)) <span class="sc">+</span></span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"gray"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>,<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the plots with a custom layout</span></span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> <span class="st">"1222"</span>)</span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prepare data for calculations</span></span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>pKaslit <span class="ot">=</span> data_ACD[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]           <span class="co"># pKa values as predicted by ACD</span></span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a>pKasliterror <span class="ot">=</span> data_ACD[,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>]    <span class="co"># pKa error as predicted by ACD</span></span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a>chargesA <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">9</span><span class="sc">:</span><span class="dv">12</span>])    <span class="co"># number of ionized groups (anions)</span></span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a>chargesB <span class="ot">=</span> <span class="fu">abs</span>(data_ACD[,<span class="dv">13</span><span class="sc">:</span><span class="dv">16</span>])   <span class="co"># number of ionized groups (cations)</span></span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a>charges <span class="ot">=</span> chargesA<span class="sc">+</span>chargesB                       <span class="co"># absolute charge</span></span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a>groupsA <span class="ot">=</span> (chargesA[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesA[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])         <span class="co"># acidic group</span></span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a>groupsB <span class="ot">=</span> <span class="sc">-</span>(chargesB[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">-</span>chargesB[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])        <span class="co"># basic group</span></span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a>R <span class="ot">=</span> data_ACD<span class="sc">$</span>R                                    <span class="co"># number of dissociation steps</span></span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> groupsB<span class="sc">-</span>groupsA</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a>logPobs <span class="ot">=</span>df<span class="sc">$</span>logP_ACD </span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a>logPobs[<span class="dv">526</span>] <span class="ot">=</span> <span class="fu">mean</span>(logPobs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a><span class="co"># identify acidic groups</span></span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a>idxGroupsA <span class="ot">&lt;-</span><span class="fu">which</span>(groupsA<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a>nGroupsA <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsA)</span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a>pKaslitA<span class="ot">&lt;-</span>pKaslit[idxGroupsA]</span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a><span class="co"># identify basic groups</span></span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a>idxGroupsB <span class="ot">&lt;-</span><span class="fu">which</span>(groupsB<span class="sc">!=</span><span class="dv">0</span>,<span class="at">arr.ind =</span> T)</span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a>nGroupsB <span class="ot">&lt;-</span> <span class="fu">nrow</span>(idxGroupsB)</span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a>pKaslitB<span class="ot">&lt;-</span>pKaslit[idxGroupsB]</span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a><span class="co"># groups dissociated in the whole pH range</span></span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a>chargesA0 <span class="ot">&lt;-</span> chargesA[,<span class="dv">1</span>]</span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a>chargesB0 <span class="ot">&lt;-</span> chargesB[,<span class="fu">max</span>(R)]</span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a>idxA0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>), <span class="fu">which</span>(chargesA0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>idxB0 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">1</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>), <span class="fu">which</span>(chargesB0<span class="sc">==</span><span class="dv">2</span>))</span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a>nA0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxA0)</span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a>nB0 <span class="ot">&lt;-</span> <span class="fu">length</span>(idxB0)</span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>ID)</span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a>nAnalytes <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID))</span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>nObs)[<span class="sc">!</span><span class="fu">duplicated</span>(data<span class="sc">$</span>ID)]</span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">c</span>(start[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>, nObs)</span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a>nSteps <span class="ot">&lt;-</span> <span class="fu">sum</span>(R<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a><span class="co"># indices</span></span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a>idxch <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> nSteps, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a>inch <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> nAnalytes) { </span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> (R[i]<span class="sc">+</span><span class="dv">1</span>)) { </span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a>idxch[inch,<span class="dv">1</span>] <span class="ot">=</span> i </span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>idxch[inch,<span class="dv">2</span>] <span class="ot">=</span> r</span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a>   inch<span class="ot">=</span>inch<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a>     }}</span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a>charges_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,nSteps)</span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (nc <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> nSteps) { </span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a>   charges_long[nc]  <span class="ot">=</span>  charges[idxch[nc,<span class="dv">1</span>],idxch[nc,<span class="dv">2</span>]];</span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates}</span></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a>initial_param <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nAnalytes,<span class="dv">3</span>)</span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nAnalytes){</span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i])<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(<span class="sc">-</span><span class="dv">16</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">0</span>)</span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">16</span></span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>    initial_param[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">polyfit</span>(data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>data<span class="sc">$</span>fi[data<span class="sc">$</span>ID<span class="sc">==</span>i]), data<span class="sc">$</span>logk[data<span class="sc">$</span>ID<span class="sc">==</span>i],<span class="dv">1</span>)</span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a>initial_param[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">logkw =</span> initial_param[,<span class="dv">2</span>])</span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>,nAnalytes)</span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>S1 <span class="ot">&lt;-</span> <span class="sc">-</span>initial_param[,<span class="dv">1</span>]<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span>)</span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesB0 <span class="ot">&lt;-</span>chargesB[,<span class="dv">2</span>]</span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a>init_aprox<span class="sc">$</span>chargesA0 <span class="ot">&lt;-</span>chargesA0</span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-estimates-plot}</span></span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a>init_aprox <span class="sc">%&gt;%</span></span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkw,<span class="at">y=</span>S1,<span class="at">color=</span><span class="fu">factor</span>(chargesB0<span class="sc">+</span>chargesA0)))<span class="sc">+</span></span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"charges"</span>)</span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a>The data was analyzed using a ...</span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a>&amp; logk  = logk_w - S_1 \cdot (1 + S_2) \cdot \varphi / (1 + S_2 \cdot \varphi)</span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stan</span></span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-338"><a href="#cb39-338" aria-hidden="true" tabindex="-1"></a>Multilevel modeling was performed in <span class="co">[</span><span class="ot">Stan software</span><span class="co">](https://mc-stan.org/)</span> linked with R/ <span class="co">[</span><span class="ot">cmdstanr</span><span class="co">](https://mc-stan.org/cmdstanr/)</span>. For the inference we used 500 iterations, 1000 warmup iterations, and 8 Markov chains. The reduce_sum function was selected to accelerate the calculations. It works by parallelizing the execution of a single Stan chain across multiple cores. Convergence diagnostics were checked using Gelman−Rubin statistics and trace plots.</span>
<span id="cb39-339"><a href="#cb39-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initialize variables and parameters</span></span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansetup}</span></span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a><span class="co"># create Stan data set:</span></span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a>datastruct <span class="ot">&lt;-</span> <span class="fu">with</span>(data,</span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">nAnalytes=</span><span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nObs=</span><span class="fu">length</span>(data<span class="sc">$</span>ID),</span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a>                       <span class="at">analyte=</span><span class="fu">match</span>(data<span class="sc">$</span>ID, <span class="fu">unique</span>(data<span class="sc">$</span>ID)),</span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fi=</span>data<span class="sc">$</span>fi,</span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logPobs=</span>logPobs, </span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a>                       <span class="at">maxR=</span><span class="fu">max</span>(R),</span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a>                       <span class="at">R=</span>R,</span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nSteps =</span> nSteps,</span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxch =</span> idxch,</span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsA=</span>nGroupsA,</span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nGroupsB=</span>nGroupsB,</span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitA=</span>pKaslitA,</span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pKaslitB=</span>pKaslitB,</span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsA=</span>idxGroupsA,</span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxGroupsB=</span>idxGroupsB,</span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logkobs=</span>data<span class="sc">$</span>logk,</span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nA0 =</span> nA0,</span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nB0 =</span> nB0,</span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxA0 =</span> idxA0,</span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a>                       <span class="at">idxB0 =</span> idxB0,</span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a>                       <span class="at">run_estimation=</span><span class="dv">1</span>))</span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the values for each variable in each chain:</span></span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(   <span class="at">logkwHat  =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a>          <span class="at">S1Hat    =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>),</span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a>          <span class="at">dlogkwHat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.125</span>),</span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a>          <span class="at">dS1Hat   =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a>          <span class="at">S2Hat =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">0.693</span>,<span class="fl">0.125</span>),</span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta  =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.5</span>),<span class="fu">c</span>(<span class="fl">0.125</span>,<span class="fl">0.5</span>)),</span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a>          <span class="at">omega =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a>          <span class="at">rho =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>),</span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a>          <span class="co">#param = cbind(matrix(2, 1, nrow=nSteps), matrix(5, 1, nrow=nSteps)),</span></span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a>          <span class="at">param =</span> <span class="fu">cbind</span>(init_aprox<span class="sc">$</span>logkw[idxch[,<span class="dv">1</span>]],init_aprox<span class="sc">$</span>S1[idxch[,<span class="dv">1</span>]]),</span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma  =</span>  <span class="fl">0.05</span><span class="sc">*</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-386"><a href="#cb39-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-387"><a href="#cb39-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting the model</span></span>
<span id="cb39-388"><a href="#cb39-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-389"><a href="#cb39-389" aria-hidden="true" tabindex="-1"></a>We compiled the model using cmdstanr:</span>
<span id="cb39-390"><a href="#cb39-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-391"><a href="#cb39-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stancompile, eval = FALSE}</span></span>
<span id="cb39-392"><a href="#cb39-392" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(model_dir,<span class="st">".stan"</span>), <span class="at">stanc_options =</span> <span class="fu">list</span>(<span class="st">"O1"</span>))</span>
<span id="cb39-393"><a href="#cb39-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-394"><a href="#cb39-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-395"><a href="#cb39-395" aria-hidden="true" tabindex="-1"></a>We used optimization for initial testing:</span>
<span id="cb39-396"><a href="#cb39-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-397"><a href="#cb39-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanoptimize, eval = FALSE}</span></span>
<span id="cb39-398"><a href="#cb39-398" aria-hidden="true" tabindex="-1"></a>fit_opt <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">optimize</span>(</span>
<span id="cb39-399"><a href="#cb39-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datastruct,</span>
<span id="cb39-400"><a href="#cb39-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb39-401"><a href="#cb39-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-opt"</span>),</span>
<span id="cb39-402"><a href="#cb39-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> init,</span>
<span id="cb39-403"><a href="#cb39-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter=</span><span class="dv">5000</span></span>
<span id="cb39-404"><a href="#cb39-404" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-405"><a href="#cb39-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-406"><a href="#cb39-406" aria-hidden="true" tabindex="-1"></a>fit_opt<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows=</span><span class="dv">100</span>)</span>
<span id="cb39-407"><a href="#cb39-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-408"><a href="#cb39-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-409"><a href="#cb39-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r optplots, eval=FALSE}</span></span>
<span id="cb39-410"><a href="#cb39-410" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>logkopt<span class="ot">&lt;-</span>fit_opt<span class="sc">$</span><span class="fu">mle</span>(<span class="st">"logkx"</span>)</span>
<span id="cb39-411"><a href="#cb39-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-412"><a href="#cb39-412" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb39-413"><a href="#cb39-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-414"><a href="#cb39-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb39-415"><a href="#cb39-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb39-416"><a href="#cb39-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logkopt)) <span class="sc">+</span> </span>
<span id="cb39-417"><a href="#cb39-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb39-418"><a href="#cb39-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\u03C6"</span>, <span class="at">y =</span> <span class="fu">expression</span>(logk)) <span class="sc">+</span> </span>
<span id="cb39-419"><a href="#cb39-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb39-420"><a href="#cb39-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb39-421"><a href="#cb39-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-422"><a href="#cb39-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-423"><a href="#cb39-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-424"><a href="#cb39-424" aria-hidden="true" tabindex="-1"></a>For local computations one can use cmdstanr:</span>
<span id="cb39-425"><a href="#cb39-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-426"><a href="#cb39-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stansample, eval = FALSE}</span></span>
<span id="cb39-427"><a href="#cb39-427" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb39-428"><a href="#cb39-428" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> datastruct,</span>
<span id="cb39-429"><a href="#cb39-429" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb39-430"><a href="#cb39-430" aria-hidden="true" tabindex="-1"></a>   <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-loc"</span>),</span>
<span id="cb39-431"><a href="#cb39-431" aria-hidden="true" tabindex="-1"></a>   <span class="at">init =</span> init,</span>
<span id="cb39-432"><a href="#cb39-432" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb39-433"><a href="#cb39-433" aria-hidden="true" tabindex="-1"></a>   <span class="at">iter_sampling =</span> <span class="dv">250</span>,</span>
<span id="cb39-434"><a href="#cb39-434" aria-hidden="true" tabindex="-1"></a>   <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb39-435"><a href="#cb39-435" aria-hidden="true" tabindex="-1"></a>   <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb39-436"><a href="#cb39-436" aria-hidden="true" tabindex="-1"></a>   <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb39-437"><a href="#cb39-437" aria-hidden="true" tabindex="-1"></a>   <span class="at">adapt_delta=</span><span class="fl">0.9</span></span>
<span id="cb39-438"><a href="#cb39-438" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb39-439"><a href="#cb39-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-440"><a href="#cb39-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-441"><a href="#cb39-441" aria-hidden="true" tabindex="-1"></a>We performed out computations at the Academic Computer Center in Gdańsk, <span class="co">[</span><span class="ot">Tryton Cluster</span><span class="co">](https://docs.task.gda.pl/kdm/zasoby-sprzetowe/tryton/)</span>. In this case:</span>
<span id="cb39-442"><a href="#cb39-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-443"><a href="#cb39-443" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we dumped the necessary data to .json format</span>
<span id="cb39-444"><a href="#cb39-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-445"><a href="#cb39-445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dumpfiles, eval = FALSE}</span></span>
<span id="cb39-446"><a href="#cb39-446" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(datastruct, <span class="fu">paste0</span>(model_dir,<span class="st">"/standata.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-447"><a href="#cb39-447" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-1.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-448"><a href="#cb39-448" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-2.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-449"><a href="#cb39-449" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-3.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-450"><a href="#cb39-450" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-4.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-451"><a href="#cb39-451" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-5.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-452"><a href="#cb39-452" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-6.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-453"><a href="#cb39-453" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-7.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-454"><a href="#cb39-454" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stan_json</span>(<span class="fu">init</span>(), <span class="fu">paste0</span>(model_dir,<span class="st">"/init-8.json"</span>), <span class="at">always_decimal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-455"><a href="#cb39-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-456"><a href="#cb39-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-457"><a href="#cb39-457" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we run the model using the batch file:</span>
<span id="cb39-458"><a href="#cb39-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-459"><a href="#cb39-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb39-460"><a href="#cb39-460" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt; </span></span>
<span id="cb39-461"><a href="#cb39-461" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb39-462"><a href="#cb39-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-463"><a href="#cb39-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-464"><a href="#cb39-464" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>After calculations, we loaded the output files using cmdstanr. </span>
<span id="cb39-465"><a href="#cb39-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-466"><a href="#cb39-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stanload}</span></span>
<span id="cb39-467"><a href="#cb39-467" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">as_cmdstan_fit</span>(<span class="fu">c</span>(</span>
<span id="cb39-468"><a href="#cb39-468" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-1.csv"</span>),</span>
<span id="cb39-469"><a href="#cb39-469" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-2.csv"</span>),</span>
<span id="cb39-470"><a href="#cb39-470" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-3.csv"</span>),</span>
<span id="cb39-471"><a href="#cb39-471" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-4.csv"</span>),</span>
<span id="cb39-472"><a href="#cb39-472" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-5.csv"</span>),</span>
<span id="cb39-473"><a href="#cb39-473" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-6.csv"</span>),</span>
<span id="cb39-474"><a href="#cb39-474" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-7.csv"</span>),</span>
<span id="cb39-475"><a href="#cb39-475" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-8.csv"</span>)</span>
<span id="cb39-476"><a href="#cb39-476" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb39-477"><a href="#cb39-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-478"><a href="#cb39-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-479"><a href="#cb39-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-480"><a href="#cb39-480" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>finally we checked the diagnostics of Monte Carlo inferences based on the Stan documentation described herein <span class="co">[</span><span class="ot">diagnose</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/diagnose.html)</span></span>
<span id="cb39-481"><a href="#cb39-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-482"><a href="#cb39-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r standiagnose, eval = FALSE}</span></span>
<span id="cb39-483"><a href="#cb39-483" aria-hidden="true" tabindex="-1"></a> <span class="co">#fit$cmdstan_diagnose()</span></span>
<span id="cb39-484"><a href="#cb39-484" aria-hidden="true" tabindex="-1"></a> <span class="fu">setwd</span>(stanfiles_dir)</span>
<span id="cb39-485"><a href="#cb39-485" aria-hidden="true" tabindex="-1"></a> str <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">cmdstan_path</span>(), <span class="st">'/bin/diagnose  mod1_*.csv'</span>)</span>
<span id="cb39-486"><a href="#cb39-486" aria-hidden="true" tabindex="-1"></a> <span class="fu">system</span>(str,<span class="at">intern=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-487"><a href="#cb39-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-488"><a href="#cb39-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-489"><a href="#cb39-489" aria-hidden="true" tabindex="-1"></a>The diagnostics are reasonable given model complexity. Output copied here to save time:</span>
<span id="cb39-490"><a href="#cb39-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-491"><a href="#cb39-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb39-492"><a href="#cb39-492" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;pre&gt;</span></span>
<span id="cb39-493"><a href="#cb39-493" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/pre&gt;</span></span>
<span id="cb39-494"><a href="#cb39-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-495"><a href="#cb39-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-496"><a href="#cb39-496" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (table):</span></span>
<span id="cb39-497"><a href="#cb39-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-498"><a href="#cb39-498" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">stansummary</span><span class="co">](https://mc-stan.org/docs/cmdstan-guide/stansummary.html)</span> function was used to report summary and diagnostic statistics over model parameters. </span>
<span id="cb39-499"><a href="#cb39-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-500"><a href="#cb39-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-501"><a href="#cb39-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary}</span></span>
<span id="cb39-502"><a href="#cb39-502" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">print</span>(<span class="at">max_rows =</span> <span class="dv">180</span>)</span>
<span id="cb39-503"><a href="#cb39-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-504"><a href="#cb39-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-505"><a href="#cb39-505" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trace plots</span></span>
<span id="cb39-506"><a href="#cb39-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-507"><a href="#cb39-507" aria-hidden="true" tabindex="-1"></a>Trace plots are time series plots of Markov chains. Here we show standard trace plots for several parameters</span>
<span id="cb39-508"><a href="#cb39-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-509"><a href="#cb39-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trace-plots, include=TRUE}</span></span>
<span id="cb39-510"><a href="#cb39-510" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>))) </span>
<span id="cb39-511"><a href="#cb39-511" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_trace</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>))) </span>
<span id="cb39-512"><a href="#cb39-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-513"><a href="#cb39-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-514"><a href="#cb39-514" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary of model parameters (figures)</span></span>
<span id="cb39-515"><a href="#cb39-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-516"><a href="#cb39-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-intervals}</span></span>
<span id="cb39-517"><a href="#cb39-517" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"logkwHat"</span>,<span class="st">"S1Hat"</span>,<span class="st">"dlogkwHat"</span>,<span class="st">"dS1Hat"</span>,<span class="st">"beta"</span>,<span class="st">"S2Hat"</span>)))</span>
<span id="cb39-518"><a href="#cb39-518" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_intervals</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">"omega"</span>,<span class="st">"rho[1,2]"</span>,<span class="st">"sigma"</span>)))</span>
<span id="cb39-519"><a href="#cb39-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-520"><a href="#cb39-520" aria-hidden="true" tabindex="-1"></a><span class="fu"># Genereted quantitites</span></span>
<span id="cb39-521"><a href="#cb39-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-522"><a href="#cb39-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generete-quntities, eval=FALSE}</span></span>
<span id="cb39-523"><a href="#cb39-523" aria-hidden="true" tabindex="-1"></a>model_gen <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">paste0</span>(stan_dir, <span class="st">"/"</span>, model_name, <span class="st">"-gen.stan"</span>))</span>
<span id="cb39-524"><a href="#cb39-524" aria-hidden="true" tabindex="-1"></a>fit_gen  <span class="ot">&lt;-</span> model_gen<span class="sc">$</span><span class="fu">generate_quantities</span>(fit,</span>
<span id="cb39-525"><a href="#cb39-525" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> datastruct,</span>
<span id="cb39-526"><a href="#cb39-526" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb39-527"><a href="#cb39-527" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb39-528"><a href="#cb39-528" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_dir =</span> stanfiles_dir,</span>
<span id="cb39-529"><a href="#cb39-529" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">output_basename =</span> <span class="fu">paste0</span>(model_name, <span class="st">"-gen"</span>))</span>
<span id="cb39-530"><a href="#cb39-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-531"><a href="#cb39-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-532"><a href="#cb39-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-533"><a href="#cb39-533" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load</span></span>
<span id="cb39-534"><a href="#cb39-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-535"><a href="#cb39-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r etaload}</span></span>
<span id="cb39-536"><a href="#cb39-536" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">read_cmdstan_csv</span>(<span class="fu">c</span>(</span>
<span id="cb39-537"><a href="#cb39-537" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-1.csv"</span>),</span>
<span id="cb39-538"><a href="#cb39-538" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-2.csv"</span>),</span>
<span id="cb39-539"><a href="#cb39-539" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-3.csv"</span>),</span>
<span id="cb39-540"><a href="#cb39-540" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(stanfiles_dir,<span class="st">"/"</span>,  model_name, <span class="st">"-gen-4.csv"</span>)</span>
<span id="cb39-541"><a href="#cb39-541" aria-hidden="true" tabindex="-1"></a>                                ))</span>
<span id="cb39-542"><a href="#cb39-542" aria-hidden="true" tabindex="-1"></a>draws_gen_df <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(x<span class="sc">$</span>generated_quantities)</span>
<span id="cb39-543"><a href="#cb39-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-544"><a href="#cb39-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-545"><a href="#cb39-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-546"><a href="#cb39-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-547"><a href="#cb39-547" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fits</span></span>
<span id="cb39-548"><a href="#cb39-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-549"><a href="#cb39-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-pop-gof-plots}</span></span>
<span id="cb39-550"><a href="#cb39-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-551"><a href="#cb39-551" aria-hidden="true" tabindex="-1"></a>results_ind <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb39-552"><a href="#cb39-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-553"><a href="#cb39-553" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_ind[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb39-554"><a href="#cb39-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb39-555"><a href="#cb39-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb39-556"><a href="#cb39-556" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_ind) <span class="sc">%&gt;%</span></span>
<span id="cb39-557"><a href="#cb39-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb39-558"><a href="#cb39-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-559"><a href="#cb39-559" aria-hidden="true" tabindex="-1"></a>results_pop <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb39-560"><a href="#cb39-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-561"><a href="#cb39-561" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(slogk_pop[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb39-562"><a href="#cb39-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>i) <span class="sc">%&gt;%</span></span>
<span id="cb39-563"><a href="#cb39-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb39-564"><a href="#cb39-564" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(<span class="at">logkpred =</span> slogk_pop) <span class="sc">%&gt;%</span></span>
<span id="cb39-565"><a href="#cb39-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)</span>
<span id="cb39-566"><a href="#cb39-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-567"><a href="#cb39-567" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb39-568"><a href="#cb39-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_ind) <span class="sc">%&gt;%</span></span>
<span id="cb39-569"><a href="#cb39-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb39-570"><a href="#cb39-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb39-571"><a href="#cb39-571" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb39-572"><a href="#cb39-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-573"><a href="#cb39-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (individual)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span></span>
<span id="cb39-574"><a href="#cb39-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb39-575"><a href="#cb39-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb39-576"><a href="#cb39-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-577"><a href="#cb39-577" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> data<span class="sc">%&gt;%</span></span>
<span id="cb39-578"><a href="#cb39-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(results_pop) <span class="sc">%&gt;%</span></span>
<span id="cb39-579"><a href="#cb39-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>logkpred, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb39-580"><a href="#cb39-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb39-581"><a href="#cb39-581" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_errorbar(aes(xmin = .lower, xmax = .upper), width=0.01)+</span></span>
<span id="cb39-582"><a href="#cb39-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-583"><a href="#cb39-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"logk (population)"</span>, <span class="at">y =</span> <span class="st">"logk (observed)"</span>) <span class="sc">+</span> </span>
<span id="cb39-584"><a href="#cb39-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb39-585"><a href="#cb39-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb39-586"><a href="#cb39-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-587"><a href="#cb39-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-588"><a href="#cb39-588" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb39-589"><a href="#cb39-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-590"><a href="#cb39-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-591"><a href="#cb39-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-592"><a href="#cb39-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-593"><a href="#cb39-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ind-predictions}</span></span>
<span id="cb39-594"><a href="#cb39-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-595"><a href="#cb39-595" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb39-596"><a href="#cb39-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-597"><a href="#cb39-597" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb39-598"><a href="#cb39-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-599"><a href="#cb39-599" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_ind[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb39-600"><a href="#cb39-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_ind) <span class="sc">%&gt;%</span></span>
<span id="cb39-601"><a href="#cb39-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb39-602"><a href="#cb39-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb39-603"><a href="#cb39-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb39-604"><a href="#cb39-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb39-605"><a href="#cb39-605" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-606"><a href="#cb39-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb39-607"><a href="#cb39-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb39-608"><a href="#cb39-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (individual)"</span>) <span class="sc">+</span></span>
<span id="cb39-609"><a href="#cb39-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb39-610"><a href="#cb39-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb39-611"><a href="#cb39-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-612"><a href="#cb39-612" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb39-613"><a href="#cb39-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-614"><a href="#cb39-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-615"><a href="#cb39-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pop-predictions}</span></span>
<span id="cb39-616"><a href="#cb39-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-617"><a href="#cb39-617" aria-hidden="true" tabindex="-1"></a>analytes_idx <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">501</span>,<span class="dv">510</span>, <span class="dv">626</span>)</span>
<span id="cb39-618"><a href="#cb39-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-619"><a href="#cb39-619" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span>draws_gen_df <span class="sc">%&gt;%</span></span>
<span id="cb39-620"><a href="#cb39-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-621"><a href="#cb39-621" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(simlogkHat_pop[a,f], sS2Hat) <span class="sc">%&gt;%</span></span>
<span id="cb39-622"><a href="#cb39-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID=</span>a,<span class="at">logk=</span>simlogkHat_pop) <span class="sc">%&gt;%</span></span>
<span id="cb39-623"><a href="#cb39-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(analytes_names) <span class="sc">%&gt;%</span></span>
<span id="cb39-624"><a href="#cb39-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> analytes_idx) <span class="sc">%&gt;%</span></span>
<span id="cb39-625"><a href="#cb39-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>), <span class="at">fi =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb39-626"><a href="#cb39-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fi, <span class="at">y =</span> logk)) <span class="sc">+</span></span>
<span id="cb39-627"><a href="#cb39-627" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">90</span>), <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-628"><a href="#cb39-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(data,ID <span class="sc">%in%</span> analytes_idx),<span class="fu">aes</span>(<span class="at">x=</span>fi, <span class="at">y=</span>logk)) <span class="sc">+</span> </span>
<span id="cb39-629"><a href="#cb39-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Analyte)<span class="sc">+</span></span>
<span id="cb39-630"><a href="#cb39-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"\u03C6"</span>, <span class="at">y=</span><span class="st">"logk (population)"</span>) <span class="sc">+</span></span>
<span id="cb39-631"><a href="#cb39-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb39-632"><a href="#cb39-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb39-633"><a href="#cb39-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-634"><a href="#cb39-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-635"><a href="#cb39-635" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb39-636"><a href="#cb39-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-637"><a href="#cb39-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-638"><a href="#cb39-638" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual Parameters and etaplots</span></span>
<span id="cb39-639"><a href="#cb39-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-640"><a href="#cb39-640" aria-hidden="true" tabindex="-1"></a>Individual parameter are the analyte-specific parameters estimated by the model. The following plots allow to assess the correlations between these parameters.</span>
<span id="cb39-641"><a href="#cb39-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-642"><a href="#cb39-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual parameters</span></span>
<span id="cb39-643"><a href="#cb39-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-644"><a href="#cb39-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iparam-column-neutral}</span></span>
<span id="cb39-645"><a href="#cb39-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-646"><a href="#cb39-646" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^sparam_ind"</span>, </span>
<span id="cb39-647"><a href="#cb39-647" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb39-648"><a href="#cb39-648" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb39-649"><a href="#cb39-649" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nSteps,]</span>
<span id="cb39-650"><a href="#cb39-650" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nSteps<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nSteps),]</span>
<span id="cb39-651"><a href="#cb39-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-652"><a href="#cb39-652" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>charges_long</span>
<span id="cb39-653"><a href="#cb39-653" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb39-654"><a href="#cb39-654" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb39-655"><a href="#cb39-655" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb39-656"><a href="#cb39-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-657"><a href="#cb39-657" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs[idxch[,<span class="dv">1</span>]])</span>
<span id="cb39-658"><a href="#cb39-658" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'logkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'S1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb39-659"><a href="#cb39-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-660"><a href="#cb39-660" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb39-661"><a href="#cb39-661" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb39-662"><a href="#cb39-662" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb39-663"><a href="#cb39-663" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-664"><a href="#cb39-664" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb39-665"><a href="#cb39-665" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb39-666"><a href="#cb39-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-667"><a href="#cb39-667" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb39-668"><a href="#cb39-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-669"><a href="#cb39-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-670"><a href="#cb39-670" aria-hidden="true" tabindex="-1"></a><span class="fu">### Etas</span></span>
<span id="cb39-671"><a href="#cb39-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-672"><a href="#cb39-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ieta}</span></span>
<span id="cb39-673"><a href="#cb39-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-674"><a href="#cb39-674" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">apply</span>(draws_gen_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(draws_gen_df) <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"^seta_ind"</span>, </span>
<span id="cb39-675"><a href="#cb39-675" aria-hidden="true" tabindex="-1"></a>                                                                          <span class="fu">names</span>(draws_gen_df), <span class="at">value =</span> <span class="cn">TRUE</span>))], <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb39-676"><a href="#cb39-676" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">melt</span>(param)</span>
<span id="cb39-677"><a href="#cb39-677" aria-hidden="true" tabindex="-1"></a>param1 <span class="ot">&lt;-</span> param[<span class="dv">1</span><span class="sc">:</span>nSteps,]</span>
<span id="cb39-678"><a href="#cb39-678" aria-hidden="true" tabindex="-1"></a>param2 <span class="ot">&lt;-</span> param[(nSteps<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>nSteps),]</span>
<span id="cb39-679"><a href="#cb39-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-680"><a href="#cb39-680" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span>charges_long</span>
<span id="cb39-681"><a href="#cb39-681" aria-hidden="true" tabindex="-1"></a>charge[charge<span class="sc">&gt;=</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb39-682"><a href="#cb39-682" aria-hidden="true" tabindex="-1"></a>charge<span class="ot">&lt;-</span><span class="fu">as.factor</span>(charge)</span>
<span id="cb39-683"><a href="#cb39-683" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(charge)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"&gt;=1"</span>)</span>
<span id="cb39-684"><a href="#cb39-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-685"><a href="#cb39-685" aria-hidden="true" tabindex="-1"></a>data_to_plot_param <span class="ot">&lt;-</span> <span class="fu">cbind</span>(param1,param2,logPobs[idxch[,<span class="dv">1</span>]])</span>
<span id="cb39-686"><a href="#cb39-686" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_to_plot_param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">'etalogkw'</span>[i]),<span class="fu">expression</span>(<span class="st">'etaS1m'</span>[i]),<span class="fu">expression</span>(<span class="st">'logP'</span>[i]))</span>
<span id="cb39-687"><a href="#cb39-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-688"><a href="#cb39-688" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggpairs</span>(<span class="fu">as.data.frame</span>(data_to_plot_param), </span>
<span id="cb39-689"><a href="#cb39-689" aria-hidden="true" tabindex="-1"></a>           <span class="at">columnLabels =</span> <span class="fu">colnames</span>(data_to_plot_param) ,</span>
<span id="cb39-690"><a href="#cb39-690" aria-hidden="true" tabindex="-1"></a>           <span class="at">labeller =</span> <span class="st">"label_parsed"</span>,</span>
<span id="cb39-691"><a href="#cb39-691" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend =</span><span class="dv">1</span>,</span>
<span id="cb39-692"><a href="#cb39-692" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">color =</span> charge, <span class="at">alpha =</span> <span class="fl">0.5</span>),</span>
<span id="cb39-693"><a href="#cb39-693" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>))<span class="sc">+</span></span>
<span id="cb39-694"><a href="#cb39-694" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_alpha</span>(<span class="at">guide =</span> <span class="st">"none"</span>)</span>
<span id="cb39-695"><a href="#cb39-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-696"><a href="#cb39-696" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb39-697"><a href="#cb39-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-698"><a href="#cb39-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-699"><a href="#cb39-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-700"><a href="#cb39-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r info}</span></span>
<span id="cb39-701"><a href="#cb39-701" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb39-702"><a href="#cb39-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>